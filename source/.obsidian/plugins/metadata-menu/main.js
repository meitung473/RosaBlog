/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getOwnPropSymbols = Object.getOwnPropertySymbols;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __propIsEnum = Object.prototype.propertyIsEnumerable;
var __objRest = (source, exclude) => {
  var target = {};
  for (var prop in source)
    if (__hasOwnProp.call(source, prop) && exclude.indexOf(prop) < 0)
      target[prop] = source[prop];
  if (source != null && __getOwnPropSymbols)
    for (var prop of __getOwnPropSymbols(source)) {
      if (exclude.indexOf(prop) < 0 && __propIsEnum.call(source, prop))
        target[prop] = source[prop];
    }
  return target;
};
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);
var __async = (__this, __arguments, generator) => {
  return new Promise((resolve, reject) => {
    var fulfilled = (value) => {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    };
    var rejected = (value) => {
      try {
        step(generator.throw(value));
      } catch (e) {
        reject(e);
      }
    };
    var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);
    step((generator = generator.apply(__this, __arguments)).next());
  });
};

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => MetadataMenu
});
module.exports = __toCommonJS(main_exports);
var import_obsidian19 = require("obsidian");

// src/settings/MetadataMenuSettingTab.ts
var import_obsidian3 = require("obsidian");

// src/settings/FieldSettingsModal.ts
var import_obsidian2 = require("obsidian");

// src/Field.ts
var Field = class {
  constructor(name = "", values = {}, id = "", isMulti = false, isCycle = false, valuesListNotePath = "") {
    this.name = name;
    this.values = values;
    this.id = id;
    this.isCycle = isCycle;
    this.isMulti = isMulti;
    this.valuesListNotePath = valuesListNotePath;
    this.insertNewValue.bind(this);
  }
  insertNewValue(value) {
    return __async(this, null, function* () {
      let newKey = 1;
      Object.keys(this.values).forEach((key) => {
        if (parseInt(key) && parseInt(key) >= newKey) {
          newKey = parseInt(key) + 1;
        }
        ;
      });
      this.values[newKey.toString()] = value;
      return newKey.toString();
    });
  }
  static copyProperty(target, source) {
    target.id = source.id;
    target.name = source.name;
    target.isCycle = source.isCycle;
    target.isMulti = source.isMulti;
    target.valuesListNotePath = source.valuesListNotePath;
    Object.keys(source.values).forEach((k) => {
      target.values[k] = source.values[k];
    });
    Object.keys(target.values).forEach((k) => {
      if (!Object.keys(source.values).includes(k)) {
        delete target.values[k];
      }
      ;
    });
  }
};
var Field_default = Field;

// src/settings/FieldSetting.ts
var import_obsidian = require("obsidian");
var FieldSetting = class extends import_obsidian.Setting {
  constructor(containerEl, property, app2, plugin) {
    super(containerEl);
    this.containerEl = containerEl;
    this.property = property;
    this.app = app2;
    this.plugin = plugin;
    this.setTextContentWithname();
    this.addEditButton();
    this.addDeleteButton();
  }
  setTextContentWithname() {
    this.infoEl.textContent = `${this.property.name}: [${Object.keys(this.property.values).map((k) => this.property.values[k]).join(", ")}]`;
  }
  addEditButton() {
    this.addButton((b) => {
      b.setIcon("pencil").setTooltip("Edit").onClick(() => {
        let modal = new FieldSettingsModal(this.app, this.plugin, this.containerEl, this, this.property);
        modal.open();
      });
    });
  }
  addDeleteButton() {
    this.addButton((b) => {
      b.setIcon("trash").setTooltip("Delete").onClick(() => {
        var _a;
        const currentExistingProperty = this.plugin.initialProperties.filter((p) => p.id == this.property.id)[0];
        if (currentExistingProperty) {
          this.plugin.initialProperties.remove(currentExistingProperty);
        }
        ;
        (_a = this.settingEl.parentElement) == null ? void 0 : _a.removeChild(this.settingEl);
        this.plugin.saveSettings();
      });
    });
  }
  static getValuesListFromNote(notePath, app2) {
    return __async(this, null, function* () {
      let values = [];
      const file = app2.vault.getAbstractFileByPath(notePath);
      if (file instanceof import_obsidian.TFile && file.extension == "md") {
        const result = yield app2.vault.read(file);
        result.split("\n").forEach((line) => {
          if (/^(.*)$/.test(line)) {
            values.push(line.trim());
          }
          ;
        });
        return values;
      } else {
        return [];
      }
      ;
    });
  }
};

// src/settings/FieldSettingsModal.ts
var FieldSettingsModal = class extends import_obsidian2.Modal {
  constructor(app2, plugin, parentSettingContainer, parentSetting, property) {
    super(app2);
    this.valuesPromptComponents = [];
    this.saved = false;
    this.new = true;
    this.plugin = plugin;
    this.parentSetting = parentSetting;
    this.initialProperty = new Field_default();
    this.parentSettingContainer = parentSettingContainer;
    if (property) {
      this.new = false;
      this.property = property;
      this.initialProperty.name = property.name;
      this.initialProperty.id = property.id;
      Object.keys(property.values).forEach((k) => {
        this.initialProperty.values[k] = property.values[k];
      });
    } else {
      let newId = 1;
      this.plugin.initialProperties.forEach((prop) => {
        if (parseInt(prop.id) && parseInt(prop.id) >= newId) {
          newId = parseInt(prop.id) + 1;
        }
        ;
      });
      this.property = new Field_default();
      this.property.id = newId.toString();
      this.initialProperty.id = newId.toString();
    }
    ;
  }
  onOpen() {
    return __async(this, null, function* () {
      if (this.property.name == "") {
        this.titleEl.setText(`Add a property and set predefined`);
      } else {
        this.titleEl.setText(`Manage settings values for ${this.property.name}`);
      }
      ;
      yield this.createForm();
    });
  }
  onClose() {
    Object.assign(this.property, this.initialProperty);
    if (!this.new && this.parentSetting) {
      this.parentSetting.infoEl.textContent = `${this.property.name}: [${Object.keys(this.property.values).map((k) => this.property.values[k]).join(", ")}]`;
    } else if (this.saved) {
      new FieldSetting(this.parentSettingContainer, this.property, this.app, this.plugin);
    }
    ;
  }
  setValueListText(header) {
    header.setText(`Preset values: ${Object.values(this.property.values).join(", ")}`);
  }
  createnameInputContainer(parentNode) {
    const propertyNameContainerLabel = parentNode.createDiv();
    propertyNameContainerLabel.setText(`Property Name:`);
    const input = new import_obsidian2.TextComponent(parentNode);
    const name = this.property.name;
    input.setValue(name);
    input.setPlaceholder("Name of the property");
    input.onChange((value) => {
      this.property.name = value;
      this.titleEl.setText(`Manage predefined values for ${this.property.name}`);
      FieldSettingsModal.removeValidationError(input);
    });
    return input;
  }
  createTogglerContainer(parentNode, label) {
    parentNode.addClass("metadata-menu-toggle");
    const propertyContainerLabel = parentNode.createDiv({ cls: "frontmatter-checkbox-toggler" });
    propertyContainerLabel.setText(label);
    const toggler = new import_obsidian2.ToggleComponent(parentNode);
    return toggler;
  }
  createListNoteContainer(parentNode) {
    const listNoteContainerLabel = parentNode.createDiv({ cls: "metadata-menu-input" });
    listNoteContainerLabel.setText(`Path of the note containing the values:`);
    const input = new import_obsidian2.TextComponent(listNoteContainerLabel);
    const listNotePath = this.property.valuesListNotePath;
    input.setValue(listNotePath);
    input.setPlaceholder("Path/of/the/note.md");
    input.onChange((value) => this.property.valuesListNotePath = value);
    return input;
  }
  removePresetValue(key) {
    let newValues = {};
    for (let _key in this.property.values) {
      if (key !== _key) {
        newValues[_key] = this.property.values[_key];
      }
      ;
    }
    ;
    this.property.values = newValues;
  }
  createValueContainer(parentNode, header, key) {
    const values = this.property.values;
    const presetValue = values[key];
    const valueContainer = parentNode.createDiv({
      cls: "metadata-menu-prompt-container"
    });
    const input = new import_obsidian2.TextComponent(valueContainer);
    input.setValue(presetValue);
    input.onChange((value) => {
      this.property.values[key] = value;
      this.setValueListText(header);
      FieldSettingsModal.removeValidationError(input);
    });
    const valueRemoveButton = new import_obsidian2.ButtonComponent(valueContainer);
    valueRemoveButton.setIcon("trash").onClick((evt) => {
      evt.preventDefault;
      this.removePresetValue(key);
      this.setValueListText(header);
      parentNode.removeChild(valueContainer);
      this.valuesPromptComponents.remove(input);
    });
    if (key != Object.keys(this.property.values)[0]) {
      const valueUpgradeButton = new import_obsidian2.ButtonComponent(valueContainer);
      valueUpgradeButton.setButtonText("\u25B2");
      valueUpgradeButton.onClick((evt) => {
        const thisValue = values[key];
        const inputIndex = this.valuesPromptComponents.indexOf(input);
        const upperComponent = inputIndex !== -1 ? this.valuesPromptComponents[inputIndex - 1] : this.valuesPromptComponents.last();
        if (upperComponent) {
          const upperValue = upperComponent.inputEl.value;
          const upperKey = Object.keys(values).filter((k) => values[k] == upperValue)[0];
          if (upperKey) {
            upperComponent.setValue(thisValue);
            values[upperKey] = thisValue;
            input.setValue(upperValue);
            values[key] = upperValue;
          }
          ;
        }
        ;
      });
    }
    ;
    return input;
  }
  createForm() {
    return __async(this, null, function* () {
      const div = this.contentEl.createDiv({
        cls: "metadata-menu-prompt-div"
      });
      const mainDiv = div.createDiv({
        cls: "metadata-menu-prompt-form"
      });
      const nameContainer = mainDiv.createDiv();
      this.namePromptComponent = this.createnameInputContainer(nameContainer);
      mainDiv.createDiv({ cls: "metadata-menu-separator" }).createEl("hr");
      const multiContainer = mainDiv.createDiv({ cls: "metadata-menu-toggle" });
      this.isMultiTogglerComponent = this.createTogglerContainer(multiContainer, "Is Multi: ");
      this.isMultiTogglerComponent.setValue(this.property.isMulti);
      this.isMultiTogglerComponent.setTooltip("Can this property have multiple values?");
      this.isMultiTogglerComponent.onChange((value) => {
        this.property.isMulti = value;
        if (this.property.isCycle && this.property.isMulti) {
          this.property.isCycle = false;
          this.isCycleTogglerComponent.setValue(false);
        }
        ;
      });
      const cycleContainer = mainDiv.createDiv();
      this.isCycleTogglerComponent = this.createTogglerContainer(cycleContainer, "Is Cycle: ");
      this.isCycleTogglerComponent.setValue(this.property.isCycle);
      this.isCycleTogglerComponent.setTooltip("Is this property's values set in cycle mode?");
      this.isCycleTogglerComponent.onChange((value) => {
        this.property.isCycle = value;
        if (this.property.isCycle && this.property.isMulti) {
          this.property.isMulti = false;
          this.isMultiTogglerComponent.setValue(false);
        }
        ;
      });
      mainDiv.createDiv({ cls: "metadata-menu-separator" }).createEl("hr");
      const listNotePathContainer = mainDiv.createDiv();
      this.createListNoteContainer(listNotePathContainer);
      mainDiv.createDiv({ cls: "metadata-menu-separator" }).createEl("hr");
      const valuesList = mainDiv.createDiv();
      const valuesListHeader = valuesList.createDiv();
      valuesListHeader.createEl("h2");
      valuesListHeader.setText(`Preset values: ${Object.values(this.property.values).join(", ")}`);
      const valuesListBody = valuesList.createDiv();
      Object.keys(this.property.values).forEach((key) => {
        this.valuesPromptComponents.push(this.createValueContainer(valuesListBody, valuesListHeader, key));
      });
      const valuesListFooter = valuesList.createDiv();
      const addValue = valuesListFooter.createEl("button");
      addValue.type = "button";
      addValue.textContent = "Add";
      addValue.onClickEvent((evt) => __async(this, null, function* () {
        evt.preventDefault;
        const newKey = yield this.property.insertNewValue("");
        this.createValueContainer(valuesListBody, valuesListHeader, newKey);
      }));
      mainDiv.createDiv({ cls: "metadata-menu-separator" }).createEl("hr");
      const footerEl = this.contentEl.createDiv();
      const footerButtons = new import_obsidian2.Setting(footerEl);
      footerButtons.addButton((b) => this.createSaveButton(b));
      footerButtons.addExtraButton((b) => this.createCancelButton(b));
    });
  }
  createSaveButton(b) {
    b.setTooltip("Save").setIcon("checkmark").onClick(() => __async(this, null, function* () {
      let error = false;
      if (/^[#>-]/.test(this.property.name)) {
        FieldSettingsModal.setValidationError(this.namePromptComponent, this.namePromptComponent.inputEl, "Property name cannot start with #, >, -");
        error = true;
      }
      ;
      if (this.property.name == "") {
        FieldSettingsModal.setValidationError(this.namePromptComponent, this.namePromptComponent.inputEl, "Property name can not be Empty");
        error = true;
      }
      ;
      this.valuesPromptComponents.forEach((input) => {
        var _a, _b, _c;
        if (/^[#>-]/.test(input.inputEl.value) && ((_a = input.inputEl.parentElement) == null ? void 0 : _a.lastElementChild)) {
          FieldSettingsModal.setValidationError(input, input.inputEl.parentElement.lastElementChild, "Values cannot cannot start with #, >, -");
          error = true;
        }
        ;
        if (/[,]/gu.test(input.inputEl.value) && ((_b = input.inputEl.parentElement) == null ? void 0 : _b.lastElementChild)) {
          FieldSettingsModal.setValidationError(input, input.inputEl.parentElement.lastElementChild, "Values cannot contain a comma");
          error = true;
        }
        ;
        if (input.inputEl.value == "" && ((_c = input.inputEl.parentElement) == null ? void 0 : _c.lastElementChild)) {
          FieldSettingsModal.setValidationError(input, input.inputEl.parentElement.lastElementChild, "Values can't be null.");
          error = true;
        }
        ;
      });
      if (error) {
        new import_obsidian2.Notice("Fix errors before saving.");
        return;
      }
      ;
      this.saved = true;
      const currentExistingProperty = this.plugin.initialProperties.filter((p) => p.id == this.property.id)[0];
      if (currentExistingProperty) {
        Field_default.copyProperty(currentExistingProperty, this.property);
      } else {
        this.plugin.initialProperties.push(this.property);
      }
      ;
      this.initialProperty = this.property;
      this.plugin.saveSettings();
      this.close();
    }));
    return b;
  }
  createCancelButton(b) {
    b.setIcon("cross").setTooltip("Cancel").onClick(() => {
      this.saved = false;
      if (this.initialProperty.name != "") {
        Object.assign(this.property, this.initialProperty);
      }
      ;
      this.close();
    });
    return b;
  }
  static setValidationError(textInput, insertAfter, message) {
    var _a;
    textInput.inputEl.addClass("is-invalid");
    if (message && ((_a = textInput.inputEl.parentElement) == null ? void 0 : _a.lastElementChild)) {
      let mDiv = textInput.inputEl.parentElement.querySelector(".invalid-feedback");
      if (!mDiv) {
        mDiv = createDiv({ cls: "invalid-feedback" });
      }
      mDiv.innerText = message;
      mDiv.insertAfter(insertAfter);
    }
  }
  static removeValidationError(textInput) {
    var _a;
    if (textInput.inputEl.hasClass("is-invalid") && ((_a = textInput.inputEl.parentElement) == null ? void 0 : _a.lastElementChild)) {
      textInput.inputEl.removeClass("is-invalid");
      textInput.inputEl.parentElement.removeChild(textInput.inputEl.parentElement.lastElementChild);
    }
    ;
  }
};

// src/settings/MetadataMenuSettingTab.ts
var SettingsMigrationConfirmModal = class extends import_obsidian3.Modal {
  constructor(plugin, tab) {
    super(plugin.app);
    this.plugin = plugin;
    this.tab = tab;
  }
  onOpen() {
    this.titleEl.setText("Confirm");
    const body = this.contentEl.createDiv({
      cls: "modal-text-danger"
    });
    body.setText("This will erase current settings. Are you sure?");
    const confirmButton = new import_obsidian3.ButtonComponent(this.contentEl);
    confirmButton.setIcon("check");
    confirmButton.onClick(() => {
      if (this.app.plugins.plugins.hasOwnProperty("supercharged-links-obsidian")) {
        let settings = this.app.plugins.plugins["supercharged-links-obsidian"].settings;
        let _settings = this.plugin.settings;
        _settings.classFilesPath = settings.classFilesPath;
        _settings.displayFieldsInContextMenu = settings.displayFieldsInContextMenu;
        _settings.getFromInlineField = settings.getFromInlineField;
        _settings.globallyIgnoredFields = settings.globallyIgnoredFields;
        this.plugin.initialProperties = [];
        settings.presetFields.forEach((prop) => {
          const property = new Field_default();
          Object.assign(property, prop);
          this.plugin.initialProperties.push(property);
        });
        this.plugin.saveSettings();
        this.close();
      }
      ;
    });
  }
  onClose() {
    this.tab.display();
  }
};
var MetadataMenuSettingTab = class extends import_obsidian3.PluginSettingTab {
  constructor(app2, plugin) {
    super(app2, plugin);
    this.plugin = plugin;
  }
  display() {
    let { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h4", { text: "Settings" });
    new import_obsidian3.Setting(containerEl).setName("Search for attribute in Inline fields like <field::>").setDesc("Sets the `data-link-<field>`-attribute to the value of inline fields").addToggle((toggle) => {
      toggle.setValue(this.plugin.settings.getFromInlineField);
      toggle.onChange((value) => __async(this, null, function* () {
        this.plugin.settings.getFromInlineField = value;
        yield this.plugin.saveSettings();
      }));
    });
    new import_obsidian3.Setting(containerEl).setName("Display field options in context menu").setDesc("Choose to show or hide fields options in the context menu of a link or a file").addToggle((toggle) => {
      toggle.setValue(this.plugin.settings.displayFieldsInContextMenu);
      toggle.onChange((value) => __async(this, null, function* () {
        this.plugin.settings.displayFieldsInContextMenu = value;
        yield this.plugin.saveSettings();
      }));
    });
    new import_obsidian3.Setting(containerEl).setName("Ignored fields").setDesc("Fields to be ignored by the plugin when adding options to the context menu").addTextArea((text) => {
      text.setPlaceholder("Enter fields as string, comma separated").setValue(this.plugin.settings.globallyIgnoredFields.join(", ")).onChange((value) => __async(this, null, function* () {
        this.plugin.settings.globallyIgnoredFields = value.replace(/\s/g, "").split(",");
        yield this.plugin.saveSettings();
      }));
      text.inputEl.rows = 6;
      text.inputEl.cols = 25;
    });
    new import_obsidian3.Setting(containerEl).setName("class Files path").setDesc("Path to the files containing the authorized fields for a type of note").addText((text) => {
      text.setPlaceholder("Path/").setValue(this.plugin.settings.classFilesPath).onChange((value) => __async(this, null, function* () {
        this.plugin.settings.classFilesPath = value;
        yield this.plugin.saveSettings();
      }));
    });
    new import_obsidian3.Setting(containerEl).setName("fileClass field alias").setDesc("Choose another name for fileClass field in frontmatter (example: Category, type, ...").addText((text) => {
      text.setValue(this.plugin.settings.fileClassAlias).onChange((value) => __async(this, null, function* () {
        this.plugin.settings.fileClassAlias = value;
        yield this.plugin.saveSettings();
      }));
    });
    new import_obsidian3.Setting(containerEl).setName("Add New Property Manager").setDesc("Add a new Frontmatter property for which you want preset values.").addButton((button) => {
      return button.setTooltip("Add New Property Manager").setButtonText("+").onClick(() => __async(this, null, function* () {
        let modal = new FieldSettingsModal(this.app, this.plugin, containerEl);
        modal.open();
      }));
    });
    this.plugin.initialProperties.forEach((prop) => {
      const property = new Field_default();
      Object.assign(property, prop);
      new FieldSetting(containerEl, property, this.app, this.plugin);
    });
    containerEl.createEl("h4", { text: "Migrate" });
    new import_obsidian3.Setting(containerEl).setName("Copy settings from supercharged links plugin").setDesc("Copy settings from supercharged links plugin").addButton((button) => {
      return button.setTooltip("Get settings from supercharged links").setButtonText("Copy").onClick(() => __async(this, null, function* () {
        let modal = new SettingsMigrationConfirmModal(this.plugin, this);
        modal.open();
      }));
    });
  }
};

// src/settings/MetadataMenuSettings.ts
var DEFAULT_SETTINGS = {
  presetFields: [],
  displayFieldsInContextMenu: true,
  globallyIgnoredFields: [],
  classFilesPath: "",
  getFromInlineField: true,
  isAutosuggestEnabled: true,
  fileClassAlias: "fileClass"
};

// src/utils/parser.ts
var fieldComponents = ["startStyle", "attribute", "endStyle", "beforeSeparatorSpacer", "afterSeparatorSpacer", "values"];
var genericFieldRegex = "(?<startStyle>[_\\*~`]*)(?<attribute>[0-9\\w\\p{Letter}\\p{Emoji_Presentation}][-0-9\\w\\p{Letter}\\p{Emoji_Presentation}\\s]*)(?<endStyle>[_\\*~`]*)(?<beforeSeparatorSpacer>\\s*)";
var inlineFieldRegex = (attribute) => new RegExp(`(?<startStyle>[_*~\`]*)(?<attribute>${attribute})(?<endStyle>[_*~\`]*)(?<beforeSeparatorSpacer>\\s*)::(?<afterSeparatorSpacer>\\s*)(?<values>.*)`, "u");

// src/commands/getValues.ts
function getValues(app2, file, attribute) {
  return __async(this, null, function* () {
    var _a;
    const content = yield (yield app2.vault.cachedRead(file)).split("\n");
    const frontmatter = (_a = this.app.metadataCache.getFileCache(file)) == null ? void 0 : _a.frontmatter;
    const { position: { start, end } } = frontmatter || null;
    const result = [];
    content.map((line, i) => {
      if (frontmatter && i >= start.line && i <= end.line) {
        const regex = new RegExp(`${attribute}:(.*)`, "u");
        const r = line.match(regex);
        if (r && r.length > 0)
          result.push(r[1]);
      } else {
        const regex = inlineFieldRegex(attribute);
        const r = line.match(regex);
        if (r == null ? void 0 : r.groups)
          result.push(r.groups.values);
      }
    });
    return result;
  });
}

// src/commands/replaceValues.ts
function replaceValues(app2, file, attribute, input) {
  return __async(this, null, function* () {
    var _a;
    const content = yield (yield app2.vault.cachedRead(file)).split("\n");
    const frontmatter = (_a = this.app.metadataCache.getFileCache(file)) == null ? void 0 : _a.frontmatter;
    const start = frontmatter ? frontmatter.position.start : null;
    const end = frontmatter ? frontmatter.position.end : null;
    const newContent = content.map((line, i) => {
      if (frontmatter && i >= start.line && i <= end.line) {
        const regex = new RegExp(`${attribute}:`, "u");
        const r = line.match(regex);
        if (r && r.length > 0) {
          const inputArray = input ? input.replace(/(\,\s+)/g, ",").split(",") : [""];
          const newValue = inputArray.length == 1 ? inputArray[0] : `[${inputArray.join(", ")}]`;
          return `${attribute}: ${newValue}`;
        } else {
          return line;
        }
      } else {
        const regex = inlineFieldRegex(attribute);
        const r = line.match(regex);
        if ((r == null ? void 0 : r.groups) && Object.keys(r.groups).every((i2) => fieldComponents.includes(i2))) {
          const { startStyle, endStyle, beforeSeparatorSpacer, afterSeparatorSpacer, values } = r.groups;
          const inputArray = input ? input.replace(/(\,\s+)/g, ",").split(",") : [""];
          const newValue = inputArray.length == 1 ? inputArray[0] : `${inputArray.join(", ")}`;
          return `${startStyle}${attribute}${endStyle}${beforeSeparatorSpacer}::${afterSeparatorSpacer}${newValue}`;
        } else {
          return line;
        }
      }
    });
    app2.vault.modify(file, newContent.join("\n"));
  });
}

// src/commands/fieldWithMenu.ts
var import_obsidian4 = require("obsidian");
function fieldWithMenu(plugin, dv, p, fieldName, attrs) {
  const fieldContainer = dv.el("div", "");
  fieldContainer.setAttr("class", "metadata-menu-dv-field-container");
  const field = dv.el("span", p[fieldName], attrs);
  const spacer = document.createElement("div");
  spacer.setAttr("class", "metadata-menu-dv-field-spacer");
  const inputContainer = document.createElement("div");
  const input = document.createElement("input");
  input.setAttr("class", "metadata-menu-dv-input");
  inputContainer.appendChild(input);
  input.value = p[fieldName];
  inputContainer.appendChild(input);
  const validateIcon = document.createElement("a");
  validateIcon.textContent = "\u2705";
  validateIcon.setAttr("class", "metadata-menu-dv-field-button");
  validateIcon.onclick = (e) => {
    const file = plugin.app.vault.getAbstractFileByPath(p["file"]["path"]);
    if (file instanceof import_obsidian4.TFile && file.extension == "md") {
      replaceValues(plugin.app, file, fieldName, input.value);
    }
    fieldContainer.removeChild(inputContainer);
  };
  inputContainer == null ? void 0 : inputContainer.appendChild(validateIcon);
  const cancelIcon = document.createElement("a");
  cancelIcon.setAttr("class", "metadata-menu-dv-field-button");
  cancelIcon.textContent = "\u274C";
  cancelIcon.onclick = (e) => {
    fieldContainer.removeChild(inputContainer);
    fieldContainer.appendChild(button);
    fieldContainer.appendChild(field);
    fieldContainer.appendChild(spacer);
  };
  inputContainer.appendChild(cancelIcon);
  input.focus();
  const button = document.createElement("button");
  button.setText("\u{1F58D}");
  button.setAttr("class", "metadata-menu-dv-field-button");
  button.hide();
  spacer.show();
  fieldContainer.onmouseover = () => {
    button.show();
    spacer.hide();
  };
  fieldContainer.onmouseout = () => {
    button.hide();
    spacer.show();
  };
  input.onkeydown = (e) => {
    if (e.key === "Enter") {
      const file = plugin.app.vault.getAbstractFileByPath(p["file"]["path"]);
      if (file instanceof import_obsidian4.TFile && file.extension == "md") {
        replaceValues(plugin.app, file, fieldName, input.value);
      }
      fieldContainer.removeChild(inputContainer);
    }
    if (e.key === "Escape") {
      fieldContainer.removeChild(inputContainer);
      fieldContainer.append(button);
      fieldContainer.append(field);
    }
  };
  fieldContainer.appendChild(button);
  fieldContainer.appendChild(field);
  fieldContainer.appendChild(spacer);
  button.onclick = (e) => {
    fieldContainer.removeChild(field);
    fieldContainer.removeChild(button);
    fieldContainer.removeChild(spacer);
    fieldContainer.appendChild(inputContainer);
    input.focus();
  };
  return fieldContainer;
}

// src/MetadataMenuApi.ts
var MetadataMenuApi = class {
  constructor(plugin) {
    this.plugin = plugin;
  }
  make() {
    return {
      getValues: this.getValues(),
      replaceValues: this.replaceValues(),
      fieldWithMenu: this.fieldWithMenu()
    };
  }
  getValues() {
    return (app2, file, attribute) => __async(this, null, function* () {
      return getValues(app2, file, attribute);
    });
  }
  replaceValues() {
    return (app2, file, attribute, input) => __async(this, null, function* () {
      return replaceValues(app2, file, attribute, input);
    });
  }
  fieldWithMenu() {
    return (dv, p, fieldName, attrs) => fieldWithMenu(this.plugin, dv, p, fieldName, attrs);
  }
};

// src/options/linkContextMenu.ts
var import_obsidian15 = require("obsidian");

// src/optionModals/valueMultiSelectModal.ts
var import_obsidian5 = require("obsidian");
var valueMultiSelectModal = class extends import_obsidian5.Modal {
  constructor(app2, file, name, initialValues, settings, lineNumber = -1, inFrontMatter = false, top = false) {
    super(app2);
    this.app = app2;
    this.file = file;
    this.name = name;
    this.settings = settings;
    if (initialValues) {
      if (initialValues.toString().startsWith("[[")) {
        this.values = initialValues.split(",").map((item) => item.trim());
      } else {
        this.values = initialValues.toString().replace(/^\[(.*)\]$/, "$1").split(",").map((item) => item.trim());
      }
      ;
    } else {
      this.values = [];
    }
    ;
    this.lineNumber = lineNumber;
    this.inFrontmatter = inFrontMatter;
    this.top = top;
  }
  onOpen() {
    return __async(this, null, function* () {
      this.containerEl.addClass("metadata-menu");
      const valueGrid = this.contentEl.createDiv({
        cls: "metadata-menu-value-grid"
      });
      const listNoteValues = yield FieldSetting.getValuesListFromNote(this.settings.valuesListNotePath, this.app);
      yield this.populateValuesGrid(valueGrid, listNoteValues);
    });
  }
  populateValuesGrid(valueGrid, listNoteValues) {
    return __async(this, null, function* () {
      if (listNoteValues.length === 0) {
        Object.keys(this.settings.values).forEach((key) => {
          const presetValue = this.settings.values[key];
          this.buildValueToggler(valueGrid, presetValue);
        });
      }
      ;
      listNoteValues.forEach((value) => {
        this.buildValueToggler(valueGrid, value);
      });
      const footer = this.contentEl.createDiv({ cls: "metadata-menu-value-grid-footer" });
      const saveButton = new import_obsidian5.ButtonComponent(footer);
      saveButton.setIcon("checkmark");
      saveButton.onClick(() => __async(this, null, function* () {
        if (this.lineNumber == -1) {
          replaceValues(this.app, this.file, this.name, this.values.join(","));
        } else {
          const result = yield this.app.vault.read(this.file);
          let newContent = [];
          if (this.top) {
            newContent.push(`${this.name}${this.inFrontmatter ? ":" : "::"} ${this.values.join(",")}`);
            result.split("\n").forEach((line, _lineNumber) => newContent.push(line));
          } else {
            result.split("\n").forEach((line, _lineNumber) => {
              newContent.push(line);
              if (_lineNumber == this.lineNumber) {
                newContent.push(`${this.name}${this.inFrontmatter ? ":" : "::"} ${this.values.join(",")}`);
              }
              ;
            });
          }
          ;
          this.app.vault.modify(this.file, newContent.join("\n"));
          this.close();
        }
        ;
        this.close();
      }));
      const cancelButton = new import_obsidian5.ExtraButtonComponent(footer);
      cancelButton.setIcon("cross");
      cancelButton.onClick(() => this.close());
    });
  }
  buildValueToggler(valueGrid, presetValue) {
    const valueSelectorContainer = valueGrid.createDiv({
      cls: "metadata-menu-value-selector-container"
    });
    const valueTogglerContainer = valueSelectorContainer.createDiv({
      cls: "metadata-menu-value-selector-toggler"
    });
    const valueToggler = new import_obsidian5.ToggleComponent(valueTogglerContainer);
    this.values.forEach((value) => {
      if (value == presetValue) {
        valueToggler.setValue(true);
      }
      ;
    });
    valueToggler.onChange((value) => {
      if (value && !this.values.includes(presetValue)) {
        this.values.push(presetValue);
      }
      ;
      if (!value) {
        this.values.remove(presetValue);
      }
      ;
    });
    const valueLabel = valueSelectorContainer.createDiv({ cls: "metadata-menu-value-selector-label" });
    valueLabel.setText(presetValue);
  }
};

// src/optionModals/valueTextInputModal.ts
var import_obsidian6 = require("obsidian");
var valueTextInputModal = class extends import_obsidian6.Modal {
  constructor(app2, file, name, value, lineNumber = -1, inFrontMatter = false, top = false) {
    super(app2);
    this.parseDate = false;
    this.app = app2;
    this.file = file;
    this.name = name;
    this.value = value;
    this.lineNumber = lineNumber;
    this.inFrontmatter = inFrontMatter;
    this.top = top;
  }
  onOpen() {
    const inputDiv = this.contentEl.createDiv({ cls: "metadata-menu-modal-value" });
    this.buildInputEl(inputDiv);
  }
  buildDateParseToggler(container) {
    if (app.plugins.plugins.hasOwnProperty("nldates-obsidian")) {
      const nldates = app.plugins.plugins["nldates-obsidian"];
      const dateParserLabel = container.createDiv({
        cls: "metadata-menu-date-parser-label"
      });
      dateParserLabel.setText("\u{1F4C6}");
      const dateParserToggler = new import_obsidian6.ToggleComponent(container);
      dateParserToggler.onChange((value) => {
        this.parseDate = value;
      });
      dateParserLabel.onclick = () => dateParserToggler.setValue(!this.parseDate);
    }
    ;
  }
  buildInputEl(inputDiv) {
    this.buildDateParseToggler(inputDiv);
    const form = inputDiv.createEl("form");
    form.type = "submit";
    const inputEl = new import_obsidian6.TextComponent(form);
    inputEl.inputEl.focus();
    inputEl.setValue(this.value);
    inputEl.inputEl.addClass("metadata-menu-prompt-input");
    form.onsubmit = (e) => __async(this, null, function* () {
      e.preventDefault();
      let inputValue = inputEl.getValue();
      if (app.plugins.plugins.hasOwnProperty("nldates-obsidian") && this.parseDate) {
        const nldates = app.plugins.plugins["nldates-obsidian"];
        const format = nldates.settings.format;
        let textStart = "";
        let textEnd = "";
        let date = "";
        const selectionStart = inputEl.inputEl.selectionStart;
        const selectionEnd = inputEl.inputEl.selectionEnd;
        if (selectionEnd == selectionStart) {
          date = nldates.parseDate(inputEl.getValue()).moment.format(format);
        } else {
          textStart = inputEl.getValue().slice(0, selectionStart);
          date = nldates.parseDate(inputEl.getValue().slice(selectionStart, selectionEnd)).moment.format(format);
          textEnd = inputEl.getValue().slice(selectionEnd);
        }
        ;
        inputValue = textStart + "[[" + date + "]]" + textEnd;
      }
      if (this.lineNumber == -1) {
        replaceValues(this.app, this.file, this.name, inputValue);
      } else {
        const result = yield this.app.vault.read(this.file);
        let newContent = [];
        if (this.top) {
          newContent.push(`${this.name}${this.inFrontmatter ? ":" : "::"} ${inputValue}`);
          result.split("\n").forEach((line, _lineNumber) => newContent.push(line));
        } else {
          result.split("\n").forEach((line, _lineNumber) => {
            newContent.push(line);
            if (_lineNumber == this.lineNumber) {
              newContent.push(`${this.name}${this.inFrontmatter ? ":" : "::"} ${inputValue}`);
            }
            ;
          });
        }
        ;
        this.app.vault.modify(this.file, newContent.join("\n"));
        this.close();
      }
      ;
      this.close();
    });
  }
};

// src/optionModals/valueToggleModal.ts
var import_obsidian7 = require("obsidian");
var valueToggleModal = class extends import_obsidian7.Modal {
  constructor(app2, file, name, value) {
    super(app2);
    this.app = app2;
    this.file = file;
    this.name = name;
    this.value = value;
  }
  onOpen() {
    const inputDiv = this.contentEl.createDiv({
      cls: "metadata-menu-toggler"
    });
    this.buildInputEl(inputDiv);
  }
  buildInputEl(inputDiv) {
    const inputEl = new import_obsidian7.ToggleComponent(inputDiv);
    inputEl.setValue(this.value);
    inputEl.onChange((v) => {
      replaceValues(this.app, this.file, this.name, v ? "true" : "false");
    });
  }
};

// src/optionModals/valueSelectModal.ts
var import_obsidian8 = require("obsidian");
var valueToggleModal2 = class extends import_obsidian8.Modal {
  constructor(app2, file, name, value, settings, lineNumber = -1, inFrontMatter = false, top = false) {
    super(app2);
    this.app = app2;
    this.file = file;
    this.name = name;
    this.value = value;
    this.settings = settings;
    this.newValue = null;
    this.lineNumber = lineNumber;
    this.inFrontmatter = inFrontMatter;
    this.top = top;
  }
  onOpen() {
    return __async(this, null, function* () {
      this.containerEl.addClass("metadata-menu");
      const inputDiv = this.contentEl.createDiv({ cls: "metadata-menu-modal-value" });
      yield this.buildInputEl(inputDiv);
    });
  }
  buildInputEl(inputDiv) {
    return __async(this, null, function* () {
      const selectEl = new import_obsidian8.DropdownComponent(inputDiv);
      selectEl.selectEl.addClass("metadata-menu-select");
      const values = this.settings.values;
      selectEl.addOption("", "--Empty--");
      const listNoteValues = yield FieldSetting.getValuesListFromNote(this.settings.valuesListNotePath, this.app);
      listNoteValues.forEach((value) => selectEl.addOption(value, value));
      if (listNoteValues.includes(this.value)) {
        selectEl.setValue(this.value);
      }
      ;
      if (listNoteValues.length === 0) {
        Object.keys(values).forEach((key) => {
          selectEl.addOption(values[key], values[key]);
        });
        if (Object.values(values).includes(this.value)) {
          selectEl.setValue(this.value);
        }
        ;
      }
      selectEl.onChange((value) => this.newValue = value != "--Empty--" ? value : "");
      const submitButton = new import_obsidian8.ButtonComponent(inputDiv);
      submitButton.setTooltip("Save").setIcon("checkmark").onClick(() => __async(this, null, function* () {
        if (this.lineNumber == -1) {
          if (this.newValue || this.newValue == "") {
            replaceValues(this.app, this.file, this.name, this.newValue);
          }
          ;
        } else {
          const result = yield this.app.vault.read(this.file);
          let newContent = [];
          if (this.top) {
            newContent.push(`${this.name}${this.inFrontmatter ? ":" : "::"} ${selectEl.getValue()}`);
            result.split("\n").forEach((line, _lineNumber) => newContent.push(line));
          } else {
            result.split("\n").forEach((line, _lineNumber) => {
              newContent.push(line);
              if (_lineNumber == this.lineNumber) {
                newContent.push(`${this.name}${this.inFrontmatter ? ":" : "::"} ${selectEl.getValue()}`);
              }
              ;
            });
          }
          ;
          this.app.vault.modify(this.file, newContent.join("\n"));
          this.close();
        }
        ;
        this.close();
      }));
    });
  }
};

// src/optionModals/chooseSectionModal.ts
var import_obsidian11 = require("obsidian");

// src/optionModals/fieldSelectModal.ts
var import_obsidian10 = require("obsidian");

// src/optionModals/addNewFieldModal.ts
var import_obsidian9 = require("obsidian");
var addNewFieldModal = class extends import_obsidian9.Modal {
  constructor(plugin, lineNumber, file, inFrontmatter, top) {
    super(plugin.app);
    this.lineNumber = lineNumber;
    this.inFrontmatter = inFrontmatter;
    this.file = file;
    this.top = top;
  }
  onOpen() {
    this.titleEl.setText("Insert new field");
    const addNewFieldContainer = this.contentEl.createDiv();
    const nameInputContainer = addNewFieldContainer.createDiv();
    nameInputContainer.setText("Field Name: ");
    const nameInputEl = new import_obsidian9.TextComponent(nameInputContainer);
    nameInputEl.setPlaceholder("Field name");
    const valueInputContainer = addNewFieldContainer.createDiv();
    valueInputContainer.setText("Field value: ");
    const valueInputEl = new import_obsidian9.TextComponent(valueInputContainer);
    valueInputEl.setPlaceholder("Field value");
    const footerButtons = this.contentEl.createDiv({
      cls: "metadata-menu-textarea-buttons"
    });
    const saveButton = new import_obsidian9.ButtonComponent(footerButtons);
    saveButton.setIcon("checkmark");
    saveButton.onClick(() => __async(this, null, function* () {
      const result = yield this.app.vault.read(this.file);
      let newContent = [];
      if (this.top) {
        newContent.push(`${nameInputEl.getValue()}${this.inFrontmatter ? ":" : "::"} ${valueInputEl.getValue()}`);
        result.split("\n").forEach((line, _lineNumber) => newContent.push(line));
      } else {
        result.split("\n").forEach((line, _lineNumber) => {
          newContent.push(line);
          if (_lineNumber == this.lineNumber) {
            newContent.push(`${nameInputEl.getValue()}${this.inFrontmatter ? ":" : "::"} ${valueInputEl.getValue()}`);
          }
        });
      }
      this.app.vault.modify(this.file, newContent.join("\n"));
      this.close();
    }));
    const cancelButton = new import_obsidian9.ExtraButtonComponent(footerButtons);
    cancelButton.setIcon("cross");
    cancelButton.onClick(() => {
      this.close();
    });
  }
};

// src/optionModals/fieldSelectModal.ts
var fieldSelectModal = class extends import_obsidian10.Modal {
  constructor(plugin, file, lineNumber, line, inFrontmatter, top) {
    super(plugin.app);
    this.line = line;
    this.lineNumber = lineNumber;
    this.plugin = plugin;
    this.file = file;
    this.inFrontmatter = inFrontmatter;
    this.top = top;
  }
  onOpen() {
    this.titleEl.setText(`Insert field after > ${this.line.substring(0, 20)}${this.line.length > 20 ? "..." : ""}`);
    const container = this.contentEl.createDiv({ cls: "metadata-menu-field-select" });
    const settingsDropdownContainer = container.createDiv();
    const settingsSelector = new import_obsidian10.DropdownComponent(settingsDropdownContainer);
    settingsSelector.addOption("---", "Choose Field");
    settingsSelector.addOption("++New", "New");
    this.plugin.settings.presetFields.forEach((setting) => {
      settingsSelector.addOption(setting.name, setting.name);
    });
    settingsSelector.onChange((value) => {
      if (value == "++New") {
        const newFieldModal = new addNewFieldModal(this.plugin, this.lineNumber, this.file, this.inFrontmatter, this.top);
        newFieldModal.open();
        this.close();
      } else {
        const field = this.plugin.settings.presetFields.filter((_field) => _field.name == value)[0];
        if (field.valuesListNotePath || field.values && Object.keys(field.values).length > 0) {
          if (field.isMulti) {
            const fieldModal = new valueMultiSelectModal(this.app, this.file, field.name, "", field, this.lineNumber, this.inFrontmatter, this.top);
            fieldModal.titleEl.setText(`Select values for ${value}`);
            fieldModal.open();
          } else {
            const fieldModal = new valueToggleModal2(this.app, this.file, field.name, "", field, this.lineNumber, this.inFrontmatter, this.top);
            fieldModal.titleEl.setText(`Select value for ${value}`);
            fieldModal.open();
          }
          ;
        } else {
          const fieldModal = new valueTextInputModal(this.app, this.file, value, "", this.lineNumber, this.inFrontmatter, this.top);
          fieldModal.titleEl.setText(`Enter value for ${value}`);
          fieldModal.open();
        }
        ;
        this.close();
      }
      ;
    });
  }
};

// src/optionModals/chooseSectionModal.ts
var chooseSectionModal = class extends import_obsidian11.Modal {
  constructor(plugin, file) {
    super(plugin.app);
    this.file = file;
    this.plugin = plugin;
  }
  onOpen() {
    return __async(this, null, function* () {
      this.titleEl.setText("Add a field in this note after:");
      const inputDiv = this.contentEl.createDiv({ cls: "metadata-menu-modal-value" });
      const selectEl = new import_obsidian11.DropdownComponent(inputDiv);
      selectEl.selectEl.addClass("metadata-menu-select");
      selectEl.addOption("", "Select line");
      selectEl.addOption("top_0", "top");
      const result = yield this.app.vault.read(this.file);
      let foreHeadText = false;
      let frontmatterStart = false;
      let frontmatterEnd = false;
      let inFrontmatter = false;
      result.split("\n").forEach((line, lineNumber) => {
        if (line != "---" && !foreHeadText && !frontmatterStart) {
          foreHeadText = true;
        }
        ;
        if (line == "---" && !foreHeadText) {
          if (!frontmatterStart) {
            frontmatterStart = true;
            inFrontmatter = true;
          } else if (!frontmatterEnd) {
            frontmatterEnd = true;
            inFrontmatter = false;
          }
          ;
        }
        if (inFrontmatter) {
          selectEl.addOption(`frontmatter_${lineNumber}`, `${line.substring(0, 30)}${line.length > 30 ? "..." : ""}`);
        } else {
          selectEl.addOption(`body_${lineNumber}`, `${line.substring(0, 30)}${line.length > 30 ? "..." : ""}`);
        }
        ;
      });
      selectEl.onChange(() => {
        const valueArray = selectEl.getValue().match(/(\w+)_(\d+)/);
        const position = valueArray && valueArray.length > 0 ? valueArray[1] : 0;
        const lineNumber = Number(valueArray && valueArray.length > 1 ? valueArray[2] : 0);
        const inFrontmatter2 = position == "frontmatter" ? true : false;
        const top = position == "top" ? true : false;
        const modal = new fieldSelectModal(this.plugin, this.file, lineNumber, result.split("\n")[lineNumber], inFrontmatter2, top);
        this.close();
        modal.open();
      });
    });
  }
};

// src/fileClass/fileClassAttribute.ts
var types = {
  "input": "Accepts any value",
  "select": "Accepts a single value from a list",
  "multi": "Accepts multiple values from a list",
  "cycle": "Cycle through values from a list"
};
var FileClassAttribute = class {
  constructor(raw) {
    var _a, _b;
    const completeRegex = new RegExp(`^${genericFieldRegex}::(?<fieldSettings>.+)?`, "u");
    const nameRegex = new RegExp(`^${genericFieldRegex}$`, "u");
    let fieldName;
    let { attribute, fieldSettings } = ((_a = raw.match(completeRegex)) == null ? void 0 : _a.groups) || {};
    if (attribute) {
      fieldName = attribute;
    } else {
      let { attribute: attribute2 } = ((_b = raw.match(nameRegex)) == null ? void 0 : _b.groups) || {};
      fieldName = attribute2;
    }
    if (fieldName) {
      this.name = attribute.trim();
      if (fieldSettings) {
        const settings = JSON.parse(`${fieldSettings.trim()}`);
        this.type = settings["type"];
        switch (this.type) {
          case "multi":
            this.isMulti = true;
            break;
          case "cycle":
            this.isCycle = true;
            break;
          default:
            break;
        }
        this.options = settings["options"];
      }
    } else {
      const error = new Error("Improper value");
      throw error;
    }
  }
  getField() {
    let values = {};
    this.options.forEach((option, index) => {
      values[index] = option;
    });
    return new Field_default(this.name, values, this.name, this.isMulti, this.isCycle);
  }
};

// src/fileClass/fileClass.ts
var import_obsidian12 = require("obsidian");
var FileClassManager = class {
  constructor(instance) {
    this.instance = instance;
  }
  all() {
    const filesWithFileClassName = this.instance.plugin.app.vault.getMarkdownFiles().filter((file) => {
      const cache = this.instance.plugin.app.metadataCache.getFileCache(file);
      const fileClassAlias = this.instance.plugin.settings.fileClassAlias;
      return (cache == null ? void 0 : cache.frontmatter) && Object.keys(cache.frontmatter).includes(fileClassAlias) && cache.frontmatter[fileClassAlias] == this.instance.name;
    });
    return filesWithFileClassName;
  }
  get(name) {
    const filesWithName = this.all().filter((file) => file.basename == name);
    if (filesWithName.length > 1) {
      const error = new Error("More than one value found");
      throw error;
    }
    if (filesWithName.length == 0) {
      const error = new Error("No file value found");
      throw error;
    }
    return filesWithName[0];
  }
  getPath(path) {
    const filesWithName = this.all().filter((file) => file.path == path);
    if (filesWithName.length > 1) {
      const error = new Error("More than one value found");
      throw error;
    }
    if (filesWithName.length == 0) {
      const error = new Error("No file value found");
      throw error;
    }
    return filesWithName[0];
  }
};
var FileClass = class {
  constructor(plugin, name) {
    this.plugin = plugin;
    this.name = name;
    this.objects = new FileClassManager(this);
    this.attributes = [];
  }
  getClassFile() {
    const filesClassPath = this.plugin.settings.classFilesPath;
    const file = this.plugin.app.vault.getAbstractFileByPath(`${filesClassPath}${this.name}.md`);
    if (file instanceof import_obsidian12.TFile && file.extension == "md") {
      return file;
    } else {
      const error = new Error("no such fileClass in fileClass folder");
      throw error;
    }
  }
  getAttributes() {
    return __async(this, null, function* () {
      try {
        const file = this.getClassFile();
        let attributes = [];
        let errors = [];
        const result = yield this.plugin.app.vault.cachedRead(file);
        result.split("\n").forEach((line) => {
          try {
            const attribute = new FileClassAttribute(line);
            attributes.push(attribute);
          } catch (error) {
            errors.push(error);
          }
        });
        this.attributes = attributes;
        this.errors = errors;
      } catch (error) {
        throw error;
      }
    });
  }
  updateAttribute(newType, newOptions, newName, attr) {
    return __async(this, null, function* () {
      const file = this.getClassFile();
      let result = yield this.plugin.app.vault.read(file);
      if (attr) {
        let newContent = [];
        result.split("\n").forEach((line) => {
          if (line.startsWith(attr.name)) {
            if (newType == "input") {
              newContent.push(newName);
            } else {
              let settings = {};
              settings["type"] = newType;
              settings["options"] = newOptions;
              newContent.push(`${newName}:: ${JSON.stringify(settings)}`);
            }
          } else {
            newContent.push(line);
          }
        });
        this.plugin.app.vault.modify(file, newContent.join("\n"));
      } else {
        let settings = {};
        settings["type"] = newType;
        settings["options"] = newOptions;
        result += `
${newName}:: ${JSON.stringify(settings)}`;
        yield this.plugin.app.vault.modify(file, result);
      }
    });
  }
  removeAttribute(attr) {
    return __async(this, null, function* () {
      const file = this.getClassFile();
      const result = yield this.plugin.app.vault.read(file);
      let newContent = [];
      result.split("\n").forEach((line) => {
        if (!line.startsWith(attr.name)) {
          newContent.push(line);
        }
      });
      yield this.plugin.app.vault.modify(file, newContent.join("\n"));
    });
  }
};
function createFileClass(plugin, name) {
  return __async(this, null, function* () {
    return new Promise((resolve, reject) => {
      const fileClass = new FileClass(plugin, name);
      fileClass.getAttributes().then(() => {
        resolve(fileClass);
      }).catch((error) => {
        reject(error);
      });
    });
  });
}

// src/fileClass/FileClassAttributeSelectModal.ts
var import_obsidian14 = require("obsidian");

// src/fileClass/FileClassAttributeModal.ts
var import_obsidian13 = require("obsidian");
var FileClassAttributeModal = class extends import_obsidian13.Modal {
  constructor(app2, fileClass, attr) {
    super(app2);
    this.attr = attr;
    this.fileClass = fileClass;
    if (this.attr) {
      this.type = this.attr.type || "input";
      this.options = this.attr.options;
      this.name = this.attr.name;
    }
  }
  onOpen() {
    this.titleEl.setText(this.attr ? `Manage ${this.attr.name}` : `Create a new attribute for ${this.fileClass.name}`);
    const nameInputContainer = this.contentEl.createDiv();
    nameInputContainer.setText("name");
    const nameInput = new import_obsidian13.TextComponent(nameInputContainer);
    this.attr ? nameInput.setValue(this.attr.name) : nameInput.setPlaceholder("Type a name for this attribute");
    const typeSelectHeader = this.contentEl.createDiv();
    const attrLine = typeSelectHeader.createEl("div");
    const attrName = attrLine.createEl("strong");
    attrName.setText(`<${this.name}>`);
    attrLine.append(" fields in files with:");
    String(`---
fileClass: ${this.fileClass.name}
...
---`).split("\n").forEach((line) => {
      typeSelectHeader.createEl("div", "yaml-metadata-menu-red").setText(line);
    });
    const typeSelectContainer = this.contentEl.createDiv({ cls: "metadata-menu-value-selector-container" });
    const typeSelectLabel = typeSelectContainer.createDiv({ cls: "metadata-menu-value-selector-inline-label" });
    typeSelectLabel.setText("will: ");
    const typeSelectDropDown = typeSelectContainer.createDiv({ cls: "metadata-menu-value-selector-toggler" });
    const typeSelect = new import_obsidian13.DropdownComponent(typeSelectDropDown);
    Object.keys(types).forEach((key) => {
      typeSelect.addOption(key, types[key]);
    });
    if (this.attr) {
      typeSelect.setValue(this.type);
    }
    const optionsInputContainer = this.contentEl.createDiv({ cls: "metadata-menu-value-selector-container" });
    const optionsInputLabel = optionsInputContainer.createDiv({ cls: "metadata-menu-value-selector-inline-label-top" });
    optionsInputLabel.setText("Values");
    const optionsInput = new import_obsidian13.TextAreaComponent(optionsInputContainer);
    optionsInput.inputEl.rows = 3;
    optionsInput.inputEl.cols = 26;
    this.attr ? optionsInput.setValue(this.type == "input" ? "" : this.options.join(", ")) : optionsInput.setPlaceholder("insert values, comma separated");
    !this.attr || this.type == "input" ? optionsInputContainer.hide() : optionsInputContainer.show();
    typeSelect.onChange((type) => {
      type == "input" ? optionsInputContainer.hide() : optionsInputContainer.show();
      this.type = type;
    });
    optionsInput.onChange((value) => this.options = value.split(",").map((item) => item.trim()));
    nameInput.onChange((value) => {
      this.name = value;
      attrName.setText(`<${value}>`);
    });
    const footer = this.contentEl.createDiv({ cls: "metadata-menu-value-grid-footer" });
    const saveButton = new import_obsidian13.ButtonComponent(footer);
    saveButton.setIcon("checkmark");
    saveButton.onClick(() => {
      this.fileClass.updateAttribute(this.type, this.options, this.name, this.attr);
      this.close();
    });
    if (this.attr) {
      const removeButton = new import_obsidian13.ButtonComponent(footer);
      removeButton.setIcon("trash");
      removeButton.onClick(() => {
        var _a;
        const confirmModal = new import_obsidian13.Modal(this.app);
        confirmModal.titleEl.setText("Please confirm");
        confirmModal.contentEl.createDiv().setText(`Do you really want to remove ${(_a = this.attr) == null ? void 0 : _a.name} attribute from ${this.fileClass.name}?`);
        const confirmFooter = confirmModal.contentEl.createDiv({ cls: "metadata-menu-value-grid-footer" });
        const confirmButton = new import_obsidian13.ButtonComponent(confirmFooter);
        confirmButton.setIcon("checkmark");
        confirmButton.onClick(() => {
          if (this.attr)
            this.fileClass.removeAttribute(this.attr);
          confirmModal.close();
          this.close();
        });
        const dismissButton = new import_obsidian13.ExtraButtonComponent(confirmFooter);
        dismissButton.setIcon("cross");
        dismissButton.onClick(() => this.close());
        confirmModal.open();
      });
    }
    const cancelButton = new import_obsidian13.ExtraButtonComponent(footer);
    cancelButton.setIcon("cross");
    cancelButton.onClick(() => this.close());
  }
};

// src/fileClass/FileClassAttributeSelectModal.ts
var FileClassAttributeSelectModal = class extends import_obsidian14.Modal {
  constructor(plugin, file) {
    super(plugin.app);
    this.file = file;
    this.plugin = plugin;
  }
  onOpen() {
    return __async(this, null, function* () {
      this.titleEl.setText(`Select the field to update`);
      const fileClass = yield createFileClass(this.plugin, this.file.basename);
      this.titleEl.setText(`Select the field to update in ${fileClass.name}`);
      const selectContainer = this.contentEl.createDiv();
      const select = new import_obsidian14.DropdownComponent(selectContainer);
      select.addOption("select an attribute", "--select an attribute--");
      fileClass.attributes.forEach((attr) => {
        select.addOption(attr.name, attr.name);
      });
      select.addOption("++newAttr++", "++Add a new attribute++");
      select.onChange((attrName) => {
        if (attrName == "++newAttr") {
          const modal = new FileClassAttributeModal(this.plugin.app, fileClass);
          modal.open();
          this.close();
        } else {
          const modal = new FileClassAttributeModal(this.plugin.app, fileClass, fileClass.attributes.filter((attr) => attr.name == attrName)[0]);
          modal.open();
          this.close();
        }
      });
    });
  }
};

// src/options/OptionsList.ts
function isMenu(category) {
  return category.addItem !== void 0;
}
function isSelect(category) {
  return category.modals !== void 0;
}
var OptionsList = class {
  constructor(plugin, file, category) {
    this.file = file;
    this.plugin = plugin;
    this.category = category;
  }
  createExtraOptionList() {
    return __async(this, null, function* () {
      var _a;
      const frontmatter = (_a = this.plugin.app.metadataCache.getCache(this.file.path)) == null ? void 0 : _a.frontmatter;
      if (frontmatter) {
        const _b = frontmatter, { position } = _b, attributes = __objRest(_b, ["position"]);
        Object.keys(attributes).forEach((key) => {
          if (this.plugin.settings.globallyIgnoredFields.includes(key)) {
            delete attributes[key];
          }
          ;
        });
        if (isMenu(this.category)) {
          this.category.addSeparator();
        }
        ;
        let fileClassForFields = false;
        let fileClassFields = [];
        const fileClassAlias = this.plugin.settings.fileClassAlias;
        if (Object.keys(attributes).includes(fileClassAlias)) {
          const fileClass = attributes[fileClassAlias];
          try {
            const _fileClass = yield createFileClass(this.plugin, fileClass);
            this.fileClass = _fileClass;
            fileClassFields = _fileClass.attributes.map((attr) => attr.name);
            fileClassForFields = true;
            Object.keys(attributes).forEach((key) => {
              if (!fileClassFields.includes(key) && key != fileClassAlias) {
                delete attributes[key];
              }
              ;
            });
            const fileClassAttributeSelectModal = new FileClassAttributeSelectModal(this.plugin, this.fileClass.getClassFile());
            if (isMenu(this.category)) {
              this.category.addSeparator();
              this.category.addItem((item) => {
                item.setIcon("gear");
                item.setTitle(`Manage <${this.fileClass.name}> fields`);
                item.onClick((evt) => {
                  fileClassAttributeSelectModal.open();
                });
              });
            } else {
              this.category.addOption("manage_fileClass_attributes", "Manage fileClass attributes");
              this.category.modals["add_field_at_section"] = () => fileClassAttributeSelectModal.open();
            }
            ;
            yield this.createExtraOptionsListForFrontmatter(attributes);
            yield this.createExtraOptionsListForInlineFields(this.file, fileClassForFields, fileClassFields);
            if (isMenu(this.category)) {
              this.category.addSeparator();
            }
            ;
            this.addSectionSelectModalOption(this.plugin);
          } catch (error) {
            yield this.createExtraOptionsListForFrontmatter(attributes);
            yield this.createExtraOptionsListForInlineFields(this.file);
            if (isMenu(this.category)) {
              this.category.addSeparator();
            }
            ;
            this.addSectionSelectModalOption(this.plugin);
          }
          ;
        } else {
          yield this.createExtraOptionsListForFrontmatter(attributes);
          yield this.createExtraOptionsListForInlineFields(this.file);
          if (isMenu(this.category)) {
            this.category.addSeparator();
          }
          ;
          this.addSectionSelectModalOption(this.plugin);
        }
        ;
      } else {
        yield this.createExtraOptionsListForInlineFields(this.file);
        if (isMenu(this.category)) {
          this.category.addSeparator();
        }
        ;
        this.addSectionSelectModalOption(this.plugin);
      }
      ;
    });
  }
  createExtraOptionsListForInlineFields(_0) {
    return __async(this, arguments, function* (file, fileClassForFields = false, fileClassFields = []) {
      let attributes = {};
      const regex = new RegExp(`^${genericFieldRegex}::s*(?<values>.+)?`, "u");
      const result = yield this.plugin.app.vault.read(file);
      result.split("\n").map((line) => {
        const regexResult = line.match(regex);
        const { attribute, values } = (regexResult == null ? void 0 : regexResult.groups) || {};
        if (attribute && !this.plugin.settings.globallyIgnoredFields.includes(attribute.trim())) {
          if (fileClassForFields) {
            if (fileClassFields.includes(attribute.trim())) {
              attributes[attribute.trim()] = values ? values.trim() : "";
            }
            ;
          } else {
            attributes[attribute.trim()] = values ? values.trim() : "";
          }
          ;
        }
        ;
      });
      if (Object.keys(attributes).length > 0) {
        if (isMenu(this.category)) {
          this.category.addSeparator();
        }
        ;
        this.buildExtraOptionsList(attributes);
      }
      ;
    });
  }
  createExtraOptionsListForFrontmatter(attributes) {
    return __async(this, null, function* () {
      this.buildExtraOptionsList(attributes);
    });
  }
  buildExtraOptionsList(attributes) {
    Object.keys(attributes).forEach((key) => {
      const value = attributes[key];
      const propertySettings = this.getPropertySettings(key);
      if (propertySettings == null ? void 0 : propertySettings.values) {
        if (propertySettings.isCycle) {
          this.addCycleMenuOption(key, value, propertySettings);
        } else if (propertySettings.isMulti) {
          this.addMultiMenuOption(key, value, propertySettings);
        } else {
          this.addSelectMenuOption(key, value, propertySettings);
        }
        ;
      } else if (isBoolean(value) || /true/i.test(value) || /false/i.test(value)) {
        let toBooleanValue = false;
        if (isBoolean(value)) {
          toBooleanValue = value;
        } else if (/true/i.test(value)) {
          toBooleanValue = true;
        } else if (/false/i.test(value)) {
          toBooleanValue = false;
        }
        ;
        this.addToggleMenuOption(key, toBooleanValue);
      } else {
        this.addTextInputMenuOption(key, value ? value.toString() : "");
      }
      ;
    });
  }
  addSectionSelectModalOption(plugin) {
    const modal = new chooseSectionModal(this.plugin, this.file);
    if (isMenu(this.category)) {
      this.category.addItem((item) => {
        item.setIcon("pencil");
        item.setTitle("Add field at section...");
        item.onClick((evt) => {
          modal.open();
        });
        item.setSection("target-metadata");
      });
    } else if (isSelect(this.category)) {
      this.category.addOption("add_field_at_section", "Add field at section...");
      this.category.modals["add_field_at_section"] = () => modal.open();
    }
    ;
  }
  addCycleMenuOption(name, value, propertySettings) {
    const values = propertySettings.values;
    const keys = Object.keys(values);
    const keyForValue = keys.find((key) => values[key] === value);
    let nextValue;
    if (keyForValue) {
      const nextKey = keys[(keys.indexOf(keyForValue) + 1) % keys.length];
      nextValue = values[nextKey];
    } else {
      nextValue = values[Object.keys(values)[0]];
    }
    ;
    if (isMenu(this.category)) {
      this.category.addItem((item) => {
        item.setTitle(`${name} : ${value} \u25B7 ${nextValue}`);
        item.setIcon("switch");
        item.onClick((evt) => {
          replaceValues(this.plugin.app, this.file, name, nextValue);
        });
        item.setSection("target-metadata");
      });
    } else if (isSelect(this.category)) {
      this.category.addOption(`${name}_${value}_${nextValue}`, `${name} : ${value} \u25B7 ${nextValue}`);
      this.category.modals[`${name}_${value}_${nextValue}`] = () => replaceValues(this.plugin.app, this.file, name, nextValue);
    }
    ;
  }
  addMultiMenuOption(name, value, propertySettings) {
    const modal = new valueMultiSelectModal(this.plugin.app, this.file, name, value, propertySettings);
    modal.titleEl.setText("Select values");
    if (isMenu(this.category)) {
      this.category.addItem((item) => {
        item.setTitle(`Update <${name}>`);
        item.setIcon("bullet-list");
        item.onClick((evt) => {
          modal.open();
        });
        item.setSection("target-metadata");
      });
    } else if (isSelect(this.category)) {
      this.category.addOption(`update_${name}`, `Update <${name}>`);
      this.category.modals[`update_${name}`] = () => modal.open();
    }
    ;
  }
  addSelectMenuOption(name, value, propertySettings) {
    const modal = new valueToggleModal2(this.plugin.app, this.file, name, value, propertySettings);
    modal.titleEl.setText("Select value");
    if (isMenu(this.category)) {
      this.category.addItem((item) => {
        item.setTitle(`Update ${name}`);
        item.setIcon("right-triangle");
        item.onClick((evt) => modal.open());
        item.setSection("target-metadata");
      });
    } else if (isSelect(this.category)) {
      this.category.addOption(`update_${name}`, `Update <${name}>`);
      this.category.modals[`update_${name}`] = () => modal.open();
    }
    ;
  }
  addToggleMenuOption(name, value) {
    const modal = new valueToggleModal(this.plugin.app, this.file, name, value);
    modal.titleEl.setText(`Change Value for <${name}>`);
    if (isMenu(this.category)) {
      this.category.addItem((item) => {
        item.setTitle(`Update <${name}>`);
        item.setIcon("checkmark");
        item.onClick((evt) => {
          modal.open();
        });
        item.setSection("target-metadata");
      });
    } else if (isSelect(this.category)) {
      this.category.addOption(`update_${name}`, `Update <${name}>`);
      this.category.modals[`update_${name}`] = () => modal.open();
    }
    ;
  }
  addTextInputMenuOption(name, value) {
    const modal = new valueTextInputModal(this.plugin.app, this.file, name, value);
    modal.titleEl.setText(`Change Value for <${name}>`);
    if (isMenu(this.category)) {
      this.category.addItem((item) => {
        item.setTitle(`Update <${name}>`);
        item.setIcon("pencil");
        item.onClick((evt) => modal.open());
        item.setSection("target-metadata");
      });
    } else if (isSelect(this.category)) {
      this.category.addOption(`update_${name}`, `Update <${name}>`);
      this.category.modals[`update_${name}`] = () => modal.open();
    }
    ;
  }
  getPropertySettings(propertyName) {
    const matchingSettings = this.plugin.settings.presetFields.filter((p) => p.name == propertyName);
    if (this.fileClass) {
      const fileClassAttributesWithName = this.fileClass.attributes.filter((attr) => attr.name == propertyName);
      if (fileClassAttributesWithName.length > 0) {
        const fileClassAttribute = fileClassAttributesWithName[0];
        if (fileClassAttribute.options) {
          return fileClassAttribute.getField();
        } else if (matchingSettings.length > 0) {
          return matchingSettings[0];
        }
        ;
      }
    } else if (matchingSettings.length > 0) {
      return matchingSettings[0];
    }
    ;
  }
};

// src/options/linkContextMenu.ts
var linkContextMenu = class {
  constructor(plugin) {
    this.plugin = plugin;
    this.createContextMenu();
  }
  createContextMenu() {
    this.plugin.registerEvent(this.plugin.app.workspace.on("file-menu", (menu, abstractFile, source) => {
      if (this.plugin.settings.displayFieldsInContextMenu) {
        const file = this.plugin.app.vault.getAbstractFileByPath(abstractFile.path);
        if (file instanceof import_obsidian15.TFile && file.extension === "md") {
          this.file = file;
          if (file.parent.path + "/" == this.plugin.settings.classFilesPath) {
            menu.addSeparator();
            menu.addItem((item) => {
              item.setIcon("gear");
              item.setTitle(`Manage <${file.basename}> fields`);
              item.onClick((evt) => {
                const fileClassAttributeSelectModal = new FileClassAttributeSelectModal(this.plugin, file);
                fileClassAttributeSelectModal.open();
              });
            });
          } else {
            this.optionsList = new OptionsList(this.plugin, this.file, menu);
            this.optionsList.createExtraOptionList();
          }
          ;
        }
        ;
      }
      ;
    }));
  }
};

// src/options/NoteFieldsCommandsModal.ts
var import_obsidian17 = require("obsidian");

// src/optionModals/SelectModal.ts
var import_obsidian16 = require("obsidian");
var SelectModal = class extends import_obsidian16.DropdownComponent {
  constructor(containerEl) {
    super(containerEl);
    this.modals = {};
  }
};

// src/options/NoteFieldsCommandsModal.ts
var NoteFieldsCommandsModal = class extends import_obsidian17.Modal {
  constructor(app2, plugin, file) {
    super(app2);
    this.app = app2;
    this.plugin = plugin;
    this.file = file;
  }
  onOpen() {
    return __async(this, null, function* () {
      this.titleEl.setText(`Select the field to manage`);
      this.containerEl.addClass("metadata-menu");
      const optionsListContainer = this.contentEl.createDiv({ cls: "field-options" });
      this.select = new SelectModal(optionsListContainer);
      this.select.addOption("---", "Choose Field");
      this.optionsList = new OptionsList(this.plugin, this.file, this.select);
      yield this.optionsList.createExtraOptionList();
      this.select.onChange((value) => {
        this.select.modals[value]();
        this.close();
      });
      this.select.selectEl.focus();
    });
  }
};

// src/suggester/MetadataSuggester.ts
var import_obsidian18 = require("obsidian");
var ValueSuggest = class extends import_obsidian18.EditorSuggest {
  constructor(app2, plugin) {
    super(app2);
    this.inFrontmatter = false;
    this.didSelect = false;
    this.filterOption = (firstValues, lastValue, option) => {
      return !firstValues || !(firstValues == null ? void 0 : firstValues.contains(option)) && (!lastValue || !!lastValue && option.contains(lastValue));
    };
    this.app = app2;
    this.plugin = plugin;
    this.setInstructions([{ command: "Shift", purpose: "put a space after::" }]);
    this.scope.register(["Shift"], "Enter", (evt) => {
      this.suggestions.useSelectedItem(evt);
      return false;
    });
  }
  onTrigger(cursor, editor, file) {
    if (this.didSelect) {
      this.didSelect = false;
      return null;
    }
    if (!this.plugin.settings.isAutosuggestEnabled) {
      return null;
    }
    ;
    const frontmatter = this.plugin.app.metadataCache.getFileCache(file).frontmatter;
    this.inFrontmatter = frontmatter !== void 0 && frontmatter.position.start.line < cursor.line && cursor.line < frontmatter.position.end.line;
    const regex = this.inFrontmatter ? new RegExp(`^${genericFieldRegex}:(?<values>.*)`, "u") : new RegExp(`^${genericFieldRegex}::(?<values>.*)`, "u");
    const fullLine = editor.getLine(editor.getCursor().line);
    if (!regex.test(fullLine)) {
      return null;
    }
    return {
      start: cursor,
      end: cursor,
      query: editor.getLine(cursor.line)
    };
  }
  getSuggestions(context) {
    return __async(this, null, function* () {
      const suggestions = yield this.getValueSuggestions(context);
      if (suggestions.length) {
        return suggestions;
      }
      return [];
    });
  }
  getValueSuggestions(context) {
    return __async(this, null, function* () {
      var _a, _b;
      const line = context.start.line;
      let regex;
      if (!this.inFrontmatter) {
        regex = new RegExp(`^${genericFieldRegex}::(?<values>.+)?`, "u");
      } else {
        regex = new RegExp(`^${genericFieldRegex}:(?<values>.+)?`, "u");
      }
      ;
      const regexResult = context.editor.getRange({ line, ch: 0 }, context.end).match(regex);
      if (regexResult && ((_a = regexResult.groups) == null ? void 0 : _a.attribute)) {
        const fieldName = regexResult.groups.attribute;
        const valuesList = (_b = regexResult.groups.values) == null ? void 0 : _b.replace(/^\[|^\s\[/, "").replace(/\]$/, "").split(",").map((o) => o.trim());
        const lastValue = valuesList == null ? void 0 : valuesList.last();
        const firstValues = valuesList == null ? void 0 : valuesList.slice(0, -1);
        if (fieldName === "tags" && this.inFrontmatter) {
          return Object.keys(this.app.metadataCache.getTags()).filter((t) => lastValue ? t.contains(lastValue) : t).sort().map((tag) => Object({ value: tag.replace(/^#/, "") }));
        }
        const cache = this.plugin.app.metadataCache.getCache(context.file.path);
        let tryWithPresetField = !(cache == null ? void 0 : cache.frontmatter);
        if (cache == null ? void 0 : cache.frontmatter) {
          const _c = cache.frontmatter, { position } = _c, attributes = __objRest(_c, ["position"]);
          const fileClassAlias = this.plugin.settings.fileClassAlias;
          if (Object.keys(attributes).contains(fileClassAlias)) {
            const fileClassValue = attributes[fileClassAlias];
            try {
              const fileClass = yield createFileClass(this.plugin, fileClassValue);
              this.fileClass = fileClass;
              const fileClassAttributes = this.fileClass.attributes;
              if (fileClassAttributes.map((attr) => attr.name).contains(fieldName)) {
                const options = fileClassAttributes.filter((attr) => attr.name == fieldName)[0].options.filter((option) => this.filterOption(firstValues, lastValue, option));
                return options.map((option) => Object({ value: option }));
              }
            } catch (error) {
              tryWithPresetField = true;
            }
            ;
          } else {
            tryWithPresetField = true;
          }
          ;
        }
        ;
        if (tryWithPresetField) {
          const presetFieldMatch = this.plugin.settings.presetFields.filter((field) => field.name == fieldName);
          if (presetFieldMatch.length > 0) {
            const presetField = presetFieldMatch[0];
            if (presetField.valuesListNotePath) {
              const valuesFile = this.plugin.app.vault.getAbstractFileByPath(presetField.valuesListNotePath);
              if (valuesFile instanceof import_obsidian18.TFile && valuesFile.extension == "md") {
                const values2 = yield (yield this.plugin.app.vault.read(valuesFile)).split("\n").filter((option) => this.filterOption(firstValues, lastValue, option)).map((_value) => Object({ value: _value }));
                return values2;
              }
              ;
            }
            ;
            const values = Object.entries(presetFieldMatch[0].values).map((option) => option[1]).filter((option) => this.filterOption(firstValues, lastValue, option));
            return values.map((_value) => Object({ value: _value }));
          }
          ;
        }
        ;
      }
      ;
      return [];
    });
  }
  renderSuggestion(suggestion, el) {
    el.setText(suggestion.value);
  }
  selectSuggestion(suggestion, event) {
    const activeView = this.app.workspace.getActiveViewOfType(import_obsidian18.MarkdownView);
    if (!activeView) {
      return;
    }
    ;
    const editor = activeView.editor;
    const activeLine = editor.getLine(this.context.start.line);
    if (this.inFrontmatter) {
      try {
        let parsedField = (0, import_obsidian18.parseYaml)(activeLine);
        let [attr, pastValues] = Object.entries(parsedField)[0];
        let newField;
        if (!pastValues) {
          newField = attr + ": " + suggestion.value;
        } else if (typeof pastValues == "string") {
          if (!pastValues.contains(",")) {
            newField = attr + ": " + suggestion.value;
          } else {
            newField = attr + ": [" + pastValues.split(",").map((o) => o.trim()).slice(0, -1).join(", ") + ", " + suggestion.value + "]";
          }
        } else if (Array.isArray(pastValues)) {
          if (activeLine.endsWith(",]") || activeLine.endsWith(", ]")) {
            newField = attr + ": [" + [...pastValues, suggestion.value].join(", ") + "]";
          } else {
            newField = attr + ": [" + [...pastValues.slice(0, -1), suggestion.value].join(", ") + "]";
          }
        } else {
          newField = attr + ": [" + [...pastValues].join(", ") + "]";
        }
        editor.replaceRange(newField, { line: this.context.start.line, ch: 0 }, { line: this.context.start.line, ch: activeLine.length });
        if (Array.isArray(pastValues) || typeof pastValues === "string" && pastValues.contains(",")) {
          editor.setCursor({ line: this.context.start.line, ch: newField.length - 1 });
        } else {
          editor.setCursor({ line: this.context.start.line, ch: newField.length });
        }
      } catch (error) {
        new import_obsidian18.Notice("Frontmatter wrongly formatted", 2e3);
        this.close();
        return;
      }
    } else {
      let cleanedLine = activeLine;
      while (![",", ":"].contains(cleanedLine.charAt(cleanedLine.length - 1))) {
        cleanedLine = cleanedLine.slice(0, -1);
      }
      editor.replaceRange(`${cleanedLine}${event.shiftKey ? " " : ""}` + suggestion.value, { line: this.context.start.line, ch: 0 }, this.context.end);
    }
    this.didSelect = true;
    this.close();
  }
};

// main.ts
var MetadataMenu = class extends import_obsidian19.Plugin {
  constructor() {
    super(...arguments);
    this.initialProperties = [];
  }
  onload() {
    return __async(this, null, function* () {
      console.log("Metadata Menu loaded");
      yield this.loadSettings();
      this.registerEditorSuggest(new ValueSuggest(this.app, this));
      this.settings.presetFields.forEach((prop) => {
        const property = new Field_default();
        Object.assign(property, prop);
        this.initialProperties.push(property);
      });
      this.addSettingTab(new MetadataMenuSettingTab(this.app, this));
      this.api = new MetadataMenuApi(this).make();
      this.addCommand({
        id: "field_options",
        name: "field options",
        checkCallback: (checking) => {
          const view = this.app.workspace.getActiveViewOfType(import_obsidian19.MarkdownView);
          if (checking) {
            return !!(view == null ? void 0 : view.file);
          }
          const fieldsOptionsModal = new NoteFieldsCommandsModal(this.app, this, view.file);
          fieldsOptionsModal.open();
        }
      });
      this.addCommand({
        id: "fileClassAttr_options",
        name: "fileClass attributes options",
        checkCallback: (checking) => {
          const view = this.app.workspace.getActiveViewOfType(import_obsidian19.MarkdownView);
          if (checking) {
            return !!(view == null ? void 0 : view.file) && `${view.file.parent.path}/` == this.settings.classFilesPath;
          }
          const modal = new FileClassAttributeSelectModal(this, view.file);
          modal.open();
        }
      });
      new linkContextMenu(this);
    });
  }
  onunload() {
    console.log("Metadata Menu unloaded");
  }
  loadSettings() {
    return __async(this, null, function* () {
      this.settings = Object.assign({}, DEFAULT_SETTINGS, yield this.loadData());
    });
  }
  saveSettings() {
    return __async(this, null, function* () {
      this.settings.presetFields = this.initialProperties;
      yield this.saveData(this.settings);
    });
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyIsICJzcmMvc2V0dGluZ3MvTWV0YWRhdGFNZW51U2V0dGluZ1RhYi50cyIsICJzcmMvc2V0dGluZ3MvRmllbGRTZXR0aW5nc01vZGFsLnRzIiwgInNyYy9GaWVsZC50cyIsICJzcmMvc2V0dGluZ3MvRmllbGRTZXR0aW5nLnRzIiwgInNyYy9zZXR0aW5ncy9NZXRhZGF0YU1lbnVTZXR0aW5ncy50cyIsICJzcmMvdXRpbHMvcGFyc2VyLnRzIiwgInNyYy9jb21tYW5kcy9nZXRWYWx1ZXMudHMiLCAic3JjL2NvbW1hbmRzL3JlcGxhY2VWYWx1ZXMudHMiLCAic3JjL2NvbW1hbmRzL2ZpZWxkV2l0aE1lbnUudHMiLCAic3JjL01ldGFkYXRhTWVudUFwaS50cyIsICJzcmMvb3B0aW9ucy9saW5rQ29udGV4dE1lbnUudHMiLCAic3JjL29wdGlvbk1vZGFscy92YWx1ZU11bHRpU2VsZWN0TW9kYWwudHMiLCAic3JjL29wdGlvbk1vZGFscy92YWx1ZVRleHRJbnB1dE1vZGFsLnRzIiwgInNyYy9vcHRpb25Nb2RhbHMvdmFsdWVUb2dnbGVNb2RhbC50cyIsICJzcmMvb3B0aW9uTW9kYWxzL3ZhbHVlU2VsZWN0TW9kYWwudHMiLCAic3JjL29wdGlvbk1vZGFscy9jaG9vc2VTZWN0aW9uTW9kYWwudHMiLCAic3JjL29wdGlvbk1vZGFscy9maWVsZFNlbGVjdE1vZGFsLnRzIiwgInNyYy9vcHRpb25Nb2RhbHMvYWRkTmV3RmllbGRNb2RhbC50cyIsICJzcmMvZmlsZUNsYXNzL2ZpbGVDbGFzc0F0dHJpYnV0ZS50cyIsICJzcmMvZmlsZUNsYXNzL2ZpbGVDbGFzcy50cyIsICJzcmMvZmlsZUNsYXNzL0ZpbGVDbGFzc0F0dHJpYnV0ZVNlbGVjdE1vZGFsLnRzIiwgInNyYy9maWxlQ2xhc3MvRmlsZUNsYXNzQXR0cmlidXRlTW9kYWwudHMiLCAic3JjL29wdGlvbnMvT3B0aW9uc0xpc3QudHMiLCAic3JjL29wdGlvbnMvTm90ZUZpZWxkc0NvbW1hbmRzTW9kYWwudHMiLCAic3JjL29wdGlvbk1vZGFscy9TZWxlY3RNb2RhbC50cyIsICJzcmMvc3VnZ2VzdGVyL01ldGFkYXRhU3VnZ2VzdGVyLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgeyBQbHVnaW4sIE1hcmtkb3duVmlldyB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCBNZXRhZGF0YU1lbnVTZXR0aW5nVGFiIGZyb20gXCJzcmMvc2V0dGluZ3MvTWV0YWRhdGFNZW51U2V0dGluZ1RhYlwiO1xuaW1wb3J0IHsgTWV0YWRhdGFNZW51U2V0dGluZ3MsIERFRkFVTFRfU0VUVElOR1MgfSBmcm9tIFwic3JjL3NldHRpbmdzL01ldGFkYXRhTWVudVNldHRpbmdzXCI7XG5pbXBvcnQgdHlwZSB7IElNZXRhZGF0YU1lbnVBcGkgfSBmcm9tICdzcmMvTWV0YWRhdGFNZW51QXBpJztcbmltcG9ydCB7IE1ldGFkYXRhTWVudUFwaSB9IGZyb20gJ3NyYy9NZXRhZGF0YU1lbnVBcGknO1xuaW1wb3J0IEZpZWxkIGZyb20gJ3NyYy9GaWVsZCc7XG5pbXBvcnQgbGlua0NvbnRleHRNZW51IGZyb20gXCJzcmMvb3B0aW9ucy9saW5rQ29udGV4dE1lbnVcIjtcbmltcG9ydCBOb3RlRmllbGRzQ29tbWFuZHNNb2RhbCBmcm9tIFwic3JjL29wdGlvbnMvTm90ZUZpZWxkc0NvbW1hbmRzTW9kYWxcIjtcbmltcG9ydCBGaWxlQ2xhc3NBdHRyaWJ1dGVTZWxlY3RNb2RhbCBmcm9tICdzcmMvZmlsZUNsYXNzL0ZpbGVDbGFzc0F0dHJpYnV0ZVNlbGVjdE1vZGFsJztcbmltcG9ydCBWYWx1ZVN1Z2dlc3QgZnJvbSBcInNyYy9zdWdnZXN0ZXIvTWV0YWRhdGFTdWdnZXN0ZXJcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTWV0YWRhdGFNZW51IGV4dGVuZHMgUGx1Z2luIHtcblx0cHVibGljIGFwaTogSU1ldGFkYXRhTWVudUFwaTtcblx0cHVibGljIHNldHRpbmdzOiBNZXRhZGF0YU1lbnVTZXR0aW5ncztcblx0cHVibGljIGluaXRpYWxQcm9wZXJ0aWVzOiBBcnJheTxGaWVsZD4gPSBbXTtcblx0cHVibGljIHNldHRpbmdUYWI6IE1ldGFkYXRhTWVudVNldHRpbmdUYWI7XG5cblx0YXN5bmMgb25sb2FkKCk6IFByb21pc2U8dm9pZD4ge1xuXHRcdGNvbnNvbGUubG9nKCdNZXRhZGF0YSBNZW51IGxvYWRlZCcpO1xuXHRcdGF3YWl0IHRoaXMubG9hZFNldHRpbmdzKCk7XG5cdFx0dGhpcy5yZWdpc3RlckVkaXRvclN1Z2dlc3QobmV3IFZhbHVlU3VnZ2VzdCh0aGlzLmFwcCwgdGhpcykpO1xuXG5cdFx0dGhpcy5zZXR0aW5ncy5wcmVzZXRGaWVsZHMuZm9yRWFjaChwcm9wID0+IHtcblx0XHRcdGNvbnN0IHByb3BlcnR5ID0gbmV3IEZpZWxkKCk7XG5cdFx0XHRPYmplY3QuYXNzaWduKHByb3BlcnR5LCBwcm9wKTtcblx0XHRcdHRoaXMuaW5pdGlhbFByb3BlcnRpZXMucHVzaChwcm9wZXJ0eSk7XG5cdFx0fSk7XG5cdFx0dGhpcy5hZGRTZXR0aW5nVGFiKG5ldyBNZXRhZGF0YU1lbnVTZXR0aW5nVGFiKHRoaXMuYXBwLCB0aGlzKSk7XG5cdFx0dGhpcy5hcGkgPSBuZXcgTWV0YWRhdGFNZW51QXBpKHRoaXMpLm1ha2UoKTtcblxuXHRcdHRoaXMuYWRkQ29tbWFuZCh7XG5cdFx0XHRpZDogXCJmaWVsZF9vcHRpb25zXCIsXG5cdFx0XHRuYW1lOiBcImZpZWxkIG9wdGlvbnNcIixcblx0XHRcdGNoZWNrQ2FsbGJhY2s6IChjaGVja2luZzogYm9vbGVhbikgPT4ge1xuXHRcdFx0XHRjb25zdCB2aWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KVxuXHRcdFx0XHRpZiAoY2hlY2tpbmcpIHtcblx0XHRcdFx0XHRyZXR1cm4gISEodmlldz8uZmlsZSlcblx0XHRcdFx0fVxuXHRcdFx0XHRjb25zdCBmaWVsZHNPcHRpb25zTW9kYWwgPSBuZXcgTm90ZUZpZWxkc0NvbW1hbmRzTW9kYWwodGhpcy5hcHAsIHRoaXMsIHZpZXchLmZpbGUpXG5cdFx0XHRcdGZpZWxkc09wdGlvbnNNb2RhbC5vcGVuKClcblx0XHRcdH0sXG5cdFx0fSk7XG5cblx0XHQvKiBUT0RPIDogYWRkIGEgY29udGV4dCBtZW51IGZvciBmaWxlQ2xhc3MgZmlsZXMgdG8gc2hvdyB0aGUgc2FtZSBvcHRpb25zIGFzIGluIEZpbGVDbGFzc0F0dHJpYnV0ZVNlbGVjdE1vZGFsKi9cblx0XHR0aGlzLmFkZENvbW1hbmQoe1xuXHRcdFx0aWQ6IFwiZmlsZUNsYXNzQXR0cl9vcHRpb25zXCIsXG5cdFx0XHRuYW1lOiBcImZpbGVDbGFzcyBhdHRyaWJ1dGVzIG9wdGlvbnNcIixcblx0XHRcdGNoZWNrQ2FsbGJhY2s6IChjaGVja2luZzogYm9vbGVhbikgPT4ge1xuXHRcdFx0XHRjb25zdCB2aWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KVxuXHRcdFx0XHRpZiAoY2hlY2tpbmcpIHtcblx0XHRcdFx0XHRyZXR1cm4gISEodmlldz8uZmlsZSkgJiYgYCR7dmlldy5maWxlLnBhcmVudC5wYXRofS9gID09IHRoaXMuc2V0dGluZ3MuY2xhc3NGaWxlc1BhdGhcblx0XHRcdFx0fVxuXHRcdFx0XHRjb25zdCBtb2RhbCA9IG5ldyBGaWxlQ2xhc3NBdHRyaWJ1dGVTZWxlY3RNb2RhbCh0aGlzLCB2aWV3IS5maWxlKVxuXHRcdFx0XHRtb2RhbC5vcGVuKClcblx0XHRcdH0sXG5cdFx0fSk7XG5cblx0XHRuZXcgbGlua0NvbnRleHRNZW51KHRoaXMpO1xuXHR9O1xuXG5cdG9udW5sb2FkKCkge1xuXHRcdGNvbnNvbGUubG9nKCdNZXRhZGF0YSBNZW51IHVubG9hZGVkJyk7XG5cdH07XG5cblx0YXN5bmMgbG9hZFNldHRpbmdzKCkge1xuXHRcdHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBhd2FpdCB0aGlzLmxvYWREYXRhKCkpO1xuXHR9O1xuXG5cdGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcblx0XHR0aGlzLnNldHRpbmdzLnByZXNldEZpZWxkcyA9IHRoaXMuaW5pdGlhbFByb3BlcnRpZXM7XG5cdFx0YXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcblx0fTtcbn1cbiIsICJpbXBvcnQgeyBBcHAsIFBsdWdpblNldHRpbmdUYWIsIFNldHRpbmcsIEJ1dHRvbkNvbXBvbmVudCwgVG9nZ2xlQ29tcG9uZW50LCBNb2RhbCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IE1ldGFkYXRhTWVudSBmcm9tIFwibWFpblwiO1xuaW1wb3J0IEZpZWxkU2V0dGluZ3NNb2RhbCBmcm9tIFwic3JjL3NldHRpbmdzL0ZpZWxkU2V0dGluZ3NNb2RhbFwiO1xuaW1wb3J0IEZpZWxkIGZyb20gXCJzcmMvRmllbGRcIjtcbmltcG9ydCBGaWVsZFNldHRpbmcgZnJvbSBcInNyYy9zZXR0aW5ncy9GaWVsZFNldHRpbmdcIjtcblxuY2xhc3MgU2V0dGluZ3NNaWdyYXRpb25Db25maXJtTW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG5cblx0cHJpdmF0ZSBwbHVnaW46IE1ldGFkYXRhTWVudTtcblx0cHJpdmF0ZSB0YWI6IE1ldGFkYXRhTWVudVNldHRpbmdUYWI7XG5cblx0Y29uc3RydWN0b3IocGx1Z2luOiBNZXRhZGF0YU1lbnUsIHRhYjogTWV0YWRhdGFNZW51U2V0dGluZ1RhYikge1xuXHRcdHN1cGVyKHBsdWdpbi5hcHApO1xuXHRcdHRoaXMucGx1Z2luID0gcGx1Z2luO1xuXHRcdHRoaXMudGFiID0gdGFiO1xuXHR9O1xuXG5cdG9uT3BlbigpOiB2b2lkIHtcblxuXHRcdHRoaXMudGl0bGVFbC5zZXRUZXh0KFwiQ29uZmlybVwiKTtcblx0XHRjb25zdCBib2R5ID0gdGhpcy5jb250ZW50RWwuY3JlYXRlRGl2KHtcblx0XHRcdGNsczogXCJtb2RhbC10ZXh0LWRhbmdlclwiXG5cdFx0fSk7XG5cdFx0Ym9keS5zZXRUZXh0KFwiVGhpcyB3aWxsIGVyYXNlIGN1cnJlbnQgc2V0dGluZ3MuIEFyZSB5b3Ugc3VyZT9cIik7XG5cdFx0Y29uc3QgY29uZmlybUJ1dHRvbiA9IG5ldyBCdXR0b25Db21wb25lbnQodGhpcy5jb250ZW50RWwpO1xuXHRcdGNvbmZpcm1CdXR0b24uc2V0SWNvbihcImNoZWNrXCIpO1xuXHRcdGNvbmZpcm1CdXR0b24ub25DbGljaygoKSA9PiB7XG5cdFx0XHQvL0B0cy1pZ25vcmVcblx0XHRcdGlmICh0aGlzLmFwcC5wbHVnaW5zLnBsdWdpbnMuaGFzT3duUHJvcGVydHkoXCJzdXBlcmNoYXJnZWQtbGlua3Mtb2JzaWRpYW5cIikpIHtcblx0XHRcdFx0Ly9AdHMtaWdub3JlXG5cdFx0XHRcdGxldCBzZXR0aW5ncyA9IHRoaXMuYXBwLnBsdWdpbnMucGx1Z2luc1tcInN1cGVyY2hhcmdlZC1saW5rcy1vYnNpZGlhblwiXS5zZXR0aW5ncztcblx0XHRcdFx0bGV0IF9zZXR0aW5ncyA9IHRoaXMucGx1Z2luLnNldHRpbmdzO1xuXHRcdFx0XHQvL2NvcHlpbmcgc2ltcGxlIHNldHRpbmdzXG5cdFx0XHRcdF9zZXR0aW5ncy5jbGFzc0ZpbGVzUGF0aCA9IHNldHRpbmdzLmNsYXNzRmlsZXNQYXRoO1xuXHRcdFx0XHRfc2V0dGluZ3MuZGlzcGxheUZpZWxkc0luQ29udGV4dE1lbnUgPSBzZXR0aW5ncy5kaXNwbGF5RmllbGRzSW5Db250ZXh0TWVudTtcblx0XHRcdFx0X3NldHRpbmdzLmdldEZyb21JbmxpbmVGaWVsZCA9IHNldHRpbmdzLmdldEZyb21JbmxpbmVGaWVsZDtcblx0XHRcdFx0X3NldHRpbmdzLmdsb2JhbGx5SWdub3JlZEZpZWxkcyA9IHNldHRpbmdzLmdsb2JhbGx5SWdub3JlZEZpZWxkcztcblx0XHRcdFx0Ly9kZWVwIGNvcHlpbmcgcHJlc2V0RmllbGRzIGluIGluaXRpYWxQcm9wZXJ0eVxuXHRcdFx0XHR0aGlzLnBsdWdpbi5pbml0aWFsUHJvcGVydGllcyA9IFtdO1xuXHRcdFx0XHRzZXR0aW5ncy5wcmVzZXRGaWVsZHMuZm9yRWFjaCgocHJvcDogRmllbGQpID0+IHtcblx0XHRcdFx0XHRjb25zdCBwcm9wZXJ0eSA9IG5ldyBGaWVsZCgpO1xuXHRcdFx0XHRcdE9iamVjdC5hc3NpZ24ocHJvcGVydHksIHByb3ApO1xuXHRcdFx0XHRcdHRoaXMucGx1Z2luLmluaXRpYWxQcm9wZXJ0aWVzLnB1c2gocHJvcGVydHkpO1xuXHRcdFx0XHR9KVxuXG5cdFx0XHRcdHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuXHRcdFx0XHR0aGlzLmNsb3NlKCk7XG5cdFx0XHR9O1xuXHRcdH0pO1xuXHR9O1xuXG5cdG9uQ2xvc2UoKTogdm9pZCB7XG5cdFx0dGhpcy50YWIuZGlzcGxheSgpO1xuXHR9O1xufTtcblxuXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1ldGFkYXRhTWVudVNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcblx0cHJpdmF0ZSBwbHVnaW46IE1ldGFkYXRhTWVudTtcblxuXHRjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBNZXRhZGF0YU1lbnUpIHtcblx0XHRzdXBlcihhcHAsIHBsdWdpbik7XG5cdFx0dGhpcy5wbHVnaW4gPSBwbHVnaW47XG5cdH07XG5cblx0ZGlzcGxheSgpOiB2b2lkIHtcblx0XHRsZXQgeyBjb250YWluZXJFbCB9ID0gdGhpcztcblxuXHRcdGNvbnRhaW5lckVsLmVtcHR5KCk7XG5cblx0XHRjb250YWluZXJFbC5jcmVhdGVFbCgnaDQnLCB7IHRleHQ6ICdTZXR0aW5ncycgfSk7XG5cblx0XHQvLyBNYW5hZ2luZyBjaG9pY2Ugd2hldGhlciB5b3UgZ2V0IGF0dHJpYnV0ZXMgZnJvbSBpbmxpbmUgZmllbGRzIGFuZCBmcm9udG1hdHRlciBvciBvbmx5IGZyb250bWF0ZXJcblx0XHRuZXcgU2V0dGluZyhjb250YWluZXJFbClcblx0XHRcdC5zZXROYW1lKCdTZWFyY2ggZm9yIGF0dHJpYnV0ZSBpbiBJbmxpbmUgZmllbGRzIGxpa2UgPGZpZWxkOjo+Jylcblx0XHRcdC5zZXREZXNjKCdTZXRzIHRoZSBgZGF0YS1saW5rLTxmaWVsZD5gLWF0dHJpYnV0ZSB0byB0aGUgdmFsdWUgb2YgaW5saW5lIGZpZWxkcycpXG5cdFx0XHQuYWRkVG9nZ2xlKHRvZ2dsZSA9PiB7XG5cdFx0XHRcdHRvZ2dsZS5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5nZXRGcm9tSW5saW5lRmllbGQpXG5cdFx0XHRcdHRvZ2dsZS5vbkNoYW5nZShhc3luYyB2YWx1ZSA9PiB7XG5cdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2V0RnJvbUlubGluZUZpZWxkID0gdmFsdWVcblx0XHRcdFx0XHRhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKVxuXHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXG5cdFx0LyogTWFuYWdpbmcgcHJlZGVmaW5lZCB2YWx1ZXMgZm9yIHByb3BlcnRpZXMgKi9cblx0XHQvKiBNYW5hZ2UgbWVudSBvcHRpb25zIGRpc3BsYXkqL1xuXHRcdG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuXHRcdFx0LnNldE5hbWUoXCJEaXNwbGF5IGZpZWxkIG9wdGlvbnMgaW4gY29udGV4dCBtZW51XCIpXG5cdFx0XHQuc2V0RGVzYyhcIkNob29zZSB0byBzaG93IG9yIGhpZGUgZmllbGRzIG9wdGlvbnMgaW4gdGhlIGNvbnRleHQgbWVudSBvZiBhIGxpbmsgb3IgYSBmaWxlXCIpXG5cdFx0XHQuYWRkVG9nZ2xlKCh0b2dnbGU6IFRvZ2dsZUNvbXBvbmVudCkgPT4ge1xuXHRcdFx0XHR0b2dnbGUuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZGlzcGxheUZpZWxkc0luQ29udGV4dE1lbnUpXG5cdFx0XHRcdHRvZ2dsZS5vbkNoYW5nZShhc3luYyB2YWx1ZSA9PiB7XG5cdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2V0dGluZ3MuZGlzcGxheUZpZWxkc0luQ29udGV4dE1lbnUgPSB2YWx1ZVxuXHRcdFx0XHRcdGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdFx0LyogRXhjbHVkZSBGaWVsZHMgZnJvbSBjb250ZXh0IG1lbnUqL1xuXHRcdG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuXHRcdFx0LnNldE5hbWUoJ0lnbm9yZWQgZmllbGRzJylcblx0XHRcdC5zZXREZXNjKCdGaWVsZHMgdG8gYmUgaWdub3JlZCBieSB0aGUgcGx1Z2luIHdoZW4gYWRkaW5nIG9wdGlvbnMgdG8gdGhlIGNvbnRleHQgbWVudScpXG5cdFx0XHQuYWRkVGV4dEFyZWEoKHRleHQpID0+IHtcblx0XHRcdFx0dGV4dFxuXHRcdFx0XHRcdC5zZXRQbGFjZWhvbGRlcignRW50ZXIgZmllbGRzIGFzIHN0cmluZywgY29tbWEgc2VwYXJhdGVkJylcblx0XHRcdFx0XHQuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2xvYmFsbHlJZ25vcmVkRmllbGRzLmpvaW4oJywgJykpXG5cdFx0XHRcdFx0Lm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2xvYmFsbHlJZ25vcmVkRmllbGRzID0gdmFsdWUucmVwbGFjZSgvXFxzL2csICcnKS5zcGxpdCgnLCcpO1xuXHRcdFx0XHRcdFx0YXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdHRleHQuaW5wdXRFbC5yb3dzID0gNjtcblx0XHRcdFx0dGV4dC5pbnB1dEVsLmNvbHMgPSAyNTtcblx0XHRcdH0pO1xuXG5cdFx0LyogU2V0IGNsYXNzRmlsZXMgUGF0aCovXG5cdFx0bmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG5cdFx0XHQuc2V0TmFtZSgnY2xhc3MgRmlsZXMgcGF0aCcpXG5cdFx0XHQuc2V0RGVzYygnUGF0aCB0byB0aGUgZmlsZXMgY29udGFpbmluZyB0aGUgYXV0aG9yaXplZCBmaWVsZHMgZm9yIGEgdHlwZSBvZiBub3RlJylcblx0XHRcdC5hZGRUZXh0KCh0ZXh0KSA9PiB7XG5cdFx0XHRcdHRleHRcblx0XHRcdFx0XHQuc2V0UGxhY2Vob2xkZXIoJ1BhdGgvJylcblx0XHRcdFx0XHQuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuY2xhc3NGaWxlc1BhdGgpXG5cdFx0XHRcdFx0Lm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2V0dGluZ3MuY2xhc3NGaWxlc1BhdGggPSB2YWx1ZVxuXHRcdFx0XHRcdFx0YXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblxuXHRcdC8qIFNldCBmaWxlQ2xhc3MgYWxpYXMqL1xuXHRcdG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuXHRcdFx0LnNldE5hbWUoJ2ZpbGVDbGFzcyBmaWVsZCBhbGlhcycpXG5cdFx0XHQuc2V0RGVzYygnQ2hvb3NlIGFub3RoZXIgbmFtZSBmb3IgZmlsZUNsYXNzIGZpZWxkIGluIGZyb250bWF0dGVyIChleGFtcGxlOiBDYXRlZ29yeSwgdHlwZSwgLi4uJylcblx0XHRcdC5hZGRUZXh0KCh0ZXh0KSA9PiB7XG5cdFx0XHRcdHRleHRcblx0XHRcdFx0XHQuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZmlsZUNsYXNzQWxpYXMpXG5cdFx0XHRcdFx0Lm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2V0dGluZ3MuZmlsZUNsYXNzQWxpYXMgPSB2YWx1ZTtcblx0XHRcdFx0XHRcdGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cblx0XHQvKiBBZGQgbmV3IHByb3BlcnR5IGZvciB3aGljaCB3ZSB3YW50IHRvIHByZXNldCB2YWx1ZXMqL1xuXHRcdG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuXHRcdFx0LnNldE5hbWUoXCJBZGQgTmV3IFByb3BlcnR5IE1hbmFnZXJcIilcblx0XHRcdC5zZXREZXNjKFwiQWRkIGEgbmV3IEZyb250bWF0dGVyIHByb3BlcnR5IGZvciB3aGljaCB5b3Ugd2FudCBwcmVzZXQgdmFsdWVzLlwiKVxuXHRcdFx0LmFkZEJ1dHRvbigoYnV0dG9uOiBCdXR0b25Db21wb25lbnQpOiBCdXR0b25Db21wb25lbnQgPT4ge1xuXHRcdFx0XHRyZXR1cm4gYnV0dG9uXG5cdFx0XHRcdFx0LnNldFRvb2x0aXAoXCJBZGQgTmV3IFByb3BlcnR5IE1hbmFnZXJcIilcblx0XHRcdFx0XHQuc2V0QnV0dG9uVGV4dChcIitcIilcblx0XHRcdFx0XHQub25DbGljayhhc3luYyAoKSA9PiB7XG5cdFx0XHRcdFx0XHRsZXQgbW9kYWwgPSBuZXcgRmllbGRTZXR0aW5nc01vZGFsKHRoaXMuYXBwLCB0aGlzLnBsdWdpbiwgY29udGFpbmVyRWwpO1xuXHRcdFx0XHRcdFx0bW9kYWwub3BlbigpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cblx0XHQvKiBNYW5hZ2VkIHByb3BlcnRpZXMgdGhhdCBjdXJyZW50bHkgaGF2ZSBwcmVzZXQgdmFsdWVzICovXG5cdFx0dGhpcy5wbHVnaW4uaW5pdGlhbFByb3BlcnRpZXMuZm9yRWFjaChwcm9wID0+IHtcblx0XHRcdGNvbnN0IHByb3BlcnR5ID0gbmV3IEZpZWxkKCk7XG5cdFx0XHRPYmplY3QuYXNzaWduKHByb3BlcnR5LCBwcm9wKTtcblx0XHRcdG5ldyBGaWVsZFNldHRpbmcoY29udGFpbmVyRWwsIHByb3BlcnR5LCB0aGlzLmFwcCwgdGhpcy5wbHVnaW4pO1xuXHRcdH0pO1xuXG5cdFx0Y29udGFpbmVyRWwuY3JlYXRlRWwoJ2g0JywgeyB0ZXh0OiAnTWlncmF0ZScgfSk7XG5cblx0XHQvKiBBZGQgbmV3IHByb3BlcnR5IGZvciB3aGljaCB3ZSB3YW50IHRvIHByZXNldCB2YWx1ZXMqL1xuXHRcdG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuXHRcdFx0LnNldE5hbWUoXCJDb3B5IHNldHRpbmdzIGZyb20gc3VwZXJjaGFyZ2VkIGxpbmtzIHBsdWdpblwiKVxuXHRcdFx0LnNldERlc2MoXCJDb3B5IHNldHRpbmdzIGZyb20gc3VwZXJjaGFyZ2VkIGxpbmtzIHBsdWdpblwiKVxuXHRcdFx0LmFkZEJ1dHRvbigoYnV0dG9uOiBCdXR0b25Db21wb25lbnQpOiBCdXR0b25Db21wb25lbnQgPT4ge1xuXHRcdFx0XHRyZXR1cm4gYnV0dG9uXG5cdFx0XHRcdFx0LnNldFRvb2x0aXAoXCJHZXQgc2V0dGluZ3MgZnJvbSBzdXBlcmNoYXJnZWQgbGlua3NcIilcblx0XHRcdFx0XHQuc2V0QnV0dG9uVGV4dChcIkNvcHlcIilcblx0XHRcdFx0XHQub25DbGljayhhc3luYyAoKSA9PiB7XG5cdFx0XHRcdFx0XHRsZXQgbW9kYWwgPSBuZXcgU2V0dGluZ3NNaWdyYXRpb25Db25maXJtTW9kYWwodGhpcy5wbHVnaW4sIHRoaXMpO1xuXHRcdFx0XHRcdFx0bW9kYWwub3BlbigpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdH07XG59O1xuIiwgImltcG9ydCB7IEFwcCwgTW9kYWwsIFNldHRpbmcsIFRleHRDb21wb25lbnQsIE5vdGljZSwgQnV0dG9uQ29tcG9uZW50LCBFeHRyYUJ1dHRvbkNvbXBvbmVudCwgVG9nZ2xlQ29tcG9uZW50IH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgTWV0YWRhdGFNZW51IGZyb20gXCJtYWluXCI7XG5pbXBvcnQgRmllbGQgZnJvbSBcInNyYy9GaWVsZFwiO1xuaW1wb3J0IEZpZWxkU2V0dGluZyBmcm9tIFwic3JjL3NldHRpbmdzL0ZpZWxkU2V0dGluZ1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBGaWVsZFNldHRpbmdzTW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG4gICAgcHJpdmF0ZSBuYW1lUHJvbXB0Q29tcG9uZW50OiBUZXh0Q29tcG9uZW50O1xuICAgIHByaXZhdGUgdmFsdWVzUHJvbXB0Q29tcG9uZW50czogQXJyYXk8VGV4dENvbXBvbmVudD4gPSBbXTtcbiAgICBwcml2YXRlIGlzTXVsdGlUb2dnbGVyQ29tcG9uZW50OiBUb2dnbGVDb21wb25lbnQ7XG4gICAgcHJpdmF0ZSBpc0N5Y2xlVG9nZ2xlckNvbXBvbmVudDogVG9nZ2xlQ29tcG9uZW50O1xuICAgIHByaXZhdGUgc2F2ZWQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBwcml2YXRlIHByb3BlcnR5OiBGaWVsZDtcbiAgICBwcml2YXRlIHBsdWdpbjogTWV0YWRhdGFNZW51O1xuICAgIHByaXZhdGUgaW5pdGlhbFByb3BlcnR5OiBGaWVsZDtcbiAgICBwcml2YXRlIHBhcmVudFNldHRpbmc/OiBTZXR0aW5nO1xuICAgIHByaXZhdGUgbmV3OiBib29sZWFuID0gdHJ1ZTtcbiAgICBwcml2YXRlIHBhcmVudFNldHRpbmdDb250YWluZXI6IEhUTUxFbGVtZW50O1xuXG5cbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBNZXRhZGF0YU1lbnUsIHBhcmVudFNldHRpbmdDb250YWluZXI6IEhUTUxFbGVtZW50LCBwYXJlbnRTZXR0aW5nPzogU2V0dGluZywgcHJvcGVydHk/OiBGaWVsZCkge1xuICAgICAgICBzdXBlcihhcHApO1xuICAgICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICAgICAgdGhpcy5wYXJlbnRTZXR0aW5nID0gcGFyZW50U2V0dGluZztcbiAgICAgICAgdGhpcy5pbml0aWFsUHJvcGVydHkgPSBuZXcgRmllbGQoKTtcbiAgICAgICAgdGhpcy5wYXJlbnRTZXR0aW5nQ29udGFpbmVyID0gcGFyZW50U2V0dGluZ0NvbnRhaW5lcjtcbiAgICAgICAgaWYgKHByb3BlcnR5KSB7XG4gICAgICAgICAgICB0aGlzLm5ldyA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5wcm9wZXJ0eSA9IHByb3BlcnR5O1xuICAgICAgICAgICAgdGhpcy5pbml0aWFsUHJvcGVydHkubmFtZSA9IHByb3BlcnR5Lm5hbWU7XG4gICAgICAgICAgICB0aGlzLmluaXRpYWxQcm9wZXJ0eS5pZCA9IHByb3BlcnR5LmlkO1xuICAgICAgICAgICAgT2JqZWN0LmtleXMocHJvcGVydHkudmFsdWVzKS5mb3JFYWNoKGsgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaW5pdGlhbFByb3BlcnR5LnZhbHVlc1trXSA9IHByb3BlcnR5LnZhbHVlc1trXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbGV0IG5ld0lkID0gMTtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLmluaXRpYWxQcm9wZXJ0aWVzLmZvckVhY2gocHJvcCA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHBhcnNlSW50KHByb3AuaWQpICYmIHBhcnNlSW50KHByb3AuaWQpID49IG5ld0lkKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld0lkID0gcGFyc2VJbnQocHJvcC5pZCkgKyAxO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMucHJvcGVydHkgPSBuZXcgRmllbGQoKTtcbiAgICAgICAgICAgIHRoaXMucHJvcGVydHkuaWQgPSBuZXdJZC50b1N0cmluZygpO1xuICAgICAgICAgICAgdGhpcy5pbml0aWFsUHJvcGVydHkuaWQgPSBuZXdJZC50b1N0cmluZygpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBhc3luYyBvbk9wZW4oKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGlmICh0aGlzLnByb3BlcnR5Lm5hbWUgPT0gXCJcIikge1xuICAgICAgICAgICAgdGhpcy50aXRsZUVsLnNldFRleHQoYEFkZCBhIHByb3BlcnR5IGFuZCBzZXQgcHJlZGVmaW5lZGApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy50aXRsZUVsLnNldFRleHQoYE1hbmFnZSBzZXR0aW5ncyB2YWx1ZXMgZm9yICR7dGhpcy5wcm9wZXJ0eS5uYW1lfWApO1xuICAgICAgICB9O1xuICAgICAgICBhd2FpdCB0aGlzLmNyZWF0ZUZvcm0oKTtcbiAgICB9O1xuXG4gICAgb25DbG9zZSgpOiB2b2lkIHtcbiAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLnByb3BlcnR5LCB0aGlzLmluaXRpYWxQcm9wZXJ0eSk7XG4gICAgICAgIGlmICghdGhpcy5uZXcgJiYgdGhpcy5wYXJlbnRTZXR0aW5nKSB7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFNldHRpbmcuaW5mb0VsLnRleHRDb250ZW50ID1cbiAgICAgICAgICAgICAgICBgJHt0aGlzLnByb3BlcnR5Lm5hbWV9OiBbJHtPYmplY3Qua2V5cyh0aGlzLnByb3BlcnR5LnZhbHVlcykubWFwKGsgPT4gdGhpcy5wcm9wZXJ0eS52YWx1ZXNba10pLmpvaW4oJywgJyl9XWA7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5zYXZlZCkge1xuICAgICAgICAgICAgbmV3IEZpZWxkU2V0dGluZyh0aGlzLnBhcmVudFNldHRpbmdDb250YWluZXIsIHRoaXMucHJvcGVydHksIHRoaXMuYXBwLCB0aGlzLnBsdWdpbik7XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIHByaXZhdGUgc2V0VmFsdWVMaXN0VGV4dChoZWFkZXI6IEhUTUxEaXZFbGVtZW50KTogdm9pZCB7XG4gICAgICAgIGhlYWRlci5zZXRUZXh0KGBQcmVzZXQgdmFsdWVzOiAke09iamVjdC52YWx1ZXModGhpcy5wcm9wZXJ0eS52YWx1ZXMpLmpvaW4oJywgJyl9YCk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgY3JlYXRlbmFtZUlucHV0Q29udGFpbmVyKHBhcmVudE5vZGU6IEhUTUxEaXZFbGVtZW50KTogVGV4dENvbXBvbmVudCB7XG4gICAgICAgIGNvbnN0IHByb3BlcnR5TmFtZUNvbnRhaW5lckxhYmVsID0gcGFyZW50Tm9kZS5jcmVhdGVEaXYoKTtcbiAgICAgICAgcHJvcGVydHlOYW1lQ29udGFpbmVyTGFiZWwuc2V0VGV4dChgUHJvcGVydHkgTmFtZTpgKTtcbiAgICAgICAgY29uc3QgaW5wdXQgPSBuZXcgVGV4dENvbXBvbmVudChwYXJlbnROb2RlKTtcbiAgICAgICAgY29uc3QgbmFtZSA9IHRoaXMucHJvcGVydHkubmFtZTtcbiAgICAgICAgaW5wdXQuc2V0VmFsdWUobmFtZSk7XG4gICAgICAgIGlucHV0LnNldFBsYWNlaG9sZGVyKFwiTmFtZSBvZiB0aGUgcHJvcGVydHlcIik7XG4gICAgICAgIGlucHV0Lm9uQ2hhbmdlKHZhbHVlID0+IHtcbiAgICAgICAgICAgIHRoaXMucHJvcGVydHkubmFtZSA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy50aXRsZUVsLnNldFRleHQoYE1hbmFnZSBwcmVkZWZpbmVkIHZhbHVlcyBmb3IgJHt0aGlzLnByb3BlcnR5Lm5hbWV9YCk7XG4gICAgICAgICAgICBGaWVsZFNldHRpbmdzTW9kYWwucmVtb3ZlVmFsaWRhdGlvbkVycm9yKGlucHV0KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBpbnB1dDtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBjcmVhdGVUb2dnbGVyQ29udGFpbmVyKHBhcmVudE5vZGU6IEhUTUxEaXZFbGVtZW50LCBsYWJlbDogc3RyaW5nKTogVG9nZ2xlQ29tcG9uZW50IHtcbiAgICAgICAgcGFyZW50Tm9kZS5hZGRDbGFzcyhcIm1ldGFkYXRhLW1lbnUtdG9nZ2xlXCIpXG4gICAgICAgIGNvbnN0IHByb3BlcnR5Q29udGFpbmVyTGFiZWwgPSBwYXJlbnROb2RlLmNyZWF0ZURpdih7IGNsczogJ2Zyb250bWF0dGVyLWNoZWNrYm94LXRvZ2dsZXInIH0pO1xuXG4gICAgICAgIHByb3BlcnR5Q29udGFpbmVyTGFiZWwuc2V0VGV4dChsYWJlbCk7XG4gICAgICAgIGNvbnN0IHRvZ2dsZXIgPSBuZXcgVG9nZ2xlQ29tcG9uZW50KHBhcmVudE5vZGUpO1xuICAgICAgICByZXR1cm4gdG9nZ2xlcjtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBjcmVhdGVMaXN0Tm90ZUNvbnRhaW5lcihwYXJlbnROb2RlOiBIVE1MRGl2RWxlbWVudCk6IFRleHRDb21wb25lbnQge1xuICAgICAgICBjb25zdCBsaXN0Tm90ZUNvbnRhaW5lckxhYmVsID0gcGFyZW50Tm9kZS5jcmVhdGVEaXYoeyBjbHM6IFwibWV0YWRhdGEtbWVudS1pbnB1dFwiIH0pO1xuICAgICAgICBsaXN0Tm90ZUNvbnRhaW5lckxhYmVsLnNldFRleHQoYFBhdGggb2YgdGhlIG5vdGUgY29udGFpbmluZyB0aGUgdmFsdWVzOmApO1xuXG4gICAgICAgIGNvbnN0IGlucHV0ID0gbmV3IFRleHRDb21wb25lbnQobGlzdE5vdGVDb250YWluZXJMYWJlbCk7XG4gICAgICAgIGNvbnN0IGxpc3ROb3RlUGF0aCA9IHRoaXMucHJvcGVydHkudmFsdWVzTGlzdE5vdGVQYXRoO1xuICAgICAgICBpbnB1dC5zZXRWYWx1ZShsaXN0Tm90ZVBhdGgpO1xuICAgICAgICBpbnB1dC5zZXRQbGFjZWhvbGRlcihcIlBhdGgvb2YvdGhlL25vdGUubWRcIik7XG4gICAgICAgIGlucHV0Lm9uQ2hhbmdlKHZhbHVlID0+IHRoaXMucHJvcGVydHkudmFsdWVzTGlzdE5vdGVQYXRoID0gdmFsdWUpO1xuICAgICAgICByZXR1cm4gaW5wdXQ7XG4gICAgfTtcblxuICAgIHByaXZhdGUgcmVtb3ZlUHJlc2V0VmFsdWUoa2V5OiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgbGV0IG5ld1ZhbHVlczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHt9O1xuICAgICAgICBmb3IgKGxldCBfa2V5IGluIHRoaXMucHJvcGVydHkudmFsdWVzKSB7XG4gICAgICAgICAgICBpZiAoa2V5ICE9PSBfa2V5KSB7XG4gICAgICAgICAgICAgICAgbmV3VmFsdWVzW19rZXldID0gdGhpcy5wcm9wZXJ0eS52YWx1ZXNbX2tleV07XG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnByb3BlcnR5LnZhbHVlcyA9IG5ld1ZhbHVlcztcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBjcmVhdGVWYWx1ZUNvbnRhaW5lcihwYXJlbnROb2RlOiBIVE1MRGl2RWxlbWVudCwgaGVhZGVyOiBIVE1MRGl2RWxlbWVudCwga2V5OiBzdHJpbmcpOiBUZXh0Q29tcG9uZW50IHtcbiAgICAgICAgY29uc3QgdmFsdWVzID0gdGhpcy5wcm9wZXJ0eS52YWx1ZXM7XG4gICAgICAgIGNvbnN0IHByZXNldFZhbHVlID0gdmFsdWVzW2tleV07XG4gICAgICAgIGNvbnN0IHZhbHVlQ29udGFpbmVyID0gcGFyZW50Tm9kZS5jcmVhdGVEaXYoe1xuICAgICAgICAgICAgY2xzOiAnbWV0YWRhdGEtbWVudS1wcm9tcHQtY29udGFpbmVyJyxcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGlucHV0ID0gbmV3IFRleHRDb21wb25lbnQodmFsdWVDb250YWluZXIpO1xuICAgICAgICBpbnB1dC5zZXRWYWx1ZShwcmVzZXRWYWx1ZSk7XG4gICAgICAgIGlucHV0Lm9uQ2hhbmdlKHZhbHVlID0+IHtcbiAgICAgICAgICAgIHRoaXMucHJvcGVydHkudmFsdWVzW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIHRoaXMuc2V0VmFsdWVMaXN0VGV4dChoZWFkZXIpO1xuICAgICAgICAgICAgRmllbGRTZXR0aW5nc01vZGFsLnJlbW92ZVZhbGlkYXRpb25FcnJvcihpbnB1dCk7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCB2YWx1ZVJlbW92ZUJ1dHRvbiA9IG5ldyBCdXR0b25Db21wb25lbnQodmFsdWVDb250YWluZXIpO1xuICAgICAgICB2YWx1ZVJlbW92ZUJ1dHRvbi5zZXRJY29uKFwidHJhc2hcIilcbiAgICAgICAgICAgIC5vbkNsaWNrKChldnQ6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQ7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVQcmVzZXRWYWx1ZShrZXkpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0VmFsdWVMaXN0VGV4dChoZWFkZXIpO1xuICAgICAgICAgICAgICAgIHBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodmFsdWVDb250YWluZXIpO1xuICAgICAgICAgICAgICAgIHRoaXMudmFsdWVzUHJvbXB0Q29tcG9uZW50cy5yZW1vdmUoaW5wdXQpO1xuXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgaWYgKGtleSAhPSBPYmplY3Qua2V5cyh0aGlzLnByb3BlcnR5LnZhbHVlcylbMF0pIHtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlVXBncmFkZUJ1dHRvbiA9IG5ldyBCdXR0b25Db21wb25lbnQodmFsdWVDb250YWluZXIpO1xuICAgICAgICAgICAgdmFsdWVVcGdyYWRlQnV0dG9uLnNldEJ1dHRvblRleHQoXCJcdTI1QjJcIik7XG4gICAgICAgICAgICB2YWx1ZVVwZ3JhZGVCdXR0b24ub25DbGljaygoZXZ0OiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGhpc1ZhbHVlID0gdmFsdWVzW2tleV07XG4gICAgICAgICAgICAgICAgY29uc3QgaW5wdXRJbmRleCA9IHRoaXMudmFsdWVzUHJvbXB0Q29tcG9uZW50cy5pbmRleE9mKGlucHV0KVxuICAgICAgICAgICAgICAgIGNvbnN0IHVwcGVyQ29tcG9uZW50ID0gaW5wdXRJbmRleCAhPT0gLTEgPyB0aGlzLnZhbHVlc1Byb21wdENvbXBvbmVudHNbaW5wdXRJbmRleCAtIDFdIDogdGhpcy52YWx1ZXNQcm9tcHRDb21wb25lbnRzLmxhc3QoKTtcbiAgICAgICAgICAgICAgICBpZiAodXBwZXJDb21wb25lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdXBwZXJWYWx1ZSA9IHVwcGVyQ29tcG9uZW50LmlucHV0RWwudmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHVwcGVyS2V5ID0gT2JqZWN0LmtleXModmFsdWVzKS5maWx0ZXIoayA9PiB2YWx1ZXNba10gPT0gdXBwZXJWYWx1ZSlbMF07XG4gICAgICAgICAgICAgICAgICAgIGlmICh1cHBlcktleSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBwZXJDb21wb25lbnQuc2V0VmFsdWUodGhpc1ZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlc1t1cHBlcktleV0gPSB0aGlzVmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5zZXRWYWx1ZSh1cHBlclZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlc1trZXldID0gdXBwZXJWYWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGlucHV0O1xuICAgIH07XG5cbiAgICBwcml2YXRlIGFzeW5jIGNyZWF0ZUZvcm0oKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnN0IGRpdiA9IHRoaXMuY29udGVudEVsLmNyZWF0ZURpdih7XG4gICAgICAgICAgICBjbHM6IFwibWV0YWRhdGEtbWVudS1wcm9tcHQtZGl2XCJcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IG1haW5EaXYgPSBkaXYuY3JlYXRlRGl2KHtcbiAgICAgICAgICAgIGNsczogXCJtZXRhZGF0YS1tZW51LXByb21wdC1mb3JtXCJcbiAgICAgICAgfSk7XG4gICAgICAgIC8qIFByb3BlcnR5IE5hbWUgU2VjdGlvbiAqL1xuICAgICAgICBjb25zdCBuYW1lQ29udGFpbmVyID0gbWFpbkRpdi5jcmVhdGVEaXYoKTtcbiAgICAgICAgdGhpcy5uYW1lUHJvbXB0Q29tcG9uZW50ID0gdGhpcy5jcmVhdGVuYW1lSW5wdXRDb250YWluZXIobmFtZUNvbnRhaW5lcik7XG5cbiAgICAgICAgbWFpbkRpdi5jcmVhdGVEaXYoeyBjbHM6ICdtZXRhZGF0YS1tZW51LXNlcGFyYXRvcicgfSkuY3JlYXRlRWwoXCJoclwiKTtcblxuICAgICAgICAvKiBQcm9wZXJ0eSBpcyBNdWx0aSBzZWN0aW9uKi9cblxuICAgICAgICBjb25zdCBtdWx0aUNvbnRhaW5lciA9IG1haW5EaXYuY3JlYXRlRGl2KHsgY2xzOiBcIm1ldGFkYXRhLW1lbnUtdG9nZ2xlXCIgfSk7XG4gICAgICAgIHRoaXMuaXNNdWx0aVRvZ2dsZXJDb21wb25lbnQgPSB0aGlzLmNyZWF0ZVRvZ2dsZXJDb250YWluZXIobXVsdGlDb250YWluZXIsIFwiSXMgTXVsdGk6IFwiKTtcbiAgICAgICAgdGhpcy5pc011bHRpVG9nZ2xlckNvbXBvbmVudC5zZXRWYWx1ZSh0aGlzLnByb3BlcnR5LmlzTXVsdGkpO1xuICAgICAgICB0aGlzLmlzTXVsdGlUb2dnbGVyQ29tcG9uZW50LnNldFRvb2x0aXAoXCJDYW4gdGhpcyBwcm9wZXJ0eSBoYXZlIG11bHRpcGxlIHZhbHVlcz9cIik7XG4gICAgICAgIHRoaXMuaXNNdWx0aVRvZ2dsZXJDb21wb25lbnQub25DaGFuZ2UodmFsdWUgPT4ge1xuICAgICAgICAgICAgdGhpcy5wcm9wZXJ0eS5pc011bHRpID0gdmFsdWU7XG4gICAgICAgICAgICBpZiAodGhpcy5wcm9wZXJ0eS5pc0N5Y2xlICYmIHRoaXMucHJvcGVydHkuaXNNdWx0aSkge1xuICAgICAgICAgICAgICAgIHRoaXMucHJvcGVydHkuaXNDeWNsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNDeWNsZVRvZ2dsZXJDb21wb25lbnQuc2V0VmFsdWUoZmFsc2UpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLyogUHJvcGVydHkgaXMgQ3ljbGUgc2VjdGlvbiovXG5cbiAgICAgICAgY29uc3QgY3ljbGVDb250YWluZXIgPSBtYWluRGl2LmNyZWF0ZURpdigpO1xuICAgICAgICB0aGlzLmlzQ3ljbGVUb2dnbGVyQ29tcG9uZW50ID0gdGhpcy5jcmVhdGVUb2dnbGVyQ29udGFpbmVyKGN5Y2xlQ29udGFpbmVyLCBcIklzIEN5Y2xlOiBcIik7XG4gICAgICAgIHRoaXMuaXNDeWNsZVRvZ2dsZXJDb21wb25lbnQuc2V0VmFsdWUodGhpcy5wcm9wZXJ0eS5pc0N5Y2xlKTtcbiAgICAgICAgdGhpcy5pc0N5Y2xlVG9nZ2xlckNvbXBvbmVudC5zZXRUb29sdGlwKFwiSXMgdGhpcyBwcm9wZXJ0eSdzIHZhbHVlcyBzZXQgaW4gY3ljbGUgbW9kZT9cIik7XG4gICAgICAgIHRoaXMuaXNDeWNsZVRvZ2dsZXJDb21wb25lbnQub25DaGFuZ2UodmFsdWUgPT4ge1xuICAgICAgICAgICAgdGhpcy5wcm9wZXJ0eS5pc0N5Y2xlID0gdmFsdWU7XG4gICAgICAgICAgICBpZiAodGhpcy5wcm9wZXJ0eS5pc0N5Y2xlICYmIHRoaXMucHJvcGVydHkuaXNNdWx0aSkge1xuICAgICAgICAgICAgICAgIHRoaXMucHJvcGVydHkuaXNNdWx0aSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNNdWx0aVRvZ2dsZXJDb21wb25lbnQuc2V0VmFsdWUoZmFsc2UpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgbWFpbkRpdi5jcmVhdGVEaXYoeyBjbHM6ICdtZXRhZGF0YS1tZW51LXNlcGFyYXRvcicgfSkuY3JlYXRlRWwoXCJoclwiKTtcblxuICAgICAgICAvKiBQcm9wZXJ0eSdzIG5vdGUgZm9yIGxpc3Qgb2YgVmFsdWVzICovXG5cbiAgICAgICAgY29uc3QgbGlzdE5vdGVQYXRoQ29udGFpbmVyID0gbWFpbkRpdi5jcmVhdGVEaXYoKTtcbiAgICAgICAgdGhpcy5jcmVhdGVMaXN0Tm90ZUNvbnRhaW5lcihsaXN0Tm90ZVBhdGhDb250YWluZXIpO1xuXG4gICAgICAgIG1haW5EaXYuY3JlYXRlRGl2KHsgY2xzOiAnbWV0YWRhdGEtbWVudS1zZXBhcmF0b3InIH0pLmNyZWF0ZUVsKFwiaHJcIik7XG5cbiAgICAgICAgLyogUHJvcGVydHkgVmFsdWVzICovXG4gICAgICAgIGNvbnN0IHZhbHVlc0xpc3QgPSBtYWluRGl2LmNyZWF0ZURpdigpO1xuICAgICAgICBjb25zdCB2YWx1ZXNMaXN0SGVhZGVyID0gdmFsdWVzTGlzdC5jcmVhdGVEaXYoKTtcbiAgICAgICAgdmFsdWVzTGlzdEhlYWRlci5jcmVhdGVFbChcImgyXCIpO1xuICAgICAgICB2YWx1ZXNMaXN0SGVhZGVyLnNldFRleHQoYFByZXNldCB2YWx1ZXM6ICR7T2JqZWN0LnZhbHVlcyh0aGlzLnByb3BlcnR5LnZhbHVlcykuam9pbignLCAnKX1gKTtcbiAgICAgICAgY29uc3QgdmFsdWVzTGlzdEJvZHkgPSB2YWx1ZXNMaXN0LmNyZWF0ZURpdigpO1xuICAgICAgICBPYmplY3Qua2V5cyh0aGlzLnByb3BlcnR5LnZhbHVlcykuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICAgICAgdGhpcy52YWx1ZXNQcm9tcHRDb21wb25lbnRzLnB1c2godGhpcy5jcmVhdGVWYWx1ZUNvbnRhaW5lcih2YWx1ZXNMaXN0Qm9keSwgdmFsdWVzTGlzdEhlYWRlciwga2V5KSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8qIEFkZCBhIG5ldyBWYWx1ZXMgKi9cbiAgICAgICAgY29uc3QgdmFsdWVzTGlzdEZvb3RlciA9IHZhbHVlc0xpc3QuY3JlYXRlRGl2KCk7XG4gICAgICAgIGNvbnN0IGFkZFZhbHVlID0gdmFsdWVzTGlzdEZvb3Rlci5jcmVhdGVFbCgnYnV0dG9uJyk7XG4gICAgICAgIGFkZFZhbHVlLnR5cGUgPSAnYnV0dG9uJztcbiAgICAgICAgYWRkVmFsdWUudGV4dENvbnRlbnQgPSAnQWRkJztcbiAgICAgICAgYWRkVmFsdWUub25DbGlja0V2ZW50KGFzeW5jIChldnQ6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdDtcbiAgICAgICAgICAgIGNvbnN0IG5ld0tleSA9IGF3YWl0IHRoaXMucHJvcGVydHkuaW5zZXJ0TmV3VmFsdWUoXCJcIilcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlVmFsdWVDb250YWluZXIodmFsdWVzTGlzdEJvZHksIHZhbHVlc0xpc3RIZWFkZXIsIG5ld0tleSlcbiAgICAgICAgfSk7XG5cbiAgICAgICAgbWFpbkRpdi5jcmVhdGVEaXYoeyBjbHM6ICdtZXRhZGF0YS1tZW51LXNlcGFyYXRvcicgfSkuY3JlYXRlRWwoXCJoclwiKTtcblxuICAgICAgICAvKiBmb290ZXIgYnV0dG9ucyovXG4gICAgICAgIGNvbnN0IGZvb3RlckVsID0gdGhpcy5jb250ZW50RWwuY3JlYXRlRGl2KCk7XG4gICAgICAgIGNvbnN0IGZvb3RlckJ1dHRvbnMgPSBuZXcgU2V0dGluZyhmb290ZXJFbCk7XG4gICAgICAgIGZvb3RlckJ1dHRvbnMuYWRkQnV0dG9uKChiKSA9PiB0aGlzLmNyZWF0ZVNhdmVCdXR0b24oYikpO1xuICAgICAgICBmb290ZXJCdXR0b25zLmFkZEV4dHJhQnV0dG9uKChiKSA9PiB0aGlzLmNyZWF0ZUNhbmNlbEJ1dHRvbihiKSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgY3JlYXRlU2F2ZUJ1dHRvbihiOiBCdXR0b25Db21wb25lbnQpOiBCdXR0b25Db21wb25lbnQge1xuICAgICAgICBiLnNldFRvb2x0aXAoXCJTYXZlXCIpXG4gICAgICAgICAgICAuc2V0SWNvbihcImNoZWNrbWFya1wiKVxuICAgICAgICAgICAgLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBlcnJvciA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmICgvXlsjPi1dLy50ZXN0KHRoaXMucHJvcGVydHkubmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgRmllbGRTZXR0aW5nc01vZGFsLnNldFZhbGlkYXRpb25FcnJvcihcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubmFtZVByb21wdENvbXBvbmVudCwgdGhpcy5uYW1lUHJvbXB0Q29tcG9uZW50LmlucHV0RWwsXG4gICAgICAgICAgICAgICAgICAgICAgICBcIlByb3BlcnR5IG5hbWUgY2Fubm90IHN0YXJ0IHdpdGggIywgPiwgLVwiXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgIGVycm9yID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnByb3BlcnR5Lm5hbWUgPT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICBGaWVsZFNldHRpbmdzTW9kYWwuc2V0VmFsaWRhdGlvbkVycm9yKFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5uYW1lUHJvbXB0Q29tcG9uZW50LCB0aGlzLm5hbWVQcm9tcHRDb21wb25lbnQuaW5wdXRFbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiUHJvcGVydHkgbmFtZSBjYW4gbm90IGJlIEVtcHR5XCJcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdGhpcy52YWx1ZXNQcm9tcHRDb21wb25lbnRzLmZvckVhY2goaW5wdXQgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoL15bIz4tXS8udGVzdChpbnB1dC5pbnB1dEVsLnZhbHVlKSAmJiBpbnB1dC5pbnB1dEVsLnBhcmVudEVsZW1lbnQ/Lmxhc3RFbGVtZW50Q2hpbGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIEZpZWxkU2V0dGluZ3NNb2RhbC5zZXRWYWxpZGF0aW9uRXJyb3IoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQsIGlucHV0LmlucHV0RWwucGFyZW50RWxlbWVudC5sYXN0RWxlbWVudENoaWxkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiVmFsdWVzIGNhbm5vdCBjYW5ub3Qgc3RhcnQgd2l0aCAjLCA+LCAtXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIGlmICgvWyxdL2d1LnRlc3QoaW5wdXQuaW5wdXRFbC52YWx1ZSkgJiYgaW5wdXQuaW5wdXRFbC5wYXJlbnRFbGVtZW50Py5sYXN0RWxlbWVudENoaWxkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBGaWVsZFNldHRpbmdzTW9kYWwuc2V0VmFsaWRhdGlvbkVycm9yKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0LCBpbnB1dC5pbnB1dEVsLnBhcmVudEVsZW1lbnQubGFzdEVsZW1lbnRDaGlsZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIlZhbHVlcyBjYW5ub3QgY29udGFpbiBhIGNvbW1hXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dC5pbnB1dEVsLnZhbHVlID09IFwiXCIgJiYgaW5wdXQuaW5wdXRFbC5wYXJlbnRFbGVtZW50Py5sYXN0RWxlbWVudENoaWxkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBGaWVsZFNldHRpbmdzTW9kYWwuc2V0VmFsaWRhdGlvbkVycm9yKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0LCBpbnB1dC5pbnB1dEVsLnBhcmVudEVsZW1lbnQubGFzdEVsZW1lbnRDaGlsZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIlZhbHVlcyBjYW4ndCBiZSBudWxsLlwiXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBuZXcgTm90aWNlKFwiRml4IGVycm9ycyBiZWZvcmUgc2F2aW5nLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdGhpcy5zYXZlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEV4aXN0aW5nUHJvcGVydHkgPSB0aGlzLnBsdWdpbi5pbml0aWFsUHJvcGVydGllcy5maWx0ZXIocCA9PiBwLmlkID09IHRoaXMucHJvcGVydHkuaWQpWzBdO1xuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50RXhpc3RpbmdQcm9wZXJ0eSkge1xuICAgICAgICAgICAgICAgICAgICBGaWVsZC5jb3B5UHJvcGVydHkoY3VycmVudEV4aXN0aW5nUHJvcGVydHksIHRoaXMucHJvcGVydHkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLmluaXRpYWxQcm9wZXJ0aWVzLnB1c2godGhpcy5wcm9wZXJ0eSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB0aGlzLmluaXRpYWxQcm9wZXJ0eSA9IHRoaXMucHJvcGVydHk7XG4gICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBiO1xuICAgIH07XG5cbiAgICBwcml2YXRlIGNyZWF0ZUNhbmNlbEJ1dHRvbihiOiBFeHRyYUJ1dHRvbkNvbXBvbmVudCk6IEV4dHJhQnV0dG9uQ29tcG9uZW50IHtcbiAgICAgICAgYi5zZXRJY29uKFwiY3Jvc3NcIilcbiAgICAgICAgICAgIC5zZXRUb29sdGlwKFwiQ2FuY2VsXCIpXG4gICAgICAgICAgICAub25DbGljaygoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zYXZlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIC8qIHJlc2V0IHZhbHVlcyBmcm9tIHNldHRpbmdzICovXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5pdGlhbFByb3BlcnR5Lm5hbWUgIT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMucHJvcGVydHksIHRoaXMuaW5pdGlhbFByb3BlcnR5KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gYjtcbiAgICB9O1xuXG4gICAgLyogdXRpbHMgZnVuY3Rpb25zICovXG5cbiAgICBwcml2YXRlIHN0YXRpYyBzZXRWYWxpZGF0aW9uRXJyb3IodGV4dElucHV0OiBUZXh0Q29tcG9uZW50LCBpbnNlcnRBZnRlcjogRWxlbWVudCwgbWVzc2FnZT86IHN0cmluZykge1xuICAgICAgICB0ZXh0SW5wdXQuaW5wdXRFbC5hZGRDbGFzcyhcImlzLWludmFsaWRcIik7XG4gICAgICAgIGlmIChtZXNzYWdlICYmIHRleHRJbnB1dC5pbnB1dEVsLnBhcmVudEVsZW1lbnQ/Lmxhc3RFbGVtZW50Q2hpbGQpIHtcblxuICAgICAgICAgICAgbGV0IG1EaXYgPSB0ZXh0SW5wdXQuaW5wdXRFbC5wYXJlbnRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgICAgICAgXCIuaW52YWxpZC1mZWVkYmFja1wiXG4gICAgICAgICAgICApIGFzIEhUTUxEaXZFbGVtZW50O1xuXG4gICAgICAgICAgICBpZiAoIW1EaXYpIHtcbiAgICAgICAgICAgICAgICBtRGl2ID0gY3JlYXRlRGl2KHsgY2xzOiBcImludmFsaWQtZmVlZGJhY2tcIiB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1EaXYuaW5uZXJUZXh0ID0gbWVzc2FnZTtcbiAgICAgICAgICAgIG1EaXYuaW5zZXJ0QWZ0ZXIoaW5zZXJ0QWZ0ZXIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHByaXZhdGUgc3RhdGljIHJlbW92ZVZhbGlkYXRpb25FcnJvcih0ZXh0SW5wdXQ6IFRleHRDb21wb25lbnQpIHtcbiAgICAgICAgaWYgKHRleHRJbnB1dC5pbnB1dEVsLmhhc0NsYXNzKFwiaXMtaW52YWxpZFwiKSAmJiB0ZXh0SW5wdXQuaW5wdXRFbC5wYXJlbnRFbGVtZW50Py5sYXN0RWxlbWVudENoaWxkKSB7XG4gICAgICAgICAgICB0ZXh0SW5wdXQuaW5wdXRFbC5yZW1vdmVDbGFzcyhcImlzLWludmFsaWRcIilcbiAgICAgICAgICAgIHRleHRJbnB1dC5pbnB1dEVsLnBhcmVudEVsZW1lbnQucmVtb3ZlQ2hpbGQoXG4gICAgICAgICAgICAgICAgdGV4dElucHV0LmlucHV0RWwucGFyZW50RWxlbWVudC5sYXN0RWxlbWVudENoaWxkXG4gICAgICAgICAgICApO1xuICAgICAgICB9O1xuICAgIH07XG59OyIsICJpbnRlcmZhY2UgRmllbGQge1xuICAgIGlkOiBzdHJpbmc7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIHZhbHVlczogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcbiAgICBpc0N5Y2xlOiBib29sZWFuO1xuICAgIGlzTXVsdGk6IGJvb2xlYW47XG4gICAgdmFsdWVzTGlzdE5vdGVQYXRoOiBzdHJpbmc7XG59XG5cbmNsYXNzIEZpZWxkIHtcblxuICAgIGNvbnN0cnVjdG9yKG5hbWU6IHN0cmluZyA9IFwiXCIsXG4gICAgICAgIHZhbHVlczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHt9LFxuICAgICAgICBpZDogc3RyaW5nID0gXCJcIixcbiAgICAgICAgaXNNdWx0aTogYm9vbGVhbiA9IGZhbHNlLFxuICAgICAgICBpc0N5Y2xlOiBib29sZWFuID0gZmFsc2UsXG4gICAgICAgIHZhbHVlc0xpc3ROb3RlUGF0aDogc3RyaW5nID0gXCJcIikge1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLnZhbHVlcyA9IHZhbHVlcztcbiAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICB0aGlzLmlzQ3ljbGUgPSBpc0N5Y2xlO1xuICAgICAgICB0aGlzLmlzTXVsdGkgPSBpc011bHRpO1xuICAgICAgICB0aGlzLnZhbHVlc0xpc3ROb3RlUGF0aCA9IHZhbHVlc0xpc3ROb3RlUGF0aDtcbiAgICAgICAgdGhpcy5pbnNlcnROZXdWYWx1ZS5iaW5kKHRoaXMpO1xuICAgIH07XG5cbiAgICBwdWJsaWMgYXN5bmMgaW5zZXJ0TmV3VmFsdWUodmFsdWU6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIGxldCBuZXdLZXkgPSAxO1xuICAgICAgICBPYmplY3Qua2V5cyh0aGlzLnZhbHVlcykuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICAgICAgaWYgKHBhcnNlSW50KGtleSkgJiYgcGFyc2VJbnQoa2V5KSA+PSBuZXdLZXkpIHtcbiAgICAgICAgICAgICAgICBuZXdLZXkgPSBwYXJzZUludChrZXkpICsgMTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnZhbHVlc1tuZXdLZXkudG9TdHJpbmcoKV0gPSB2YWx1ZTtcbiAgICAgICAgcmV0dXJuIG5ld0tleS50b1N0cmluZygpO1xuICAgIH07XG5cbiAgICBzdGF0aWMgY29weVByb3BlcnR5KHRhcmdldDogRmllbGQsIHNvdXJjZTogRmllbGQpIHtcbiAgICAgICAgdGFyZ2V0LmlkID0gc291cmNlLmlkO1xuICAgICAgICB0YXJnZXQubmFtZSA9IHNvdXJjZS5uYW1lO1xuICAgICAgICB0YXJnZXQuaXNDeWNsZSA9IHNvdXJjZS5pc0N5Y2xlO1xuICAgICAgICB0YXJnZXQuaXNNdWx0aSA9IHNvdXJjZS5pc011bHRpO1xuICAgICAgICB0YXJnZXQudmFsdWVzTGlzdE5vdGVQYXRoID0gc291cmNlLnZhbHVlc0xpc3ROb3RlUGF0aDtcbiAgICAgICAgT2JqZWN0LmtleXMoc291cmNlLnZhbHVlcykuZm9yRWFjaChrID0+IHtcbiAgICAgICAgICAgIHRhcmdldC52YWx1ZXNba10gPSBzb3VyY2UudmFsdWVzW2tdO1xuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmtleXModGFyZ2V0LnZhbHVlcykuZm9yRWFjaChrID0+IHtcbiAgICAgICAgICAgIGlmICghT2JqZWN0LmtleXMoc291cmNlLnZhbHVlcykuaW5jbHVkZXMoaykpIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgdGFyZ2V0LnZhbHVlc1trXTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH07XG59O1xuXG5leHBvcnQgZGVmYXVsdCBGaWVsZDsiLCAiaW1wb3J0IHsgQXBwLCBTZXR0aW5nLCBURmlsZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IE1ldGFkYXRhTWVudSBmcm9tIFwibWFpblwiO1xuaW1wb3J0IEZpZWxkIGZyb20gXCJzcmMvRmllbGRcIjtcbmltcG9ydCBGaWVsZFNldHRpbmdzTW9kYWwgZnJvbSBcInNyYy9zZXR0aW5ncy9GaWVsZFNldHRpbmdzTW9kYWxcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRmllbGRTZXR0aW5nIGV4dGVuZHMgU2V0dGluZyB7XG4gICAgcHJpdmF0ZSBwcm9wZXJ0eTogRmllbGQ7XG4gICAgcHJpdmF0ZSBhcHA6IEFwcDtcbiAgICBwcml2YXRlIHBsdWdpbjogTWV0YWRhdGFNZW51O1xuICAgIHByaXZhdGUgY29udGFpbmVyRWw6IEhUTUxFbGVtZW50O1xuICAgIGNvbnN0cnVjdG9yKGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCwgcHJvcGVydHk6IEZpZWxkLCBhcHA6IEFwcCwgcGx1Z2luOiBNZXRhZGF0YU1lbnUpIHtcbiAgICAgICAgc3VwZXIoY29udGFpbmVyRWwpO1xuICAgICAgICB0aGlzLmNvbnRhaW5lckVsID0gY29udGFpbmVyRWw7XG4gICAgICAgIHRoaXMucHJvcGVydHkgPSBwcm9wZXJ0eTtcbiAgICAgICAgdGhpcy5hcHAgPSBhcHA7XG4gICAgICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgICAgICB0aGlzLnNldFRleHRDb250ZW50V2l0aG5hbWUoKTtcbiAgICAgICAgdGhpcy5hZGRFZGl0QnV0dG9uKCk7XG4gICAgICAgIHRoaXMuYWRkRGVsZXRlQnV0dG9uKCk7XG5cbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBzZXRUZXh0Q29udGVudFdpdGhuYW1lKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmluZm9FbC50ZXh0Q29udGVudCA9XG4gICAgICAgICAgICBgJHt0aGlzLnByb3BlcnR5Lm5hbWV9OiBbJHtPYmplY3Qua2V5cyh0aGlzLnByb3BlcnR5LnZhbHVlcykubWFwKGsgPT4gdGhpcy5wcm9wZXJ0eS52YWx1ZXNba10pLmpvaW4oJywgJyl9XWA7XG4gICAgfTtcblxuXG4gICAgcHJpdmF0ZSBhZGRFZGl0QnV0dG9uKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmFkZEJ1dHRvbigoYikgPT4ge1xuICAgICAgICAgICAgYi5zZXRJY29uKFwicGVuY2lsXCIpXG4gICAgICAgICAgICAgICAgLnNldFRvb2x0aXAoXCJFZGl0XCIpXG4gICAgICAgICAgICAgICAgLm9uQ2xpY2soKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsZXQgbW9kYWwgPSBuZXcgRmllbGRTZXR0aW5nc01vZGFsKHRoaXMuYXBwLCB0aGlzLnBsdWdpbiwgdGhpcy5jb250YWluZXJFbCwgdGhpcywgdGhpcy5wcm9wZXJ0eSk7XG4gICAgICAgICAgICAgICAgICAgIG1vZGFsLm9wZW4oKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgYWRkRGVsZXRlQnV0dG9uKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmFkZEJ1dHRvbigoYikgPT4ge1xuICAgICAgICAgICAgYi5zZXRJY29uKFwidHJhc2hcIilcbiAgICAgICAgICAgICAgICAuc2V0VG9vbHRpcChcIkRlbGV0ZVwiKVxuICAgICAgICAgICAgICAgIC5vbkNsaWNrKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEV4aXN0aW5nUHJvcGVydHkgPSB0aGlzLnBsdWdpbi5pbml0aWFsUHJvcGVydGllcy5maWx0ZXIocCA9PiBwLmlkID09IHRoaXMucHJvcGVydHkuaWQpWzBdO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudEV4aXN0aW5nUHJvcGVydHkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLmluaXRpYWxQcm9wZXJ0aWVzLnJlbW92ZShjdXJyZW50RXhpc3RpbmdQcm9wZXJ0eSk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ0VsLnBhcmVudEVsZW1lbnQ/LnJlbW92ZUNoaWxkKHRoaXMuc2V0dGluZ0VsKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBwdWJsaWMgc3RhdGljIGFzeW5jIGdldFZhbHVlc0xpc3RGcm9tTm90ZShub3RlUGF0aDogc3RyaW5nLCBhcHA6IEFwcCk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICAgICAgbGV0IHZhbHVlczogQXJyYXk8c3RyaW5nPiA9IFtdO1xuICAgICAgICBjb25zdCBmaWxlID0gYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChub3RlUGF0aCk7XG4gICAgICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUgJiYgZmlsZS5leHRlbnNpb24gPT0gXCJtZFwiKSB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhcHAudmF1bHQucmVhZChmaWxlKVxuICAgICAgICAgICAgcmVzdWx0LnNwbGl0KCdcXG4nKS5mb3JFYWNoKGxpbmUgPT4ge1xuICAgICAgICAgICAgICAgIGlmICgvXiguKikkLy50ZXN0KGxpbmUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKGxpbmUudHJpbSgpKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gdmFsdWVzO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9O1xuICAgIH07XG59OyIsICJpbXBvcnQgRmllbGQgZnJvbSBcInNyYy9GaWVsZFwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIE1ldGFkYXRhTWVudVNldHRpbmdzIHtcblx0cHJlc2V0RmllbGRzOiBBcnJheTxGaWVsZD47XG5cdGRpc3BsYXlGaWVsZHNJbkNvbnRleHRNZW51OiBib29sZWFuO1xuXHRnbG9iYWxseUlnbm9yZWRGaWVsZHM6IEFycmF5PHN0cmluZz47XG5cdGdldEZyb21JbmxpbmVGaWVsZDogYm9vbGVhbjtcblx0Y2xhc3NGaWxlc1BhdGg6IHN0cmluZztcblx0aXNBdXRvc3VnZ2VzdEVuYWJsZWQ6IGJvb2xlYW47XG5cdGZpbGVDbGFzc0FsaWFzOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBjb25zdCBERUZBVUxUX1NFVFRJTkdTOiBNZXRhZGF0YU1lbnVTZXR0aW5ncyA9IHtcblx0cHJlc2V0RmllbGRzOiBbXSxcblx0ZGlzcGxheUZpZWxkc0luQ29udGV4dE1lbnU6IHRydWUsXG5cdGdsb2JhbGx5SWdub3JlZEZpZWxkczogW10sXG5cdGNsYXNzRmlsZXNQYXRoOiBcIlwiLFxuXHRnZXRGcm9tSW5saW5lRmllbGQ6IHRydWUsXG5cdGlzQXV0b3N1Z2dlc3RFbmFibGVkOiB0cnVlLFxuXHRmaWxlQ2xhc3NBbGlhczogXCJmaWxlQ2xhc3NcIlxufTsiLCAiZXhwb3J0IGNvbnN0IGZpZWxkQ29tcG9uZW50cyA9IFsnc3RhcnRTdHlsZScsICdhdHRyaWJ1dGUnLCAnZW5kU3R5bGUnLCAnYmVmb3JlU2VwYXJhdG9yU3BhY2VyJywgJ2FmdGVyU2VwYXJhdG9yU3BhY2VyJywgJ3ZhbHVlcyddXG5cbmV4cG9ydCBjb25zdCBnZW5lcmljRmllbGRSZWdleCA9IFwiKD88c3RhcnRTdHlsZT5bX1xcXFwqfmBdKikoPzxhdHRyaWJ1dGU+WzAtOVxcXFx3XFxcXHB7TGV0dGVyfVxcXFxwe0Vtb2ppX1ByZXNlbnRhdGlvbn1dWy0wLTlcXFxcd1xcXFxwe0xldHRlcn1cXFxccHtFbW9qaV9QcmVzZW50YXRpb259XFxcXHNdKikoPzxlbmRTdHlsZT5bX1xcXFwqfmBdKikoPzxiZWZvcmVTZXBhcmF0b3JTcGFjZXI+XFxcXHMqKVwiO1xuXG5leHBvcnQgY29uc3QgaW5saW5lRmllbGRSZWdleCA9IChhdHRyaWJ1dGU6IHN0cmluZykgPT4gbmV3IFJlZ0V4cChgKD88c3RhcnRTdHlsZT5bX1xcKn5cXGBdKikoPzxhdHRyaWJ1dGU+JHthdHRyaWJ1dGV9KSg/PGVuZFN0eWxlPltfXFwqflxcYF0qKSg/PGJlZm9yZVNlcGFyYXRvclNwYWNlcj5cXFxccyopOjooPzxhZnRlclNlcGFyYXRvclNwYWNlcj5cXFxccyopKD88dmFsdWVzPi4qKWAsICd1Jyk7IiwgImltcG9ydCB7IEFwcCwgVEZpbGUgfSBmcm9tIFwib2JzaWRpYW5cIlxuaW1wb3J0IHsgaW5saW5lRmllbGRSZWdleCB9IGZyb20gXCJzcmMvdXRpbHMvcGFyc2VyXCI7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRWYWx1ZXMoYXBwOiBBcHAsIGZpbGU6IFRGaWxlLCBhdHRyaWJ1dGU6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgKGF3YWl0IGFwcC52YXVsdC5jYWNoZWRSZWFkKGZpbGUpKS5zcGxpdCgnXFxuJyk7XG4gICAgY29uc3QgZnJvbnRtYXR0ZXIgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKT8uZnJvbnRtYXR0ZXI7XG4gICAgY29uc3QgeyBwb3NpdGlvbjogeyBzdGFydCwgZW5kIH0gfSA9IGZyb250bWF0dGVyIHx8IG51bGw7XG4gICAgY29uc3QgcmVzdWx0OiBzdHJpbmdbXSA9IFtdO1xuICAgIGNvbnRlbnQubWFwKChsaW5lLCBpKSA9PiB7XG4gICAgICAgIGlmIChmcm9udG1hdHRlciAmJiBpID49IHN0YXJ0LmxpbmUgJiYgaSA8PSBlbmQubGluZSkge1xuICAgICAgICAgICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGAke2F0dHJpYnV0ZX06KC4qKWAsICd1Jyk7XG4gICAgICAgICAgICBjb25zdCByID0gbGluZS5tYXRjaChyZWdleCk7XG4gICAgICAgICAgICBpZiAociAmJiByLmxlbmd0aCA+IDApIHJlc3VsdC5wdXNoKHJbMV0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgcmVnZXggPSBpbmxpbmVGaWVsZFJlZ2V4KGF0dHJpYnV0ZSk7XG4gICAgICAgICAgICBjb25zdCByID0gbGluZS5tYXRjaChyZWdleCk7XG4gICAgICAgICAgICBpZiAocj8uZ3JvdXBzKSByZXN1bHQucHVzaChyLmdyb3Vwcy52YWx1ZXMpO1xuICAgICAgICB9XG4gICAgfSlcbiAgICByZXR1cm4gcmVzdWx0O1xufSIsICJpbXBvcnQgeyBBcHAsIFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBmaWVsZENvbXBvbmVudHMsIGlubGluZUZpZWxkUmVnZXggfSBmcm9tIFwic3JjL3V0aWxzL3BhcnNlclwiO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVwbGFjZVZhbHVlcyhhcHA6IEFwcCwgZmlsZTogVEZpbGUsIGF0dHJpYnV0ZTogc3RyaW5nLCBpbnB1dDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgY29udGVudCA9IGF3YWl0IChhd2FpdCBhcHAudmF1bHQuY2FjaGVkUmVhZChmaWxlKSkuc3BsaXQoJ1xcbicpO1xuICAgIGNvbnN0IGZyb250bWF0dGVyID0gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUoZmlsZSk/LmZyb250bWF0dGVyO1xuICAgIGNvbnN0IHN0YXJ0ID0gZnJvbnRtYXR0ZXIgPyBmcm9udG1hdHRlci5wb3NpdGlvbi5zdGFydCA6IG51bGxcbiAgICBjb25zdCBlbmQgPSBmcm9udG1hdHRlciA/IGZyb250bWF0dGVyLnBvc2l0aW9uLmVuZCA6IG51bGxcbiAgICBjb25zdCBuZXdDb250ZW50ID0gY29udGVudC5tYXAoKGxpbmUsIGkpID0+IHtcbiAgICAgICAgaWYgKGZyb250bWF0dGVyICYmIGkgPj0gc3RhcnQubGluZSAmJiBpIDw9IGVuZC5saW5lKSB7XG4gICAgICAgICAgICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYCR7YXR0cmlidXRlfTpgLCAndScpO1xuICAgICAgICAgICAgY29uc3QgciA9IGxpbmUubWF0Y2gocmVnZXgpO1xuICAgICAgICAgICAgaWYgKHIgJiYgci5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5wdXRBcnJheSA9IGlucHV0ID8gaW5wdXQucmVwbGFjZSgvKFxcLFxccyspL2csICcsJykuc3BsaXQoJywnKSA6IFtcIlwiXTtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IGlucHV0QXJyYXkubGVuZ3RoID09IDEgPyBpbnB1dEFycmF5WzBdIDogYFske2lucHV0QXJyYXkuam9pbignLCAnKX1dYDtcbiAgICAgICAgICAgICAgICByZXR1cm4gYCR7YXR0cmlidXRlfTogJHtuZXdWYWx1ZX1gO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbGluZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHJlZ2V4ID0gaW5saW5lRmllbGRSZWdleChhdHRyaWJ1dGUpO1xuICAgICAgICAgICAgY29uc3QgciA9IGxpbmUubWF0Y2gocmVnZXgpO1xuICAgICAgICAgICAgaWYgKHI/Lmdyb3VwcyAmJiBPYmplY3Qua2V5cyhyLmdyb3VwcykuZXZlcnkoaSA9PiBmaWVsZENvbXBvbmVudHMuaW5jbHVkZXMoaSkpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBzdGFydFN0eWxlLCBlbmRTdHlsZSwgYmVmb3JlU2VwYXJhdG9yU3BhY2VyLCBhZnRlclNlcGFyYXRvclNwYWNlciwgdmFsdWVzIH0gPSByLmdyb3Vwc1xuICAgICAgICAgICAgICAgIGNvbnN0IGlucHV0QXJyYXkgPSBpbnB1dCA/IGlucHV0LnJlcGxhY2UoLyhcXCxcXHMrKS9nLCAnLCcpLnNwbGl0KCcsJykgOiBbXCJcIl07XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3VmFsdWUgPSBpbnB1dEFycmF5Lmxlbmd0aCA9PSAxID8gaW5wdXRBcnJheVswXSA6IGAke2lucHV0QXJyYXkuam9pbignLCAnKX1gO1xuICAgICAgICAgICAgICAgIHJldHVybiBgJHtzdGFydFN0eWxlfSR7YXR0cmlidXRlfSR7ZW5kU3R5bGV9JHtiZWZvcmVTZXBhcmF0b3JTcGFjZXJ9Ojoke2FmdGVyU2VwYXJhdG9yU3BhY2VyfSR7bmV3VmFsdWV9YDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxpbmU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KVxuICAgIGFwcC52YXVsdC5tb2RpZnkoZmlsZSwgbmV3Q29udGVudC5qb2luKCdcXG4nKSk7XG59IiwgImltcG9ydCB7IFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCJcbmltcG9ydCB7IHJlcGxhY2VWYWx1ZXMgfSBmcm9tIFwiLi9yZXBsYWNlVmFsdWVzXCJcbmltcG9ydCBNZXRhZGF0YU1lbnUgZnJvbSBcIm1haW5cIlxuXG5leHBvcnQgZnVuY3Rpb24gZmllbGRXaXRoTWVudShwbHVnaW46IE1ldGFkYXRhTWVudSwgZHY6IGFueSwgcDogYW55LCBmaWVsZE5hbWU6IHN0cmluZywgYXR0cnM/OiB7IGNsczogc3RyaW5nLCBhdHRyOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+IH0pOiBIVE1MRWxlbWVudCB7XG4gICAgLyogZmllbGRDb250YWluZXIqL1xuICAgIGNvbnN0IGZpZWxkQ29udGFpbmVyOiBIVE1MRWxlbWVudCA9IGR2LmVsKFwiZGl2XCIsIFwiXCIpXG4gICAgZmllbGRDb250YWluZXIuc2V0QXR0cihcImNsYXNzXCIsIFwibWV0YWRhdGEtbWVudS1kdi1maWVsZC1jb250YWluZXJcIilcblxuICAgIC8qIGZpZWxkICovXG4gICAgY29uc3QgZmllbGQgPSBkdi5lbCgnc3BhbicsIHBbZmllbGROYW1lXSwgYXR0cnMpXG5cbiAgICAvKiBlbmQgc3BhY2VyICovXG4gICAgY29uc3Qgc3BhY2VyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKVxuICAgIHNwYWNlci5zZXRBdHRyKFwiY2xhc3NcIiwgXCJtZXRhZGF0YS1tZW51LWR2LWZpZWxkLXNwYWNlclwiKVxuXG4gICAgLyogaW5wdXQgd2l0aCBidXR0b25zICovXG4gICAgY29uc3QgaW5wdXRDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpXG4gICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIilcbiAgICBpbnB1dC5zZXRBdHRyKFwiY2xhc3NcIiwgXCJtZXRhZGF0YS1tZW51LWR2LWlucHV0XCIpXG4gICAgaW5wdXRDb250YWluZXIuYXBwZW5kQ2hpbGQoaW5wdXQpXG4gICAgaW5wdXQudmFsdWUgPSBwW2ZpZWxkTmFtZV1cbiAgICBpbnB1dENvbnRhaW5lci5hcHBlbmRDaGlsZChpbnB1dClcblxuICAgIGNvbnN0IHZhbGlkYXRlSWNvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpXG4gICAgdmFsaWRhdGVJY29uLnRleHRDb250ZW50ID0gXCJcdTI3MDVcIlxuICAgIHZhbGlkYXRlSWNvbi5zZXRBdHRyKFwiY2xhc3NcIiwgXCJtZXRhZGF0YS1tZW51LWR2LWZpZWxkLWJ1dHRvblwiKVxuICAgIHZhbGlkYXRlSWNvbi5vbmNsaWNrID0gKGUpID0+IHtcbiAgICAgICAgY29uc3QgZmlsZSA9IHBsdWdpbi5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKHBbXCJmaWxlXCJdW1wicGF0aFwiXSlcbiAgICAgICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURmlsZSAmJiBmaWxlLmV4dGVuc2lvbiA9PSBcIm1kXCIpIHtcbiAgICAgICAgICAgIHJlcGxhY2VWYWx1ZXMocGx1Z2luLmFwcCwgZmlsZSwgZmllbGROYW1lLCBpbnB1dC52YWx1ZSlcbiAgICAgICAgfVxuICAgICAgICBmaWVsZENvbnRhaW5lci5yZW1vdmVDaGlsZChpbnB1dENvbnRhaW5lcilcbiAgICB9XG4gICAgaW5wdXRDb250YWluZXI/LmFwcGVuZENoaWxkKHZhbGlkYXRlSWNvbilcbiAgICBjb25zdCBjYW5jZWxJY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIilcbiAgICBjYW5jZWxJY29uLnNldEF0dHIoXCJjbGFzc1wiLCBcIm1ldGFkYXRhLW1lbnUtZHYtZmllbGQtYnV0dG9uXCIpXG4gICAgY2FuY2VsSWNvbi50ZXh0Q29udGVudCA9IFwiXHUyNzRDXCJcbiAgICBjYW5jZWxJY29uLm9uY2xpY2sgPSAoZSkgPT4ge1xuICAgICAgICBmaWVsZENvbnRhaW5lci5yZW1vdmVDaGlsZChpbnB1dENvbnRhaW5lcilcbiAgICAgICAgZmllbGRDb250YWluZXIuYXBwZW5kQ2hpbGQoYnV0dG9uKVxuICAgICAgICBmaWVsZENvbnRhaW5lci5hcHBlbmRDaGlsZChmaWVsZClcbiAgICAgICAgZmllbGRDb250YWluZXIuYXBwZW5kQ2hpbGQoc3BhY2VyKVxuICAgIH1cbiAgICBpbnB1dENvbnRhaW5lci5hcHBlbmRDaGlsZChjYW5jZWxJY29uKVxuICAgIGlucHV0LmZvY3VzKClcblxuICAgIC8qIGJ1dHRvbiB0byBkaXNwbGF5IGlucHV0ICovXG4gICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKVxuICAgIGJ1dHRvbi5zZXRUZXh0KFwiXHVEODNEXHVERDhEXCIpXG4gICAgYnV0dG9uLnNldEF0dHIoJ2NsYXNzJywgXCJtZXRhZGF0YS1tZW51LWR2LWZpZWxkLWJ1dHRvblwiKVxuICAgIGJ1dHRvbi5oaWRlKClcbiAgICBzcGFjZXIuc2hvdygpXG4gICAgZmllbGRDb250YWluZXIub25tb3VzZW92ZXIgPSAoKSA9PiB7XG4gICAgICAgIGJ1dHRvbi5zaG93KClcbiAgICAgICAgc3BhY2VyLmhpZGUoKVxuICAgIH1cbiAgICBmaWVsZENvbnRhaW5lci5vbm1vdXNlb3V0ID0gKCkgPT4ge1xuICAgICAgICBidXR0b24uaGlkZSgpXG4gICAgICAgIHNwYWNlci5zaG93KClcbiAgICB9XG5cbiAgICBpbnB1dC5vbmtleWRvd24gPSAoZSkgPT4ge1xuICAgICAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIikge1xuICAgICAgICAgICAgY29uc3QgZmlsZSA9IHBsdWdpbi5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKHBbXCJmaWxlXCJdW1wicGF0aFwiXSlcbiAgICAgICAgICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUgJiYgZmlsZS5leHRlbnNpb24gPT0gXCJtZFwiKSB7XG4gICAgICAgICAgICAgICAgcmVwbGFjZVZhbHVlcyhwbHVnaW4uYXBwLCBmaWxlLCBmaWVsZE5hbWUsIGlucHV0LnZhbHVlKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZmllbGRDb250YWluZXIucmVtb3ZlQ2hpbGQoaW5wdXRDb250YWluZXIpXG4gICAgICAgIH1cbiAgICAgICAgaWYgKGUua2V5ID09PSAnRXNjYXBlJykge1xuICAgICAgICAgICAgZmllbGRDb250YWluZXIucmVtb3ZlQ2hpbGQoaW5wdXRDb250YWluZXIpXG4gICAgICAgICAgICBmaWVsZENvbnRhaW5lci5hcHBlbmQoYnV0dG9uKVxuICAgICAgICAgICAgZmllbGRDb250YWluZXIuYXBwZW5kKGZpZWxkKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyogbWFuYWdlICovXG4gICAgLyogaW5pdGlhbCBzdGF0ZSAqL1xuICAgIGZpZWxkQ29udGFpbmVyLmFwcGVuZENoaWxkKGJ1dHRvbilcbiAgICBmaWVsZENvbnRhaW5lci5hcHBlbmRDaGlsZChmaWVsZClcbiAgICBmaWVsZENvbnRhaW5lci5hcHBlbmRDaGlsZChzcGFjZXIpXG5cbiAgICAvKiBidXR0b24gb24gY2xpY2sgOiByZW1vdmUgYnV0dG9uIGFuZCBmaWVsZCBhbmQgZGlzcGxheSBpbnB1dCBmaWVsZCovXG4gICAgYnV0dG9uLm9uY2xpY2sgPSAoZSkgPT4ge1xuICAgICAgICBmaWVsZENvbnRhaW5lci5yZW1vdmVDaGlsZChmaWVsZClcbiAgICAgICAgZmllbGRDb250YWluZXIucmVtb3ZlQ2hpbGQoYnV0dG9uKVxuICAgICAgICBmaWVsZENvbnRhaW5lci5yZW1vdmVDaGlsZChzcGFjZXIpXG4gICAgICAgIGZpZWxkQ29udGFpbmVyLmFwcGVuZENoaWxkKGlucHV0Q29udGFpbmVyKVxuICAgICAgICBpbnB1dC5mb2N1cygpXG4gICAgfVxuXG5cbiAgICByZXR1cm4gZmllbGRDb250YWluZXJcbn07ICIsICJpbXBvcnQgeyBBcHAsIFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCJcbmltcG9ydCBNZXRhZGF0YU1lbnUgZnJvbSBcIm1haW5cIlxuaW1wb3J0IHsgZ2V0VmFsdWVzIH0gZnJvbSBcIi4vY29tbWFuZHMvZ2V0VmFsdWVzXCI7XG5pbXBvcnQgeyByZXBsYWNlVmFsdWVzIH0gZnJvbSBcIi4vY29tbWFuZHMvcmVwbGFjZVZhbHVlc1wiO1xuaW1wb3J0IHsgZmllbGRXaXRoTWVudSB9IGZyb20gXCIuL2NvbW1hbmRzL2ZpZWxkV2l0aE1lbnVcIjtcblxuXG5leHBvcnQgaW50ZXJmYWNlIElNZXRhZGF0YU1lbnVBcGkge1xuICAgIGdldFZhbHVlczogKGFwcDogQXBwLCBmaWxlOiBURmlsZSwgYXR0cmlidXRlOiBzdHJpbmcpID0+IFByb21pc2U8c3RyaW5nW10+O1xuICAgIHJlcGxhY2VWYWx1ZXM6IChhcHA6IEFwcCwgZmlsZTogVEZpbGUsIGF0dHJpYnV0ZTogc3RyaW5nLCBpbnB1dDogc3RyaW5nKSA9PiBQcm9taXNlPHZvaWQ+O1xuICAgIGZpZWxkV2l0aE1lbnU6IChkdjogYW55LCBwOiBhbnksIGZpZWxkTmFtZTogc3RyaW5nLCBhdHRycz86IHsgY2xzOiBzdHJpbmcsIGF0dHI6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gfSkgPT4gSFRNTEVsZW1lbnQ7XG59XG5cbmV4cG9ydCBjbGFzcyBNZXRhZGF0YU1lbnVBcGkge1xuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcGx1Z2luOiBNZXRhZGF0YU1lbnUpIHtcbiAgICB9XG5cbiAgICBwdWJsaWMgbWFrZSgpOiBJTWV0YWRhdGFNZW51QXBpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGdldFZhbHVlczogdGhpcy5nZXRWYWx1ZXMoKSxcbiAgICAgICAgICAgIHJlcGxhY2VWYWx1ZXM6IHRoaXMucmVwbGFjZVZhbHVlcygpLFxuICAgICAgICAgICAgZmllbGRXaXRoTWVudTogdGhpcy5maWVsZFdpdGhNZW51KClcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFZhbHVlcygpOiAoYXBwOiBBcHAsIGZpbGU6IFRGaWxlLCBhdHRyaWJ1dGU6IHN0cmluZykgPT4gUHJvbWlzZTxzdHJpbmdbXT4ge1xuICAgICAgICByZXR1cm4gYXN5bmMgKGFwcDogQXBwLCBmaWxlOiBURmlsZSwgYXR0cmlidXRlOiBzdHJpbmcpID0+IGdldFZhbHVlcyhhcHAsIGZpbGUsIGF0dHJpYnV0ZSlcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlcGxhY2VWYWx1ZXMoKTogKGFwcDogQXBwLCBmaWxlOiBURmlsZSwgYXR0cmlidXRlOiBzdHJpbmcsIGlucHV0OiBzdHJpbmcpID0+IFByb21pc2U8dm9pZD4ge1xuICAgICAgICByZXR1cm4gYXN5bmMgKGFwcDogQXBwLCBmaWxlOiBURmlsZSwgYXR0cmlidXRlOiBzdHJpbmcsIGlucHV0OiBzdHJpbmcpID0+IHJlcGxhY2VWYWx1ZXMoYXBwLCBmaWxlLCBhdHRyaWJ1dGUsIGlucHV0KVxuICAgIH1cblxuICAgIHByaXZhdGUgZmllbGRXaXRoTWVudSgpOiAoZHY6IGFueSwgcDogYW55LCBmaWVsZE5hbWU6IHN0cmluZywgYXR0cnM/OiB7IGNsczogc3RyaW5nLCBhdHRyOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+IH0pID0+IEhUTUxFbGVtZW50IHtcbiAgICAgICAgcmV0dXJuIChkdjogYW55LCBwOiBhbnksIGZpZWxkTmFtZTogc3RyaW5nLCBhdHRycz86IHsgY2xzOiBzdHJpbmcsIGF0dHI6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gfSkgPT4gZmllbGRXaXRoTWVudSh0aGlzLnBsdWdpbiwgZHYsIHAsIGZpZWxkTmFtZSwgYXR0cnMpXG4gICAgfVxufSIsICJpbXBvcnQgeyBURmlsZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IE1ldGFkYXRhTWVudSBmcm9tIFwibWFpblwiO1xuaW1wb3J0IE9wdGlvbnNMaXN0IGZyb20gXCJzcmMvb3B0aW9ucy9PcHRpb25zTGlzdFwiO1xuaW1wb3J0IEZpbGVDbGFzc0F0dHJpYnV0ZVNlbGVjdE1vZGFsIGZyb20gXCJzcmMvZmlsZUNsYXNzL0ZpbGVDbGFzc0F0dHJpYnV0ZVNlbGVjdE1vZGFsXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIGxpbmtDb250ZXh0TWVudSB7XG5cdHByaXZhdGUgcGx1Z2luOiBNZXRhZGF0YU1lbnU7XG5cdHByaXZhdGUgZmlsZTogVEZpbGU7XG5cdHByaXZhdGUgb3B0aW9uc0xpc3Q6IE9wdGlvbnNMaXN0O1xuXG5cdGNvbnN0cnVjdG9yKHBsdWdpbjogTWV0YWRhdGFNZW51KSB7XG5cdFx0dGhpcy5wbHVnaW4gPSBwbHVnaW47XG5cdFx0dGhpcy5jcmVhdGVDb250ZXh0TWVudSgpO1xuXHR9O1xuXG5cdHByaXZhdGUgY3JlYXRlQ29udGV4dE1lbnUoKTogdm9pZCB7XG5cdFx0dGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudChcblx0XHRcdHRoaXMucGx1Z2luLmFwcC53b3Jrc3BhY2Uub24oJ2ZpbGUtbWVudScsIChtZW51LCBhYnN0cmFjdEZpbGUsIHNvdXJjZSkgPT4ge1xuXHRcdFx0XHRpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MuZGlzcGxheUZpZWxkc0luQ29udGV4dE1lbnUpIHtcblx0XHRcdFx0XHRjb25zdCBmaWxlID0gdGhpcy5wbHVnaW4uYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChhYnN0cmFjdEZpbGUucGF0aClcblx0XHRcdFx0XHRpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlICYmIGZpbGUuZXh0ZW5zaW9uID09PSAnbWQnKSB7XG5cdFx0XHRcdFx0XHR0aGlzLmZpbGUgPSBmaWxlO1xuXHRcdFx0XHRcdFx0aWYgKGZpbGUucGFyZW50LnBhdGggKyBcIi9cIiA9PSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5jbGFzc0ZpbGVzUGF0aCkge1xuXHRcdFx0XHRcdFx0XHRtZW51LmFkZFNlcGFyYXRvcigpO1xuXHRcdFx0XHRcdFx0XHRtZW51LmFkZEl0ZW0oKGl0ZW0pID0+IHtcblx0XHRcdFx0XHRcdFx0XHRpdGVtLnNldEljb24oXCJnZWFyXCIpO1xuXHRcdFx0XHRcdFx0XHRcdGl0ZW0uc2V0VGl0bGUoYE1hbmFnZSA8JHtmaWxlLmJhc2VuYW1lfT4gZmllbGRzYCk7XG5cdFx0XHRcdFx0XHRcdFx0aXRlbS5vbkNsaWNrKChldnQpID0+IHtcblx0XHRcdFx0XHRcdFx0XHRcdGNvbnN0IGZpbGVDbGFzc0F0dHJpYnV0ZVNlbGVjdE1vZGFsID0gbmV3IEZpbGVDbGFzc0F0dHJpYnV0ZVNlbGVjdE1vZGFsKHRoaXMucGx1Z2luLCBmaWxlKTtcblx0XHRcdFx0XHRcdFx0XHRcdGZpbGVDbGFzc0F0dHJpYnV0ZVNlbGVjdE1vZGFsLm9wZW4oKTtcblx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHR0aGlzLm9wdGlvbnNMaXN0ID0gbmV3IE9wdGlvbnNMaXN0KHRoaXMucGx1Z2luLCB0aGlzLmZpbGUsIG1lbnUpO1xuXHRcdFx0XHRcdFx0XHR0aGlzLm9wdGlvbnNMaXN0LmNyZWF0ZUV4dHJhT3B0aW9uTGlzdCgpO1xuXHRcdFx0XHRcdFx0fTtcblx0XHRcdFx0XHR9O1xuXHRcdFx0XHR9O1xuXHRcdFx0fSlcblx0XHQpO1xuXHR9O1xufTsiLCAiaW1wb3J0IHsgQXBwLCBNb2RhbCwgVG9nZ2xlQ29tcG9uZW50LCBURmlsZSwgQnV0dG9uQ29tcG9uZW50LCBFeHRyYUJ1dHRvbkNvbXBvbmVudCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IEZpZWxkIGZyb20gXCJzcmMvRmllbGRcIjtcbmltcG9ydCB7IHJlcGxhY2VWYWx1ZXMgfSBmcm9tIFwic3JjL2NvbW1hbmRzL3JlcGxhY2VWYWx1ZXNcIjtcbmltcG9ydCBGaWVsZFNldHRpbmcgZnJvbSBcInNyYy9zZXR0aW5ncy9GaWVsZFNldHRpbmdcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgdmFsdWVNdWx0aVNlbGVjdE1vZGFsIGV4dGVuZHMgTW9kYWwge1xuXG4gICAgcHJpdmF0ZSBmaWxlOiBURmlsZTtcbiAgICBwcml2YXRlIG5hbWU6IHN0cmluZztcbiAgICBwcml2YXRlIHNldHRpbmdzOiBGaWVsZDtcbiAgICBwcml2YXRlIHZhbHVlczogQXJyYXk8c3RyaW5nPjtcbiAgICBwcml2YXRlIGxpbmVOdW1iZXI6IG51bWJlcjtcbiAgICBwcml2YXRlIGluRnJvbnRtYXR0ZXI6IGJvb2xlYW47XG4gICAgcHJpdmF0ZSB0b3A6IGJvb2xlYW47XG5cbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgZmlsZTogVEZpbGUsIG5hbWU6IHN0cmluZywgaW5pdGlhbFZhbHVlczogc3RyaW5nLCBzZXR0aW5nczogRmllbGQsIGxpbmVOdW1iZXI6IG51bWJlciA9IC0xLCBpbkZyb250TWF0dGVyOiBib29sZWFuID0gZmFsc2UsIHRvcDogYm9vbGVhbiA9IGZhbHNlKSB7XG4gICAgICAgIHN1cGVyKGFwcCk7XG4gICAgICAgIHRoaXMuYXBwID0gYXBwO1xuICAgICAgICB0aGlzLmZpbGUgPSBmaWxlO1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLnNldHRpbmdzID0gc2V0dGluZ3M7XG4gICAgICAgIGlmIChpbml0aWFsVmFsdWVzKSB7XG4gICAgICAgICAgICBpZiAoaW5pdGlhbFZhbHVlcy50b1N0cmluZygpLnN0YXJ0c1dpdGgoXCJbW1wiKSkge1xuICAgICAgICAgICAgICAgIHRoaXMudmFsdWVzID0gaW5pdGlhbFZhbHVlcy5zcGxpdChcIixcIikubWFwKGl0ZW0gPT4gaXRlbS50cmltKCkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlcyA9IGluaXRpYWxWYWx1ZXMudG9TdHJpbmcoKS5yZXBsYWNlKC9eXFxbKC4qKVxcXSQvLCBcIiQxXCIpLnNwbGl0KFwiLFwiKS5tYXAoaXRlbSA9PiBpdGVtLnRyaW0oKSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy52YWx1ZXMgPSBbXTtcbiAgICAgICAgfTtcbiAgICAgICAgLy90aGlzLnZhbHVlcyA9IGluaXRpYWxWYWx1ZXMgPyBpbml0aWFsVmFsdWVzLnRvU3RyaW5nKCkucmVwbGFjZSgvXlxcWyguKilcXF0kLywgXCIkMVwiKS5zcGxpdChcIixcIikubWFwKGl0ZW0gPT4gaXRlbS50cmltKCkpIDogW11cbiAgICAgICAgdGhpcy5saW5lTnVtYmVyID0gbGluZU51bWJlcjtcbiAgICAgICAgdGhpcy5pbkZyb250bWF0dGVyID0gaW5Gcm9udE1hdHRlcjtcbiAgICAgICAgdGhpcy50b3AgPSB0b3A7XG4gICAgfTtcblxuICAgIGFzeW5jIG9uT3BlbigpIHtcbiAgICAgICAgdGhpcy5jb250YWluZXJFbC5hZGRDbGFzcyhcIm1ldGFkYXRhLW1lbnVcIik7XG5cbiAgICAgICAgY29uc3QgdmFsdWVHcmlkID0gdGhpcy5jb250ZW50RWwuY3JlYXRlRGl2KHtcbiAgICAgICAgICAgIGNsczogXCJtZXRhZGF0YS1tZW51LXZhbHVlLWdyaWRcIlxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgbGlzdE5vdGVWYWx1ZXMgPSBhd2FpdCBGaWVsZFNldHRpbmcuZ2V0VmFsdWVzTGlzdEZyb21Ob3RlKHRoaXMuc2V0dGluZ3MudmFsdWVzTGlzdE5vdGVQYXRoLCB0aGlzLmFwcClcbiAgICAgICAgYXdhaXQgdGhpcy5wb3B1bGF0ZVZhbHVlc0dyaWQodmFsdWVHcmlkLCBsaXN0Tm90ZVZhbHVlcyk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgYXN5bmMgcG9wdWxhdGVWYWx1ZXNHcmlkKHZhbHVlR3JpZDogSFRNTERpdkVsZW1lbnQsIGxpc3ROb3RlVmFsdWVzOiBzdHJpbmdbXSk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBpZiAobGlzdE5vdGVWYWx1ZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBPYmplY3Qua2V5cyh0aGlzLnNldHRpbmdzLnZhbHVlcykuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHByZXNldFZhbHVlID0gdGhpcy5zZXR0aW5ncy52YWx1ZXNba2V5XTtcbiAgICAgICAgICAgICAgICB0aGlzLmJ1aWxkVmFsdWVUb2dnbGVyKHZhbHVlR3JpZCwgcHJlc2V0VmFsdWUpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfTtcbiAgICAgICAgbGlzdE5vdGVWYWx1ZXMuZm9yRWFjaCh2YWx1ZSA9PiB7XG4gICAgICAgICAgICB0aGlzLmJ1aWxkVmFsdWVUb2dnbGVyKHZhbHVlR3JpZCwgdmFsdWUpO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgZm9vdGVyID0gdGhpcy5jb250ZW50RWwuY3JlYXRlRGl2KHsgY2xzOiBcIm1ldGFkYXRhLW1lbnUtdmFsdWUtZ3JpZC1mb290ZXJcIiB9KTtcbiAgICAgICAgY29uc3Qgc2F2ZUJ1dHRvbiA9IG5ldyBCdXR0b25Db21wb25lbnQoZm9vdGVyKTtcbiAgICAgICAgc2F2ZUJ1dHRvbi5zZXRJY29uKFwiY2hlY2ttYXJrXCIpO1xuICAgICAgICBzYXZlQnV0dG9uLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMubGluZU51bWJlciA9PSAtMSkge1xuICAgICAgICAgICAgICAgIHJlcGxhY2VWYWx1ZXModGhpcy5hcHAsIHRoaXMuZmlsZSwgdGhpcy5uYW1lLCB0aGlzLnZhbHVlcy5qb2luKFwiLFwiKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQodGhpcy5maWxlKVxuICAgICAgICAgICAgICAgIGxldCBuZXdDb250ZW50OiBzdHJpbmdbXSA9IFtdO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnRvcCkge1xuICAgICAgICAgICAgICAgICAgICBuZXdDb250ZW50LnB1c2goYCR7dGhpcy5uYW1lfSR7dGhpcy5pbkZyb250bWF0dGVyID8gXCI6XCIgOiBcIjo6XCJ9ICR7dGhpcy52YWx1ZXMuam9pbihcIixcIil9YCk7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5zcGxpdChcIlxcblwiKS5mb3JFYWNoKChsaW5lLCBfbGluZU51bWJlcikgPT4gbmV3Q29udGVudC5wdXNoKGxpbmUpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQuc3BsaXQoXCJcXG5cIikuZm9yRWFjaCgobGluZSwgX2xpbmVOdW1iZXIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0NvbnRlbnQucHVzaChsaW5lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfbGluZU51bWJlciA9PSB0aGlzLmxpbmVOdW1iZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdDb250ZW50LnB1c2goYCR7dGhpcy5uYW1lfSR7dGhpcy5pbkZyb250bWF0dGVyID8gXCI6XCIgOiBcIjo6XCJ9ICR7dGhpcy52YWx1ZXMuam9pbihcIixcIil9YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgdGhpcy5hcHAudmF1bHQubW9kaWZ5KHRoaXMuZmlsZSwgbmV3Q29udGVudC5qb2luKCdcXG4nKSk7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgY2FuY2VsQnV0dG9uID0gbmV3IEV4dHJhQnV0dG9uQ29tcG9uZW50KGZvb3Rlcik7XG4gICAgICAgIGNhbmNlbEJ1dHRvbi5zZXRJY29uKFwiY3Jvc3NcIik7XG4gICAgICAgIGNhbmNlbEJ1dHRvbi5vbkNsaWNrKCgpID0+IHRoaXMuY2xvc2UoKSk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgYnVpbGRWYWx1ZVRvZ2dsZXIodmFsdWVHcmlkOiBIVE1MRGl2RWxlbWVudCwgcHJlc2V0VmFsdWU6IHN0cmluZykge1xuICAgICAgICBjb25zdCB2YWx1ZVNlbGVjdG9yQ29udGFpbmVyID0gdmFsdWVHcmlkLmNyZWF0ZURpdih7XG4gICAgICAgICAgICBjbHM6IFwibWV0YWRhdGEtbWVudS12YWx1ZS1zZWxlY3Rvci1jb250YWluZXJcIlxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgdmFsdWVUb2dnbGVyQ29udGFpbmVyID0gdmFsdWVTZWxlY3RvckNvbnRhaW5lci5jcmVhdGVEaXYoe1xuICAgICAgICAgICAgY2xzOiBcIm1ldGFkYXRhLW1lbnUtdmFsdWUtc2VsZWN0b3ItdG9nZ2xlclwiXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCB2YWx1ZVRvZ2dsZXIgPSBuZXcgVG9nZ2xlQ29tcG9uZW50KHZhbHVlVG9nZ2xlckNvbnRhaW5lcik7XG4gICAgICAgIHRoaXMudmFsdWVzLmZvckVhY2godmFsdWUgPT4ge1xuICAgICAgICAgICAgaWYgKHZhbHVlID09IHByZXNldFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdmFsdWVUb2dnbGVyLnNldFZhbHVlKHRydWUpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgICAgdmFsdWVUb2dnbGVyLm9uQ2hhbmdlKHZhbHVlID0+IHtcbiAgICAgICAgICAgIGlmICh2YWx1ZSAmJiAhdGhpcy52YWx1ZXMuaW5jbHVkZXMocHJlc2V0VmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52YWx1ZXMucHVzaChwcmVzZXRWYWx1ZSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKCF2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMudmFsdWVzLnJlbW92ZShwcmVzZXRWYWx1ZSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgdmFsdWVMYWJlbCA9IHZhbHVlU2VsZWN0b3JDb250YWluZXIuY3JlYXRlRGl2KHsgY2xzOiBcIm1ldGFkYXRhLW1lbnUtdmFsdWUtc2VsZWN0b3ItbGFiZWxcIiB9KTtcbiAgICAgICAgdmFsdWVMYWJlbC5zZXRUZXh0KHByZXNldFZhbHVlKTtcbiAgICB9O1xufTsiLCAiaW1wb3J0IHsgQXBwLCBNb2RhbCwgVGV4dENvbXBvbmVudCwgVEZpbGUsIFRvZ2dsZUNvbXBvbmVudCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgcmVwbGFjZVZhbHVlcyB9IGZyb20gXCJzcmMvY29tbWFuZHMvcmVwbGFjZVZhbHVlc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyB2YWx1ZVRleHRJbnB1dE1vZGFsIGV4dGVuZHMgTW9kYWwge1xuXG4gICAgcHJpdmF0ZSBmaWxlOiBURmlsZTtcbiAgICBwcml2YXRlIG5hbWU6IHN0cmluZztcbiAgICBwcml2YXRlIHZhbHVlOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBsaW5lTnVtYmVyOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBpbkZyb250bWF0dGVyOiBib29sZWFuO1xuICAgIHByaXZhdGUgdG9wOiBib29sZWFuO1xuICAgIHByaXZhdGUgcGFyc2VEYXRlOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgZmlsZTogVEZpbGUsIG5hbWU6IHN0cmluZywgdmFsdWU6IHN0cmluZywgbGluZU51bWJlcjogbnVtYmVyID0gLTEsIGluRnJvbnRNYXR0ZXI6IGJvb2xlYW4gPSBmYWxzZSwgdG9wOiBib29sZWFuID0gZmFsc2UpIHtcbiAgICAgICAgc3VwZXIoYXBwKTtcbiAgICAgICAgdGhpcy5hcHAgPSBhcHA7XG4gICAgICAgIHRoaXMuZmlsZSA9IGZpbGU7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5saW5lTnVtYmVyID0gbGluZU51bWJlcjtcbiAgICAgICAgdGhpcy5pbkZyb250bWF0dGVyID0gaW5Gcm9udE1hdHRlcjtcbiAgICAgICAgdGhpcy50b3AgPSB0b3A7XG4gICAgfTtcblxuICAgIG9uT3BlbigpIHtcbiAgICAgICAgY29uc3QgaW5wdXREaXYgPSB0aGlzLmNvbnRlbnRFbC5jcmVhdGVEaXYoeyBjbHM6IFwibWV0YWRhdGEtbWVudS1tb2RhbC12YWx1ZVwiIH0pO1xuICAgICAgICB0aGlzLmJ1aWxkSW5wdXRFbChpbnB1dERpdik7XG4gICAgfTtcblxuICAgIGJ1aWxkRGF0ZVBhcnNlVG9nZ2xlcihjb250YWluZXI6IEhUTUxFbGVtZW50KSB7XG4gICAgICAgIC8vQHRzLWlnbm9yZVxuICAgICAgICBpZiAoYXBwLnBsdWdpbnMucGx1Z2lucy5oYXNPd25Qcm9wZXJ0eSgnbmxkYXRlcy1vYnNpZGlhbicpKSB7XG4gICAgICAgICAgICAvL0B0cy1pZ25vcmVcbiAgICAgICAgICAgIGNvbnN0IG5sZGF0ZXMgPSBhcHAucGx1Z2lucy5wbHVnaW5zWydubGRhdGVzLW9ic2lkaWFuJ107XG4gICAgICAgICAgICBjb25zdCBkYXRlUGFyc2VyTGFiZWwgPSBjb250YWluZXIuY3JlYXRlRGl2KHtcbiAgICAgICAgICAgICAgICBjbHM6IFwibWV0YWRhdGEtbWVudS1kYXRlLXBhcnNlci1sYWJlbFwiXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRhdGVQYXJzZXJMYWJlbC5zZXRUZXh0KFwiXHVEODNEXHVEQ0M2XCIpO1xuICAgICAgICAgICAgY29uc3QgZGF0ZVBhcnNlclRvZ2dsZXIgPSBuZXcgVG9nZ2xlQ29tcG9uZW50KGNvbnRhaW5lcik7XG4gICAgICAgICAgICBkYXRlUGFyc2VyVG9nZ2xlci5vbkNoYW5nZSh2YWx1ZSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXJzZURhdGUgPSB2YWx1ZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZGF0ZVBhcnNlckxhYmVsLm9uY2xpY2sgPSAoKSA9PiBkYXRlUGFyc2VyVG9nZ2xlci5zZXRWYWx1ZSghdGhpcy5wYXJzZURhdGUpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBwcml2YXRlIGJ1aWxkSW5wdXRFbChpbnB1dERpdjogSFRNTERpdkVsZW1lbnQpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5idWlsZERhdGVQYXJzZVRvZ2dsZXIoaW5wdXREaXYpO1xuICAgICAgICBjb25zdCBmb3JtID0gaW5wdXREaXYuY3JlYXRlRWwoXCJmb3JtXCIpO1xuICAgICAgICBmb3JtLnR5cGUgPSBcInN1Ym1pdFwiO1xuXG4gICAgICAgIGNvbnN0IGlucHV0RWwgPSBuZXcgVGV4dENvbXBvbmVudChmb3JtKTtcbiAgICAgICAgaW5wdXRFbC5pbnB1dEVsLmZvY3VzKCk7XG4gICAgICAgIGlucHV0RWwuc2V0VmFsdWUodGhpcy52YWx1ZSk7XG4gICAgICAgIGlucHV0RWwuaW5wdXRFbC5hZGRDbGFzcyhcIm1ldGFkYXRhLW1lbnUtcHJvbXB0LWlucHV0XCIpO1xuXG4gICAgICAgIGZvcm0ub25zdWJtaXQgPSBhc3luYyAoZTogRXZlbnQpID0+IHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGxldCBpbnB1dFZhbHVlID0gaW5wdXRFbC5nZXRWYWx1ZSgpO1xuICAgICAgICAgICAgLy9AdHMtaWdub3JlXG4gICAgICAgICAgICBpZiAoYXBwLnBsdWdpbnMucGx1Z2lucy5oYXNPd25Qcm9wZXJ0eSgnbmxkYXRlcy1vYnNpZGlhbicpICYmIHRoaXMucGFyc2VEYXRlKSB7XG4gICAgICAgICAgICAgICAgLy9AdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgY29uc3QgbmxkYXRlcyA9IGFwcC5wbHVnaW5zLnBsdWdpbnNbJ25sZGF0ZXMtb2JzaWRpYW4nXTtcbiAgICAgICAgICAgICAgICBjb25zdCBmb3JtYXQgPSBubGRhdGVzLnNldHRpbmdzLmZvcm1hdDtcbiAgICAgICAgICAgICAgICBsZXQgdGV4dFN0YXJ0ID0gXCJcIjtcbiAgICAgICAgICAgICAgICBsZXQgdGV4dEVuZCA9IFwiXCI7XG4gICAgICAgICAgICAgICAgbGV0IGRhdGUgPSBcIlwiO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGlvblN0YXJ0ID0gaW5wdXRFbC5pbnB1dEVsLnNlbGVjdGlvblN0YXJ0O1xuICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGlvbkVuZCA9IGlucHV0RWwuaW5wdXRFbC5zZWxlY3Rpb25FbmQ7XG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdGlvbkVuZCA9PSBzZWxlY3Rpb25TdGFydCkge1xuICAgICAgICAgICAgICAgICAgICBkYXRlID0gbmxkYXRlcy5wYXJzZURhdGUoaW5wdXRFbC5nZXRWYWx1ZSgpKS5tb21lbnQuZm9ybWF0KGZvcm1hdCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dFN0YXJ0ID0gaW5wdXRFbC5nZXRWYWx1ZSgpLnNsaWNlKDAsIHNlbGVjdGlvblN0YXJ0ISk7XG4gICAgICAgICAgICAgICAgICAgIGRhdGUgPSBubGRhdGVzLnBhcnNlRGF0ZShpbnB1dEVsLmdldFZhbHVlKCkuc2xpY2Uoc2VsZWN0aW9uU3RhcnQhLCBzZWxlY3Rpb25FbmQhKSkubW9tZW50LmZvcm1hdChmb3JtYXQpO1xuICAgICAgICAgICAgICAgICAgICB0ZXh0RW5kID0gaW5wdXRFbC5nZXRWYWx1ZSgpLnNsaWNlKHNlbGVjdGlvbkVuZCEpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgaW5wdXRWYWx1ZSA9IHRleHRTdGFydCArIFwiW1tcIiArIGRhdGUgKyBcIl1dXCIgKyB0ZXh0RW5kO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMubGluZU51bWJlciA9PSAtMSkge1xuICAgICAgICAgICAgICAgIHJlcGxhY2VWYWx1ZXModGhpcy5hcHAsIHRoaXMuZmlsZSwgdGhpcy5uYW1lLCBpbnB1dFZhbHVlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZCh0aGlzLmZpbGUpXG4gICAgICAgICAgICAgICAgbGV0IG5ld0NvbnRlbnQ6IHN0cmluZ1tdID0gW107XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudG9wKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld0NvbnRlbnQucHVzaChgJHt0aGlzLm5hbWV9JHt0aGlzLmluRnJvbnRtYXR0ZXIgPyBcIjpcIiA6IFwiOjpcIn0gJHtpbnB1dFZhbHVlfWApO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQuc3BsaXQoXCJcXG5cIikuZm9yRWFjaCgobGluZSwgX2xpbmVOdW1iZXIpID0+IG5ld0NvbnRlbnQucHVzaChsaW5lKSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnNwbGl0KFwiXFxuXCIpLmZvckVhY2goKGxpbmUsIF9saW5lTnVtYmVyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdDb250ZW50LnB1c2gobGluZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoX2xpbmVOdW1iZXIgPT0gdGhpcy5saW5lTnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3Q29udGVudC5wdXNoKGAke3RoaXMubmFtZX0ke3RoaXMuaW5Gcm9udG1hdHRlciA/IFwiOlwiIDogXCI6OlwifSAke2lucHV0VmFsdWV9YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHRoaXMuYXBwLnZhdWx0Lm1vZGlmeSh0aGlzLmZpbGUsIG5ld0NvbnRlbnQuam9pbignXFxuJykpO1xuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgIH07XG5cbiAgICB9O1xufTsiLCAiaW1wb3J0IHsgQXBwLCBNb2RhbCwgVG9nZ2xlQ29tcG9uZW50LCBURmlsZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgcmVwbGFjZVZhbHVlcyB9IGZyb20gXCJzcmMvY29tbWFuZHMvcmVwbGFjZVZhbHVlc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyB2YWx1ZVRvZ2dsZU1vZGFsIGV4dGVuZHMgTW9kYWwge1xuXG4gICAgcHJpdmF0ZSBmaWxlOiBURmlsZTtcbiAgICBwcml2YXRlIG5hbWU6IHN0cmluZztcbiAgICBwcml2YXRlIHZhbHVlOiBib29sZWFuO1xuXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAsIGZpbGU6IFRGaWxlLCBuYW1lOiBzdHJpbmcsIHZhbHVlOiBib29sZWFuKSB7XG4gICAgICAgIHN1cGVyKGFwcCk7XG4gICAgICAgIHRoaXMuYXBwID0gYXBwO1xuICAgICAgICB0aGlzLmZpbGUgPSBmaWxlO1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG4gICAgfTtcblxuICAgIG9uT3BlbigpIHtcbiAgICAgICAgY29uc3QgaW5wdXREaXYgPSB0aGlzLmNvbnRlbnRFbC5jcmVhdGVEaXYoe1xuICAgICAgICAgICAgY2xzOiBcIm1ldGFkYXRhLW1lbnUtdG9nZ2xlclwiXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmJ1aWxkSW5wdXRFbChpbnB1dERpdik7XG4gICAgfTtcblxuICAgIHByaXZhdGUgYnVpbGRJbnB1dEVsKGlucHV0RGl2OiBIVE1MRGl2RWxlbWVudCk6IHZvaWQge1xuICAgICAgICBjb25zdCBpbnB1dEVsID0gbmV3IFRvZ2dsZUNvbXBvbmVudChpbnB1dERpdik7XG4gICAgICAgIGlucHV0RWwuc2V0VmFsdWUodGhpcy52YWx1ZSk7XG4gICAgICAgIGlucHV0RWwub25DaGFuZ2UodiA9PiB7XG4gICAgICAgICAgICByZXBsYWNlVmFsdWVzKHRoaXMuYXBwLCB0aGlzLmZpbGUsIHRoaXMubmFtZSwgdiA/IFwidHJ1ZVwiIDogXCJmYWxzZVwiKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbn07IiwgImltcG9ydCB7IEFwcCwgTW9kYWwsIERyb3Bkb3duQ29tcG9uZW50LCBURmlsZSwgQnV0dG9uQ29tcG9uZW50IH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgRmllbGQgZnJvbSBcInNyYy9GaWVsZFwiO1xuaW1wb3J0IHsgcmVwbGFjZVZhbHVlcyB9IGZyb20gXCJzcmMvY29tbWFuZHMvcmVwbGFjZVZhbHVlc1wiO1xuaW1wb3J0IEZpZWxkU2V0dGluZyBmcm9tIFwic3JjL3NldHRpbmdzL0ZpZWxkU2V0dGluZ1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyB2YWx1ZVRvZ2dsZU1vZGFsIGV4dGVuZHMgTW9kYWwge1xuXG4gICAgcHJpdmF0ZSBmaWxlOiBURmlsZTtcbiAgICBwcml2YXRlIG5hbWU6IHN0cmluZztcbiAgICBwcml2YXRlIHZhbHVlOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBzZXR0aW5nczogRmllbGQ7XG4gICAgcHJpdmF0ZSBuZXdWYWx1ZTogc3RyaW5nIHwgbnVsbDtcbiAgICBwcml2YXRlIGxpbmVOdW1iZXI6IG51bWJlcjtcbiAgICBwcml2YXRlIGluRnJvbnRtYXR0ZXI6IGJvb2xlYW47XG4gICAgcHJpdmF0ZSB0b3A6IGJvb2xlYW47XG5cbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgZmlsZTogVEZpbGUsIG5hbWU6IHN0cmluZywgdmFsdWU6IHN0cmluZywgc2V0dGluZ3M6IEZpZWxkLCBsaW5lTnVtYmVyOiBudW1iZXIgPSAtMSwgaW5Gcm9udE1hdHRlcjogYm9vbGVhbiA9IGZhbHNlLCB0b3A6IGJvb2xlYW4gPSBmYWxzZSkge1xuICAgICAgICBzdXBlcihhcHApO1xuICAgICAgICB0aGlzLmFwcCA9IGFwcDtcbiAgICAgICAgdGhpcy5maWxlID0gZmlsZTtcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICAgICAgICB0aGlzLnNldHRpbmdzID0gc2V0dGluZ3M7XG4gICAgICAgIHRoaXMubmV3VmFsdWUgPSBudWxsO1xuICAgICAgICB0aGlzLmxpbmVOdW1iZXIgPSBsaW5lTnVtYmVyO1xuICAgICAgICB0aGlzLmluRnJvbnRtYXR0ZXIgPSBpbkZyb250TWF0dGVyO1xuICAgICAgICB0aGlzLnRvcCA9IHRvcDtcbiAgICB9O1xuXG4gICAgYXN5bmMgb25PcGVuKCkge1xuICAgICAgICB0aGlzLmNvbnRhaW5lckVsLmFkZENsYXNzKFwibWV0YWRhdGEtbWVudVwiKTtcbiAgICAgICAgY29uc3QgaW5wdXREaXYgPSB0aGlzLmNvbnRlbnRFbC5jcmVhdGVEaXYoeyBjbHM6IFwibWV0YWRhdGEtbWVudS1tb2RhbC12YWx1ZVwiIH0pO1xuICAgICAgICBhd2FpdCB0aGlzLmJ1aWxkSW5wdXRFbChpbnB1dERpdik7XG4gICAgfTtcblxuICAgIHByaXZhdGUgYXN5bmMgYnVpbGRJbnB1dEVsKGlucHV0RGl2OiBIVE1MRGl2RWxlbWVudCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBzZWxlY3RFbCA9IG5ldyBEcm9wZG93bkNvbXBvbmVudChpbnB1dERpdik7XG4gICAgICAgIHNlbGVjdEVsLnNlbGVjdEVsLmFkZENsYXNzKFwibWV0YWRhdGEtbWVudS1zZWxlY3RcIik7XG5cbiAgICAgICAgY29uc3QgdmFsdWVzID0gdGhpcy5zZXR0aW5ncy52YWx1ZXM7XG4gICAgICAgIHNlbGVjdEVsLmFkZE9wdGlvbihcIlwiLCBcIi0tRW1wdHktLVwiKTtcbiAgICAgICAgY29uc3QgbGlzdE5vdGVWYWx1ZXMgPSBhd2FpdCBGaWVsZFNldHRpbmcuZ2V0VmFsdWVzTGlzdEZyb21Ob3RlKHRoaXMuc2V0dGluZ3MudmFsdWVzTGlzdE5vdGVQYXRoLCB0aGlzLmFwcClcbiAgICAgICAgbGlzdE5vdGVWYWx1ZXMuZm9yRWFjaCh2YWx1ZSA9PiBzZWxlY3RFbC5hZGRPcHRpb24odmFsdWUsIHZhbHVlKSk7XG4gICAgICAgIGlmIChsaXN0Tm90ZVZhbHVlcy5pbmNsdWRlcyh0aGlzLnZhbHVlKSkge1xuICAgICAgICAgICAgc2VsZWN0RWwuc2V0VmFsdWUodGhpcy52YWx1ZSk7XG4gICAgICAgIH07XG4gICAgICAgIGlmIChsaXN0Tm90ZVZhbHVlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKHZhbHVlcykuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICAgICAgICAgIHNlbGVjdEVsLmFkZE9wdGlvbih2YWx1ZXNba2V5XSwgdmFsdWVzW2tleV0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoT2JqZWN0LnZhbHVlcyh2YWx1ZXMpLmluY2x1ZGVzKHRoaXMudmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgc2VsZWN0RWwuc2V0VmFsdWUodGhpcy52YWx1ZSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHNlbGVjdEVsLm9uQ2hhbmdlKHZhbHVlID0+IHRoaXMubmV3VmFsdWUgPSB2YWx1ZSAhPSBcIi0tRW1wdHktLVwiID8gdmFsdWUgOiBcIlwiKTtcbiAgICAgICAgY29uc3Qgc3VibWl0QnV0dG9uID0gbmV3IEJ1dHRvbkNvbXBvbmVudChpbnB1dERpdik7XG4gICAgICAgIHN1Ym1pdEJ1dHRvbi5zZXRUb29sdGlwKFwiU2F2ZVwiKVxuICAgICAgICAgICAgLnNldEljb24oXCJjaGVja21hcmtcIilcbiAgICAgICAgICAgIC5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5saW5lTnVtYmVyID09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm5ld1ZhbHVlIHx8IHRoaXMubmV3VmFsdWUgPT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZVZhbHVlcyh0aGlzLmFwcCwgdGhpcy5maWxlLCB0aGlzLm5hbWUsIHRoaXMubmV3VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQodGhpcy5maWxlKVxuICAgICAgICAgICAgICAgICAgICBsZXQgbmV3Q29udGVudDogc3RyaW5nW10gPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudG9wKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdDb250ZW50LnB1c2goYCR7dGhpcy5uYW1lfSR7dGhpcy5pbkZyb250bWF0dGVyID8gXCI6XCIgOiBcIjo6XCJ9ICR7c2VsZWN0RWwuZ2V0VmFsdWUoKX1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5zcGxpdChcIlxcblwiKS5mb3JFYWNoKChsaW5lLCBfbGluZU51bWJlcikgPT4gbmV3Q29udGVudC5wdXNoKGxpbmUpKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5zcGxpdChcIlxcblwiKS5mb3JFYWNoKChsaW5lLCBfbGluZU51bWJlcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld0NvbnRlbnQucHVzaChsaW5lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX2xpbmVOdW1iZXIgPT0gdGhpcy5saW5lTnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld0NvbnRlbnQucHVzaChgJHt0aGlzLm5hbWV9JHt0aGlzLmluRnJvbnRtYXR0ZXIgPyBcIjpcIiA6IFwiOjpcIn0gJHtzZWxlY3RFbC5nZXRWYWx1ZSgpfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHAudmF1bHQubW9kaWZ5KHRoaXMuZmlsZSwgbmV3Q29udGVudC5qb2luKCdcXG4nKSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH07XG59OyIsICJpbXBvcnQgeyBNb2RhbCwgRHJvcGRvd25Db21wb25lbnQsIFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgZmllbGRTZWxlY3RNb2RhbCBmcm9tIFwiLi9maWVsZFNlbGVjdE1vZGFsXCI7XG5pbXBvcnQgTWV0YWRhdGFNZW51IGZyb20gXCJtYWluXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIGNob29zZVNlY3Rpb25Nb2RhbCBleHRlbmRzIE1vZGFsIHtcblxuICAgIHByaXZhdGUgcGx1Z2luOiBNZXRhZGF0YU1lbnU7XG4gICAgcHJpdmF0ZSBmaWxlOiBURmlsZTtcblxuICAgIGNvbnN0cnVjdG9yKHBsdWdpbjogTWV0YWRhdGFNZW51LCBmaWxlOiBURmlsZSkge1xuICAgICAgICBzdXBlcihwbHVnaW4uYXBwKTtcbiAgICAgICAgdGhpcy5maWxlID0gZmlsZTtcbiAgICAgICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgfTtcblxuICAgIGFzeW5jIG9uT3BlbigpIHtcbiAgICAgICAgdGhpcy50aXRsZUVsLnNldFRleHQoXCJBZGQgYSBmaWVsZCBpbiB0aGlzIG5vdGUgYWZ0ZXI6XCIpO1xuICAgICAgICBjb25zdCBpbnB1dERpdiA9IHRoaXMuY29udGVudEVsLmNyZWF0ZURpdih7IGNsczogXCJtZXRhZGF0YS1tZW51LW1vZGFsLXZhbHVlXCIgfSk7XG5cbiAgICAgICAgY29uc3Qgc2VsZWN0RWwgPSBuZXcgRHJvcGRvd25Db21wb25lbnQoaW5wdXREaXYpO1xuICAgICAgICBzZWxlY3RFbC5zZWxlY3RFbC5hZGRDbGFzcyhcIm1ldGFkYXRhLW1lbnUtc2VsZWN0XCIpO1xuICAgICAgICBzZWxlY3RFbC5hZGRPcHRpb24oXCJcIiwgXCJTZWxlY3QgbGluZVwiKTtcbiAgICAgICAgc2VsZWN0RWwuYWRkT3B0aW9uKFwidG9wXzBcIiwgXCJ0b3BcIik7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQodGhpcy5maWxlKVxuICAgICAgICBsZXQgZm9yZUhlYWRUZXh0ID0gZmFsc2U7XG4gICAgICAgIGxldCBmcm9udG1hdHRlclN0YXJ0ID0gZmFsc2U7XG4gICAgICAgIGxldCBmcm9udG1hdHRlckVuZCA9IGZhbHNlO1xuICAgICAgICBsZXQgaW5Gcm9udG1hdHRlciA9IGZhbHNlO1xuICAgICAgICByZXN1bHQuc3BsaXQoXCJcXG5cIikuZm9yRWFjaCgobGluZSwgbGluZU51bWJlcikgPT4ge1xuICAgICAgICAgICAgaWYgKGxpbmUgIT0gXCItLS1cIiAmJiAhZm9yZUhlYWRUZXh0ICYmICFmcm9udG1hdHRlclN0YXJ0KSB7XG4gICAgICAgICAgICAgICAgZm9yZUhlYWRUZXh0ID0gdHJ1ZTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAobGluZSA9PSBcIi0tLVwiICYmICFmb3JlSGVhZFRleHQpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWZyb250bWF0dGVyU3RhcnQpIHtcbiAgICAgICAgICAgICAgICAgICAgZnJvbnRtYXR0ZXJTdGFydCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGluRnJvbnRtYXR0ZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWZyb250bWF0dGVyRW5kKSB7XG4gICAgICAgICAgICAgICAgICAgIGZyb250bWF0dGVyRW5kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgaW5Gcm9udG1hdHRlciA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaW5Gcm9udG1hdHRlcikge1xuICAgICAgICAgICAgICAgIHNlbGVjdEVsLmFkZE9wdGlvbihgZnJvbnRtYXR0ZXJfJHtsaW5lTnVtYmVyfWAsIGAke2xpbmUuc3Vic3RyaW5nKDAsIDMwKX0ke2xpbmUubGVuZ3RoID4gMzAgPyBcIi4uLlwiIDogXCJcIn1gKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc2VsZWN0RWwuYWRkT3B0aW9uKGBib2R5XyR7bGluZU51bWJlcn1gLCBgJHtsaW5lLnN1YnN0cmluZygwLCAzMCl9JHtsaW5lLmxlbmd0aCA+IDMwID8gXCIuLi5cIiA6IFwiXCJ9YCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgICAgc2VsZWN0RWwub25DaGFuZ2UoKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdmFsdWVBcnJheSA9IHNlbGVjdEVsLmdldFZhbHVlKCkubWF0Y2goLyhcXHcrKV8oXFxkKykvKTtcbiAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9uID0gdmFsdWVBcnJheSAmJiB2YWx1ZUFycmF5Lmxlbmd0aCA+IDAgPyB2YWx1ZUFycmF5WzFdIDogMDtcbiAgICAgICAgICAgIGNvbnN0IGxpbmVOdW1iZXIgPSBOdW1iZXIodmFsdWVBcnJheSAmJiB2YWx1ZUFycmF5Lmxlbmd0aCA+IDEgPyB2YWx1ZUFycmF5WzJdIDogMCk7XG4gICAgICAgICAgICBjb25zdCBpbkZyb250bWF0dGVyID0gcG9zaXRpb24gPT0gXCJmcm9udG1hdHRlclwiID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgY29uc3QgdG9wID0gcG9zaXRpb24gPT0gXCJ0b3BcIiA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgICAgIGNvbnN0IG1vZGFsID0gbmV3IGZpZWxkU2VsZWN0TW9kYWwodGhpcy5wbHVnaW4sIHRoaXMuZmlsZSwgbGluZU51bWJlciwgcmVzdWx0LnNwbGl0KCdcXG4nKVtsaW5lTnVtYmVyXSwgaW5Gcm9udG1hdHRlciwgdG9wKTtcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgIG1vZGFsLm9wZW4oKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbn07IiwgImltcG9ydCB7IE1vZGFsLCBEcm9wZG93bkNvbXBvbmVudCwgVEZpbGUgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCBNZXRhZGF0YU1lbnUgZnJvbSBcIm1haW5cIjtcbmltcG9ydCBhZGROZXdGaWVsZE1vZGFsIGZyb20gXCIuL2FkZE5ld0ZpZWxkTW9kYWxcIjtcbmltcG9ydCB2YWx1ZVRleHRJbnB1dE1vZGFsIGZyb20gXCIuL3ZhbHVlVGV4dElucHV0TW9kYWxcIjtcbmltcG9ydCB2YWx1ZVNlbGVjdE1vZGFsIGZyb20gXCIuL3ZhbHVlU2VsZWN0TW9kYWxcIjtcbmltcG9ydCB2YWx1ZU11bHRpU2VsZWN0TW9kYWwgZnJvbSBcIi4vdmFsdWVNdWx0aVNlbGVjdE1vZGFsXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIGZpZWxkU2VsZWN0TW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG5cbiAgICBwcml2YXRlIGxpbmVOdW1iZXI6IG51bWJlcjtcbiAgICBwcml2YXRlIGxpbmU6IHN0cmluZztcbiAgICBwcml2YXRlIHBsdWdpbjogTWV0YWRhdGFNZW51O1xuICAgIHByaXZhdGUgZmlsZTogVEZpbGU7XG4gICAgcHJpdmF0ZSBpbkZyb250bWF0dGVyOiBib29sZWFuO1xuICAgIHByaXZhdGUgdG9wOiBib29sZWFuO1xuXG4gICAgY29uc3RydWN0b3IocGx1Z2luOiBNZXRhZGF0YU1lbnUsIGZpbGU6IFRGaWxlLCBsaW5lTnVtYmVyOiBudW1iZXIsIGxpbmU6IHN0cmluZywgaW5Gcm9udG1hdHRlcjogYm9vbGVhbiwgdG9wOiBib29sZWFuKSB7XG4gICAgICAgIHN1cGVyKHBsdWdpbi5hcHApO1xuICAgICAgICB0aGlzLmxpbmUgPSBsaW5lO1xuICAgICAgICB0aGlzLmxpbmVOdW1iZXIgPSBsaW5lTnVtYmVyO1xuICAgICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICAgICAgdGhpcy5maWxlID0gZmlsZTtcbiAgICAgICAgdGhpcy5pbkZyb250bWF0dGVyID0gaW5Gcm9udG1hdHRlcjtcbiAgICAgICAgdGhpcy50b3AgPSB0b3A7XG4gICAgfTtcblxuICAgIG9uT3BlbigpIHtcbiAgICAgICAgdGhpcy50aXRsZUVsLnNldFRleHQoYEluc2VydCBmaWVsZCBhZnRlciA+ICR7dGhpcy5saW5lLnN1YnN0cmluZygwLCAyMCl9JHt0aGlzLmxpbmUubGVuZ3RoID4gMjAgPyBcIi4uLlwiIDogXCJcIn1gKTtcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gdGhpcy5jb250ZW50RWwuY3JlYXRlRGl2KHsgY2xzOiBcIm1ldGFkYXRhLW1lbnUtZmllbGQtc2VsZWN0XCIgfSk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBzZXR0aW5nc0Ryb3Bkb3duQ29udGFpbmVyID0gY29udGFpbmVyLmNyZWF0ZURpdigpO1xuICAgICAgICBjb25zdCBzZXR0aW5nc1NlbGVjdG9yID0gbmV3IERyb3Bkb3duQ29tcG9uZW50KHNldHRpbmdzRHJvcGRvd25Db250YWluZXIpO1xuICAgICAgICBzZXR0aW5nc1NlbGVjdG9yLmFkZE9wdGlvbihcIi0tLVwiLCBcIkNob29zZSBGaWVsZFwiKTtcbiAgICAgICAgc2V0dGluZ3NTZWxlY3Rvci5hZGRPcHRpb24oXCIrK05ld1wiLCBcIk5ld1wiKTtcbiAgICAgICAgXG4gICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnByZXNldEZpZWxkcy5mb3JFYWNoKHNldHRpbmcgPT4ge1xuICAgICAgICAgICAgc2V0dGluZ3NTZWxlY3Rvci5hZGRPcHRpb24oc2V0dGluZy5uYW1lLCBzZXR0aW5nLm5hbWUpO1xuICAgICAgICB9KTtcblxuICAgICAgICBzZXR0aW5nc1NlbGVjdG9yLm9uQ2hhbmdlKHZhbHVlID0+IHtcbiAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBcIisrTmV3XCIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdGaWVsZE1vZGFsID0gbmV3IGFkZE5ld0ZpZWxkTW9kYWwodGhpcy5wbHVnaW4sIHRoaXMubGluZU51bWJlciwgdGhpcy5maWxlLCB0aGlzLmluRnJvbnRtYXR0ZXIsIHRoaXMudG9wKTtcbiAgICAgICAgICAgICAgICBuZXdGaWVsZE1vZGFsLm9wZW4oKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MucHJlc2V0RmllbGRzLmZpbHRlcihfZmllbGQgPT4gX2ZpZWxkLm5hbWUgPT0gdmFsdWUpWzBdO1xuICAgICAgICAgICAgICAgIGlmIChmaWVsZC52YWx1ZXNMaXN0Tm90ZVBhdGggfHwgKGZpZWxkLnZhbHVlcyAmJiBPYmplY3Qua2V5cyhmaWVsZC52YWx1ZXMpLmxlbmd0aCA+IDApKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWVsZC5pc011bHRpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWVsZE1vZGFsID0gbmV3IHZhbHVlTXVsdGlTZWxlY3RNb2RhbCh0aGlzLmFwcCwgdGhpcy5maWxlLCBmaWVsZC5uYW1lLCBcIlwiLCBmaWVsZCwgdGhpcy5saW5lTnVtYmVyLCB0aGlzLmluRnJvbnRtYXR0ZXIsIHRoaXMudG9wKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkTW9kYWwudGl0bGVFbC5zZXRUZXh0KGBTZWxlY3QgdmFsdWVzIGZvciAke3ZhbHVlfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRNb2RhbC5vcGVuKCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWVsZE1vZGFsID0gbmV3IHZhbHVlU2VsZWN0TW9kYWwodGhpcy5hcHAsIHRoaXMuZmlsZSwgZmllbGQubmFtZSwgXCJcIiwgZmllbGQsIHRoaXMubGluZU51bWJlciwgdGhpcy5pbkZyb250bWF0dGVyLCB0aGlzLnRvcCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZE1vZGFsLnRpdGxlRWwuc2V0VGV4dChgU2VsZWN0IHZhbHVlIGZvciAke3ZhbHVlfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRNb2RhbC5vcGVuKCk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmllbGRNb2RhbCA9IG5ldyB2YWx1ZVRleHRJbnB1dE1vZGFsKHRoaXMuYXBwLCB0aGlzLmZpbGUsIHZhbHVlLCBcIlwiLCB0aGlzLmxpbmVOdW1iZXIsIHRoaXMuaW5Gcm9udG1hdHRlciwgdGhpcy50b3ApO1xuICAgICAgICAgICAgICAgICAgICBmaWVsZE1vZGFsLnRpdGxlRWwuc2V0VGV4dChgRW50ZXIgdmFsdWUgZm9yICR7dmFsdWV9YCk7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkTW9kYWwub3BlbigpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfTtcbn07IiwgImltcG9ydCB7IE1vZGFsLCBUZXh0Q29tcG9uZW50LCBCdXR0b25Db21wb25lbnQsIEV4dHJhQnV0dG9uQ29tcG9uZW50LCBURmlsZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IE1ldGFkYXRhTWVudSBmcm9tIFwibWFpblwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBhZGROZXdGaWVsZE1vZGFsIGV4dGVuZHMgTW9kYWwge1xuXG4gICAgcHJpdmF0ZSBsaW5lTnVtYmVyOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBmaWxlOiBURmlsZTtcbiAgICBwcml2YXRlIGluRnJvbnRtYXR0ZXI6IGJvb2xlYW47XG4gICAgcHJpdmF0ZSB0b3A6IGJvb2xlYW47XG5cbiAgICBjb25zdHJ1Y3RvcihwbHVnaW46IE1ldGFkYXRhTWVudSwgbGluZU51bWJlcjogbnVtYmVyLCBmaWxlOiBURmlsZSwgaW5Gcm9udG1hdHRlcjogYm9vbGVhbiwgdG9wOiBib29sZWFuKSB7XG4gICAgICAgIHN1cGVyKHBsdWdpbi5hcHApO1xuICAgICAgICB0aGlzLmxpbmVOdW1iZXIgPSBsaW5lTnVtYmVyO1xuICAgICAgICB0aGlzLmluRnJvbnRtYXR0ZXIgPSBpbkZyb250bWF0dGVyO1xuICAgICAgICB0aGlzLmZpbGUgPSBmaWxlO1xuICAgICAgICB0aGlzLnRvcCA9IHRvcDtcbiAgICB9XG5cbiAgICBvbk9wZW4oKSB7XG4gICAgICAgIHRoaXMudGl0bGVFbC5zZXRUZXh0KFwiSW5zZXJ0IG5ldyBmaWVsZFwiKTtcbiAgICAgICAgY29uc3QgYWRkTmV3RmllbGRDb250YWluZXIgPSB0aGlzLmNvbnRlbnRFbC5jcmVhdGVEaXYoKTtcbiAgICAgICAgY29uc3QgbmFtZUlucHV0Q29udGFpbmVyID0gYWRkTmV3RmllbGRDb250YWluZXIuY3JlYXRlRGl2KCk7XG4gICAgICAgIG5hbWVJbnB1dENvbnRhaW5lci5zZXRUZXh0KFwiRmllbGQgTmFtZTogXCIpO1xuICAgICAgICBjb25zdCBuYW1lSW5wdXRFbCA9IG5ldyBUZXh0Q29tcG9uZW50KG5hbWVJbnB1dENvbnRhaW5lcik7XG4gICAgICAgIG5hbWVJbnB1dEVsLnNldFBsYWNlaG9sZGVyKFwiRmllbGQgbmFtZVwiKTtcbiAgICAgICAgY29uc3QgdmFsdWVJbnB1dENvbnRhaW5lciA9IGFkZE5ld0ZpZWxkQ29udGFpbmVyLmNyZWF0ZURpdigpO1xuICAgICAgICB2YWx1ZUlucHV0Q29udGFpbmVyLnNldFRleHQoXCJGaWVsZCB2YWx1ZTogXCIpO1xuICAgICAgICBjb25zdCB2YWx1ZUlucHV0RWwgPSBuZXcgVGV4dENvbXBvbmVudCh2YWx1ZUlucHV0Q29udGFpbmVyKTtcbiAgICAgICAgdmFsdWVJbnB1dEVsLnNldFBsYWNlaG9sZGVyKFwiRmllbGQgdmFsdWVcIik7XG4gICAgICAgIGNvbnN0IGZvb3RlckJ1dHRvbnMgPSB0aGlzLmNvbnRlbnRFbC5jcmVhdGVEaXYoe1xuICAgICAgICAgICAgY2xzOiAnbWV0YWRhdGEtbWVudS10ZXh0YXJlYS1idXR0b25zJ1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3Qgc2F2ZUJ1dHRvbiA9IG5ldyBCdXR0b25Db21wb25lbnQoZm9vdGVyQnV0dG9ucyk7XG4gICAgICAgIHNhdmVCdXR0b24uc2V0SWNvbihcImNoZWNrbWFya1wiKTtcbiAgICAgICAgc2F2ZUJ1dHRvbi5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQodGhpcy5maWxlKVxuICAgICAgICAgICAgbGV0IG5ld0NvbnRlbnQ6IHN0cmluZ1tdID0gW107XG4gICAgICAgICAgICBpZiAodGhpcy50b3ApIHtcbiAgICAgICAgICAgICAgICBuZXdDb250ZW50LnB1c2goYCR7bmFtZUlucHV0RWwuZ2V0VmFsdWUoKX0ke3RoaXMuaW5Gcm9udG1hdHRlciA/IFwiOlwiIDogXCI6OlwifSAke3ZhbHVlSW5wdXRFbC5nZXRWYWx1ZSgpfWApO1xuICAgICAgICAgICAgICAgIHJlc3VsdC5zcGxpdChcIlxcblwiKS5mb3JFYWNoKChsaW5lLCBfbGluZU51bWJlcikgPT4gbmV3Q29udGVudC5wdXNoKGxpbmUpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnNwbGl0KFwiXFxuXCIpLmZvckVhY2goKGxpbmUsIF9saW5lTnVtYmVyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIG5ld0NvbnRlbnQucHVzaChsaW5lKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKF9saW5lTnVtYmVyID09IHRoaXMubGluZU51bWJlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3Q29udGVudC5wdXNoKGAke25hbWVJbnB1dEVsLmdldFZhbHVlKCl9JHt0aGlzLmluRnJvbnRtYXR0ZXIgPyBcIjpcIiA6IFwiOjpcIn0gJHt2YWx1ZUlucHV0RWwuZ2V0VmFsdWUoKX1gKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5hcHAudmF1bHQubW9kaWZ5KHRoaXMuZmlsZSwgbmV3Q29udGVudC5qb2luKCdcXG4nKSk7XG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBjYW5jZWxCdXR0b24gPSBuZXcgRXh0cmFCdXR0b25Db21wb25lbnQoZm9vdGVyQnV0dG9ucyk7XG4gICAgICAgIGNhbmNlbEJ1dHRvbi5zZXRJY29uKFwiY3Jvc3NcIik7XG4gICAgICAgIGNhbmNlbEJ1dHRvbi5vbkNsaWNrKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgfSk7XG5cblxuICAgIH07XG59OyIsICJpbXBvcnQgRmllbGQgZnJvbSBcInNyYy9GaWVsZFwiO1xuaW1wb3J0IHsgZ2VuZXJpY0ZpZWxkUmVnZXggfSBmcm9tIFwic3JjL3V0aWxzL3BhcnNlclwiO1xuXG5pbnRlcmZhY2UgRmlsZUNsYXNzQXR0cmlidXRlIHtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgdHlwZTogc3RyaW5nO1xuICAgIG9wdGlvbnM6IHN0cmluZ1tdO1xuICAgIGlzTXVsdGk6IGJvb2xlYW47XG4gICAgaXNDeWNsZTogYm9vbGVhbjtcbn1cblxuY29uc3QgdHlwZXM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7XG4gICAgXCJpbnB1dFwiOiBcIkFjY2VwdHMgYW55IHZhbHVlXCIsXG4gICAgXCJzZWxlY3RcIjogXCJBY2NlcHRzIGEgc2luZ2xlIHZhbHVlIGZyb20gYSBsaXN0XCIsXG4gICAgXCJtdWx0aVwiOiBcIkFjY2VwdHMgbXVsdGlwbGUgdmFsdWVzIGZyb20gYSBsaXN0XCIsXG4gICAgXCJjeWNsZVwiOiBcIkN5Y2xlIHRocm91Z2ggdmFsdWVzIGZyb20gYSBsaXN0XCJcbn1cblxuY2xhc3MgRmlsZUNsYXNzQXR0cmlidXRlIHtcblxuICAgIGNvbnN0cnVjdG9yKHJhdzogc3RyaW5nKSB7XG4gICAgICAgIGNvbnN0IGNvbXBsZXRlUmVnZXggPSBuZXcgUmVnRXhwKGBeJHtnZW5lcmljRmllbGRSZWdleH06Oig/PGZpZWxkU2V0dGluZ3M+LispP2AsIFwidVwiKTtcbiAgICAgICAgY29uc3QgbmFtZVJlZ2V4ID0gbmV3IFJlZ0V4cChgXiR7Z2VuZXJpY0ZpZWxkUmVnZXh9JGAsIFwidVwiKTtcbiAgICAgICAgbGV0IGZpZWxkTmFtZTogc3RyaW5nXG4gICAgICAgIGxldCB7IGF0dHJpYnV0ZSwgZmllbGRTZXR0aW5ncyB9ID0gcmF3Lm1hdGNoKGNvbXBsZXRlUmVnZXgpPy5ncm91cHMgfHwge31cbiAgICAgICAgaWYgKGF0dHJpYnV0ZSkge1xuICAgICAgICAgICAgZmllbGROYW1lID0gYXR0cmlidXRlXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsZXQgeyBhdHRyaWJ1dGUgfSA9IHJhdy5tYXRjaChuYW1lUmVnZXgpPy5ncm91cHMgfHwge31cbiAgICAgICAgICAgIGZpZWxkTmFtZSA9IGF0dHJpYnV0ZVxuICAgICAgICB9XG4gICAgICAgIGlmIChmaWVsZE5hbWUpIHtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZS50cmltKCk7XG4gICAgICAgICAgICBpZiAoZmllbGRTZXR0aW5ncykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNldHRpbmdzID0gSlNPTi5wYXJzZShgJHtmaWVsZFNldHRpbmdzLnRyaW0oKX1gKTtcbiAgICAgICAgICAgICAgICB0aGlzLnR5cGUgPSBzZXR0aW5nc1sndHlwZSddO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodGhpcy50eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJtdWx0aVwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc011bHRpID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiY3ljbGVcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNDeWNsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSBzZXR0aW5nc1snb3B0aW9ucyddO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoXCJJbXByb3BlciB2YWx1ZVwiKTtcbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGdldEZpZWxkKCkge1xuICAgICAgICBsZXQgdmFsdWVzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge307XG4gICAgICAgIHRoaXMub3B0aW9ucy5mb3JFYWNoKChvcHRpb24sIGluZGV4KSA9PiB7XG4gICAgICAgICAgICB2YWx1ZXNbaW5kZXhdID0gb3B0aW9uO1xuICAgICAgICB9KVxuICAgICAgICByZXR1cm4gbmV3IEZpZWxkKHRoaXMubmFtZSwgdmFsdWVzLCB0aGlzLm5hbWUsIHRoaXMuaXNNdWx0aSwgdGhpcy5pc0N5Y2xlKTtcbiAgICB9XG59XG5cbmV4cG9ydCB7IEZpbGVDbGFzc0F0dHJpYnV0ZSwgdHlwZXMgfTsiLCAiaW1wb3J0IHsgRmlsZUNsYXNzQXR0cmlidXRlIH0gZnJvbSBcIi4vZmlsZUNsYXNzQXR0cmlidXRlXCI7XG5pbXBvcnQgTWV0YWRhdGFNZW51IGZyb20gXCJtYWluXCI7XG5pbXBvcnQgeyBURmlsZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuXG5pbnRlcmZhY2UgRmlsZUNsYXNzIHtcbiAgICBwbHVnaW46IE1ldGFkYXRhTWVudTtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgYXR0cmlidXRlczogQXJyYXk8RmlsZUNsYXNzQXR0cmlidXRlPjtcbiAgICBvYmplY3RzOiBGaWxlQ2xhc3NNYW5hZ2VyO1xuICAgIGVycm9yczogc3RyaW5nW107XG59XG5cbmNsYXNzIEZpbGVDbGFzc01hbmFnZXIge1xuICAgIHB1YmxpYyBpbnN0YW5jZTogRmlsZUNsYXNzO1xuXG4gICAgY29uc3RydWN0b3IoaW5zdGFuY2U6IEZpbGVDbGFzcykge1xuICAgICAgICB0aGlzLmluc3RhbmNlID0gaW5zdGFuY2U7XG4gICAgfVxuXG4gICAgcHVibGljIGFsbCgpIHtcbiAgICAgICAgY29uc3QgZmlsZXNXaXRoRmlsZUNsYXNzTmFtZSA9IHRoaXMuaW5zdGFuY2UucGx1Z2luLmFwcC52YXVsdC5nZXRNYXJrZG93bkZpbGVzKCkuZmlsdGVyKGZpbGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2FjaGUgPSB0aGlzLmluc3RhbmNlLnBsdWdpbi5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUoZmlsZSk7XG4gICAgICAgICAgICBjb25zdCBmaWxlQ2xhc3NBbGlhcyA9IHRoaXMuaW5zdGFuY2UucGx1Z2luLnNldHRpbmdzLmZpbGVDbGFzc0FsaWFzO1xuICAgICAgICAgICAgcmV0dXJuIGNhY2hlPy5mcm9udG1hdHRlclxuICAgICAgICAgICAgICAgICYmIE9iamVjdC5rZXlzKGNhY2hlLmZyb250bWF0dGVyKS5pbmNsdWRlcyhmaWxlQ2xhc3NBbGlhcylcbiAgICAgICAgICAgICAgICAmJiBjYWNoZS5mcm9udG1hdHRlcltmaWxlQ2xhc3NBbGlhc10gPT0gdGhpcy5pbnN0YW5jZS5uYW1lO1xuICAgICAgICB9KVxuICAgICAgICByZXR1cm4gZmlsZXNXaXRoRmlsZUNsYXNzTmFtZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0KG5hbWU6IHN0cmluZykge1xuICAgICAgICBjb25zdCBmaWxlc1dpdGhOYW1lID0gdGhpcy5hbGwoKS5maWx0ZXIoZmlsZSA9PiBmaWxlLmJhc2VuYW1lID09IG5hbWUpO1xuICAgICAgICBpZiAoZmlsZXNXaXRoTmFtZS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcihcIk1vcmUgdGhhbiBvbmUgdmFsdWUgZm91bmRcIik7XG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZmlsZXNXaXRoTmFtZS5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoXCJObyBmaWxlIHZhbHVlIGZvdW5kXCIpO1xuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZpbGVzV2l0aE5hbWVbMF07XG5cbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0UGF0aChwYXRoOiBzdHJpbmcpIHtcbiAgICAgICAgY29uc3QgZmlsZXNXaXRoTmFtZSA9IHRoaXMuYWxsKCkuZmlsdGVyKGZpbGUgPT4gZmlsZS5wYXRoID09IHBhdGgpO1xuICAgICAgICBpZiAoZmlsZXNXaXRoTmFtZS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcihcIk1vcmUgdGhhbiBvbmUgdmFsdWUgZm91bmRcIik7XG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZmlsZXNXaXRoTmFtZS5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoXCJObyBmaWxlIHZhbHVlIGZvdW5kXCIpO1xuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZpbGVzV2l0aE5hbWVbMF07XG5cbiAgICB9XG59XG5cbmNsYXNzIEZpbGVDbGFzcyB7XG4gICAgY29uc3RydWN0b3IocGx1Z2luOiBNZXRhZGF0YU1lbnUsIG5hbWU6IHN0cmluZykge1xuICAgICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgdGhpcy5vYmplY3RzID0gbmV3IEZpbGVDbGFzc01hbmFnZXIodGhpcyk7XG4gICAgICAgIHRoaXMuYXR0cmlidXRlcyA9IFtdO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRDbGFzc0ZpbGUoKTogVEZpbGUge1xuICAgICAgICBjb25zdCBmaWxlc0NsYXNzUGF0aCA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmNsYXNzRmlsZXNQYXRoO1xuICAgICAgICBjb25zdCBmaWxlID0gdGhpcy5wbHVnaW4uYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChgJHtmaWxlc0NsYXNzUGF0aH0ke3RoaXMubmFtZX0ubWRgKTtcbiAgICAgICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURmlsZSAmJiBmaWxlLmV4dGVuc2lvbiA9PSBcIm1kXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBmaWxlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoXCJubyBzdWNoIGZpbGVDbGFzcyBpbiBmaWxlQ2xhc3MgZm9sZGVyXCIpO1xuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgZ2V0QXR0cmlidXRlcygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmdldENsYXNzRmlsZSgpO1xuICAgICAgICAgICAgbGV0IGF0dHJpYnV0ZXM6IEFycmF5PEZpbGVDbGFzc0F0dHJpYnV0ZT4gPSBbXTtcbiAgICAgICAgICAgIGxldCBlcnJvcnM6IHN0cmluZ1tdID0gW107XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnBsdWdpbi5hcHAudmF1bHQuY2FjaGVkUmVhZChmaWxlKVxuICAgICAgICAgICAgcmVzdWx0LnNwbGl0KCdcXG4nKS5mb3JFYWNoKGxpbmUgPT4ge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGF0dHJpYnV0ZSA9IG5ldyBGaWxlQ2xhc3NBdHRyaWJ1dGUobGluZSk7XG4gICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXMucHVzaChhdHRyaWJ1dGUpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGVycm9ycy5wdXNoKGVycm9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgdGhpcy5hdHRyaWJ1dGVzID0gYXR0cmlidXRlcztcbiAgICAgICAgICAgIHRoaXMuZXJyb3JzID0gZXJyb3JzO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgdGhyb3cgKGVycm9yKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyB1cGRhdGVBdHRyaWJ1dGUobmV3VHlwZTogc3RyaW5nLCBuZXdPcHRpb25zOiBzdHJpbmdbXSwgbmV3TmFtZTogc3RyaW5nLCBhdHRyPzogRmlsZUNsYXNzQXR0cmlidXRlKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmdldENsYXNzRmlsZSgpO1xuICAgICAgICBsZXQgcmVzdWx0ID0gYXdhaXQgdGhpcy5wbHVnaW4uYXBwLnZhdWx0LnJlYWQoZmlsZSlcbiAgICAgICAgaWYgKGF0dHIpIHtcbiAgICAgICAgICAgIGxldCBuZXdDb250ZW50OiBzdHJpbmdbXSA9IFtdO1xuICAgICAgICAgICAgcmVzdWx0LnNwbGl0KCdcXG4nKS5mb3JFYWNoKGxpbmUgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChsaW5lLnN0YXJ0c1dpdGgoYXR0ci5uYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAobmV3VHlwZSA9PSBcImlucHV0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0NvbnRlbnQucHVzaChuZXdOYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzZXR0aW5nczogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NbXCJ0eXBlXCJdID0gbmV3VHlwZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzW1wib3B0aW9uc1wiXSA9IG5ld09wdGlvbnM7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdDb250ZW50LnB1c2goYCR7bmV3TmFtZX06OiAke0pTT04uc3RyaW5naWZ5KHNldHRpbmdzKX1gKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld0NvbnRlbnQucHVzaChsaW5lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgdGhpcy5wbHVnaW4uYXBwLnZhdWx0Lm1vZGlmeShmaWxlLCBuZXdDb250ZW50LmpvaW4oJ1xcbicpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxldCBzZXR0aW5nczogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9O1xuICAgICAgICAgICAgc2V0dGluZ3NbXCJ0eXBlXCJdID0gbmV3VHlwZTtcbiAgICAgICAgICAgIHNldHRpbmdzW1wib3B0aW9uc1wiXSA9IG5ld09wdGlvbnM7XG4gICAgICAgICAgICByZXN1bHQgKz0gKGBcXG4ke25ld05hbWV9OjogJHtKU09OLnN0cmluZ2lmeShzZXR0aW5ncyl9YCk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5hcHAudmF1bHQubW9kaWZ5KGZpbGUsIHJlc3VsdCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgcmVtb3ZlQXR0cmlidXRlKGF0dHI6IEZpbGVDbGFzc0F0dHJpYnV0ZSk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBmaWxlID0gdGhpcy5nZXRDbGFzc0ZpbGUoKTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5wbHVnaW4uYXBwLnZhdWx0LnJlYWQoZmlsZSlcbiAgICAgICAgbGV0IG5ld0NvbnRlbnQ6IHN0cmluZ1tdID0gW107XG4gICAgICAgIHJlc3VsdC5zcGxpdCgnXFxuJykuZm9yRWFjaChsaW5lID0+IHtcbiAgICAgICAgICAgIGlmICghbGluZS5zdGFydHNXaXRoKGF0dHIubmFtZSkpIHtcbiAgICAgICAgICAgICAgICBuZXdDb250ZW50LnB1c2gobGluZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLmFwcC52YXVsdC5tb2RpZnkoZmlsZSwgbmV3Q29udGVudC5qb2luKCdcXG4nKSk7XG4gICAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBjcmVhdGVGaWxlQ2xhc3MocGx1Z2luOiBNZXRhZGF0YU1lbnUsIG5hbWU6IHN0cmluZyk6IFByb21pc2U8RmlsZUNsYXNzPiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgY29uc3QgZmlsZUNsYXNzID0gbmV3IEZpbGVDbGFzcyhwbHVnaW4sIG5hbWUpO1xuICAgICAgICBmaWxlQ2xhc3MuZ2V0QXR0cmlidXRlcygpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgcmVzb2x2ZShmaWxlQ2xhc3MpO1xuICAgICAgICB9KS5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICAgIH0pXG4gICAgfSlcbn1cblxuZXhwb3J0IHsgY3JlYXRlRmlsZUNsYXNzLCBGaWxlQ2xhc3MgfTsiLCAiaW1wb3J0IE1ldGFkYXRhTWVudSBmcm9tIFwibWFpblwiO1xuaW1wb3J0IHsgRHJvcGRvd25Db21wb25lbnQsIE1vZGFsLCBURmlsZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgY3JlYXRlRmlsZUNsYXNzIH0gZnJvbSBcInNyYy9maWxlQ2xhc3MvZmlsZUNsYXNzXCI7XG5pbXBvcnQgeyBGaWxlQ2xhc3NBdHRyaWJ1dGVNb2RhbCB9IGZyb20gXCJzcmMvZmlsZUNsYXNzL0ZpbGVDbGFzc0F0dHJpYnV0ZU1vZGFsXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEZpbGVDbGFzc0F0dHJpYnV0ZVNlbGVjdE1vZGFsIGV4dGVuZHMgTW9kYWwge1xuXG4gICAgcGx1Z2luOiBNZXRhZGF0YU1lbnU7XG4gICAgZmlsZTogVEZpbGU7XG5cbiAgICBjb25zdHJ1Y3RvcihwbHVnaW46IE1ldGFkYXRhTWVudSwgZmlsZTogVEZpbGUpIHtcbiAgICAgICAgc3VwZXIocGx1Z2luLmFwcCk7XG4gICAgICAgIHRoaXMuZmlsZSA9IGZpbGU7XG4gICAgICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIH1cblxuICAgIGFzeW5jIG9uT3BlbigpIHtcbiAgICAgICAgdGhpcy50aXRsZUVsLnNldFRleHQoYFNlbGVjdCB0aGUgZmllbGQgdG8gdXBkYXRlYCk7XG4gICAgICAgIGNvbnN0IGZpbGVDbGFzcyA9IGF3YWl0IGNyZWF0ZUZpbGVDbGFzcyh0aGlzLnBsdWdpbiwgdGhpcy5maWxlLmJhc2VuYW1lKVxuICAgICAgICB0aGlzLnRpdGxlRWwuc2V0VGV4dChgU2VsZWN0IHRoZSBmaWVsZCB0byB1cGRhdGUgaW4gJHtmaWxlQ2xhc3MubmFtZX1gKTtcbiAgICAgICAgY29uc3Qgc2VsZWN0Q29udGFpbmVyID0gdGhpcy5jb250ZW50RWwuY3JlYXRlRGl2KCk7XG4gICAgICAgIGNvbnN0IHNlbGVjdCA9IG5ldyBEcm9wZG93bkNvbXBvbmVudChzZWxlY3RDb250YWluZXIpO1xuICAgICAgICBzZWxlY3QuYWRkT3B0aW9uKFwic2VsZWN0IGFuIGF0dHJpYnV0ZVwiLCBcIi0tc2VsZWN0IGFuIGF0dHJpYnV0ZS0tXCIpO1xuICAgICAgICBmaWxlQ2xhc3MuYXR0cmlidXRlcy5mb3JFYWNoKGF0dHIgPT4ge1xuICAgICAgICAgICAgc2VsZWN0LmFkZE9wdGlvbihhdHRyLm5hbWUsIGF0dHIubmFtZSk7XG4gICAgICAgIH0pXG5cbiAgICAgICAgc2VsZWN0LmFkZE9wdGlvbihcIisrbmV3QXR0cisrXCIsIFwiKytBZGQgYSBuZXcgYXR0cmlidXRlKytcIik7XG4gICAgICAgIHNlbGVjdC5vbkNoYW5nZSgoYXR0ck5hbWUpID0+IHtcbiAgICAgICAgICAgIGlmIChhdHRyTmFtZSA9PSBcIisrbmV3QXR0clwiKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbW9kYWwgPSBuZXcgRmlsZUNsYXNzQXR0cmlidXRlTW9kYWwodGhpcy5wbHVnaW4uYXBwLCBmaWxlQ2xhc3MpO1xuICAgICAgICAgICAgICAgIG1vZGFsLm9wZW4oKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1vZGFsID0gbmV3IEZpbGVDbGFzc0F0dHJpYnV0ZU1vZGFsKHRoaXMucGx1Z2luLmFwcCwgZmlsZUNsYXNzLCBmaWxlQ2xhc3MuYXR0cmlidXRlcy5maWx0ZXIoYXR0ciA9PiBhdHRyLm5hbWUgPT0gYXR0ck5hbWUpWzBdKTtcbiAgICAgICAgICAgICAgICBtb2RhbC5vcGVuKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgIH1cbn0iLCAiaW1wb3J0IHsgQXBwLCBEcm9wZG93bkNvbXBvbmVudCwgTW9kYWwsIFRleHRDb21wb25lbnQsIEJ1dHRvbkNvbXBvbmVudCwgRXh0cmFCdXR0b25Db21wb25lbnQsIFRleHRBcmVhQ29tcG9uZW50IH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBGaWxlQ2xhc3NBdHRyaWJ1dGUsIHR5cGVzIH0gZnJvbSBcInNyYy9maWxlQ2xhc3MvZmlsZUNsYXNzQXR0cmlidXRlXCI7XG5pbXBvcnQgeyBGaWxlQ2xhc3MgfSBmcm9tIFwic3JjL2ZpbGVDbGFzcy9maWxlQ2xhc3NcIjtcblxuXG5pbnRlcmZhY2UgRmlsZUNsYXNzQXR0cmlidXRlTW9kYWwge1xuICAgIGF0dHI/OiBGaWxlQ2xhc3NBdHRyaWJ1dGU7XG4gICAgZmlsZUNsYXNzOiBGaWxlQ2xhc3M7XG4gICAgdHlwZTogc3RyaW5nO1xuICAgIG9wdGlvbnM6IHN0cmluZ1tdO1xuICAgIG5hbWU6IHN0cmluZztcbn1cblxuY2xhc3MgRmlsZUNsYXNzQXR0cmlidXRlTW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG5cbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgZmlsZUNsYXNzOiBGaWxlQ2xhc3MsIGF0dHI/OiBGaWxlQ2xhc3NBdHRyaWJ1dGUpIHtcbiAgICAgICAgc3VwZXIoYXBwKTtcbiAgICAgICAgdGhpcy5hdHRyID0gYXR0cjtcbiAgICAgICAgdGhpcy5maWxlQ2xhc3MgPSBmaWxlQ2xhc3M7XG4gICAgICAgIGlmICh0aGlzLmF0dHIpIHtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IHRoaXMuYXR0ci50eXBlIHx8IFwiaW5wdXRcIjtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9IHRoaXMuYXR0ci5vcHRpb25zO1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gdGhpcy5hdHRyLm5hbWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvbk9wZW4oKSB7XG4gICAgICAgIC8vdGl0bGVcbiAgICAgICAgdGhpcy50aXRsZUVsLnNldFRleHQodGhpcy5hdHRyID8gYE1hbmFnZSAke3RoaXMuYXR0ci5uYW1lfWAgOiBgQ3JlYXRlIGEgbmV3IGF0dHJpYnV0ZSBmb3IgJHt0aGlzLmZpbGVDbGFzcy5uYW1lfWApO1xuXG4gICAgICAgIC8vbmFtZSBpbnB1dFxuICAgICAgICBjb25zdCBuYW1lSW5wdXRDb250YWluZXIgPSB0aGlzLmNvbnRlbnRFbC5jcmVhdGVEaXYoKTtcbiAgICAgICAgbmFtZUlucHV0Q29udGFpbmVyLnNldFRleHQoXCJuYW1lXCIpO1xuICAgICAgICBjb25zdCBuYW1lSW5wdXQgPSBuZXcgVGV4dENvbXBvbmVudChuYW1lSW5wdXRDb250YWluZXIpO1xuICAgICAgICB0aGlzLmF0dHIgPyBuYW1lSW5wdXQuc2V0VmFsdWUodGhpcy5hdHRyLm5hbWUpIDogbmFtZUlucHV0LnNldFBsYWNlaG9sZGVyKFwiVHlwZSBhIG5hbWUgZm9yIHRoaXMgYXR0cmlidXRlXCIpO1xuXG4gICAgICAgIC8vaGVhZGVyIGZvciBzZWxlY3RcbiAgICAgICAgY29uc3QgdHlwZVNlbGVjdEhlYWRlciA9IHRoaXMuY29udGVudEVsLmNyZWF0ZURpdigpO1xuICAgICAgICBjb25zdCBhdHRyTGluZSA9IHR5cGVTZWxlY3RIZWFkZXIuY3JlYXRlRWwoXCJkaXZcIik7XG4gICAgICAgIGNvbnN0IGF0dHJOYW1lID0gYXR0ckxpbmUuY3JlYXRlRWwoXCJzdHJvbmdcIik7XG4gICAgICAgIGF0dHJOYW1lLnNldFRleHQoYDwke3RoaXMubmFtZX0+YCk7XG4gICAgICAgIGF0dHJMaW5lLmFwcGVuZChcIiBmaWVsZHMgaW4gZmlsZXMgd2l0aDpcIik7XG4gICAgICAgIFN0cmluZyhgLS0tXFxuZmlsZUNsYXNzOiAke3RoaXMuZmlsZUNsYXNzLm5hbWV9XFxuLi4uXFxuLS0tYCkuc3BsaXQoJ1xcbicpLmZvckVhY2gobGluZSA9PiB7XG4gICAgICAgICAgICB0eXBlU2VsZWN0SGVhZGVyLmNyZWF0ZUVsKFwiZGl2XCIsIFwieWFtbC1tZXRhZGF0YS1tZW51LXJlZFwiKS5zZXRUZXh0KGxpbmUpO1xuICAgICAgICB9KVxuXG4gICAgICAgIC8vIHR5cGUgc2VsZWN0XG4gICAgICAgIGNvbnN0IHR5cGVTZWxlY3RDb250YWluZXIgPSB0aGlzLmNvbnRlbnRFbC5jcmVhdGVEaXYoeyBjbHM6ICdtZXRhZGF0YS1tZW51LXZhbHVlLXNlbGVjdG9yLWNvbnRhaW5lcicgfSk7XG4gICAgICAgIGNvbnN0IHR5cGVTZWxlY3RMYWJlbCA9IHR5cGVTZWxlY3RDb250YWluZXIuY3JlYXRlRGl2KHsgY2xzOiAnbWV0YWRhdGEtbWVudS12YWx1ZS1zZWxlY3Rvci1pbmxpbmUtbGFiZWwnIH0pO1xuICAgICAgICB0eXBlU2VsZWN0TGFiZWwuc2V0VGV4dChcIndpbGw6IFwiKTtcbiAgICAgICAgY29uc3QgdHlwZVNlbGVjdERyb3BEb3duID0gdHlwZVNlbGVjdENvbnRhaW5lci5jcmVhdGVEaXYoeyBjbHM6ICdtZXRhZGF0YS1tZW51LXZhbHVlLXNlbGVjdG9yLXRvZ2dsZXInIH0pO1xuICAgICAgICBjb25zdCB0eXBlU2VsZWN0ID0gbmV3IERyb3Bkb3duQ29tcG9uZW50KHR5cGVTZWxlY3REcm9wRG93bik7XG4gICAgICAgIE9iamVjdC5rZXlzKHR5cGVzKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgICAgICB0eXBlU2VsZWN0LmFkZE9wdGlvbihrZXksIHR5cGVzW2tleV0pO1xuICAgICAgICB9KVxuICAgICAgICBpZiAodGhpcy5hdHRyKSB7XG4gICAgICAgICAgICB0eXBlU2VsZWN0LnNldFZhbHVlKHRoaXMudHlwZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBvcHRpb25zIGlucHV0XG4gICAgICAgIGNvbnN0IG9wdGlvbnNJbnB1dENvbnRhaW5lciA9IHRoaXMuY29udGVudEVsLmNyZWF0ZURpdih7IGNsczogJ21ldGFkYXRhLW1lbnUtdmFsdWUtc2VsZWN0b3ItY29udGFpbmVyJyB9KTtcbiAgICAgICAgY29uc3Qgb3B0aW9uc0lucHV0TGFiZWwgPSBvcHRpb25zSW5wdXRDb250YWluZXIuY3JlYXRlRGl2KHsgY2xzOiAnbWV0YWRhdGEtbWVudS12YWx1ZS1zZWxlY3Rvci1pbmxpbmUtbGFiZWwtdG9wJyB9KTtcbiAgICAgICAgb3B0aW9uc0lucHV0TGFiZWwuc2V0VGV4dChcIlZhbHVlc1wiKTtcbiAgICAgICAgY29uc3Qgb3B0aW9uc0lucHV0ID0gbmV3IFRleHRBcmVhQ29tcG9uZW50KG9wdGlvbnNJbnB1dENvbnRhaW5lcik7XG4gICAgICAgIG9wdGlvbnNJbnB1dC5pbnB1dEVsLnJvd3MgPSAzO1xuICAgICAgICBvcHRpb25zSW5wdXQuaW5wdXRFbC5jb2xzID0gMjY7XG4gICAgICAgIHRoaXMuYXR0ciA/IG9wdGlvbnNJbnB1dC5zZXRWYWx1ZSh0aGlzLnR5cGUgPT0gXCJpbnB1dFwiID8gXCJcIiA6IHRoaXMub3B0aW9ucy5qb2luKFwiLCBcIikpIDogb3B0aW9uc0lucHV0LnNldFBsYWNlaG9sZGVyKFwiaW5zZXJ0IHZhbHVlcywgY29tbWEgc2VwYXJhdGVkXCIpO1xuICAgICAgICAhdGhpcy5hdHRyIHx8IHRoaXMudHlwZSA9PSBcImlucHV0XCIgPyBvcHRpb25zSW5wdXRDb250YWluZXIuaGlkZSgpIDogb3B0aW9uc0lucHV0Q29udGFpbmVyLnNob3coKTtcblxuICAgICAgICAvLyBldmVudCBoYW5kbGVyc1xuICAgICAgICB0eXBlU2VsZWN0Lm9uQ2hhbmdlKHR5cGUgPT4ge1xuICAgICAgICAgICAgdHlwZSA9PSBcImlucHV0XCIgPyBvcHRpb25zSW5wdXRDb250YWluZXIuaGlkZSgpIDogb3B0aW9uc0lucHV0Q29udGFpbmVyLnNob3coKTtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XG4gICAgICAgIH0pXG4gICAgICAgIG9wdGlvbnNJbnB1dC5vbkNoYW5nZSh2YWx1ZSA9PiB0aGlzLm9wdGlvbnMgPSB2YWx1ZS5zcGxpdChcIixcIikubWFwKGl0ZW0gPT4gaXRlbS50cmltKCkpKTtcbiAgICAgICAgbmFtZUlucHV0Lm9uQ2hhbmdlKHZhbHVlID0+IHsgdGhpcy5uYW1lID0gdmFsdWU7IGF0dHJOYW1lLnNldFRleHQoYDwke3ZhbHVlfT5gKSB9KTtcblxuICAgICAgICAvLyBmb290ZXIgYnV0dG9uc1xuICAgICAgICBjb25zdCBmb290ZXIgPSB0aGlzLmNvbnRlbnRFbC5jcmVhdGVEaXYoeyBjbHM6IFwibWV0YWRhdGEtbWVudS12YWx1ZS1ncmlkLWZvb3RlclwiIH0pO1xuICAgICAgICBjb25zdCBzYXZlQnV0dG9uID0gbmV3IEJ1dHRvbkNvbXBvbmVudChmb290ZXIpO1xuICAgICAgICBzYXZlQnV0dG9uLnNldEljb24oXCJjaGVja21hcmtcIik7XG4gICAgICAgIHNhdmVCdXR0b24ub25DbGljaygoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmZpbGVDbGFzcy51cGRhdGVBdHRyaWJ1dGUodGhpcy50eXBlLCB0aGlzLm9wdGlvbnMsIHRoaXMubmFtZSwgdGhpcy5hdHRyKTtcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgfSlcbiAgICAgICAgaWYgKHRoaXMuYXR0cikge1xuICAgICAgICAgICAgY29uc3QgcmVtb3ZlQnV0dG9uID0gbmV3IEJ1dHRvbkNvbXBvbmVudChmb290ZXIpO1xuICAgICAgICAgICAgcmVtb3ZlQnV0dG9uLnNldEljb24oXCJ0cmFzaFwiKTtcbiAgICAgICAgICAgIHJlbW92ZUJ1dHRvbi5vbkNsaWNrKCgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb25maXJtTW9kYWwgPSBuZXcgTW9kYWwodGhpcy5hcHApO1xuICAgICAgICAgICAgICAgIGNvbmZpcm1Nb2RhbC50aXRsZUVsLnNldFRleHQoXCJQbGVhc2UgY29uZmlybVwiKTtcbiAgICAgICAgICAgICAgICBjb25maXJtTW9kYWwuY29udGVudEVsLmNyZWF0ZURpdigpLnNldFRleHQoYERvIHlvdSByZWFsbHkgd2FudCB0byByZW1vdmUgJHt0aGlzLmF0dHI/Lm5hbWV9IGF0dHJpYnV0ZSBmcm9tICR7dGhpcy5maWxlQ2xhc3MubmFtZX0/YCk7XG4gICAgICAgICAgICAgICAgY29uc3QgY29uZmlybUZvb3RlciA9IGNvbmZpcm1Nb2RhbC5jb250ZW50RWwuY3JlYXRlRGl2KHsgY2xzOiBcIm1ldGFkYXRhLW1lbnUtdmFsdWUtZ3JpZC1mb290ZXJcIiB9KTtcbiAgICAgICAgICAgICAgICBjb25zdCBjb25maXJtQnV0dG9uID0gbmV3IEJ1dHRvbkNvbXBvbmVudChjb25maXJtRm9vdGVyKTtcbiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uLnNldEljb24oXCJjaGVja21hcmtcIik7XG4gICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvbi5vbkNsaWNrKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYXR0cikgdGhpcy5maWxlQ2xhc3MucmVtb3ZlQXR0cmlidXRlKHRoaXMuYXR0cik7XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpcm1Nb2RhbC5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICBjb25zdCBkaXNtaXNzQnV0dG9uID0gbmV3IEV4dHJhQnV0dG9uQ29tcG9uZW50KGNvbmZpcm1Gb290ZXIpO1xuICAgICAgICAgICAgICAgIGRpc21pc3NCdXR0b24uc2V0SWNvbihcImNyb3NzXCIpO1xuICAgICAgICAgICAgICAgIGRpc21pc3NCdXR0b24ub25DbGljaygoKSA9PiB0aGlzLmNsb3NlKCkpO1xuICAgICAgICAgICAgICAgIGNvbmZpcm1Nb2RhbC5vcGVuKCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNhbmNlbEJ1dHRvbiA9IG5ldyBFeHRyYUJ1dHRvbkNvbXBvbmVudChmb290ZXIpO1xuICAgICAgICBjYW5jZWxCdXR0b24uc2V0SWNvbihcImNyb3NzXCIpO1xuICAgICAgICBjYW5jZWxCdXR0b24ub25DbGljaygoKSA9PiB0aGlzLmNsb3NlKCkpO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgRmlsZUNsYXNzQXR0cmlidXRlTW9kYWwgfSIsICJpbXBvcnQgTWV0YWRhdGFNZW51IGZyb20gXCJtYWluXCI7XG5pbXBvcnQgeyBBcHAsIFRGaWxlLCBNZW51IH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgdmFsdWVNdWx0aVNlbGVjdE1vZGFsIGZyb20gXCJzcmMvb3B0aW9uTW9kYWxzL3ZhbHVlTXVsdGlTZWxlY3RNb2RhbFwiO1xuaW1wb3J0IHZhbHVlVGV4dElucHV0TW9kYWwgZnJvbSBcInNyYy9vcHRpb25Nb2RhbHMvdmFsdWVUZXh0SW5wdXRNb2RhbFwiO1xuaW1wb3J0IHZhbHVlVG9nZ2xlTW9kYWwgZnJvbSBcInNyYy9vcHRpb25Nb2RhbHMvdmFsdWVUb2dnbGVNb2RhbFwiO1xuaW1wb3J0IHZhbHVlU2VsZWN0TW9kYWwgZnJvbSBcInNyYy9vcHRpb25Nb2RhbHMvdmFsdWVTZWxlY3RNb2RhbFwiO1xuaW1wb3J0IEZpZWxkIGZyb20gXCJzcmMvRmllbGRcIjtcbmltcG9ydCBjaG9vc2VTZWN0aW9uTW9kYWwgZnJvbSBcIi4uL29wdGlvbk1vZGFscy9jaG9vc2VTZWN0aW9uTW9kYWxcIjtcbmltcG9ydCBTZWxlY3RNb2RhbCBmcm9tIFwic3JjL29wdGlvbk1vZGFscy9TZWxlY3RNb2RhbFwiO1xuaW1wb3J0IHsgY3JlYXRlRmlsZUNsYXNzLCBGaWxlQ2xhc3MgfSBmcm9tIFwic3JjL2ZpbGVDbGFzcy9maWxlQ2xhc3NcIjtcbmltcG9ydCB7IHJlcGxhY2VWYWx1ZXMgfSBmcm9tIFwiLi4vY29tbWFuZHMvcmVwbGFjZVZhbHVlc1wiO1xuaW1wb3J0IEZpbGVDbGFzc0F0dHJpYnV0ZVNlbGVjdE1vZGFsIGZyb20gXCJzcmMvZmlsZUNsYXNzL0ZpbGVDbGFzc0F0dHJpYnV0ZVNlbGVjdE1vZGFsXCI7XG5pbXBvcnQgeyBnZW5lcmljRmllbGRSZWdleCB9IGZyb20gXCIuLi91dGlscy9wYXJzZXJcIjtcblxuZnVuY3Rpb24gaXNNZW51KGNhdGVnb3J5OiBNZW51IHwgU2VsZWN0TW9kYWwpOiBjYXRlZ29yeSBpcyBNZW51IHtcblx0cmV0dXJuIChjYXRlZ29yeSBhcyBNZW51KS5hZGRJdGVtICE9PSB1bmRlZmluZWQ7XG59O1xuXG5mdW5jdGlvbiBpc1NlbGVjdChjYXRlZ29yeTogTWVudSB8IFNlbGVjdE1vZGFsKTogY2F0ZWdvcnkgaXMgU2VsZWN0TW9kYWwge1xuXHRyZXR1cm4gKGNhdGVnb3J5IGFzIFNlbGVjdE1vZGFsKS5tb2RhbHMgIT09IHVuZGVmaW5lZDtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE9wdGlvbnNMaXN0IHtcblx0YXBwOiBBcHA7XG5cdGZpbGU6IFRGaWxlO1xuXHRwbHVnaW46IE1ldGFkYXRhTWVudTtcblx0cGF0aDogc3RyaW5nO1xuXHRjYXRlZ29yeTogTWVudSB8IFNlbGVjdE1vZGFsO1xuXHRmaWxlQ2xhc3M6IEZpbGVDbGFzcztcblxuXHRjb25zdHJ1Y3RvcihwbHVnaW46IE1ldGFkYXRhTWVudSwgZmlsZTogVEZpbGUsIGNhdGVnb3J5OiBNZW51IHwgU2VsZWN0TW9kYWwpIHtcblx0XHR0aGlzLmZpbGUgPSBmaWxlO1xuXHRcdHRoaXMucGx1Z2luID0gcGx1Z2luO1xuXHRcdHRoaXMuY2F0ZWdvcnkgPSBjYXRlZ29yeTtcblx0fTtcblxuXHRwdWJsaWMgYXN5bmMgY3JlYXRlRXh0cmFPcHRpb25MaXN0KCk6IFByb21pc2U8dm9pZD4ge1xuXHRcdGNvbnN0IGZyb250bWF0dGVyID0gdGhpcy5wbHVnaW4uYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0Q2FjaGUodGhpcy5maWxlLnBhdGgpPy5mcm9udG1hdHRlcjtcblx0XHRpZiAoZnJvbnRtYXR0ZXIpIHtcblx0XHRcdGNvbnN0IHsgcG9zaXRpb24sIC4uLmF0dHJpYnV0ZXMgfSA9IGZyb250bWF0dGVyO1xuXHRcdFx0T2JqZWN0LmtleXMoYXR0cmlidXRlcykuZm9yRWFjaChrZXkgPT4ge1xuXHRcdFx0XHRpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MuZ2xvYmFsbHlJZ25vcmVkRmllbGRzLmluY2x1ZGVzKGtleSkpIHtcblx0XHRcdFx0XHRkZWxldGUgYXR0cmlidXRlc1trZXldO1xuXHRcdFx0XHR9O1xuXHRcdFx0fSk7XG5cdFx0XHRpZiAoaXNNZW51KHRoaXMuY2F0ZWdvcnkpKSB7IHRoaXMuY2F0ZWdvcnkuYWRkU2VwYXJhdG9yKCk7IH07XG5cdFx0XHRsZXQgZmlsZUNsYXNzRm9yRmllbGRzID0gZmFsc2U7XG5cdFx0XHRsZXQgZmlsZUNsYXNzRmllbGRzOiBzdHJpbmdbXSA9IFtdO1xuXHRcdFx0Y29uc3QgZmlsZUNsYXNzQWxpYXMgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5maWxlQ2xhc3NBbGlhcztcblx0XHRcdGlmIChPYmplY3Qua2V5cyhhdHRyaWJ1dGVzKS5pbmNsdWRlcyhmaWxlQ2xhc3NBbGlhcykpIHtcblx0XHRcdFx0Y29uc3QgZmlsZUNsYXNzID0gYXR0cmlidXRlc1tmaWxlQ2xhc3NBbGlhc107XG5cdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0Y29uc3QgX2ZpbGVDbGFzcyA9IGF3YWl0IGNyZWF0ZUZpbGVDbGFzcyh0aGlzLnBsdWdpbiwgZmlsZUNsYXNzKVxuXHRcdFx0XHRcdHRoaXMuZmlsZUNsYXNzID0gX2ZpbGVDbGFzcztcblx0XHRcdFx0XHRmaWxlQ2xhc3NGaWVsZHMgPSBfZmlsZUNsYXNzLmF0dHJpYnV0ZXMubWFwKGF0dHIgPT4gYXR0ci5uYW1lKTtcblx0XHRcdFx0XHRmaWxlQ2xhc3NGb3JGaWVsZHMgPSB0cnVlO1xuXHRcdFx0XHRcdE9iamVjdC5rZXlzKGF0dHJpYnV0ZXMpLmZvckVhY2goa2V5ID0+IHtcblx0XHRcdFx0XHRcdGlmICghZmlsZUNsYXNzRmllbGRzLmluY2x1ZGVzKGtleSkgJiYga2V5ICE9IGZpbGVDbGFzc0FsaWFzKSB7XG5cdFx0XHRcdFx0XHRcdGRlbGV0ZSBhdHRyaWJ1dGVzW2tleV07XG5cdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGNvbnN0IGZpbGVDbGFzc0F0dHJpYnV0ZVNlbGVjdE1vZGFsID0gbmV3IEZpbGVDbGFzc0F0dHJpYnV0ZVNlbGVjdE1vZGFsKHRoaXMucGx1Z2luLCB0aGlzLmZpbGVDbGFzcy5nZXRDbGFzc0ZpbGUoKSk7XG5cdFx0XHRcdFx0aWYgKGlzTWVudSh0aGlzLmNhdGVnb3J5KSkge1xuXHRcdFx0XHRcdFx0dGhpcy5jYXRlZ29yeS5hZGRTZXBhcmF0b3IoKTtcblx0XHRcdFx0XHRcdHRoaXMuY2F0ZWdvcnkuYWRkSXRlbSgoaXRlbSkgPT4ge1xuXHRcdFx0XHRcdFx0XHRpdGVtLnNldEljb24oXCJnZWFyXCIpO1xuXHRcdFx0XHRcdFx0XHRpdGVtLnNldFRpdGxlKGBNYW5hZ2UgPCR7dGhpcy5maWxlQ2xhc3MubmFtZX0+IGZpZWxkc2ApO1xuXHRcdFx0XHRcdFx0XHRpdGVtLm9uQ2xpY2soKGV2dCkgPT4ge1xuXHRcdFx0XHRcdFx0XHRcdGZpbGVDbGFzc0F0dHJpYnV0ZVNlbGVjdE1vZGFsLm9wZW4oKTtcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0dGhpcy5jYXRlZ29yeS5hZGRPcHRpb24oXCJtYW5hZ2VfZmlsZUNsYXNzX2F0dHJpYnV0ZXNcIiwgXCJNYW5hZ2UgZmlsZUNsYXNzIGF0dHJpYnV0ZXNcIik7XG5cdFx0XHRcdFx0XHR0aGlzLmNhdGVnb3J5Lm1vZGFsc1tcImFkZF9maWVsZF9hdF9zZWN0aW9uXCJdID0gKCkgPT4gZmlsZUNsYXNzQXR0cmlidXRlU2VsZWN0TW9kYWwub3BlbigpO1xuXHRcdFx0XHRcdH07XG5cblx0XHRcdFx0XHRhd2FpdCB0aGlzLmNyZWF0ZUV4dHJhT3B0aW9uc0xpc3RGb3JGcm9udG1hdHRlcihhdHRyaWJ1dGVzLClcblx0XHRcdFx0XHRhd2FpdCB0aGlzLmNyZWF0ZUV4dHJhT3B0aW9uc0xpc3RGb3JJbmxpbmVGaWVsZHModGhpcy5maWxlLCBmaWxlQ2xhc3NGb3JGaWVsZHMsIGZpbGVDbGFzc0ZpZWxkcylcblx0XHRcdFx0XHRpZiAoaXNNZW51KHRoaXMuY2F0ZWdvcnkpKSB7IHRoaXMuY2F0ZWdvcnkuYWRkU2VwYXJhdG9yKCkgfTtcblx0XHRcdFx0XHR0aGlzLmFkZFNlY3Rpb25TZWxlY3RNb2RhbE9wdGlvbih0aGlzLnBsdWdpbik7XG5cdFx0XHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHRcdFx0YXdhaXQgdGhpcy5jcmVhdGVFeHRyYU9wdGlvbnNMaXN0Rm9yRnJvbnRtYXR0ZXIoYXR0cmlidXRlcylcblx0XHRcdFx0XHRhd2FpdCB0aGlzLmNyZWF0ZUV4dHJhT3B0aW9uc0xpc3RGb3JJbmxpbmVGaWVsZHModGhpcy5maWxlKVxuXHRcdFx0XHRcdGlmIChpc01lbnUodGhpcy5jYXRlZ29yeSkpIHsgdGhpcy5jYXRlZ29yeS5hZGRTZXBhcmF0b3IoKTsgfTtcblx0XHRcdFx0XHR0aGlzLmFkZFNlY3Rpb25TZWxlY3RNb2RhbE9wdGlvbih0aGlzLnBsdWdpbik7XG5cdFx0XHRcdH07XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRhd2FpdCB0aGlzLmNyZWF0ZUV4dHJhT3B0aW9uc0xpc3RGb3JGcm9udG1hdHRlcihhdHRyaWJ1dGVzKVxuXHRcdFx0XHRhd2FpdCB0aGlzLmNyZWF0ZUV4dHJhT3B0aW9uc0xpc3RGb3JJbmxpbmVGaWVsZHModGhpcy5maWxlKVxuXHRcdFx0XHRpZiAoaXNNZW51KHRoaXMuY2F0ZWdvcnkpKSB7IHRoaXMuY2F0ZWdvcnkuYWRkU2VwYXJhdG9yKCk7IH07XG5cdFx0XHRcdHRoaXMuYWRkU2VjdGlvblNlbGVjdE1vZGFsT3B0aW9uKHRoaXMucGx1Z2luKTtcblx0XHRcdH07XG5cdFx0fSBlbHNlIHtcblx0XHRcdGF3YWl0IHRoaXMuY3JlYXRlRXh0cmFPcHRpb25zTGlzdEZvcklubGluZUZpZWxkcyh0aGlzLmZpbGUpXG5cdFx0XHRpZiAoaXNNZW51KHRoaXMuY2F0ZWdvcnkpKSB7IHRoaXMuY2F0ZWdvcnkuYWRkU2VwYXJhdG9yKCk7IH07XG5cdFx0XHR0aGlzLmFkZFNlY3Rpb25TZWxlY3RNb2RhbE9wdGlvbih0aGlzLnBsdWdpbik7XG5cdFx0fTtcblxuXHR9O1xuXG5cdHByaXZhdGUgYXN5bmMgY3JlYXRlRXh0cmFPcHRpb25zTGlzdEZvcklubGluZUZpZWxkcyhmaWxlOiBURmlsZSwgZmlsZUNsYXNzRm9yRmllbGRzOiBib29sZWFuID0gZmFsc2UsIGZpbGVDbGFzc0ZpZWxkczogc3RyaW5nW10gPSBbXSk6IFByb21pc2U8dm9pZD4ge1xuXHRcdGxldCBhdHRyaWJ1dGVzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge307XG5cdFx0Y29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGBeJHtnZW5lcmljRmllbGRSZWdleH06OlxccyooPzx2YWx1ZXM+LispP2AsIFwidVwiKTtcblx0XHRjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnBsdWdpbi5hcHAudmF1bHQucmVhZChmaWxlKVxuXHRcdHJlc3VsdC5zcGxpdCgnXFxuJykubWFwKGxpbmUgPT4ge1xuXHRcdFx0Y29uc3QgcmVnZXhSZXN1bHQgPSBsaW5lLm1hdGNoKHJlZ2V4KTtcblx0XHRcdGNvbnN0IHsgYXR0cmlidXRlLCB2YWx1ZXMgfSA9IHJlZ2V4UmVzdWx0Py5ncm91cHMgfHwge31cblx0XHRcdGlmIChhdHRyaWJ1dGUgJiYgIXRoaXMucGx1Z2luLnNldHRpbmdzLmdsb2JhbGx5SWdub3JlZEZpZWxkcy5pbmNsdWRlcyhhdHRyaWJ1dGUudHJpbSgpKSkge1xuXHRcdFx0XHRpZiAoZmlsZUNsYXNzRm9yRmllbGRzKSB7XG5cdFx0XHRcdFx0aWYgKGZpbGVDbGFzc0ZpZWxkcy5pbmNsdWRlcyhhdHRyaWJ1dGUudHJpbSgpKSkge1xuXHRcdFx0XHRcdFx0YXR0cmlidXRlc1thdHRyaWJ1dGUudHJpbSgpXSA9IHZhbHVlcyA/IHZhbHVlcy50cmltKCkgOiBcIlwiO1xuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0YXR0cmlidXRlc1thdHRyaWJ1dGUudHJpbSgpXSA9IHZhbHVlcyA/IHZhbHVlcy50cmltKCkgOiBcIlwiO1xuXHRcdFx0XHR9O1xuXHRcdFx0fTtcblx0XHR9KTtcblx0XHRpZiAoT2JqZWN0LmtleXMoYXR0cmlidXRlcykubGVuZ3RoID4gMCkge1xuXHRcdFx0aWYgKGlzTWVudSh0aGlzLmNhdGVnb3J5KSkgeyB0aGlzLmNhdGVnb3J5LmFkZFNlcGFyYXRvcigpOyB9O1xuXHRcdFx0dGhpcy5idWlsZEV4dHJhT3B0aW9uc0xpc3QoYXR0cmlidXRlcyk7XG5cdFx0fTtcblx0fTtcblxuXHRwcml2YXRlIGFzeW5jIGNyZWF0ZUV4dHJhT3B0aW9uc0xpc3RGb3JGcm9udG1hdHRlcihhdHRyaWJ1dGVzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+KSB7XG5cdFx0dGhpcy5idWlsZEV4dHJhT3B0aW9uc0xpc3QoYXR0cmlidXRlcywpO1xuXHR9O1xuXG5cdGJ1aWxkRXh0cmFPcHRpb25zTGlzdChhdHRyaWJ1dGVzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+KSB7XG5cdFx0T2JqZWN0LmtleXMoYXR0cmlidXRlcykuZm9yRWFjaCgoa2V5OiBzdHJpbmcpID0+IHtcblx0XHRcdGNvbnN0IHZhbHVlID0gYXR0cmlidXRlc1trZXldO1xuXHRcdFx0Y29uc3QgcHJvcGVydHlTZXR0aW5ncyA9IHRoaXMuZ2V0UHJvcGVydHlTZXR0aW5ncyhrZXkpO1xuXHRcdFx0aWYgKHByb3BlcnR5U2V0dGluZ3M/LnZhbHVlcykge1xuXHRcdFx0XHRpZiAocHJvcGVydHlTZXR0aW5ncy5pc0N5Y2xlKSB7XG5cdFx0XHRcdFx0dGhpcy5hZGRDeWNsZU1lbnVPcHRpb24oa2V5LCB2YWx1ZSwgcHJvcGVydHlTZXR0aW5ncyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAocHJvcGVydHlTZXR0aW5ncy5pc011bHRpKSB7XG5cdFx0XHRcdFx0dGhpcy5hZGRNdWx0aU1lbnVPcHRpb24oa2V5LCB2YWx1ZSwgcHJvcGVydHlTZXR0aW5ncyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5hZGRTZWxlY3RNZW51T3B0aW9uKGtleSwgdmFsdWUsIHByb3BlcnR5U2V0dGluZ3MpO1xuXHRcdFx0XHR9O1xuXHRcdFx0fSBlbHNlIGlmIChpc0Jvb2xlYW4odmFsdWUpIHx8IC90cnVlL2kudGVzdCh2YWx1ZSkgfHwgL2ZhbHNlL2kudGVzdCh2YWx1ZSkpIHtcblx0XHRcdFx0bGV0IHRvQm9vbGVhblZhbHVlOiBib29sZWFuID0gZmFsc2U7XG5cdFx0XHRcdGlmIChpc0Jvb2xlYW4odmFsdWUpKSB7XG5cdFx0XHRcdFx0dG9Cb29sZWFuVmFsdWUgPSB2YWx1ZTtcblx0XHRcdFx0fSBlbHNlIGlmICgvdHJ1ZS9pLnRlc3QodmFsdWUpKSB7XG5cdFx0XHRcdFx0dG9Cb29sZWFuVmFsdWUgPSB0cnVlO1xuXHRcdFx0XHR9IGVsc2UgaWYgKC9mYWxzZS9pLnRlc3QodmFsdWUpKSB7XG5cdFx0XHRcdFx0dG9Cb29sZWFuVmFsdWUgPSBmYWxzZTtcblx0XHRcdFx0fTtcblx0XHRcdFx0dGhpcy5hZGRUb2dnbGVNZW51T3B0aW9uKGtleSwgdG9Cb29sZWFuVmFsdWUpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5hZGRUZXh0SW5wdXRNZW51T3B0aW9uKGtleSwgdmFsdWUgPyB2YWx1ZS50b1N0cmluZygpIDogXCJcIik7XG5cdFx0XHR9O1xuXHRcdH0pO1xuXHR9O1xuXG5cdHByaXZhdGUgYWRkU2VjdGlvblNlbGVjdE1vZGFsT3B0aW9uKHBsdWdpbjogTWV0YWRhdGFNZW51KTogdm9pZCB7XG5cdFx0Y29uc3QgbW9kYWwgPSBuZXcgY2hvb3NlU2VjdGlvbk1vZGFsKHRoaXMucGx1Z2luLCB0aGlzLmZpbGUpO1xuXHRcdGlmIChpc01lbnUodGhpcy5jYXRlZ29yeSkpIHtcblx0XHRcdHRoaXMuY2F0ZWdvcnkuYWRkSXRlbSgoaXRlbSkgPT4ge1xuXHRcdFx0XHRpdGVtLnNldEljb24oXCJwZW5jaWxcIik7XG5cdFx0XHRcdGl0ZW0uc2V0VGl0bGUoXCJBZGQgZmllbGQgYXQgc2VjdGlvbi4uLlwiKTtcblx0XHRcdFx0aXRlbS5vbkNsaWNrKChldnQ6IE1vdXNlRXZlbnQpID0+IHtcblx0XHRcdFx0XHRtb2RhbC5vcGVuKCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRpdGVtLnNldFNlY3Rpb24oXCJ0YXJnZXQtbWV0YWRhdGFcIik7XG5cdFx0XHR9KTtcblx0XHR9IGVsc2UgaWYgKGlzU2VsZWN0KHRoaXMuY2F0ZWdvcnkpKSB7XG5cdFx0XHR0aGlzLmNhdGVnb3J5LmFkZE9wdGlvbihcImFkZF9maWVsZF9hdF9zZWN0aW9uXCIsIFwiQWRkIGZpZWxkIGF0IHNlY3Rpb24uLi5cIik7XG5cdFx0XHR0aGlzLmNhdGVnb3J5Lm1vZGFsc1tcImFkZF9maWVsZF9hdF9zZWN0aW9uXCJdID0gKCkgPT4gbW9kYWwub3BlbigpO1xuXHRcdH07XG5cdH07XG5cblx0cHJpdmF0ZSBhZGRDeWNsZU1lbnVPcHRpb24obmFtZTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nLCBwcm9wZXJ0eVNldHRpbmdzOiBGaWVsZCk6IHZvaWQge1xuXHRcdGNvbnN0IHZhbHVlcyA9IHByb3BlcnR5U2V0dGluZ3MudmFsdWVzO1xuXHRcdGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyh2YWx1ZXMpO1xuXHRcdGNvbnN0IGtleUZvclZhbHVlID0ga2V5cy5maW5kKGtleSA9PiB2YWx1ZXNba2V5XSA9PT0gdmFsdWUpO1xuXHRcdGxldCBuZXh0VmFsdWU6IHN0cmluZztcblx0XHRpZiAoa2V5Rm9yVmFsdWUpIHtcblx0XHRcdGNvbnN0IG5leHRLZXkgPSBrZXlzWyhrZXlzLmluZGV4T2Yoa2V5Rm9yVmFsdWUpICsgMSkgJSBrZXlzLmxlbmd0aF07XG5cdFx0XHRuZXh0VmFsdWUgPSB2YWx1ZXNbbmV4dEtleV07XG5cdFx0fSBlbHNlIHtcblx0XHRcdG5leHRWYWx1ZSA9IHZhbHVlc1tPYmplY3Qua2V5cyh2YWx1ZXMpWzBdXTtcblx0XHR9O1xuXHRcdGlmIChpc01lbnUodGhpcy5jYXRlZ29yeSkpIHtcblx0XHRcdHRoaXMuY2F0ZWdvcnkuYWRkSXRlbSgoaXRlbSkgPT4ge1xuXHRcdFx0XHRpdGVtLnNldFRpdGxlKGAke25hbWV9IDogJHt2YWx1ZX0gXHUyNUI3ICR7bmV4dFZhbHVlfWApO1xuXHRcdFx0XHRpdGVtLnNldEljb24oJ3N3aXRjaCcpO1xuXHRcdFx0XHRpdGVtLm9uQ2xpY2soKGV2dDogTW91c2VFdmVudCkgPT4ge1xuXHRcdFx0XHRcdHJlcGxhY2VWYWx1ZXModGhpcy5wbHVnaW4uYXBwLCB0aGlzLmZpbGUsIG5hbWUsIG5leHRWYWx1ZSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRpdGVtLnNldFNlY3Rpb24oXCJ0YXJnZXQtbWV0YWRhdGFcIik7XG5cdFx0XHR9KTtcblx0XHR9IGVsc2UgaWYgKGlzU2VsZWN0KHRoaXMuY2F0ZWdvcnkpKSB7XG5cdFx0XHR0aGlzLmNhdGVnb3J5LmFkZE9wdGlvbihgJHtuYW1lfV8ke3ZhbHVlfV8ke25leHRWYWx1ZX1gLCBgJHtuYW1lfSA6ICR7dmFsdWV9IFx1MjVCNyAke25leHRWYWx1ZX1gKTtcblx0XHRcdHRoaXMuY2F0ZWdvcnkubW9kYWxzW2Ake25hbWV9XyR7dmFsdWV9XyR7bmV4dFZhbHVlfWBdID0gKCkgPT5cblx0XHRcdFx0cmVwbGFjZVZhbHVlcyh0aGlzLnBsdWdpbi5hcHAsIHRoaXMuZmlsZSwgbmFtZSwgbmV4dFZhbHVlKTtcblx0XHR9O1xuXHR9O1xuXG5cdHByaXZhdGUgYWRkTXVsdGlNZW51T3B0aW9uKG5hbWU6IHN0cmluZywgdmFsdWU6IHN0cmluZywgcHJvcGVydHlTZXR0aW5nczogRmllbGQpOiB2b2lkIHtcblx0XHRjb25zdCBtb2RhbCA9IG5ldyB2YWx1ZU11bHRpU2VsZWN0TW9kYWwodGhpcy5wbHVnaW4uYXBwLCB0aGlzLmZpbGUsIG5hbWUsIHZhbHVlLCBwcm9wZXJ0eVNldHRpbmdzKTtcblx0XHRtb2RhbC50aXRsZUVsLnNldFRleHQoXCJTZWxlY3QgdmFsdWVzXCIpO1xuXHRcdGlmIChpc01lbnUodGhpcy5jYXRlZ29yeSkpIHtcblx0XHRcdHRoaXMuY2F0ZWdvcnkuYWRkSXRlbSgoaXRlbSkgPT4ge1xuXHRcdFx0XHRpdGVtLnNldFRpdGxlKGBVcGRhdGUgPCR7bmFtZX0+YCk7XG5cdFx0XHRcdGl0ZW0uc2V0SWNvbignYnVsbGV0LWxpc3QnKTtcblx0XHRcdFx0aXRlbS5vbkNsaWNrKChldnQ6IE1vdXNlRXZlbnQpID0+IHtcblx0XHRcdFx0XHRtb2RhbC5vcGVuKCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRpdGVtLnNldFNlY3Rpb24oXCJ0YXJnZXQtbWV0YWRhdGFcIik7XG5cdFx0XHR9KTtcblx0XHR9IGVsc2UgaWYgKGlzU2VsZWN0KHRoaXMuY2F0ZWdvcnkpKSB7XG5cdFx0XHR0aGlzLmNhdGVnb3J5LmFkZE9wdGlvbihgdXBkYXRlXyR7bmFtZX1gLCBgVXBkYXRlIDwke25hbWV9PmApO1xuXHRcdFx0dGhpcy5jYXRlZ29yeS5tb2RhbHNbYHVwZGF0ZV8ke25hbWV9YF0gPSAoKSA9PiBtb2RhbC5vcGVuKCk7XG5cdFx0fTtcblx0fTtcblxuXHRwcml2YXRlIGFkZFNlbGVjdE1lbnVPcHRpb24obmFtZTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nLCBwcm9wZXJ0eVNldHRpbmdzOiBGaWVsZCk6IHZvaWQge1xuXHRcdGNvbnN0IG1vZGFsID0gbmV3IHZhbHVlU2VsZWN0TW9kYWwodGhpcy5wbHVnaW4uYXBwLCB0aGlzLmZpbGUsIG5hbWUsIHZhbHVlLCBwcm9wZXJ0eVNldHRpbmdzKTtcblx0XHRtb2RhbC50aXRsZUVsLnNldFRleHQoXCJTZWxlY3QgdmFsdWVcIik7XG5cdFx0aWYgKGlzTWVudSh0aGlzLmNhdGVnb3J5KSkge1xuXHRcdFx0dGhpcy5jYXRlZ29yeS5hZGRJdGVtKChpdGVtKSA9PiB7XG5cdFx0XHRcdGl0ZW0uc2V0VGl0bGUoYFVwZGF0ZSAke25hbWV9YCk7XG5cdFx0XHRcdGl0ZW0uc2V0SWNvbigncmlnaHQtdHJpYW5nbGUnKTtcblx0XHRcdFx0aXRlbS5vbkNsaWNrKChldnQ6IE1vdXNlRXZlbnQpID0+IG1vZGFsLm9wZW4oKSk7XG5cdFx0XHRcdGl0ZW0uc2V0U2VjdGlvbihcInRhcmdldC1tZXRhZGF0YVwiKTtcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAoaXNTZWxlY3QodGhpcy5jYXRlZ29yeSkpIHtcblx0XHRcdHRoaXMuY2F0ZWdvcnkuYWRkT3B0aW9uKGB1cGRhdGVfJHtuYW1lfWAsIGBVcGRhdGUgPCR7bmFtZX0+YCk7XG5cdFx0XHR0aGlzLmNhdGVnb3J5Lm1vZGFsc1tgdXBkYXRlXyR7bmFtZX1gXSA9ICgpID0+IG1vZGFsLm9wZW4oKTtcblx0XHR9O1xuXHR9O1xuXG5cdHByaXZhdGUgYWRkVG9nZ2xlTWVudU9wdGlvbihuYW1lOiBzdHJpbmcsIHZhbHVlOiBib29sZWFuKTogdm9pZCB7XG5cdFx0Y29uc3QgbW9kYWwgPSBuZXcgdmFsdWVUb2dnbGVNb2RhbCh0aGlzLnBsdWdpbi5hcHAsIHRoaXMuZmlsZSwgbmFtZSwgdmFsdWUpO1xuXHRcdG1vZGFsLnRpdGxlRWwuc2V0VGV4dChgQ2hhbmdlIFZhbHVlIGZvciA8JHtuYW1lfT5gKTtcblx0XHRpZiAoaXNNZW51KHRoaXMuY2F0ZWdvcnkpKSB7XG5cdFx0XHR0aGlzLmNhdGVnb3J5LmFkZEl0ZW0oKGl0ZW0pID0+IHtcblx0XHRcdFx0aXRlbS5zZXRUaXRsZShgVXBkYXRlIDwke25hbWV9PmApO1xuXHRcdFx0XHRpdGVtLnNldEljb24oJ2NoZWNrbWFyaycpO1xuXHRcdFx0XHRpdGVtLm9uQ2xpY2soKGV2dDogTW91c2VFdmVudCkgPT4geyBtb2RhbC5vcGVuKCkgfSk7XG5cdFx0XHRcdGl0ZW0uc2V0U2VjdGlvbihcInRhcmdldC1tZXRhZGF0YVwiKTtcblx0XHRcdH0pXG5cdFx0fSBlbHNlIGlmIChpc1NlbGVjdCh0aGlzLmNhdGVnb3J5KSkge1xuXHRcdFx0dGhpcy5jYXRlZ29yeS5hZGRPcHRpb24oYHVwZGF0ZV8ke25hbWV9YCwgYFVwZGF0ZSA8JHtuYW1lfT5gKTtcblx0XHRcdHRoaXMuY2F0ZWdvcnkubW9kYWxzW2B1cGRhdGVfJHtuYW1lfWBdID0gKCkgPT4gbW9kYWwub3BlbigpO1xuXHRcdH07XG5cdH07XG5cblx0cHJpdmF0ZSBhZGRUZXh0SW5wdXRNZW51T3B0aW9uKG5hbWU6IHN0cmluZywgdmFsdWU6IHN0cmluZyk6IHZvaWQge1xuXHRcdGNvbnN0IG1vZGFsID0gbmV3IHZhbHVlVGV4dElucHV0TW9kYWwodGhpcy5wbHVnaW4uYXBwLCB0aGlzLmZpbGUsIG5hbWUsIHZhbHVlKTtcblx0XHRtb2RhbC50aXRsZUVsLnNldFRleHQoYENoYW5nZSBWYWx1ZSBmb3IgPCR7bmFtZX0+YCk7XG5cdFx0aWYgKGlzTWVudSh0aGlzLmNhdGVnb3J5KSkge1xuXHRcdFx0dGhpcy5jYXRlZ29yeS5hZGRJdGVtKChpdGVtKSA9PiB7XG5cdFx0XHRcdGl0ZW0uc2V0VGl0bGUoYFVwZGF0ZSA8JHtuYW1lfT5gKTtcblx0XHRcdFx0aXRlbS5zZXRJY29uKCdwZW5jaWwnKTtcblx0XHRcdFx0aXRlbS5vbkNsaWNrKChldnQ6IE1vdXNlRXZlbnQpID0+IG1vZGFsLm9wZW4oKSk7XG5cdFx0XHRcdGl0ZW0uc2V0U2VjdGlvbihcInRhcmdldC1tZXRhZGF0YVwiKTtcblx0XHRcdH0pXG5cdFx0fSBlbHNlIGlmIChpc1NlbGVjdCh0aGlzLmNhdGVnb3J5KSkge1xuXHRcdFx0dGhpcy5jYXRlZ29yeS5hZGRPcHRpb24oYHVwZGF0ZV8ke25hbWV9YCwgYFVwZGF0ZSA8JHtuYW1lfT5gKTtcblx0XHRcdHRoaXMuY2F0ZWdvcnkubW9kYWxzW2B1cGRhdGVfJHtuYW1lfWBdID0gKCkgPT4gbW9kYWwub3BlbigpO1xuXHRcdH07XG5cdH07XG5cblx0cHJpdmF0ZSBnZXRQcm9wZXJ0eVNldHRpbmdzKHByb3BlcnR5TmFtZTogc3RyaW5nKTogRmllbGQgfCB1bmRlZmluZWQge1xuXHRcdGNvbnN0IG1hdGNoaW5nU2V0dGluZ3MgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcmVzZXRGaWVsZHMuZmlsdGVyKHAgPT4gcC5uYW1lID09IHByb3BlcnR5TmFtZSk7XG5cdFx0aWYgKHRoaXMuZmlsZUNsYXNzKSB7XG5cdFx0XHRjb25zdCBmaWxlQ2xhc3NBdHRyaWJ1dGVzV2l0aE5hbWUgPSB0aGlzLmZpbGVDbGFzcy5hdHRyaWJ1dGVzLmZpbHRlcihhdHRyID0+IGF0dHIubmFtZSA9PSBwcm9wZXJ0eU5hbWUpO1xuXHRcdFx0aWYgKGZpbGVDbGFzc0F0dHJpYnV0ZXNXaXRoTmFtZS5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdGNvbnN0IGZpbGVDbGFzc0F0dHJpYnV0ZSA9IGZpbGVDbGFzc0F0dHJpYnV0ZXNXaXRoTmFtZVswXTtcblx0XHRcdFx0aWYgKGZpbGVDbGFzc0F0dHJpYnV0ZS5vcHRpb25zKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGZpbGVDbGFzc0F0dHJpYnV0ZS5nZXRGaWVsZCgpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKG1hdGNoaW5nU2V0dGluZ3MubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRcdHJldHVybiBtYXRjaGluZ1NldHRpbmdzWzBdO1xuXHRcdFx0XHR9O1xuXHRcdFx0fVxuXHRcdH0gZWxzZSBpZiAobWF0Y2hpbmdTZXR0aW5ncy5sZW5ndGggPiAwKSB7XG5cdFx0XHRyZXR1cm4gbWF0Y2hpbmdTZXR0aW5nc1swXTtcblx0XHR9O1xuXHR9O1xufTtcbiIsICJpbXBvcnQgeyBBcHAsIE1vZGFsLCBURmlsZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IE1ldGFkYXRhTWVudSBmcm9tIFwibWFpblwiO1xuaW1wb3J0IE9wdGlvbnNMaXN0IGZyb20gXCJzcmMvb3B0aW9ucy9PcHRpb25zTGlzdFwiO1xuaW1wb3J0IFNlbGVjdE1vZGFsIGZyb20gXCJzcmMvb3B0aW9uTW9kYWxzL1NlbGVjdE1vZGFsXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE5vdGVGaWVsZHNDb21tYW5kc01vZGFsIGV4dGVuZHMgTW9kYWwge1xuICAgIHB1YmxpYyBhcHA6IEFwcDtcbiAgICBwcml2YXRlIHBsdWdpbjogTWV0YWRhdGFNZW51O1xuICAgIHByaXZhdGUgZmlsZTogVEZpbGU7XG4gICAgcHJpdmF0ZSBzZWxlY3Q6IFNlbGVjdE1vZGFsO1xuICAgIHByaXZhdGUgb3B0aW9uc0xpc3Q6IE9wdGlvbnNMaXN0O1xuXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogTWV0YWRhdGFNZW51LCBmaWxlOiBURmlsZSkge1xuICAgICAgICBzdXBlcihhcHApO1xuICAgICAgICB0aGlzLmFwcCA9IGFwcDtcbiAgICAgICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgICAgIHRoaXMuZmlsZSA9IGZpbGU7XG4gICAgfTtcblxuICAgIGFzeW5jIG9uT3BlbigpIHtcbiAgICAgICAgdGhpcy50aXRsZUVsLnNldFRleHQoYFNlbGVjdCB0aGUgZmllbGQgdG8gbWFuYWdlYCk7XG4gICAgICAgIHRoaXMuY29udGFpbmVyRWwuYWRkQ2xhc3MoXCJtZXRhZGF0YS1tZW51XCIpO1xuICAgICAgICBjb25zdCBvcHRpb25zTGlzdENvbnRhaW5lciA9IHRoaXMuY29udGVudEVsLmNyZWF0ZURpdih7IGNsczogXCJmaWVsZC1vcHRpb25zXCJ9KTtcblxuICAgICAgICB0aGlzLnNlbGVjdCA9IG5ldyBTZWxlY3RNb2RhbChvcHRpb25zTGlzdENvbnRhaW5lcik7XG4gICAgICAgIHRoaXMuc2VsZWN0LmFkZE9wdGlvbihcIi0tLVwiLCBcIkNob29zZSBGaWVsZFwiKTtcbiAgICAgICAgXG4gICAgICAgIHRoaXMub3B0aW9uc0xpc3QgPSBuZXcgT3B0aW9uc0xpc3QodGhpcy5wbHVnaW4sIHRoaXMuZmlsZSwgdGhpcy5zZWxlY3QpO1xuICAgICAgICBhd2FpdCB0aGlzLm9wdGlvbnNMaXN0LmNyZWF0ZUV4dHJhT3B0aW9uTGlzdCgpO1xuICAgICAgICB0aGlzLnNlbGVjdC5vbkNoYW5nZSgodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0Lm1vZGFsc1t2YWx1ZV0oKTtcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc2VsZWN0LnNlbGVjdEVsLmZvY3VzKCk7XG4gICAgfTtcbn07IiwgImltcG9ydCB7IERyb3Bkb3duQ29tcG9uZW50IH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlbGVjdE1vZGFsIGV4dGVuZHMgRHJvcGRvd25Db21wb25lbnQge1xuICAgIHB1YmxpYyBtb2RhbHM6IFJlY29yZDxzdHJpbmcsIGFueT47XG5cbiAgICBjb25zdHJ1Y3Rvcihjb250YWluZXJFbDogSFRNTEVsZW1lbnQpIHtcbiAgICAgICAgc3VwZXIoY29udGFpbmVyRWwpO1xuICAgICAgICB0aGlzLm1vZGFscyA9IHt9O1xuICAgIH07XG59OyIsICJpbXBvcnQgTWV0YWRhdGFNZW51IGZyb20gXCJtYWluXCI7XG5pbXBvcnQge1xuICAgIEFwcCxcbiAgICBFZGl0b3IsXG4gICAgRWRpdG9yUG9zaXRpb24sXG4gICAgRWRpdG9yU3VnZ2VzdCxcbiAgICBFZGl0b3JTdWdnZXN0Q29udGV4dCxcbiAgICBFZGl0b3JTdWdnZXN0VHJpZ2dlckluZm8sXG4gICAgTWFya2Rvd25WaWV3LFxuICAgIFRGaWxlLFxuICAgIHBhcnNlWWFtbCxcbiAgICBOb3RpY2Vcbn0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBjcmVhdGVGaWxlQ2xhc3MsIEZpbGVDbGFzcyB9IGZyb20gXCJzcmMvZmlsZUNsYXNzL2ZpbGVDbGFzc1wiO1xuaW1wb3J0IHsgZ2VuZXJpY0ZpZWxkUmVnZXggfSBmcm9tIFwiLi4vdXRpbHMvcGFyc2VyXCI7XG5cbmludGVyZmFjZSBJVmFsdWVDb21wbGV0aW9uIHtcbiAgICB2YWx1ZTogc3RyaW5nO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVmFsdWVTdWdnZXN0IGV4dGVuZHMgRWRpdG9yU3VnZ2VzdDxJVmFsdWVDb21wbGV0aW9uPiB7XG4gICAgcHJpdmF0ZSBwbHVnaW46IE1ldGFkYXRhTWVudTtcbiAgICBwcml2YXRlIGFwcDogQXBwO1xuICAgIHByaXZhdGUgZmlsZUNsYXNzOiBGaWxlQ2xhc3M7XG4gICAgcHJpdmF0ZSBpbkZyb250bWF0dGVyOiBib29sZWFuID0gZmFsc2U7XG4gICAgcHJpdmF0ZSBkaWRTZWxlY3Q6IGJvb2xlYW4gPSBmYWxzZVxuXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogTWV0YWRhdGFNZW51KSB7XG4gICAgICAgIHN1cGVyKGFwcCk7XG4gICAgICAgIHRoaXMuYXBwID0gYXBwO1xuICAgICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICAgICAgdGhpcy5zZXRJbnN0cnVjdGlvbnMoW3sgY29tbWFuZDogXCJTaGlmdFwiLCBwdXJwb3NlOiBcInB1dCBhIHNwYWNlIGFmdGVyOjpcIiB9XSk7XG5cbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICB0aGlzLnNjb3BlLnJlZ2lzdGVyKFtcIlNoaWZ0XCJdLCBcIkVudGVyXCIsIChldnQ6IEtleWJvYXJkRXZlbnQpID0+IHtcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIHRoaXMuc3VnZ2VzdGlvbnMudXNlU2VsZWN0ZWRJdGVtKGV2dCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBvblRyaWdnZXIoXG4gICAgICAgIGN1cnNvcjogRWRpdG9yUG9zaXRpb24sXG4gICAgICAgIGVkaXRvcjogRWRpdG9yLFxuICAgICAgICBmaWxlOiBURmlsZVxuICAgICk6IEVkaXRvclN1Z2dlc3RUcmlnZ2VySW5mbyB8IG51bGwge1xuICAgICAgICBpZiAodGhpcy5kaWRTZWxlY3QpIHtcbiAgICAgICAgICAgIHRoaXMuZGlkU2VsZWN0ID0gZmFsc2VcbiAgICAgICAgICAgIHJldHVybiBudWxsXG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLnBsdWdpbi5zZXR0aW5ncy5pc0F1dG9zdWdnZXN0RW5hYmxlZCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH07XG4gICAgICAgIC8vQHRzLWlnbm9yZVxuICAgICAgICBjb25zdCBmcm9udG1hdHRlciA9IHRoaXMucGx1Z2luLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKS5mcm9udG1hdHRlcjtcblxuICAgICAgICB0aGlzLmluRnJvbnRtYXR0ZXIgPSBmcm9udG1hdHRlciAhPT0gdW5kZWZpbmVkICYmIGZyb250bWF0dGVyLnBvc2l0aW9uLnN0YXJ0LmxpbmUgPCBjdXJzb3IubGluZSAmJiBjdXJzb3IubGluZSA8IGZyb250bWF0dGVyLnBvc2l0aW9uLmVuZC5saW5lXG4gICAgICAgIGNvbnN0IHJlZ2V4ID0gdGhpcy5pbkZyb250bWF0dGVyID8gbmV3IFJlZ0V4cChgXiR7Z2VuZXJpY0ZpZWxkUmVnZXh9Oig/PHZhbHVlcz4uKilgLCBcInVcIikgOiBuZXcgUmVnRXhwKGBeJHtnZW5lcmljRmllbGRSZWdleH06Oig/PHZhbHVlcz4uKilgLCBcInVcIilcbiAgICAgICAgY29uc3QgZnVsbExpbmUgPSBlZGl0b3IuZ2V0TGluZShlZGl0b3IuZ2V0Q3Vyc29yKCkubGluZSlcbiAgICAgICAgaWYgKCFyZWdleC50ZXN0KGZ1bGxMaW5lKSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3RhcnQ6IGN1cnNvcixcbiAgICAgICAgICAgIGVuZDogY3Vyc29yLFxuICAgICAgICAgICAgcXVlcnk6IGVkaXRvci5nZXRMaW5lKGN1cnNvci5saW5lKSxcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgcHJpdmF0ZSBmaWx0ZXJPcHRpb24gPSAoZmlyc3RWYWx1ZXM6IHN0cmluZ1tdIHwgdW5kZWZpbmVkLCBsYXN0VmFsdWU6IHN0cmluZyB8IHVuZGVmaW5lZCwgb3B0aW9uOiBzdHJpbmcpOiBib29sZWFuID0+IHtcbiAgICAgICAgcmV0dXJuICFmaXJzdFZhbHVlcyB8fCAhZmlyc3RWYWx1ZXM/LmNvbnRhaW5zKG9wdGlvbikgJiYgKCFsYXN0VmFsdWUgfHwgISFsYXN0VmFsdWUgJiYgb3B0aW9uLmNvbnRhaW5zKGxhc3RWYWx1ZSkpXG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0U3VnZ2VzdGlvbnMoY29udGV4dDogRWRpdG9yU3VnZ2VzdENvbnRleHQpOiBQcm9taXNlPElWYWx1ZUNvbXBsZXRpb25bXT4ge1xuICAgICAgICBjb25zdCBzdWdnZXN0aW9ucyA9IGF3YWl0IHRoaXMuZ2V0VmFsdWVTdWdnZXN0aW9ucyhjb250ZXh0KTtcbiAgICAgICAgaWYgKHN1Z2dlc3Rpb25zLmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIHN1Z2dlc3Rpb25zO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9O1xuXG4gICAgYXN5bmMgZ2V0VmFsdWVTdWdnZXN0aW9ucyhjb250ZXh0OiBFZGl0b3JTdWdnZXN0Q29udGV4dCk6IFByb21pc2U8SVZhbHVlQ29tcGxldGlvbltdPiB7XG4gICAgICAgIGNvbnN0IGxpbmUgPSBjb250ZXh0LnN0YXJ0LmxpbmU7XG4gICAgICAgIGxldCByZWdleDtcbiAgICAgICAgaWYgKCF0aGlzLmluRnJvbnRtYXR0ZXIpIHtcbiAgICAgICAgICAgIHJlZ2V4ID0gbmV3IFJlZ0V4cChgXiR7Z2VuZXJpY0ZpZWxkUmVnZXh9OjooPzx2YWx1ZXM+LispP2AsIFwidVwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlZ2V4ID0gbmV3IFJlZ0V4cChgXiR7Z2VuZXJpY0ZpZWxkUmVnZXh9Oig/PHZhbHVlcz4uKyk/YCwgXCJ1XCIpO1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCByZWdleFJlc3VsdCA9IGNvbnRleHQuZWRpdG9yLmdldFJhbmdlKHsgbGluZTogbGluZSwgY2g6IDAgfSwgY29udGV4dC5lbmQpLm1hdGNoKHJlZ2V4KTtcblxuICAgICAgICBpZiAocmVnZXhSZXN1bHQgJiYgcmVnZXhSZXN1bHQuZ3JvdXBzPy5hdHRyaWJ1dGUpIHtcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkTmFtZSA9IHJlZ2V4UmVzdWx0Lmdyb3Vwcy5hdHRyaWJ1dGU7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZXNMaXN0ID0gcmVnZXhSZXN1bHQuZ3JvdXBzLnZhbHVlcz8ucmVwbGFjZSgvXlxcW3xeXFxzXFxbLywgJycpLnJlcGxhY2UoL1xcXSQvLCAnJykuc3BsaXQoXCIsXCIpLm1hcChvID0+IG8udHJpbSgpKVxuICAgICAgICAgICAgY29uc3QgbGFzdFZhbHVlID0gdmFsdWVzTGlzdD8ubGFzdCgpXG4gICAgICAgICAgICBjb25zdCBmaXJzdFZhbHVlcyA9IHZhbHVlc0xpc3Q/LnNsaWNlKDAsIC0xKVxuICAgICAgICAgICAgLy90YWdzIHNwZWNpZmljIGNhc1xuICAgICAgICAgICAgaWYgKGZpZWxkTmFtZSA9PT0gXCJ0YWdzXCIgJiYgdGhpcy5pbkZyb250bWF0dGVyKSB7XG4gICAgICAgICAgICAgICAgLy9AdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0VGFncygpKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKHQgPT4gbGFzdFZhbHVlID8gdC5jb250YWlucyhsYXN0VmFsdWUpIDogdClcbiAgICAgICAgICAgICAgICAgICAgLnNvcnQoKVxuICAgICAgICAgICAgICAgICAgICAubWFwKHRhZyA9PiBPYmplY3QoeyB2YWx1ZTogdGFnLnJlcGxhY2UoL14jLywgXCJcIikgfSkpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL2lmIHRoaXMgbm90ZSBoYXMgYSBmaWxlQ2xhc3MsIGNoZWNrIGlmIGZpZWxkIHZhbHVlcyBhcmUgZGVmaW5lZCBpbiB0aGUgRmlsZUNsYXNzXG4gICAgICAgICAgICBjb25zdCBjYWNoZSA9IHRoaXMucGx1Z2luLmFwcC5tZXRhZGF0YUNhY2hlLmdldENhY2hlKGNvbnRleHQuZmlsZS5wYXRoKTtcbiAgICAgICAgICAgIGxldCB0cnlXaXRoUHJlc2V0RmllbGQgPSAhY2FjaGU/LmZyb250bWF0dGVyO1xuICAgICAgICAgICAgaWYgKGNhY2hlPy5mcm9udG1hdHRlcikge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgcG9zaXRpb24sIC4uLmF0dHJpYnV0ZXMgfSA9IGNhY2hlLmZyb250bWF0dGVyO1xuICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVDbGFzc0FsaWFzID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmlsZUNsYXNzQWxpYXM7XG4gICAgICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKGF0dHJpYnV0ZXMpLmNvbnRhaW5zKGZpbGVDbGFzc0FsaWFzKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlQ2xhc3NWYWx1ZSA9IGF0dHJpYnV0ZXNbZmlsZUNsYXNzQWxpYXNdO1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZUNsYXNzID0gYXdhaXQgY3JlYXRlRmlsZUNsYXNzKHRoaXMucGx1Z2luLCBmaWxlQ2xhc3NWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbGVDbGFzcyA9IGZpbGVDbGFzcztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVDbGFzc0F0dHJpYnV0ZXMgPSB0aGlzLmZpbGVDbGFzcy5hdHRyaWJ1dGVzO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVDbGFzc0F0dHJpYnV0ZXMubWFwKGF0dHIgPT4gYXR0ci5uYW1lKS5jb250YWlucyhmaWVsZE5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IGZpbGVDbGFzc0F0dHJpYnV0ZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihhdHRyID0+IGF0dHIubmFtZSA9PSBmaWVsZE5hbWUpWzBdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vcHRpb25zXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIob3B0aW9uID0+IHRoaXMuZmlsdGVyT3B0aW9uKGZpcnN0VmFsdWVzLCBsYXN0VmFsdWUsIG9wdGlvbikpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hcChvcHRpb24gPT4gT2JqZWN0KHsgdmFsdWU6IG9wdGlvbiB9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cnlXaXRoUHJlc2V0RmllbGQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRyeVdpdGhQcmVzZXRGaWVsZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAodHJ5V2l0aFByZXNldEZpZWxkKSB7XG4gICAgICAgICAgICAgICAgLy9lbHNlIGNoZWNrIGlmIHRoZXJlIGFyZSBnbG9iYWwgcHJlc2V0IHZhbHVlc1xuICAgICAgICAgICAgICAgIGNvbnN0IHByZXNldEZpZWxkTWF0Y2ggPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcmVzZXRGaWVsZHMuZmlsdGVyKGZpZWxkID0+IGZpZWxkLm5hbWUgPT0gZmllbGROYW1lKTtcbiAgICAgICAgICAgICAgICBpZiAocHJlc2V0RmllbGRNYXRjaC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHByZXNldEZpZWxkID0gcHJlc2V0RmllbGRNYXRjaFswXTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAocHJlc2V0RmllbGQudmFsdWVzTGlzdE5vdGVQYXRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL292ZXJyaWRlIHByZXNldFZhbHVlcyBpZiB0aGVyZSBpcyBhIHZhbHVlc0xpc3RcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlc0ZpbGUgPSB0aGlzLnBsdWdpbi5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKHByZXNldEZpZWxkLnZhbHVlc0xpc3ROb3RlUGF0aCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWVzRmlsZSBpbnN0YW5jZW9mIFRGaWxlICYmIHZhbHVlc0ZpbGUuZXh0ZW5zaW9uID09IFwibWRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlczogeyB2YWx1ZTogc3RyaW5nIH1bXSA9IGF3YWl0IChhd2FpdCB0aGlzLnBsdWdpbi5hcHAudmF1bHQucmVhZCh2YWx1ZXNGaWxlKSkuc3BsaXQoXCJcXG5cIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihvcHRpb24gPT4gdGhpcy5maWx0ZXJPcHRpb24oZmlyc3RWYWx1ZXMsIGxhc3RWYWx1ZSwgb3B0aW9uKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hcChfdmFsdWUgPT4gT2JqZWN0KHsgdmFsdWU6IF92YWx1ZSB9KSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWVzO1xuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWVzID0gT2JqZWN0LmVudHJpZXMocHJlc2V0RmllbGRNYXRjaFswXS52YWx1ZXMpLm1hcChvcHRpb24gPT4gb3B0aW9uWzFdKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihvcHRpb24gPT4gdGhpcy5maWx0ZXJPcHRpb24oZmlyc3RWYWx1ZXMsIGxhc3RWYWx1ZSwgb3B0aW9uKSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlc1xuICAgICAgICAgICAgICAgICAgICAgICAgLm1hcChfdmFsdWUgPT4gT2JqZWN0KHsgdmFsdWU6IF92YWx1ZSB9KSlcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH07XG5cbiAgICByZW5kZXJTdWdnZXN0aW9uKHN1Z2dlc3Rpb246IElWYWx1ZUNvbXBsZXRpb24sIGVsOiBIVE1MRWxlbWVudCk6IHZvaWQge1xuICAgICAgICBlbC5zZXRUZXh0KHN1Z2dlc3Rpb24udmFsdWUpO1xuICAgIH07XG5cbiAgICBzZWxlY3RTdWdnZXN0aW9uKHN1Z2dlc3Rpb246IElWYWx1ZUNvbXBsZXRpb24sIGV2ZW50OiBLZXlib2FyZEV2ZW50IHwgTW91c2VFdmVudCk6IHZvaWQge1xuICAgICAgICBjb25zdCBhY3RpdmVWaWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KTtcbiAgICAgICAgaWYgKCFhY3RpdmVWaWV3KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGVkaXRvciA9IGFjdGl2ZVZpZXcuZWRpdG9yO1xuICAgICAgICBjb25zdCBhY3RpdmVMaW5lID0gZWRpdG9yLmdldExpbmUodGhpcy5jb250ZXh0IS5zdGFydC5saW5lKTtcblxuICAgICAgICBpZiAodGhpcy5pbkZyb250bWF0dGVyKSB7XG4gICAgICAgICAgICAvL2Zvcm1hdCBsaXN0IGlmIGluIGZyb250bWF0dGVyXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGxldCBwYXJzZWRGaWVsZDogUmVjb3JkPHN0cmluZywgc3RyaW5nIHwgc3RyaW5nW10gfCBudWxsPiA9IHBhcnNlWWFtbChhY3RpdmVMaW5lKVxuICAgICAgICAgICAgICAgIGxldCBbYXR0ciwgcGFzdFZhbHVlc10gPSBPYmplY3QuZW50cmllcyhwYXJzZWRGaWVsZClbMF1cbiAgICAgICAgICAgICAgICBsZXQgbmV3RmllbGQ6IHN0cmluZ1xuICAgICAgICAgICAgICAgIGlmICghcGFzdFZhbHVlcykge1xuICAgICAgICAgICAgICAgICAgICBuZXdGaWVsZCA9IGF0dHIgKyBcIjogXCIgKyBzdWdnZXN0aW9uLnZhbHVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHBhc3RWYWx1ZXMgPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFwYXN0VmFsdWVzLmNvbnRhaW5zKFwiLFwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3RmllbGQgPSBhdHRyICsgXCI6IFwiICsgc3VnZ2VzdGlvbi52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0ZpZWxkID0gYXR0ciArIFwiOiBbXCIgKyBwYXN0VmFsdWVzLnNwbGl0KFwiLFwiKS5tYXAobyA9PiBvLnRyaW0oKSkuc2xpY2UoMCwgLTEpLmpvaW4oJywgJykgKyBcIiwgXCIgKyBzdWdnZXN0aW9uLnZhbHVlICsgXCJdXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkocGFzdFZhbHVlcykpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGl2ZUxpbmUuZW5kc1dpdGgoXCIsXVwiKSB8fCBhY3RpdmVMaW5lLmVuZHNXaXRoKFwiLCBdXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL3ZhbHVlIGNhbiBiZSBkaXJlY3RseSBhZGRlZCBzaW5jZSBwYXJzZVlhbWwgd29udCBjcmVhdGUgYW4gZW1wdHkgbGFzdCBpdGVtIGluIHBhc3RWYWx1ZXNcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0ZpZWxkID0gYXR0ciArIFwiOiBbXCIgKyBbLi4ucGFzdFZhbHVlcywgc3VnZ2VzdGlvbi52YWx1ZV0uam9pbihcIiwgXCIpICsgXCJdXCI7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL3dlIGhhdmUgdHlwZWQgc29tZXRoaW5nIHRoYXQgd2UgYWh2ZSB0byByZW1vdmUgdG8gcmVwbGFjZSB3aXRoIHNlbGVjdGVkIHZhbHVlXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdGaWVsZCA9IGF0dHIgKyBcIjogW1wiICsgWy4uLnBhc3RWYWx1ZXMuc2xpY2UoMCwgLTEpLCBzdWdnZXN0aW9uLnZhbHVlXS5qb2luKFwiLCBcIikgKyBcIl1cIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3RmllbGQgPSBhdHRyICsgXCI6IFtcIiArIFsuLi5wYXN0VmFsdWVzXS5qb2luKFwiLCBcIikgKyBcIl1cIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWRpdG9yLnJlcGxhY2VSYW5nZShuZXdGaWVsZCwgeyBsaW5lOiB0aGlzLmNvbnRleHQhLnN0YXJ0LmxpbmUsIGNoOiAwIH0sIHsgbGluZTogdGhpcy5jb250ZXh0IS5zdGFydC5saW5lLCBjaDogYWN0aXZlTGluZS5sZW5ndGggfSk7XG4gICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocGFzdFZhbHVlcykgfHwgdHlwZW9mIHBhc3RWYWx1ZXMgPT09ICdzdHJpbmcnICYmIHBhc3RWYWx1ZXMuY29udGFpbnMoXCIsXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGVkaXRvci5zZXRDdXJzb3IoeyBsaW5lOiB0aGlzLmNvbnRleHQhLnN0YXJ0LmxpbmUsIGNoOiBuZXdGaWVsZC5sZW5ndGggLSAxIH0pXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLnNldEN1cnNvcih7IGxpbmU6IHRoaXMuY29udGV4dCEuc3RhcnQubGluZSwgY2g6IG5ld0ZpZWxkLmxlbmd0aCB9KVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZShcIkZyb250bWF0dGVyIHdyb25nbHkgZm9ybWF0dGVkXCIsIDIwMDApXG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpXG4gICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvL2NsZWFuIGxpbmUgYnkgcmVtb3ZpbmcgZXZlcnl0aGluZyBhZnRlciAsIG9yIDo6XG4gICAgICAgICAgICBsZXQgY2xlYW5lZExpbmUgPSBhY3RpdmVMaW5lXG4gICAgICAgICAgICB3aGlsZSAoIVsnLCcsICc6J10uY29udGFpbnMoY2xlYW5lZExpbmUuY2hhckF0KGNsZWFuZWRMaW5lLmxlbmd0aCAtIDEpKSkge1xuICAgICAgICAgICAgICAgIGNsZWFuZWRMaW5lID0gY2xlYW5lZExpbmUuc2xpY2UoMCwgLTEpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlZGl0b3IucmVwbGFjZVJhbmdlKGAke2NsZWFuZWRMaW5lfSR7ZXZlbnQuc2hpZnRLZXkgPyBcIiBcIiA6IFwiXCJ9YCArIHN1Z2dlc3Rpb24udmFsdWUsXG4gICAgICAgICAgICAgICAgeyBsaW5lOiB0aGlzLmNvbnRleHQhLnN0YXJ0LmxpbmUsIGNoOiAwIH0sIHRoaXMuY29udGV4dCEuZW5kKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmRpZFNlbGVjdCA9IHRydWVcbiAgICAgICAgdGhpcy5jbG9zZSgpXG4gICAgfTtcbn07Il0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSx3QkFBcUM7OztBQ0Fy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
