---
title: ç­†è¨˜ | JavaScript - Closure é–‰åŒ…(I) åŸºç¤æ¦‚å¿µ
tags:
  - JavaScript
categories:
  - '2022'
  - '04'
author: Rosa Hong
date: 2022-04-13 21:51:39
description:
---

## å‰è¨€
Closure æ˜¯ JavaScript å¾ˆé‡è¦çš„åŸºç¤  
è—‰ç”±æœ¬ç¯‡å¹«åŠ©è‡ªå·±é‡æ¸… Closure çš„æ¦‚å¿µ  

<!-- more -->

## å…ˆèªè­˜ Scope Chain
[Scope](https://blog.rosa.tw/Frontend/JavaScript/JavaScript-Hoisting-II/?highlight=scope#%E4%BD%9C%E7%94%A8%E5%9F%9F-Scope) æ˜¯è®Šæ•¸ç”Ÿå­˜çš„ç¯„åœï¼Œå¦‚æœåœ¨è‡ªå·±å±¤ç´šæ‰¾ä¸åˆ°å°±æœƒä¸€å±¤ä¸€å±¤å¾€å¤–æ‰¾ï¼Œç›´åˆ° Global ç‚ºæ­¢ã€‚  

é€™ç¨®è¡Œç‚ºå°±ç¨±ç‚ºã€Œ**ç¯„åœéˆ**ã€(Scope Chain)ã€‚

> ç¯„åœéˆæ˜¯åœ¨å‡½å¼**è¢«å®šç¾©çš„ç•¶ä¸‹æ±ºå®š** (lexical scope ä¾†æ±ºå®š)çš„ï¼Œä¸æ˜¯åœ¨è¢«å‘¼å«çš„æ™‚å€™æ±ºå®šã€‚

### ç¯„ä¾‹
```javascript
var a = 'global'
function change(){
	var a  = 'change'
	test()
	console.log(a) // change
}
function test(){
	console.log(a) //global
}
change()
```
ä¸€é–‹å§‹æœƒä»¥ç‚º `test()` åœ¨ change è£¡é¢å‘¼å«ï¼Œå–å¾—çš„è®Šæ•¸ a æ˜¯ change å°ä¸å° ? 

NO NO NO,å†é‡è¤‡ä¸€æ¬¡ !      
> ç¯„åœéˆæ˜¯åœ¨å‡½å¼**è¢«å®šç¾©çš„ç•¶ä¸‹æ±ºå®š** çš„ï¼Œä¸æ˜¯åœ¨è¢«å‘¼å«çš„æ™‚å€™æ±ºå®šã€‚

`test` å‡½å¼åœ¨ Lexical Environments æ˜¯ gloabal çš„ä¸‹ä¸€å±¤ï¼ŒScope Chain æ˜¯æ ¹æ“š Lexical scope æ±ºå®šï¼Œå¾€ä¸Šæ‰¾æ˜¯ gloabl é‚£å±¤ï¼Œæ‰€ä»¥çµæœæ‰æœƒæ˜¯ `'global'`


## ç‚ºä»€éº¼è¦æœ‰ Closure ? 
> åå• ğŸ‘‰ **æ²’æœ‰ Closure æœƒæ€æ¨£ ?**
 
æˆ‘å€‘çŸ¥é“ Execution Context åŸ·è¡Œç’°å¢ƒåœ¨åŸ·è¡Œå®Œ function å¾Œï¼ŒStack æœƒæŠ½æ‰ï¼Œæœ‰é—œé€™å€‹ function çš„ä¸€åˆ‡è®Šæ•¸ä¹Ÿæœƒè¢«å›æ”¶è€Œä¸”ä¸å¯å†ä½¿ç”¨ã€‚
	
- å¦‚æœè¦ä½¿ç”¨ function è£¡çš„è®Šæ•¸å‘¢ ? (`private variable` çš„æ¦‚å¿µ)

ç›´è¦ºå¯èƒ½æœƒä¸Ÿåˆ° `global` é€²è¡Œå®£å‘Šï¼Œä½†ç•¶å°ˆæ¡ˆçµæ§‹é€æ¼¸é¾å¤§ï¼Œä¹…è€Œä¹…ä¹‹æœƒé€ æˆ **å…¨åŸŸè®Šæ•¸æ±™æŸ“**  

**é‚£é–‰åŒ…çš„å‡ºç¾è§£æ±ºäº†...** :
- è‡ªç”±è®Šæ•¸ (free variable)ï¼Œåªæœ‰åœ¨ function å…§éƒ¨å¯è®€å–è®Šæ•¸ï¼Œåœ¨å¤–éƒ¨å‰‡ç„¡æ³•è®€å–ã€‚
- è®Šæ•¸æš«å­˜ï¼Œæ¸›å°‘é‡è¤‡çš„è¤‡é›œè¨ˆç®—

## Closure çš„å„ªç¼ºé»
- å„ªé» : 
  1. é¿å… **å…¨åŸŸè®Šæ•¸æ±™æŸ“**
  2. æä¾› **è‡ªç”±è®Šæ•¸**ï¼Œè®“è©² function åŸ·è¡Œå®Œå¾Œï¼Œè®Šæ•¸çš„ä½œç”¨åŸŸä¸æœƒå›  function çµæŸè¢«å›æ”¶ï¼Œè€Œæ˜¯æœƒç¹¼çºŒå­˜åœ¨ã€‚
  3. é¿å…é‡è¤‡åŸ·è¡Œé¾å¤§çš„è¨ˆç®—  
  	å¯ä»¥è¨˜éŒ„å‰ä¸€æ¬¡è¨ˆç®—çš„ç‹€æ…‹ï¼Œä¸‹ä¸€æ¬¡å†å‘¼å«ä¸ç”¨é‡ç®—ä¸€æ¬¡ (cache çš„æ¦‚å¿µ)ã€‚  
  4. åœ¨å¤šäººå”ä½œçš„æ™‚å€™ï¼Œæœ‰äº›éš±å¯†çš„è³‡è¨Šä¸æƒ³è®“äººå»ä¿®æ”¹ï¼Œå¯ä»¥ä½¿ç”¨å°è£é–‰åŒ…çš„æ–¹å¼ã€‚
  	åˆ¥äººå¿…é ˆä¾ç…§å›ºå®šçš„å¯«æ³•ä¾†å–å¾—è³‡æ–™ï¼Œä¸”ä¸èƒ½ä¿®æ”¹åˆ°å…§éƒ¨çš„è³‡è¨Šã€‚
  	åœ¨é–‹æºè³‡æ–™æˆ– API çš„æ–¹æ³•å¸¸ä½¿ç”¨é€™æ¨£çš„æ–¹å¼ï¼Œä»¥å…æ”¹å‹•åˆ°å…§éƒ¨æ•¸å€¼ã€‚

- ç¼ºé» :
  1. å¯èƒ½ä¿ç•™åˆ°ä¸€äº›ä¸å¿…è¦çš„è®Šæ•¸æˆ–è³‡è¨Šï¼Œé€ æˆè³‡æºå¤šé¤˜æ¶ˆè€—ã€‚
  2. åªèƒ½ä½¿ç”¨æ¶µå¼æä¾›çš„æ–¹æ³•ï¼Œå› ç‚ºå…§éƒ¨çš„è³‡è¨Šè¢«éš±è”½ï¼Œåœ¨æ›´å‹•ä¸Šè¼ƒä¸å½ˆæ€§ã€‚  
   	(ä½†æ˜¯ç›¸åå¦‚æœä¸æƒ³è¦è¢«æ”¹å‹•æœƒæ˜¯å„ªé»)  

## ä»€éº¼æ˜¯é–‰åŒ… ?
é™¤äº†è‡ªå·±æœ¬èº«çš„ç¨‹å¼ç¢¼å¤–ï¼Œä¹Ÿå¯ä»¥å–å¾—äº†**å…§éƒ¨å‡½å¼ã€Œç•¶æ™‚ç’°å¢ƒã€çš„è®Šæ•¸å€¼**ï¼Œè¨˜ä½äº†åŸ·è¡Œç•¶æ™‚çš„ç’°å¢ƒï¼Œé€™å°±æ˜¯ã€Œé–‰åŒ…ã€ã€‚ 

## ç°¡å–®çš„ Closure ç¯„ä¾‹
- æ²’æœ‰ä½¿ç”¨é–‰åŒ…  
```javascript
var rate = .75
function itmePrice(price){
 return price >= 100 ? price*rate : price
}
rate = .1 
let bag = itmePrice(150)
console.log(bag)
```
> å¯ä»¥é€éç›´æ¥ä¿®æ”¹æ•¸å€¼ (ğŸ‘)  
> ä»»ä½•äººéƒ½å¯ä»¥åœ¨å¤–éƒ¨é€²è¡Œä¿®æ”¹

- ä½¿ç”¨é–‰åŒ…
```javascript
function itmePrice(price){
	// æŠŠ rate è®Šæˆç§æœ‰è®Šæ•¸
	var rate = .75
	return function (){
	return price >= 100 ? price*rate : price
	}
}
let bag = itmePrice(150)
console.log(bag())
```
> åªè¦å‘¼å«éœ€è¦çš„æ±è¥¿å³å¯ (ğŸ‘)  
> ä¸æœƒè¢«å¤–éƒ¨ä¿®æ”¹


## åƒè€ƒ 
1. [æ‰€æœ‰çš„å‡½å¼éƒ½æ˜¯é–‰åŒ…ï¼šè«‡ JS ä¸­çš„ä½œç”¨åŸŸèˆ‡ Closure - Huli](https://blog.huli.tw/2018/12/08/javascript-closure/)
2. [Variable scope, closure](https://javascript.info/closure#lexical-environment)
3. [é‡æ–°èªè­˜ JavaScript: Day 19 é–‰åŒ… Closure](https://ithelp.ithome.com.tw/articles/10193009)

