<!DOCTYPE html><html lang="zh-TW"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/shan-logo-appletouch.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/shan-logo.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/shan-logo-16X16.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><script class="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"blog.rosa.tw",root:"/",scheme:"Gemini",version:"8.0.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,"Pisces | Gemini":240},copycode:!0,bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!0,pangu:!1,comments:{style:"buttons",active:!0,storage:!0,lazyload:!0,nav:{disqus:{text:"ç•™è¨€å€",order:-1}},"Available values":"disqus"},motion:{enable:!1,async:!1,transition:{post_block:"fadeIn",post_header:"fadeInDown",post_body:"fadeInDown",coll_header:"fadeInLeft",sidebar:"fadeInUp"}},prism:!1,i18n:{placeholder:"æœå°‹...",empty:"We didn't find any results for the search: ${query}",hits_time:"${hits} results found in ${time} ms",hits:"${hits} results found"},path:"search.xml",localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1}}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-S8ZEBJDRWG"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-S8ZEBJDRWG")</script><meta name="description" content="æ–‡ç« ä¾†è‡ª :  Refs å’Œ DOM â€“ React React Hook ç­†è¨˜ useRef. useRef ç¥å¥‡çš„åœ°æ–¹é™¤äº†å¯ä»¥åœ¨ä¸ re-renderâ€¦  Imperative vs Declarative Programming in JavaScript   æ‘˜è¦  ä»€éº¼æ˜¯ ref ? ref ä½¿ç”¨çš„æ™‚æ©Ÿ ref çš„å¦ä¸€ç¨®å‹æ…‹ callback ref"><meta property="og:type" content="article"><meta property="og:title" content="ç­†è¨˜ | React - ref èˆ‡ callback ref"><meta property="og:url" content="https://blog.rosa.tw/2022/08/React/ref-and-callback-ref"><meta property="og:site_name" content="å¥å¿˜é›œè¨˜"><meta property="og:description" content="æ–‡ç« ä¾†è‡ª :  Refs å’Œ DOM â€“ React React Hook ç­†è¨˜ useRef. useRef ç¥å¥‡çš„åœ°æ–¹é™¤äº†å¯ä»¥åœ¨ä¸ re-renderâ€¦  Imperative vs Declarative Programming in JavaScript   æ‘˜è¦  ä»€éº¼æ˜¯ ref ? ref ä½¿ç”¨çš„æ™‚æ©Ÿ ref çš„å¦ä¸€ç¨®å‹æ…‹ callback ref"><meta property="og:locale" content="zh_TW"><meta property="og:image" content="https://i.imgur.com/H2K46gT.png"><meta property="og:image" content="https://blog.thoughtspile.tech/images/react-ref-order-f455246e4b65dcd8bad4434384f2460e.png"><meta property="article:published_time" content="2022-08-24T02:43:24.000Z"><meta property="article:modified_time" content="2022-08-24T02:44:43.111Z"><meta property="article:author" content="Rosa Hong"><meta property="article:tag" content="React"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://i.imgur.com/H2K46gT.png"><link rel="canonical" href="https://blog.rosa.tw/2022/08/React/ref-and-callback-ref.html"><script class="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-TW"}</script><title>ç­†è¨˜ | React - ref èˆ‡ callback ref | å¥å¿˜é›œè¨˜</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-S8ZEBJDRWG"></script><script>if(CONFIG.hostname===location.hostname){function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-S8ZEBJDRWG")}</script><noscript><style>body{margin-top:2rem}.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header,.use-motion .sidebar{visibility:visible}.use-motion .footer,.use-motion .header,.use-motion .site-brand-container .toggle{opacity:initial}.use-motion .custom-logo-image,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line{transform:scaleX(1)}.search-pop-overlay,.sidebar-nav{display:none}.sidebar-panel{display:block}</style></noscript><link rel="alternate" href="/atom.xml" title="å¥å¿˜é›œè¨˜" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="åˆ‡æ›å°èˆªæ¬„"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><h1 class="site-title">å¥å¿˜é›œè¨˜</h1><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">ç´€éŒ„å­¸ç¿’èˆ‡ç”Ÿæ´»</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i> é¦–é </a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i> æ¨™ç±¤<span class="badge">21</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i> åˆ†é¡<span class="badge">15</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i> æ­¸æª”<span class="badge">55</span></a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> æœå°‹</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="æœå°‹..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> æ–‡ç« ç›®éŒ„</li><li class="sidebar-nav-overview"> æœ¬ç«™æ¦‚è¦</li></ul><section class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">1.</span> <span class="nav-text">æ‘˜è¦</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">2.</span> <span class="nav-text">ä»€éº¼æ˜¯ ref ?</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">3.</span> <span class="nav-text">ä¸éåº¦ä½¿ç”¨ ref</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">4.</span> <span class="nav-text">ä½¿ç”¨ ref çš„æ™‚æ©Ÿ</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">5.</span> <span class="nav-text">è£œå…… : Declarative v.s Imperative in JavaScript</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Declarative-%E5%AE%A3%E5%91%8A%E5%BC%8F"><span class="nav-number">5.1.</span> <span class="nav-text">Declarative å®£å‘Šå¼</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Imperative-%E5%91%BD%E4%BB%A4%E5%BC%8F"><span class="nav-number">5.2.</span> <span class="nav-text">Imperative å‘½ä»¤å¼</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8F%E7%B5%90-8"><span class="nav-number">5.3.</span> <span class="nav-text">å°çµ</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">6.</span> <span class="nav-text">å»ºç«‹ ref</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">7.</span> <span class="nav-text">å­˜å– ref</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8-DOM-Element-%E5%8A%A0%E4%B8%8A-Ref"><span class="nav-number">7.1.</span> <span class="nav-text">åœ¨ DOM Element åŠ ä¸Š Ref</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8-Class-Component-%E5%8A%A0%E4%B8%8A-Ref"><span class="nav-number">7.2.</span> <span class="nav-text">åœ¨ Class Component åŠ ä¸Š Ref</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ref-%E5%92%8C-Function-Component"><span class="nav-number">7.3.</span> <span class="nav-text">Ref å’Œ Function Component</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">8.</span> <span class="nav-text">å¯¦å‹™ä¸Šçš„ ref</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A8%88%E7%AE%97-render-%E6%AC%A1%E6%95%B8"><span class="nav-number">8.1.</span> <span class="nav-text">è¨ˆç®— render æ¬¡æ•¸</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8-Imperatively-%E6%96%B9%E6%B3%95%E6%94%B9%E8%AE%8A-DOM-%E8%B7%9F-Child-Component"><span class="nav-number">8.2.</span> <span class="nav-text">ç”¨ Imperatively æ–¹æ³•æ”¹è®Š DOM è·Ÿ Child Component</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%A6%E4%BD%9C-%E4%BD%BF%E7%94%A8-state-%E4%BE%86%E6%8E%A7%E5%88%B6-autofocus"><span class="nav-number">8.2.1.</span> <span class="nav-text">å¯¦ä½œ : ä½¿ç”¨ state ä¾†æ§åˆ¶ autofocus</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-ref"><span class="nav-number">8.2.2.</span> <span class="nav-text">ä½¿ç”¨ ref</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8A%93-Previous-%E7%9A%84%E5%80%BC"><span class="nav-number">8.3.</span> <span class="nav-text">æŠ“ Previous çš„å€¼</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">9.</span> <span class="nav-text">callback ref</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%89-ref-effect-%E7%82%BA%E4%BB%80%E9%BA%BC%E9%82%84%E9%9C%80%E8%A6%81-callback-ref"><span class="nav-number">9.0.1.</span> <span class="nav-text">æœ‰ ref + effect ç‚ºä»€éº¼é‚„éœ€è¦ callback ref</span></a></li></ol></li></ol><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">10.</span> <span class="nav-text">callback ref çš„ä½¿ç”¨æ™‚æ©Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8F%E5%AF%A6%E4%BD%9C"><span class="nav-number">10.1.</span> <span class="nav-text">å°å¯¦ä½œ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F-3"><span class="nav-number">10.2.</span> <span class="nav-text">æ³¨æ„</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">11.</span> <span class="nav-text">ref ã€ effect èˆ‡ layouteffect</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">12.</span> <span class="nav-text">callback ref çš„ clean up function</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">13.</span> <span class="nav-text">ç¸½çµ</span></a></li></div></section><section class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Rosa Hong" src="/images/RosaBlog-LOGO.png"><p class="site-author-name" itemprop="name">Rosa Hong</p><div class="site-description" itemprop="description">èœé³¥èµ·é£›ä¸­</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">55</span> <span class="site-state-item-name">æ–‡ç« </span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">15</span> <span class="site-state-item-name">åˆ†é¡</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">21</span> <span class="site-state-item-name">æ¨™ç±¤</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/meitung473" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;meitung473" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a></span><span class="links-of-author-item"><a href="mailto:a8870506@gmail.com" title="è¯çµ¡æˆ‘ â†’ mailto:a8870506@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a></span><span class="links-of-author-item"><a href="https://www.facebook.com/yanshan.hong1" title="Rosa Hong â†’ https:&#x2F;&#x2F;www.facebook.com&#x2F;yanshan.hong1" rel="noopener" target="_blank"><i class="fa fa-facebook fa-fw"></i></a></span></div></section></div></aside><div class="sidebar-dimmer"></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW"><link itemprop="mainEntityOfPage" href="https://blog.rosa.tw/2022/08/React/ref-and-callback-ref"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/RosaBlog-LOGO.png"><meta itemprop="name" content="Rosa Hong"><meta itemprop="description" content="èœé³¥èµ·é£›ä¸­"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="å¥å¿˜é›œè¨˜"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> ç­†è¨˜ | React - ref èˆ‡ callback ref</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">ç™¼è¡¨æ–¼</span> <time title="å‰µå»ºæ™‚é–“ï¼š2022-08-24 10:43:24" itemprop="dateCreated datePublished" datetime="2022-08-24T10:43:24+08:00">2022-08-24</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">åˆ†é¡æ–¼</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Front-end/" itemprop="url" rel="index"><span itemprop="name">Front-end</span></a></span> ï¼Œ <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Front-end/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a></span></span></div><div class="post-meta"><span class="post-meta-item" title="æ–‡ç« å­—æ•¸"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">æ–‡ç« å­—æ•¸ï¼š</span> <span>18k</span></span><span class="post-meta-item" title="æ‰€éœ€é–±è®€æ™‚é–“"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">æ‰€éœ€é–±è®€æ™‚é–“ &asymp;</span> <span>16 åˆ†é˜</span></span></div></div></header><div class="post-body" itemprop="articleBody"><blockquote><p>æ–‡ç« ä¾†è‡ª :</p><ol><li><a href="https://zh-hant.reactjs.org/docs/refs-and-the-dom.html">Refs å’Œ DOM â€“ React</a></li><li><a href="https://medium.com/hannah-lin/react-hook-%E7%AD%86%E8%A8%98-useref-c628cbf0d7fb">React Hook ç­†è¨˜ useRef. useRef ç¥å¥‡çš„åœ°æ–¹é™¤äº†å¯ä»¥åœ¨ä¸ re-renderâ€¦</a></li><li><a href="https://www.linkedin.com/pulse/imperative-vs-declarative-programming-javascript-yehuda-margolis">Imperative vs Declarative Programming in JavaScript</a></li></ol></blockquote><h1>æ‘˜è¦</h1><ol><li>ä»€éº¼æ˜¯ ref ?</li><li>ref ä½¿ç”¨çš„æ™‚æ©Ÿ</li><li>ref çš„å¦ä¸€ç¨®å‹æ…‹ callback ref</li></ol><span id="more"></span><h1>ä»€éº¼æ˜¯ ref ?</h1><p>ref æä¾› React è³‡æ–™æµä»¥å¤–çš„æ“ä½œæ–¹å¼ï¼Œè®“æˆ‘å€‘å¯ä»¥æ”¹è®Š React Component çš„ instance (å¯¦ä¾‹)ï¼Œæˆ–è€…å®ƒä¾†ä¾†æ“ä½œ DOM å…ƒç´ ã€‚</p><p>ref å¯çœ‹ä½œæ˜¯ä¸€å€‹æ™®é€šçš„ JavaScript ç‰©ä»¶ï¼Œå…§éƒ¨å…·æœ‰ current çš„å±¬æ€§çš„æ±è¥¿ï¼Œå¯ä»¥ç›´æ¥ (mutable) æ”¹è®Šå®ƒã€‚ React ä¿è­‰å®ƒåœ¨ç”Ÿå‘½é€±æœŸ (render) å¾ªç’°ä¸­æ°¸é éƒ½æŒ‡å‘åŒä¸€å€‹ä½å€ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ref = &#123;current : ... &#125;;</span><br></pre></td></tr></table></figure><h1>ä¸éåº¦ä½¿ç”¨ ref</h1><p>ä½¿ç”¨ ref çš„ç¬¬ä¸€ç›´è¦ºä¸Šï¼Œæˆ‘å€‘å¯èƒ½æœƒæƒ³èªª ref <strong>è¦åœ¨å“ªè£¡ç™¼ç”Ÿ</strong> ( åƒæ˜¯ state æœƒæ”¾åˆ°éœ€è¦ç”¨åˆ°çš„å…ƒä»¶å…§)ï¼Œref ä¸å–®å–®æ˜¯æ‹¿ä¾†å­˜æ”¾ä¸æœƒå½±éŸ¿ re-render çš„å€¼ï¼Œä¸æ‡‰è©²è¢«éåº¦ä½¿ç”¨æ“ä½œæœ‰é—œ React è³‡æ–™æµçš„éƒ¨åˆ†ã€‚é€™æ™‚å€™æ‡‰è©²ä½¿ç”¨ stateï¼Œä¸¦ä¸”è€ƒæ…® <strong>å“ªå€‹ component æ‡‰è©²æ“æœ‰ç‹€æ…‹</strong>ï¼Œå¦‚æœæ˜¯è¦å…±åŒæ“æœ‰çš„ state è¦åšçš„æ˜¯ <em>æå‡ state</em>ã€‚</p><h1>ä½¿ç”¨ ref çš„æ™‚æ©Ÿ</h1><ol><li>focusã€é¸æ“‡æ–‡å­—æˆ–å½±éŸ³åª’é«”æ’­æ”¾ç­‰ç­‰</li><li>è§¸ç™¼å³æ™‚çš„å‹•ç•«</li><li>èˆ‡ç¬¬ä¸‰æ–¹ DOM å‡½å¼æ•´åˆ</li></ol><blockquote><p>å¦‚æœæ“ä½œå¯ä»¥ç”¨å®£å‘Šå¼ (declarative) æ“ä½œï¼Œé¿å…ä½¿ç”¨ ref</p></blockquote><p>ä¾‹å¦‚ : å°è©±è¦–çª—æˆ‘å€‘å¯ä»¥ä¸ç”¨æš´éœ² <code>open()</code> æˆ– <code>close()</code> æ–¹æ³• ï¼Œè€Œæ˜¯ä½¿ç”¨ <code>isOpen</code> ä½œç‚º props ä¾†æ“ä½œã€‚ æˆ‘å€‘ä¸ç”¨å‘Šè¨´æŸå…ƒä»¶è¦æ€éº¼åš (HOW) ï¼Œè€Œå‘Šè¨´å…¶çµæœ (WHAT) å°±å¥½ã€‚</p><h1>è£œå…… : Declarative v.s Imperative in JavaScript</h1><h2 id="Declarative-å®£å‘Šå¼">Declarative å®£å‘Šå¼</h2><p>è‘—é‡æ–¼ WHAT (æƒ³è¦æ‹¿åˆ°çš„çµæœæ˜¯ä»€éº¼)ï¼Œæ¯”è¼ƒæŠ½è±¡çš„æµç¨‹ï¼Œå¤šä½¿ç”¨è¡¨é”å¼ (expression)ï¼Œç‰¹è‰²æ˜¯å–®ç´”é‹ç®—ä¸”å…·æœ‰å›å‚³å€¼ã€‚åƒæ˜¯ functional programmingã€‚</p><p><strong>ç‰¹è‰² :</strong></p><ul><li>Stateless : å°ˆæ³¨å…§éƒ¨ç®—å¼ï¼Œä¸¦ä¸æœƒç›´æ¥æ”¹è®ŠåŸæœ¬å‚³å…¥çš„å€¼ï¼Œå–®ç´”è¼¸å…¥èˆ‡è¼¸å‡ºã€‚</li><li>ç„¡å‰¯ä½œç”¨ (side effect)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‡½å¼è¡¨é”ç›¸ä¹˜</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">multiple</span>(<span class="params">arr</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(arr.<span class="property">length</span>===<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">  <span class="comment">// å›å‚³ç›¸ä¹˜å¾Œçš„çµæœï¼Œå…¶ state åˆè¢«å¡é€²å…§éƒ¨å›å‚³æ–°çš„çµæœ</span></span><br><span class="line">  <span class="keyword">return</span> arr.<span class="title function_">map</span>(<span class="function"><span class="params">x</span> =&gt;</span> x*<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">multiple</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]))</span><br></pre></td></tr></table></figure><p>å°‡å…¶ function åç¨±ä»£è¡¨å›å‚³çš„æ„ç¾©æœƒä½¿ç¨‹å¼ç¢¼æ¯”è¼ƒäº†è§£ï¼Œä¹Ÿå¯ä»¥èªª <strong>å®šç¾© OO æ˜¯ä»€éº¼</strong>ã€‚</p><h2 id="Imperative-å‘½ä»¤å¼">Imperative å‘½ä»¤å¼</h2><p>è‘—é‡æ–¼ HOW (ç›®æ¨™åˆ°åº•è¦æ€éº¼åš)ï¼Œå…·é«”è¡¨ç¤ºæ‡‰è©²æ€éº¼åšä¾†é”åˆ°ç›®æ¨™ï¼Œä¸€æ­¥æ­¥æŒ‰ç…§æ­¥é©Ÿï¼Œå¸¸ä½¿ç”¨ statement æµç¨‹æ§åˆ¶ (if , while , for , switch) ç­‰ã€‚åƒæ˜¯ OOPã€‚</p><p><strong>ç‰¹è‰² :</strong></p><ul><li>Stateful : state æ˜¯äº’ç›¸æœ‰é—œé€£æ€§çš„ã€‚</li><li>å¸¸æœƒæœ‰å‰¯ä½œç”¨ side effect ç™¼ç”Ÿ</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">multiple</span> = array =&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span>(array.<span class="property">length</span> == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">  <span class="keyword">const</span> result = [];</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;array.<span class="property">length</span>;i++)&#123;</span><br><span class="line">    result.<span class="title function_">push</span>(array[i]*<span class="number">2</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">multiple</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]))</span><br></pre></td></tr></table></figure><h2 id="å°çµ-8">å°çµ</h2><p>å¾ä¾‹å­ä¾†çœ‹ï¼Œå…©ç¨®æ–¹å¼éƒ½èƒ½é”åˆ°çµæœï¼Œåœ¨ Imperative ä¸­å¯ä»¥å¾ˆæ¸…æ¥šçœ‹è¦‹ state æ˜¯ â€œå¦‚ä½•è®ŠåŒ–â€ çš„ï¼Œç¶“éä¸€æ­¥æ­¥çš„æµç¨‹æ§åˆ¶å¾—å‡ºçµæœï¼›åœ¨ Declarative ä¸­è³‡æ–™çš„è®ŠåŒ–éƒ½è¢«è—åˆ°å…§éƒ¨å¦ä¸€å€‹å‡½å¼ä¸­ (é‚è¼¯è¢«æŠ½è±¡åŒ–)ï¼Œæˆ‘å€‘çœ‹åˆ°çš„æ˜¯ â€œçµæœâ€ã€‚</p><p>JavaScript ä½¿æˆ‘å€‘å¯ä»¥ç”¨å…©ç¨®æ–¹å¼ä¾†å¯¦ä½œï¼Œå…¶å„æœ‰å„ªç¼º :<br> <strong>Imperative :</strong></p><ul><li>å„ªé» :<ol><li>èªæ³•å°æ–¼é–‹ç™¼äººå“¡æ¯”è¼ƒå¥½æŒæ¡ã€‚</li><li>åœ¨æµç¨‹æ§åˆ¶ä¸Šéƒ½æ˜¯åœ¨åŒä¸€å€‹å€å¡Šæ“ä½œï¼ŒåŒ…å«åœæ­¢æˆ–æš«åœ loop éƒ½å¯ä»¥æ ¹æ“šæƒ³è¦çš„æ“ä½œã€‚</li><li>åœ¨æŸäº›æƒ…æ³ä¸‹ï¼Œæ•ˆèƒ½æœƒæ¯”è¼ƒå¥½ã€‚</li></ol></li><li>ç¼ºé» :<ol><li>ç¨‹å¼ç¢¼é€šå¸¸è¼ƒå†—é•·ï¼ŒåŸå› æ˜¯é‚è¼¯éƒ½å¯«åœ¨åŒä¸€å¡Š</li><li>æ¯”è¼ƒé›£ä»¥é–±è®€</li></ol></li></ul><p><strong>Declarative :</strong></p><ul><li>å„ªé» :<ol><li>ç¨‹å¼ç¢¼é€šå¸¸éƒ½å¾ˆçŸ­ï¼Œè€Œä¸”æ•´æ½”ã€æ˜“è®€</li><li>å¾ˆé©åˆç”¨åœ¨ JavaScript ä¸€äº›æ¡†æ¶ä¸Šï¼Œåƒæ˜¯ React èˆ‡ç‹€æ…‹ç®¡ç†çš„ redux</li></ol></li><li>ç¼ºé» :<ol><li>é‹è¡Œçš„æ¯”è¼ƒæ…¢ä¸€é»ï¼Œä½†åœ¨å°å‹çš„æ‡‰ç”¨ç¨‹å¼ä¸æ˜¯å¤ªæ˜é¡¯ã€‚</li></ol></li></ul><h1>å»ºç«‹ ref</h1><p>åœ¨ class component å¯ä»¥åœ¨å»ºç«‹ (constructor) æ™‚æ–°å»º refï¼Œå¯ä»¥æ˜¯ä»£è¡¨å±¬æ–¼æŸå€‹ instance çš„å±¬æ€§ï¼Œæˆ–è€…é€éå±¬æ€§ (attribute) ä¾é™„åœ¨ React elementï¼Œåœ¨æ•´å€‹ component è£¡é¢è¢«åƒè€ƒã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="comment">// 1. ç”¨ createRef() å»ºç«‹</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">myRef</span> = <span class="title class_">React</span>.<span class="title function_">createRef</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 2. ä½¿å…¶ç”¨ attr ä¾é™„åœ¨ node ä¸Šï¼Œé€é this.myRef å°±å¯ä»¥æ“ä½œ DOM å…ƒç´ </span></span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;this.myRef&#125;</span> /&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ function component ç”¨ Hooks å¯ä»¥ç›´æ¥åœ¨å…§éƒ¨å»ºç«‹ ref</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ref = <span class="title function_">useRef</span>(<span class="number">0</span>)</span><br><span class="line"><span class="comment">// ref = &#123; current : 0&#125;</span></span><br></pre></td></tr></table></figure><p><code>useRef</code> æ¯”ä¸€èˆ¬çš„ ref æ›´æœ‰ç”¨ï¼Œå®ƒå¯ä»¥å¾ˆæ–¹ä¾¿åœ°æŒæœ‰ä»»ä½• mutable çš„å€¼ (<code>useRef</code> å¯ä»¥æ˜¯ä»»ä½•çš„å€¼)ï¼Œè·Ÿ class ä¸­çš„ instance field é¡ä¼¼ã€‚</p><p>é™¤éåšå»¶é²åˆå§‹åŒ–<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>ï¼Œé¿å…åœ¨ render æ™‚è¨­å®š ref ï¼Œé€ æˆéé æœŸçš„è¡Œç‚ºï¼Œæ‰€ä»¥æˆ‘å€‘æ‡‰è©² <strong>åœ¨ event handler å’Œ effect ä¸­ä¿®æ”¹ ref</strong>ã€‚</p><h1>å­˜å– ref</h1><p>Ref çš„å€¼æœƒæ ¹æ“šç¯€é»çš„é¡å‹è€Œæœ‰æ‰€ä¸åŒï¼š</p><ol><li>å»ºç«‹çš„ ref ç”¨åœ¨ html å…ƒç´ ä¸Šçš„å±¬æ€§ï¼Œç­‰åŒæ–¼å–å¾— DOM å…ƒç´ æœ¬èº«ä½œç‚º current å±¬æ€§ã€‚</li><li>å®¢è£½åŒ–çš„ class component ä½¿ç”¨ ref æ™‚ï¼Œref ç­‰åŒæ–¼æ­¤ component mount ä¹‹å¾Œçš„å¯¦ä¾‹(instance) ç•¶ä½œ currentã€‚ (ç°¡å–®ä¾†èªª ref å¯ä»¥ç›´æ¥å‚³çµ¦ class component ä¸­çš„å­å…ƒä»¶ï¼Œä½† functional component ä¸è¡Œ)</li><li>ä¸èƒ½åœ¨ functional component ä¸Šä½¿ç”¨ refï¼Œå› ç‚ºä»–å€‘æ²’æœ‰å¯¦ä¾‹ (instance)ã€‚</li></ol><h2 id="åœ¨-DOM-Element-åŠ ä¸Š-Ref">åœ¨ DOM Element åŠ ä¸Š Ref</h2><p>åœ¨ DOM Element åŠ ä¸Š refï¼Œåˆ©ç”¨ ref ä¾†å„²å­˜å°æ–¼ DOM ç¯€é»çš„åƒè€ƒï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CustomTextInput</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="comment">// ç”¢ç”Ÿä¸€å€‹å¯ä»¥å„²å­˜ textInput DOM element çš„ ref</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">textInput</span> = <span class="title class_">React</span>.<span class="title function_">createRef</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">focusTextInput</span> = <span class="variable language_">this</span>.<span class="property">focusTextInput</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// focus æ–¹æ³•ï¼Œç›´æ¥å° DOM å…ƒç´ æ“ä½œ</span></span><br><span class="line">  <span class="title function_">focusTextInput</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">textInput</span>.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &#123;/* <span class="attr">åœ¨</span> <span class="attr">mount</span> <span class="attr">çš„æ™‚å€™å°‡</span> <span class="attr">DOM</span> <span class="attr">element</span> <span class="attr">è³¦å€¼åˆ°</span> <span class="attr">current</span> <span class="attr">å±¬æ€§</span>*/&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">ref</span>=<span class="string">&#123;this.textInput&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">type</span>=<span class="string">&quot;button&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&quot;Focus the text input&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onClick</span>=<span class="string">&#123;this.focusTextInput&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>React æœƒåœ¨ component mount çš„æ™‚å€™å°‡ DOM element è³¦å€¼åˆ° current å±¬æ€§ï¼Œä¸¦åœ¨ unmount æ™‚å°‡å®ƒæ¸…ç©ºå› null ã€‚ ref çš„æ›´æ–°ç™¼ç”Ÿåœ¨ç”Ÿå‘½é€±æœŸ <code>componentDidMount</code> æˆ– <code>componentDidUpdate</code> ä¹‹å‰ã€‚</p><h2 id="åœ¨-Class-Component-åŠ ä¸Š-Ref">åœ¨ Class Component åŠ ä¸Š Ref</h2><p>å¦‚æœæˆ‘å€‘æƒ³åœ¨çˆ¶å…ƒä»¶ mount ä¹‹å¾Œï¼Œè‡ªå‹•åš <code>focus</code> é€™ä»¶äº‹ï¼Œå¯ä»¥é€éçˆ¶å…ƒä»¶çš„ ref æ‹¿åˆ° <code>textInput</code> å¯¦ä¾‹æœ¬èº« (ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å…§éƒ¨çš„æ–¹æ³•)ï¼Œä¸¦åœ¨ <code>componentDidMount</code> å‘¼å«ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AutoFocusTextInput</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">textInput</span> = <span class="title class_">React</span>.<span class="title function_">createRef</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åœ¨å…ƒä»¶ mount ä¹‹å¾Œè‡ªå‹•åšé€™ä»¶äº‹ </span></span><br><span class="line">  <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// focusTextInput() æ˜¯ä¾†è‡ª CustomTextInput æœ¬èº« </span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">textInput</span>.<span class="property">current</span>.<span class="title function_">focusTextInput</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">CustomTextInput</span> <span class="attr">ref</span>=<span class="string">&#123;this.textInput&#125;</span> /&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„é€™ <strong>åªé©ç”¨æ–¼åˆ©ç”¨ class ä¾†å®£å‘Š</strong> <code>CustomTextInput</code> çš„æƒ…å½¢ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CustomTextInput</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Ref-å’Œ-Function-Component">Ref å’Œ Function Component</h2><p>ä¸èƒ½ç”¨ function component ä½¿ç”¨ ref ï¼Œå› ç‚ºæœ¬èº«æ²’æœ‰ instance ï¼Œä¸èƒ½åƒ class component ç›´æ¥å°‡ ref å‚³çµ¦ child componentã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* æ²’æœ‰é€™æ±è¥¿ */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Input</span>(<span class="params">&#123;ref&#125;</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>/&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* âŒä¸è¡Œï¼Œ Input æ²’æœ‰ instanceï¼Œä¸èƒ½æ¥æ”¶ ref */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Input</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦ä¸å°±åœ¨ child component ç›´æ¥ä½¿ç”¨ <code>useRef</code></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Input</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// âœ… é€™æ¨£å¯ä»¥</span></span><br><span class="line">  <span class="keyword">const</span> ref = <span class="title function_">useRef</span>(<span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>/&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœåœ¨çˆ¶å…ƒä»¶çœŸçš„æƒ³å°‡ ref äº¤éçµ¦å…¶ä»– function component ï¼ŒReact æœƒå»ºè­°ä½¿ç”¨ <strong>å‚³é€ ref</strong> (<code>forwardRef</code>) çš„æ–¹å¼ï¼Œ<strong>å‚³é€ Ref ä½¿å¾— component èƒ½å¤ é¸æ“‡è¦ä¸è¦æŠŠ child component çš„ ref ç•¶ä½œè‡ªå·±çš„ ref</strong> ã€‚ä¸éé€™æ¨£çš„æ–¹æ³•ä¸å¤ªå»ºè­°ï¼Œå› ç‚ºæœƒç ´å£ component çš„å°è£ã€‚ä½†æœ‰æ™‚å€™è§¸ç™¼ focus æˆ–æ¸¬é‡ child çš„ DOM ç¯€é»çš„å¤§å°ã€ä½ç½®æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚</p><h1>å¯¦å‹™ä¸Šçš„ ref</h1><ol><li>è¨ˆç®— render æ¬¡æ•¸ (å°‘)</li><li><strong>ç”¨ Imperatively æ–¹æ³•æ”¹è®Š DOM è·Ÿ Child Component (æœ€å¸¸)</strong></li><li>æƒ³æŠ“ Previous çš„å€¼ (å°‘)</li></ol><h2 id="è¨ˆç®—-render-æ¬¡æ•¸">è¨ˆç®— render æ¬¡æ•¸</h2><p>å¦‚æœç”¨ state ä¾†è¨ˆç®—ï¼Œé€™å€‹ä¾‹å­æœƒå°è‡´ç„¡çª®è¿´åœˆï¼Œ <code>setState</code> å°è‡´ re-render ï¼Œåš <code>setRenderCount</code> åˆä¸€è€Œå†åœ°è§¸ç™¼ï¼Œæ²’å®Œæ²’äº†ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [count,setCount] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> [renderCount,setRenderCount] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¯æ¬¡ render å°± ++</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">setRenderCount</span>(<span class="function"><span class="params">r</span> =&gt;</span> r+<span class="number">1</span>) </span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;count&#125;</span></span><br><span class="line"><span class="language-xml">      render : &#123;renderCount&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€™æ™‚å€™å¾ˆé©åˆä½¿ç”¨ <code>useRef</code> ï¼Œå› ç‚ºå®ƒä¸æœƒè§¸ç™¼ re-renderã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [count,setCount] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> countRef = <span class="title class_">React</span>.<span class="title function_">useRef</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¯æ¬¡ render å°± ++</span></span><br><span class="line">  <span class="title class_">React</span>.<span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    countRef.<span class="property">current</span> +=<span class="number">1</span> </span><br><span class="line">  &#125;,[count])</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;count&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span> setCount(count+1)&#125;&gt;+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      render : &#123;countRef.current&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç”¨-Imperatively-æ–¹æ³•æ”¹è®Š-DOM-è·Ÿ-Child-Component">ç”¨ Imperatively æ–¹æ³•æ”¹è®Š DOM è·Ÿ Child Component</h2><p>Imperative çš„æ„æ€åœ¨ [[#è£œå…… Declarative v s Imperative in JavaScript]] ç« ç¯€è§£é‡‹éã€‚å¦‚æœä½¿ç”¨<br> state çš„æ€è·¯ä¾†çœ‹ï¼Œæœƒåˆ©ç”¨ focus state ä¾†æ§åˆ¶å…ƒä»¶çš„ç‹€æ…‹ï¼ŒåŸºæ–¼å¥½å¥‡ï¼Œæˆ‘ä¹Ÿå°±å¯¦ä½œäº† state ç‰ˆæœ¬ã€‚</p><h3 id="å¯¦ä½œ-ä½¿ç”¨-state-ä¾†æ§åˆ¶-autofocus">å¯¦ä½œ : ä½¿ç”¨ state ä¾†æ§åˆ¶ autofocus</h3><p>åˆ©ç”¨ key çš„ç‰¹æ€§ï¼Œè®“ React æ›æ‰ç¯€é»ï¼Œç‚ºä»€éº¼ç”¨ key å¾Œé¢æœƒè§£é‡‹</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [autoFocus, setAutoFocus] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">key</span>=<span class="string">&#123;Number(autoFocus)&#125;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">autoFocus</span>=<span class="string">&#123;autoFocus&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setAutoFocus((f) =&gt; !f)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        é—œæ³¨</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ render ä¹‹å¾Œè‡ªå‹• Focus ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>useEffect</code> å†å¤šåšä¸€æ¬¡çš„ render</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="title function_">setAutoFocus</span>(<span class="literal">true</span>)</span><br><span class="line">&#125;,[])</span><br></pre></td></tr></table></figure><p>é‚„è¨˜å¾— key æ˜¯æ‹¿ä¾†åˆ¤æ–· DOM ç¯€é»æ˜¯å¦æ›¿æ›çš„ä¸€ç¨®æŒ‡æ¨™å— ? æˆ‘å€‘æœ€å¸¸ä½¿ç”¨åœ¨ array ä¸Šï¼Œä½†å…¶å¯¦ä¹Ÿå¯ä»¥å–®ç¨æ‹¿å‡ºä¾†ä½¿ç”¨ï¼Œå°¤å…¶å°æ–¼å¤§å€å¡Šçš„æ›´å‹•ã€‚</p><p>é€™éƒ¨åˆ†æ™‚åŸæœ¬æ¡å–é€™æ¨£çš„å¯«æ³•ï¼Œçµæœç™¼ç¾é›–ç„¶ state æœ‰æ”¹è®Šï¼Œä½†æ˜¯ <code>input</code> æ²’æœ‰è¢« focus :</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">&quot;text&quot;</span> autoFocus=&#123;autoFocus&#125; /&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setAutoFocus((f) =&gt; !f)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">  é—œæ³¨</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>é˜¿ ! çµæœå¿˜äº† React æ€éº¼å»æ¸²æŸ“é€™ä»¶åŸºæœ¬çš„äº‹ï¼Œè¨˜å¾—å—ğŸ˜µå®ƒæœƒåšæ·ºæ¯”è¼ƒï¼Œæ—¢ç„¶ input ç¯€é»æ²’æœ‰æ”¹è®Šï¼Œå®ƒåªæœƒä¿®æ”¹å±¬æ€§ã€‚åœ¨ä¾†èªªèªª <code>autofocus</code> ï¼Œå®ƒçš„è§¸ç™¼é»æ˜¯åœ¨ DOM ç¯€é»è¢«æ”¾åœ¨ä¸Šé¢ä¹‹å¾Œæ‰æœƒåš <code>focus()</code>ï¼Œé‚£ä¸Šé¢é€™æ®µæˆ‘å€‘ç¢ºå¯¦å¯ä»¥æŠŠ <code>autoFoucs</code> é€é state è®ŠåŒ–æ·»åŠ ä¸Šå»ï¼Œä½†æ˜¯ input æœ¬èº«æ˜¯æ²’æœ‰é‡æ–°å»ºç«‹é€™ä»¶äº‹ï¼Œå› ç‚º React æ·ºæ¯”è¼ƒè‡ªå‹•å¹«æˆ‘å€‘åšæ¸²æŸ“ä¸Šçš„å„ªåŒ–ï¼Œæ‰€ä»¥æˆ‘é€é key å¹«ç›´æ¥é‡æ–°ç”¢ç”Ÿ input ã€‚</p><p>åŸæœ¬æ˜¯é€éæ›¿æ›ä¸åŒçš„ html tagï¼Œå¯¦ä½œ <code>autoFocus</code> æˆåŠŸï¼Œä½†é€™ä¸æ˜¯æ­£ç¢ºçš„ç­”æ¡ˆï¼Œåˆçªç„¶æƒ³åˆ° key çš„ä½œç”¨ï¼Œçµæœå°±å‡ºä¾†äº†ã€‚</p><h3 id="ä½¿ç”¨-ref">ä½¿ç”¨ ref</h3><p>å›åˆ° ref ï¼Œå»ºç«‹ ref ç¶åœ¨ DOM element ä¸Šï¼Œä½¿æˆ‘å€‘å¯ä»¥ç›´æ¥æ“ä½œ DOMï¼Œæ¯”ä¸Šé¢çš„ç°¡å–®å¤šäº†ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = <span class="title function_">useRef</span>(<span class="literal">null</span>)</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    inputRef.<span class="property">current</span>.<span class="title function_">focus</span>()</span><br><span class="line">  &#125;,[])</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€™æ¨£çš„æ–¹å¼åœ¨è¡¨å–®å¾ˆå¸¸ä½¿ç”¨ï¼Œåœ¨ React ä¸­åˆ†æˆ controlled component å’Œ uncontrolled componentï¼Œ å‰è€…ä¾è³´ state ä¾†æ“ä½œï¼Œå¾Œè€…æ˜¯é€é ref ç›´æ¥è®€å– DOMã€‚</p><blockquote><p>ref ä¸¦ä¸æœƒå‡ºç¾åœ¨ <code>devtool</code> çš„æª¢æŸ¥è¦–çª—ä¸Šï¼Œå¯¦éš›çœ‹åˆ°çš„åªæœƒæ˜¯ <code>&lt;input type=&quot;text&quot;/&gt;</code></p></blockquote><h2 id="æŠ“-Previous-çš„å€¼">æŠ“ Previous çš„å€¼</h2><p>function component å› ç‚º closure çš„é—œä¿‚ï¼Œåªæœƒè¨˜ä½ç•¶æ¬¡ render çš„ state æˆ– props ç”šè‡³æ˜¯ä»»ä½•æ±è¥¿ï¼Œæˆ‘å€‘æ²’è¾¦æ³•æ‹¿åˆ°ä¸Šä¸€æ¬¡ render çš„å€¼ã€‚è€Œé€é ref ä¾†å»ºç«‹ä¸æœƒéš¨ render è€Œæ”¹è®Šçš„ç›’å­ï¼Œè®“æˆ‘å€‘å¯ä»¥åœ¨ä¸‹ä¸€æ¬¡ effect å‘¼å«ä¹‹å‰å…ˆè¨˜ä½ä¸Šä¸€æ¬¡çš„å€¼ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [value,setValue] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line">  <span class="keyword">const</span> prevValue =<span class="title class_">React</span>.<span class="title function_">useRef</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="title class_">React</span>.<span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    prevValue.<span class="property">current</span> = value</span><br><span class="line">  &#125;,[value])</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;(e)</span>=&gt;</span> setValue(e.target.value)&#125;/&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>previous: &#123;prevValue.current&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¦éš›è·Ÿè‘—è·‘ä¸€æ¬¡ :</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬ä¸€æ¬¡ render</span></span><br><span class="line">  value = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment">// JSX(UIé¡¯ç¤º)</span></span><br><span class="line">  input value =<span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">previous</span>:</span><br><span class="line"><span class="comment">// effect åŸ·è¡Œ</span></span><br><span class="line">  prevValue.<span class="property">current</span> = value = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨è€…è¼¸å…¥ &quot;1&quot; re-render</span></span><br><span class="line">  value = <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="comment">// JSX(UIé¡¯ç¤º)</span></span><br><span class="line">  input value =<span class="string">&quot;1&quot;</span></span><br><span class="line">  <span class="attr">previous</span>:</span><br><span class="line"><span class="comment">// effect åŸ·è¡Œï¼Œä½†æ˜¯æ”¹è®Š ref ä¸¦ä¸æœƒé€ æˆ re-renderï¼Œæ­¤æ™‚æ²’æœ‰æ›´æ–°åœç•™åœ¨ previous:</span></span><br><span class="line">  prevValue.<span class="property">current</span> = value = <span class="string">&quot;1&quot;</span> </span><br></pre></td></tr></table></figure><p>å¯¦éš›ä¸Š <code>prevValue.current</code> ç­‰æ–¼ <code>value</code>ï¼Œä½†æ˜¯ render æ˜¯åœç•™åœ¨ç¬¬äºŒæ¬¡ï¼Œä¸¦æ²’æœ‰åˆ·æ–° UIï¼Œå› æ­¤åœ¨ç•«é¢ä¸Šçœ‹èµ·ä¾† <code>prevValue</code> åœç•™åœ¨å‰ä¸€æ¬¡çš„ renderï¼Œä½¿æˆ‘å€‘å¯ä»¥æ‹¿åˆ° previous å€¼ã€‚<br> <img data-src="https://i.imgur.com/H2K46gT.png" alt="300x180"></p><h1>callback ref</h1><p>ref é‚„æœ‰å¦ä¸€ç¨®å½¢å¼ï¼Œä¸æ˜¯å°‡ <code>createRef()</code> æ‰€ç”¢ç”Ÿçš„ ref å‚³éä¸‹å»ï¼Œè€Œæ˜¯æŠŠä¸€å€‹ function å¾€ä¸‹å‚³ (function ä¹Ÿæ˜¯ä¸€ç¨® Object)ã€‚ function æœƒå°‡ React component çš„å¯¦ä¾‹ (instance) æˆ– HTML DOM ä½œç‚ºå®ƒçš„åƒæ•¸ï¼Œå„²å­˜ä¹‹å¾Œåœ¨åˆ¥çš„åœ°æ–¹ä½¿ç”¨ã€‚</p><ul><li>class component</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CustomTextInput</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="comment">// 1. å„²å­˜ callback ref å–å¾—çš„ node æˆ– instance çš„ç©ºé–“</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">textInput</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// 2. åƒæ•¸æ˜¯ html DOM æˆ–æ˜¯ component å¯¦ä¾‹</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">setTextInputRef</span> = <span class="function"><span class="params">element</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">textInput</span> = element;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">focusTextInput</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// åˆ©ç”¨åŸç”Ÿçš„ DOM API ä¾† focus æ–‡å­—è¼¸å…¥</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">textInput</span>) <span class="variable language_">this</span>.<span class="property">textInput</span>.<span class="title function_">focus</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// åœ¨ mount çš„æ™‚å€™è‡ªå‹• focus è¼¸å…¥</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">focusTextInput</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &#123;/* <span class="attr">ref</span> <span class="attr">å„²å­˜åƒè€ƒ</span> */&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">ref</span>=<span class="string">&#123;this.setTextInputRef&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">type</span>=<span class="string">&quot;button&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&quot;Focus the text input&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onClick</span>=<span class="string">&#123;this.focusTextInput&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>React æœƒåœ¨ component render æ™‚ç”¨ DOM element å‘¼å« ref callbackï¼Œç„¶å¾Œåœ¨ unmount æ™‚ç”¨ null å‘¼å«å®ƒã€‚</p><blockquote><p>Ref è¢«ä¿è­‰åœ¨ <code>componentDidMount</code> æˆ– <code>componentDidUpdate</code> è§¸ç™¼æ™‚èƒ½å¤ ç¶­æŒåœ¨æœ€æ–°çš„ç‹€æ…‹ã€‚</p></blockquote><h3 id="æœ‰-ref-effect-ç‚ºä»€éº¼é‚„éœ€è¦-callback-ref">æœ‰ ref + effect ç‚ºä»€éº¼é‚„éœ€è¦ callback ref</h3><p>ref å»ºç«‹/æ›´æ–°çš„æ™‚é–“é»æ˜¯åœ¨ render éšæ®µï¼Œä¸”åœ¨ <code>componentDidMount</code> æˆ– <code>componentDidUpdate</code> è§¸ç™¼æ™‚èƒ½å¤ ç¶­æŒåœ¨æœ€æ–°çš„ç‹€æ…‹ (åœ¨è£¡é¢ç²å– state æ˜¯æœ€æ–°çš„)ï¼Œæ›æˆ Hooks æ˜¯ <code>setState</code> ç•¶ä¸‹èƒ½æ‹¿åˆ°æœ€æ–°å€¼ï¼Œä¸¦ä¸”åœ¨ effect åŸ·è¡Œä¹‹å‰ç™¼ç”Ÿã€‚é€™é¿å…åœ¨é‚„æ²’ç²å–åˆ° DOM å…ƒç´ ä¹‹å‰æ‹¿åˆ° null ä¾†æ“ä½œã€‚ä»¥å¾€æˆ‘å€‘ç›´æ¥åœ¨ html tag åŠ ä¸Š ref åœ¨ effect æ“ä½œ ref æ™‚å°±å·²ç¶“æ‹¿åˆ° <code>ref.current</code> å­˜å–çš„ DOM å…ƒç´ æœ¬èº«ã€‚</p><p>åˆ°é€™è£¡å¥½åƒéƒ½æ²’å•é¡Œï¼Œä½†å¦‚æœæ˜¯ <strong>å­å…ƒä»¶çš„æ¢ä»¶å¼æ¸²æŸ“</strong> å‘¢ ? åœ¨å­å…ƒä»¶å·¢ç‹€çµæ§‹ä¸­ï¼Œçˆ¶å…ƒä»¶ä¸¦ä¸çŸ¥é“å­å…ƒä»¶çš„å·¢ç‹€å…ƒä»¶æ˜¯å¦å­˜åœ¨ (æˆ–æ˜¯å­˜åœ¨æ–¼ç¬¬ä¸€æ¬¡ render )ï¼Œå°è‡´ render ä¹‹å¾Œåœ¨çˆ¶å…ƒä»¶çš„ ref ä¸çŸ¥é“æœ‰æ²’æœ‰æŠ“åˆ°å°±åŸ·è¡Œ effectï¼Œè€Œå°è‡´éŒ¯èª¤ã€‚</p><blockquote><p>ç¯„ä¾‹ä¾†è‡ª : <a href="https://tkdodo.eu/blog/avoiding-use-effect-with-callback-refs#focus-with-an-effect">Avoiding useEffect with callback refs | TkDodoâ€™s blog</a></p></blockquote><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> ref = <span class="title class_">React</span>.<span class="title function_">useRef</span>(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">  <span class="title class_">React</span>.<span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ğŸš¨ ref.current æ°¸é æ˜¯ nullï¼Œé€™è¡Œæœƒå ±éŒ¯ </span></span><br><span class="line">    ref.<span class="property">current</span>?.<span class="title function_">focus</span>()</span><br><span class="line">  &#125;, [])</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Form</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> /&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Form</span> = <span class="title class_">React</span>.<span class="title function_">forwardRef</span>(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [show, setShow] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="literal">false</span>)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setShow(true)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        show</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      /* </span></span><br><span class="line"><span class="language-xml">      ref é™„åŠ åœ¨ input ä¸Šã€‚</span></span><br><span class="line"><span class="language-xml">      ä½†é€™æ˜¯æ¢ä»¶æ˜¯æ¸²æŸ“ï¼Œref.current åœ¨ show = false ä¸¦æ²’æœ‰æŠ“åˆ° input DOM</span></span><br><span class="line"><span class="language-xml">      */</span></span><br><span class="line"><span class="language-xml">      &#123;show &amp;&amp; <span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æˆ‘å¾Œä¾†åœ¨æƒ³é€™å€‹ä¾‹å­å¥½ä¸å¥½ğŸ¤”ï¼Œå…¶å¯¦æå‡ state å°±å¯ä»¥è§£æ±ºå•é¡Œäº†ã€‚ä½†æƒ³ä¸€æƒ³æˆ‘æéŒ¯äº†ğŸ˜µï¼Œç›®çš„æ˜¯ <strong>Form æœ¬èº«å»åˆ¤æ–· input å‡ºç¾å°± autofocus</strong>ï¼Œæ‡‰è©²æŠŠåŠŸèƒ½è·Ÿ Form ç¶åœ¨ä¸€èµ·ï¼Œä¸¦éé€éå¤–éƒ¨çš„å…ƒä»¶ä¾†æ§åˆ¶ï¼Œé€™æ¨£æœƒä½¿ APP è·Ÿè‘— re-render ï¼Œæ˜¯ä¸å¿…è¦çš„ï¼Œæ‰€ä»¥æ‡‰è©²æ˜¯ Form å…ƒä»¶æœ¬èº« state æ”¹è®Šï¼Œ input åŸ·è¡Œ <code>onfocus</code>ã€‚</p><p>è£œ : å¾Œä¾†æˆ‘åˆæƒ³äº†æƒ³ï¼Œæ‡‰è©²æ˜¯æŒ‡ ref å‚³ä¸‹å»ä¸çŸ¥é“æ˜¯ä¸æ˜¯æœ‰æŠ“åˆ°è©²å€¼ï¼Œç”±æ–¼ ref æ˜¯å¯ä»¥ç›´æ¥æ”¹è®Šçš„ï¼Œå¦‚æœåœ¨ render æœŸé–“æ”¹è®Šï¼Œæœƒé€ æˆçµæœä¸åŒğŸ¤”ã€‚</p><p>ç¬¬äºŒæ¬¡å˜—è©¦ï¼Œç›´è¦ºä¸Šæˆ‘å€‘æœƒåœ¨ Form å…ƒä»¶ç”¨ state é€é effect ä¾†æ“ä½œï¼Œé€™ä¹Ÿæ˜¯å¯ä»¥çš„ :</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> ref = <span class="title class_">React</span>.<span class="title function_">useRef</span>(<span class="literal">null</span>)</span><br><span class="line">  <span class="comment">// âŒ ä¸éœ€è¦ effect äº†</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Form</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> /&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Form</span> = <span class="title class_">React</span>.<span class="title function_">forwardRef</span>(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [show, setShow] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="literal">false</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ç”¨ effect ä¾†è£œé€™å€‹å•é¡Œ</span></span><br><span class="line">  <span class="title class_">React</span>.<span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(show)&#123;</span><br><span class="line">      ref.<span class="property">current</span>?.<span class="title function_">focus</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,[show]) <span class="comment">// ç•¶æŒ‰ä¸‹æŒ‰éˆ•å°±é¡¯ç¤ºï¼ŒåŸ·è¡Œ focus</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setShow(true)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        show</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;show &amp;&amp; <span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">  )</span><br></pre></td></tr></table></figure><p>æ©â€¦é›–ç„¶é€™å¯ä»¥è§£æ±ºå•é¡Œï¼Œä½† effect å…¶å¯¦ä¸å¿…é€™æ¨£æª¢æŸ¥ show ï¼Œä½•æ³ button åªè§¸ç™¼ä¸€æ¬¡çš„ <code>setShow</code>ğŸ¤”ï¼Œé›£é“ä¸èƒ½è®“å®ƒç”¢ç”Ÿçš„æ™‚å€™è‡ªå·± focus å— ? ç•¶ input <code>mount</code> å°±è‡ªå·± focus ã€‚</p><p>å¦ä¸€å€‹è‘—æ‰‹é»å°±æ˜¯æŠŠ <code>autoFocus</code> è£ä¸Šå»ï¼Œ input åš <code>mount</code> åˆ <code>unmout</code> å° React ä¾†èªªéƒ½æ˜¯æ–°çš„ç¯€é»èª•ç”Ÿ :</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;show &amp;&amp; <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">autoFocus</span>/&gt;</span></span>&#125;</span><br></pre></td></tr></table></figure><p>ä¸éè¡ç”Ÿå•é¡Œå°±åœ¨ [[#å¯¦ä½œ ä½¿ç”¨ state ä¾†æ§åˆ¶ autofocus]] çš„éƒ¨åˆ†æœ‰è¨è«–éï¼Œå¦‚æœåœ¨ input æ˜¯ â€œå·²å‡ºç¾â€ çš„ç‹€æ³ä¸‹é€éæŒ‰éˆ•ä¾†æ§åˆ¶ <code>autoFocus</code> ï¼Œç”±æ–¼ React çš„æ·ºæ¯”è¼ƒå„ªåŒ–å°è‡´å…ƒä»¶åƒ…ä¿®æ”¹å±¬æ€§ï¼Œè€Œ <code>autoFocus</code> åªæœƒåœ¨å…ƒä»¶ mount åŸ·è¡Œã€‚</p><p>æœ€å¾Œä¸€å€‹è§£æ±ºçš„å•é¡Œå°±æ˜¯é  <strong>callback ref</strong> è‡ªå·±å»åˆ¤æ–· Element node æ˜¯å¦å­˜åœ¨å»åŸ·è¡Œé‚è¼¯ :</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Form</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Form</span> = (<span class="params">props</span>)=&gt;&#123;</span><br><span class="line">  <span class="keyword">const</span> [show, setShow] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setShow(true)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        show</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;show &amp;&amp; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          // <span class="attr">ref</span> <span class="attr">æ¥æ”¶çš„æ˜¯ä¸€å€‹</span> <span class="attr">function</span>ï¼Œ<span class="attr">åƒæ•¸æœƒæ˜¯</span> <span class="attr">DOM</span> <span class="attr">ç¯€é»æœ¬èº«</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">ref</span>=<span class="string">&#123;(node)</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">            if (node) &#123;</span></span><br><span class="line"><span class="language-xml">              node.focus();</span></span><br><span class="line"><span class="language-xml">            &#125;</span></span><br><span class="line"><span class="language-xml">          &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        /&gt;</span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æª¢æŸ¥ node æ˜¯å¦å­˜åœ¨å†å‘¼å«ï¼Œå› ç‚º ref æ˜¯åœ¨ <code>componentDidMount</code> æˆ– <code>componentDidUpdate</code> æ‹¿åˆ°æœ€æ–°å€¼ï¼Œç°¡å–®ä¾†èªªå°±æ˜¯ render éšæ®µåŸ·è¡Œï¼Œåœ¨æˆ‘å€‘ <code>setShow</code> æ”¹è®Š show ç‚º true é€²åˆ° render éšæ®µï¼Œå¦‚æœæ²’æœ‰åŠ ä¸Šåˆ¤æ–·ï¼Œæœƒå°è‡´ <code>unmout</code> æ™‚åŸ·è¡ŒéŒ¯èª¤ã€‚</p><p>å¦‚æœæˆ‘å€‘ä¸åˆ¤æ–· node æ˜¯å¦å­˜åœ¨ï¼ŒåŸ·è¡Œé †åºä¸Šæ˜¯é€™æ¨£ :</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬ä¸€æ¬¡ render</span></span><br><span class="line"><span class="keyword">const</span> show = <span class="literal">false</span></span><br><span class="line">input callback ref ä¸æœƒåŸ·è¡Œ</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨è€…æŒ‰ä¸‹æŒ‰éˆ•è§¸ç™¼ setShow re-render</span></span><br><span class="line"><span class="keyword">const</span> show = <span class="literal">true</span></span><br><span class="line"><span class="comment">// input ref function åŸ·è¡Œï¼Œ function(node) åƒæ•¸æ˜¯è©² DOM å…ƒç´ </span></span><br><span class="line">node.<span class="title function_">focus</span>() <span class="comment">// âœ… åŸ·è¡ŒæˆåŠŸï¼Œnode ä¸æ˜¯ null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å†æŒ‰ä¸€æ¬¡æŒ‰éˆ• setShow re-render </span></span><br><span class="line"><span class="keyword">const</span> show = <span class="literal">false</span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">  input unmoutï¼Œref function åŸ·è¡Œï¼Œref å›åˆ° null ä»£è¡¨ç¯€é»æ¶ˆå¤±ï¼Œå…ƒç´ æ¶ˆå¤±äº† node = null </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">node.<span class="title function_">focus</span>() <span class="comment">//ğŸ˜µ åŸ·è¡Œå¤±æ•—</span></span><br></pre></td></tr></table></figure><p>callback ref æœƒåœ¨ component <code>mount</code> è·Ÿ <code>unmout</code> éƒ½å„åŸ·è¡Œä¸€æ¬¡ï¼Œä½† <code>unmount</code> é‚£æ¬¡å°±ä¸æœƒæŠ“åˆ°åƒæ•¸æœ¬èº«ï¼Œå› ç‚º ref å›å‚³çš„æ˜¯ nullã€‚</p><p>å¯«æˆ inline çš„æ–¹å¼å°±æœƒä½¿å…ƒä»¶ re-render ä¹Ÿè·Ÿè‘—é‡æ–°å»ºç«‹ functionï¼Œå¯ä»¥ç”¨ <code>useCallback</code> æŠŠ function è¨˜èµ·ä¾†ï¼Œé¿å…ä¸å¿…è¦çš„ render :</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Form</span> = (<span class="params">props</span>)=&gt;&#123;</span><br><span class="line">  <span class="keyword">const</span> [show, setShow] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="comment">// 1. å»ºç«‹ function</span></span><br><span class="line">  <span class="keyword">const</span> inputRef = <span class="title class_">React</span>.<span class="title function_">useCallback</span>(<span class="function">(<span class="params">node</span>)=&gt;</span>&#123;</span><br><span class="line">    node?.<span class="title function_">focus</span>();</span><br><span class="line">  &#125;,[])</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setShow(true)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        show</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;show &amp;&amp; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          // <span class="attr">2.</span> <span class="attr">å¡«å…¥</span> <span class="attr">function</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1>callback ref çš„ä½¿ç”¨æ™‚æ©Ÿ</h1><ol><li>ç¯€é»æœƒæ¶ˆå¤±åˆå‡ºç¾ï¼Œéœ€è¦å‹•æ…‹çš„æ§åˆ¶å…ƒä»¶æœ¬èº«</li><li>æ¸¬é‡ DOM çš„ä½ç½®ã€å¤§å°</li></ol><p>callback ref æä¾›å‹•æ…‹çš„æ–¹å¼è®“æˆ‘å€‘å–å¾— DOM ç¯€é»ï¼Œä¸¦ä¸”åœ¨ browser painting ä¹‹å‰å¯ä»¥åšä¸€äº›äº‹ã€‚å¾ä¸Šé¢ <code>autofocus</code> å¯ä»¥è®“å…ƒä»¶å»ºç«‹åˆåš DOM çš„ <code>focus()</code>ã€‚</p><h2 id="å°å¯¦ä½œ">å°å¯¦ä½œ</h2><p>Accordion çš„å…§å®¹æœƒæŒ‰ç…§ <code>open</code> é–‹é—œå½±éŸ¿é«˜åº¦ï¼Œæˆ‘å€‘åªè¦åœ¨ <code>open</code> è§¸ç™¼ re-render æ™‚ï¼Œä¸€ä½µæŠŠæ¨£å¼æ”¹è®Šå°±å¯ä»¥è¼•é¬†åšåˆ°åŠŸèƒ½ã€‚<br> ğŸ‘‰<a href="https://codepen.io/shan473/pen/MWVxzPX">Collapsibles/Accordion React callback ref</a></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Accordion</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 1. é–‹é—œæ§åˆ¶</span></span><br><span class="line">  <span class="keyword">const</span> [open,setOpen] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="literal">false</span>)</span><br><span class="line">  <span class="comment">// 2. callback ref node å­˜åœ¨ä¸” open = true</span></span><br><span class="line">  <span class="keyword">const</span> panelRef = <span class="title class_">React</span>.<span class="title function_">useCallback</span>(<span class="function">(<span class="params">node</span>)=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(node &amp;&amp; open)&#123;</span><br><span class="line">        node.<span class="property">style</span>.<span class="property">maxHeight</span> =node.<span class="property">scrollHeight</span> +<span class="string">&#x27;px&#x27;</span></span><br><span class="line">      &#125;<span class="keyword">else</span> <span class="keyword">if</span>(node &amp;&amp; !open)&#123;</span><br><span class="line">        node.<span class="property">style</span>.<span class="property">maxHeight</span> =<span class="number">0</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;,[open])</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;accordion&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span> setOpen(open =&gt; !open)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        Section</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">className</span>=<span class="string">&quot;panel&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">ref</span>=<span class="string">&#123;panelRef&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do</span></span><br><span class="line"><span class="language-xml">          eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad</span></span><br><span class="line"><span class="language-xml">          minim veniam, quis nostrud exercitation ullamco laboris nisi ut</span></span><br><span class="line"><span class="language-xml">          aliquip ex ea commodo consequat.</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç•¶ç„¶é€™æ¨£çš„æ–¹å¼ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>useRef</code> æ­é… <code>useEffect</code> ä¾†å¯¦ä½œ :</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> panelRef = <span class="title class_">React</span>.<span class="title function_">useRef</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="title class_">React</span>.<span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line"> panelRef.<span class="property">current</span>.<span class="property">style</span>.<span class="property">maxHeight</span>= open ? panelRef.<span class="property">current</span>.<span class="property">scrollHeight</span> +<span class="string">&#x27;px&#x27;</span> : <span class="number">0</span></span><br><span class="line">&#125;,[open])</span><br></pre></td></tr></table></figure><p>ç›®å‰é‚„æƒ³ä¸åˆ°å¯¦éš›ä¸Šçš„å·®ç•°ï¼Œä½†è«–æ™‚é–“é»ä¾†èªªï¼ŒuseEffect æœƒåœ¨ render ä¹‹å¾Œæ‰åŸ·è¡Œï¼Œå¾ˆå¯èƒ½ç•«é¢æœƒé€ æˆä¸€ç¬é–“çš„é–ƒçˆï¼Œé€™æ™‚å€™æˆ‘å€‘å¯èƒ½æœƒç”¨ <code>useLayoutEffect</code> ä¾†è™•ç†ï¼Œåœ¨ painting ä¹‹å‰å°±åŸ·è¡ŒçµæŸï¼Œåƒæ˜¯æ¨£å¼çš„æ›´æ–°ï¼Œé€™ä¸æœƒè®“ä½¿ç”¨è€…çœ‹åˆ°ç•«é¢çªç„¶é–ƒä¸€ä¸‹è®ŠåŒ–ã€‚</p><p>é€šå¸¸ ref + <code>useEffect</code> éƒ½å¯ä»¥åšåˆ° callback ref åšåˆ°çš„äº‹ã€‚ä½† <code>useEffect</code> å…·æœ‰ clean up functionï¼Œå‡å¦‚å…ƒä»¶å…·æœ‰ç›£è½äº‹ä»¶ä¸” <code>unmount</code> æ™‚ï¼Œéœ€è¦åšæ¸…é™¤çš„å‹•ä½œ (clean up function)ï¼Œeffect ä½¿æ™‚æˆ‘å€‘æ‹¿åˆ°çš„ <code>ref.current</code> ä¾èˆŠæ˜¯ä¸Šä¸€æ¬¡ render ï¼Œå° <code>ref.current</code> å–æ¶ˆç›£è½äº‹ä»¶æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ callback ref åœ¨ unmount æ™‚æœƒæŠŠ node å›æ­¸åˆ° nullï¼Œä¸èƒ½å° null å–æ¶ˆç›£è½äº‹ä»¶ã€‚</p><h2 id="æ³¨æ„-3">æ³¨æ„</h2><p>å¦‚æœ callback ref æ˜¯è¢« inline function æ‰€å®šç¾©çš„ï¼Œæœƒåœ¨æ›´æ–°çš„æ™‚å€™è¢«å‘¼å«å…©æ¬¡ã€‚render ä¸€æ¬¡ï¼Œmount ä¸€æ¬¡ã€‚ç¬¬ä¸€æ¬¡ç”¨ null ç„¶å¾Œå†ç”¨ DOM element å‘¼å«ä¸€æ¬¡ã€‚é€™æ˜¯å› ç‚ºæ–°çš„ function çš„ instance æ˜¯åœ¨æ¯æ¬¡ render çš„æ™‚å€™è¢«ç”¢ç”Ÿï¼Œæ‰€ä»¥ React éœ€è¦å°‡èˆŠçš„ ref æ¸…æ‰ç„¶å¾Œè¨­å®šæ–°çš„ã€‚</p><p>å¯ä»¥å®šç¾© callback ref ç‚º class ä¸Šçš„ä¸€å€‹ bound method (<code>method.bind</code>) ä¾†é¿å…é€™ç¨®æƒ…å½¢ï¼Œä½†åœ¨å¤§å¤šæƒ…æ³ä¸‹ä»–ä¸¦æ²’æœ‰ä»»ä½•å½±éŸ¿ã€‚</p><blockquote><p>ç°¡å–®ä¾†èªª function ä¸è¦éš¨ render æ¯æ¬¡éƒ½ç”¢ç”Ÿæ–°çš„ï¼Œå°‡å…¶çµ¦è¨˜ä½ã€‚</p></blockquote><h1>ref ã€ effect èˆ‡ layouteffect</h1><p>ğŸ‘‰ <a href="https://codepen.io/shan473/pen/BarbEWJ?editors=0011">Box moving / multiple ref test with show null</a> æˆ‘è©¦åš <code>ref + useEffect</code> ã€ <code>ref + uselayoutEffect</code> ï¼Œä¾†çœ‹çœ‹é€™ä¸‰è€…çš„æ™‚é–“é»ã€‚</p><p>æ ¹æ“šç¯„ä¾‹å°å‡º <code>render</code> ã€<code>mount</code> ä»¥åŠ <code>unmout</code> æ™‚é–“ :</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// render</span></span><br><span class="line">callback ref call <span class="literal">undefined</span> (ä¸ç®¡æœ‰æ²’æœ‰ node)</span><br><span class="line">callback ref call <span class="literal">null</span> node <span class="literal">undefined</span></span><br><span class="line">callback ref render <span class="literal">undefined</span></span><br><span class="line">render effect <span class="literal">null</span></span><br><span class="line">render layout <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// mount </span></span><br><span class="line">callback ref call (ä¸ç®¡æœ‰æ²’æœ‰ node)</span><br><span class="line">  &lt;div <span class="keyword">class</span>=â€‹<span class="string">&quot;box one&quot;</span> style=â€‹<span class="string">&quot;top:â€‹ 100px;â€‹&quot;</span>&gt;â€‹callback refâ€‹&lt;/div&gt;â€‹</span><br><span class="line">callback ref call <span class="keyword">in</span> node </span><br><span class="line">  &lt;div <span class="keyword">class</span>=â€‹<span class="string">&quot;box one&quot;</span> style=â€‹<span class="string">&quot;top:â€‹ 100px;â€‹&quot;</span>&gt;â€‹callback refâ€‹&lt;/div&gt;â€‹</span><br><span class="line"><span class="keyword">in</span> effect layout </span><br><span class="line">  &lt;div <span class="keyword">class</span>=â€‹<span class="string">&quot;box three&quot;</span> style=â€‹<span class="string">&quot;top:â€‹ 100px;â€‹&quot;</span>&gt;â€‹layout effectâ€‹&lt;/div&gt;â€‹</span><br><span class="line"><span class="keyword">in</span> effect </span><br><span class="line">  &lt;div <span class="keyword">class</span>=â€‹<span class="string">&quot;box two&quot;</span> style=â€‹<span class="string">&quot;top:â€‹ 100px;â€‹&quot;</span>&gt;â€‹effectâ€‹&lt;/div&gt;â€‹</span><br><span class="line"></span><br><span class="line"><span class="comment">// unmount</span></span><br><span class="line">callback ref call <span class="literal">null</span> (ä¸ç®¡æœ‰æ²’æœ‰ node)</span><br><span class="line">callback ref call <span class="literal">null</span> node <span class="literal">null</span></span><br><span class="line">clean up layout </span><br><span class="line">  &lt;div <span class="keyword">class</span>=â€‹<span class="string">&quot;box three&quot;</span> style=â€‹<span class="string">&quot;top:â€‹ 100px;â€‹&quot;</span>&gt;â€‹layout effectâ€‹&lt;/div&gt;â€‹</span><br><span class="line">clean up effect <span class="literal">null</span></span><br></pre></td></tr></table></figure><ol><li>callback ref åœ¨ render æ™‚ call å† mount æ™‚åˆ call</li><li><code>layoutEffect</code> åœ¨ unmount æ™‚ ref é‚„æ²’æ¶ˆå¤±ğŸ¤”</li></ol><p>ç¶²è·¯ä¸Šå·²ç¶“æœ‰äººæŠŠå®ƒè£½æˆè¡¨æ ¼ï¼Œè€Œä¸”é‚„æœ‰ updating ğŸ˜„<br> <img data-src="https://blog.thoughtspile.tech/images/react-ref-order-f455246e4b65dcd8bad4434384f2460e.png" alt="|400x180"></p><blockquote><p>åœ–æºè‡ª : <a href="https://blog.thoughtspile.tech/2021/05/17/everything-about-react-refs/">So you think you know everything about React refs</a></p></blockquote><p>effect åœ¨ unmount è®€å– node ä¹Ÿæœƒæ¶ˆå¤±ï¼Œä½†å¯ä»¥åˆ©ç”¨ closure çš„ç‰¹æ€§ï¼Œå»ºç«‹è®Šæ•¸å…ˆå°‡ node çµ¦è¨˜ä½ï¼Œåœ¨ <code>unmout</code> å‘¼å« clean up function æ™‚å–æ¶ˆç›£è½äº‹ä»¶ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">React</span>.<span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// åˆ»æ„è¨˜ä½ï¼Œå› ç‚º boxRef æ˜¯æœƒè®Šå‹•çš„</span></span><br><span class="line">  <span class="keyword">const</span> keepRef = boxRef.<span class="property">current</span></span><br><span class="line">  boxRef.<span class="property">current</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, changeColor);</span><br><span class="line">  boxRef.<span class="property">current</span>.<span class="property">style</span>.<span class="property">top</span> = <span class="string">&quot;100px&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// null , box two æœ¬èº«</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(boxRef.<span class="property">current</span>,keepRef.<span class="property">current</span>)</span><br><span class="line">    keepRef.<span class="property">current</span>.<span class="title function_">removeEventListener</span>(<span class="string">&quot;click&quot;</span>, changeColor);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><p>é‚£ <code>layoutEffect</code> å¯ä»¥ç›´æ¥åœ¨æ¸…é™¤åŸ·è¡Œå–æ¶ˆç›£è½å— ? é›–ç„¶ <code>ref.current</code> ä¾èˆŠå­˜åœ¨ï¼Œä½†é‚„æ˜¯ä¸å®‰å…¨çš„ï¼Œæœ€å¥½æ˜¯åƒ effect ä¸€æ¨£ï¼Œåˆ©ç”¨ closure çš„æ–¹å¼ä¾†å–æ¶ˆç›£è½äº‹ä»¶ã€‚</p><h1>callback ref çš„ clean up function</h1><blockquote><p>å®˜æ–¹è¨è«–ä¸² : <a href="https://github.com/facebook/react/issues/15176">React callback ref cleanup function Â· Issue #15176 Â· facebook/react Â· GitHub</a></p></blockquote><p>åœ¨ React 18 é‡‹å‡ºä»¥å‰å·²ç¶“æœ‰æ¢è¨ callback ref clean up çš„å•é¡Œï¼Œä¸Šé¢æœ‰æåˆ°ç•¶ callback ref åœ¨ <code>unmount</code> å‘¼å«æ™‚æ˜¯ nullï¼Œå› æ­¤è¨»éŠ·ç›£è½äº‹ä»¶æ˜¯ä¸å®¹æ˜“çš„ï¼Œå› æ­¤æœ‰äººæå‡ºä¸€äº›è§£æ±ºæ–¹æ¡ˆï¼Œæœªä¾†ä¹Ÿå¯èƒ½å‡ºç¾æ–°çš„ API ä¾†è§£æ±ºæ­¤å•é¡ŒğŸ¤”ï¼Œå¤§æ¦‚çœ‹å®Œ RFC ç›®å‰æ‡‰è©²æ˜¯æ²’æœ‰æ‰“ç®—å»ºç«‹æ–° API ï¼Œçµå°¾éƒ½æŒ‡å‡ºé€™æ¨£çš„æ”¹è®Šå¯èƒ½å°è‡´æ–°èˆŠæœƒç”¢ç”Ÿè¡çªã€‚</p><p>ä¸éé€™éƒ¨åˆ†æˆ‘é‚„æ²’è©³è®€ğŸ˜µï¼Œå…ˆè¨˜éŒ„èµ·ä¾†ï¼Œä¹‹å¾Œæœƒå†å¯«æ–‡ç« ä¾†ç ”ç©¶ç ”ç©¶ğŸ¤”</p><ol><li>Dan å¤§æœ‰æåˆ°ï¼ŒuseCallback å¦‚æœå›å‚³ function ï¼Œç­‰åŒæ–¼åšå‡ºæ–°çš„è¡Œç‚ºï¼Œå°±ä¸æœƒæœ‰å‘¼å«åˆ° null å¾—çš„å•é¡Œï¼ŒğŸ¤”ã€‚ <a href="https://github.com/reactjs/rfcs/pull/205">RFC: Callback Ref Cleanup by KurtGokhan Â· Pull Request #205</a></li><li>æˆ‘è¦ºå¾—å¾ˆç„çš„å•é¡Œï¼Œ æ”¹è®Š ref ä¸ re-render ï¼Œä½†æ˜¯é€™å€‹éœ€æ±‚å»è¦æ±‚ ref è¦è·Ÿ state åšä¸€æ¨£çš„äº‹ğŸ¤”ï¼Œä¸éæœ€å¾Œä¹Ÿæ˜¯æåˆ° <code>return ()=&gt;&#123;&#125;</code> clean up function ã€‚<a href="https://github.com/facebook/react/issues/21903">React 18 letâ€™s make ref.currant to be reactive value Â· Issue #21903</a></li><li>é€™ä¸€ä¸²è¨è«– Custom Hooks å°‡ ref å¤–å‚³ï¼Œç„¶å¾Œ <code>useEffect</code> çš„ deps æ˜¯æ”¾å…¥ <code>ref.current</code> é€™ä»¶äº‹ã€‚è½èµ·ä¾†æœ‰é»åè¨­è¨ˆï¼Œå› ç‚º ref ä¸æœƒè§¸ç™¼ re-render ï¼Œä½†æ˜¯å»æŠŠå®ƒæ”¾åœ¨ deps ä¸­ç›£è½æ˜¯å¦æœ‰æ”¹è®Šå†éš¨ re-render é‡æ–°å‘¼å«ğŸ¤” <a href="https://github.com/facebook/react/issues/16154">Accessing state/props in callback ref with hooks Â· Issue #16154</a></li><li>æ ¹æ“šç¬¬ä¸‰é»å®˜æ–¹æå‡ºçš„è§£æ±ºè¾¦æ³• : <a href="https://reactjs.org/docs/hooks-faq.html#how-to-read-an-often-changing-value-from-usecallback">Hooks FAQ â€“ How to read an often-changing value from useCallback?t</a></li></ol><p>ä»¥ä¸Šéƒ½æ˜¯è™•ç†é‚Šéš›æ¢ä»¶ (edge case) çš„è¨è«–ã€‚</p><h1>ç¸½çµ</h1><ol><li>ref å¯ä»¥çœ‹åšæ˜¯ä¸€å€‹æ™®é€š JavaScript ç‰©ä»¶ï¼Œå¸¶æœ‰ <code>current</code> å±¬æ€§ï¼ŒReact ç¢ºä¿æ”¹è®Šå®ƒä¸æœƒé€ æˆ re-renderï¼Œä¹Ÿä¸æœƒéš¨ç”Ÿå‘½é€±æœŸæ”¹è®Š ã€‚</li><li>ä¸èƒ½ä½¿ç”¨ <code>useRef</code> æ›¿ä»£ <code>useState</code>ã€‚ <code>useRef</code> ä¸æœƒè§¸ç™¼ re-render ï¼Œæ“ä½œå¾Œä¸ä¿è­‰èƒ½åŒæ­¥ UI (è³‡æ–™æ”¹äº†ä½†æ˜¯ React ä¸æœƒåˆ·æ–°ç•«é¢ï¼Œåƒè¦‹ : [[#æŠ“ Previous çš„å€¼]])ã€‚</li><li>æœ€å¥½åœ¨ effect æˆ–æ˜¯ event handler è£¡é¢æ›´æ–° ref ï¼Œå› ç‚º ref çš„å»ºç«‹èˆ‡æ›´æ–°çš„æ™‚é–“é»ã€‚</li><li>æœ€å¸¸æ‹¿ä¾†ç›´æ¥æ“ä½œ DOM å…ƒç´ ã€‚</li><li>callback ref å¸¸ç”¨ä¾†æ¸¬é‡ DOM çš„å¤§å°</li></ol><p>éç¨‹ä¸­å·®é»å¿˜è¨˜ä¸»è¦ç›®çš„æ˜¯èªè­˜ ref çš„ç”¨é€”ï¼Œä¸€ä¸å°å¿ƒæŒ–å¤ªæ·±ğŸ¤“ï¼ŒåŒæ™‚ä¹Ÿçœ‹åˆ°åŸä¾† callback ref æœ‰é€™éº¼å¤šå¯æ“´å±•çš„æ–¹å¼ï¼Œæˆ‘ä¸€é–‹å§‹ä¸å¤ªèƒ½ç†è§£ callback ref è¦æ€éº¼ä½¿ç”¨ ï¼Œå› ç‚º <code>useEffect + ref</code> éƒ½èƒ½è§£æ±ºå¤§éƒ¨åˆ†çš„å•é¡Œï¼Œåªæ˜¯éº»ç…©äº†é»ğŸ¤”ã€‚å¾ŒçºŒ ref çš„éƒ¨ä»½æœƒå†å¯«ä¸€ç¯‡å†æ·±å…¥ ref çš„æ–‡ç« ã€‚</p><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style:none;padding-left:0"><li id="fn:1"><span style="display:inline-block;vertical-align:top;padding-right:10px">1.</span><span style="display:inline-block;vertical-align:top">å»¶é²åˆå§‹åŒ–æ˜¯æŒ‡åˆå§‹å€¼éœ€è¦ç¶“éè¨ˆç®—è€Œä¾†ï¼Œæˆ‘å€‘åªéœ€è¦åœ¨ render ä¸€æ¬¡å»ºç«‹å°±å¥½</span> <a href="#fnref:1" rev="footnote">â†©</a></li></ol></div></div></div><div class="popular-posts-header">ç›¸é—œæ–‡ç« </div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><a href="\2022\07\React\ContextAPI.html" rel="bookmark">ç­†è¨˜ | React - Context API</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="\2022\04\04\Practice-to-Master-01.html" rel="bookmark">ç´€éŒ„ | Frontend Mentor æŒ‘æˆ°é¡Œ - Time tracking dashboard</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="\2022\07\React\Higher-Order-Component.html" rel="bookmark">ç­†è¨˜ | React - Higher Order Component (HOC)</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="\2022\07\React\Render-props.html" rel="bookmark">ç­†è¨˜ | React - render props</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="\2022\08\React\react-useEffect-about-everythings.html" rel="bookmark">ç­†è¨˜ | React - é‡æ–°äº†è§£ useEffect</a></div></li></ul><footer class="post-footer"><div class="post-tags"><a href="/tags/React/" rel="tag"><i class="fa fa-tag"></i> React</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2022/08/React/react-useEffect-about-everythings" rel="prev" title="ç­†è¨˜ | React - é‡æ–°äº†è§£ useEffect"><i class="fa fa-chevron-left"></i> ç­†è¨˜ | React - é‡æ–°äº†è§£ useEffect</a></div><div class="post-nav-item"></div></div></footer></article><div style=""><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2022</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">RosaHong</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>ç¸½å­—æ•¸ï¼š</span> <span title="ç¸½å­—æ•¸">249k</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>æ‰€éœ€ç¸½é–±è®€æ™‚é–“ &asymp;</span> <span title="æ‰€éœ€ç¸½é–±è®€æ™‚é–“">3:46</span></span></div><div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼·åŠ›é©…å‹•</div></div></footer><script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script src="//cdn.jsdelivr.net/npm/lozad@1.15.0/dist/lozad.min.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script>
if (document.querySelectorAll('.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8.7.0/dist/mermaid.min.js', () => {
    mermaid.init({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    }, '.mermaid');
  }, window.mermaid);
}
</script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"></body></html>