<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>å¥å¿˜é›œè¨˜</title>
  
  <subtitle>ç´€éŒ„å­¸ç¿’èˆ‡ç”Ÿæ´»</subtitle>
  <link href="https://blog.rosa.tw/atom.xml" rel="self"/>
  
  <link href="https://blog.rosa.tw/"/>
  <updated>2022-08-24T02:44:43.111Z</updated>
  <id>https://blog.rosa.tw/</id>
  
  <author>
    <name>Rosa Hong</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ç­†è¨˜ | React - ref èˆ‡ callback ref</title>
    <link href="https://blog.rosa.tw/2022/08/React/ref-and-callback-ref"/>
    <id>https://blog.rosa.tw/2022/08/React/ref-and-callback-ref</id>
    <published>2022-08-24T02:43:24.000Z</published>
    <updated>2022-08-24T02:44:43.111Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ–‡ç« ä¾†è‡ª :</p><ol><li><a href="https://zh-hant.reactjs.org/docs/refs-and-the-dom.html">Refs å’Œ DOM â€“ React</a></li><li><a href="https://medium.com/hannah-lin/react-hook-%E7%AD%86%E8%A8%98-useref-c628cbf0d7fb">React Hook ç­†è¨˜ useRef. useRef ç¥å¥‡çš„åœ°æ–¹é™¤äº†å¯ä»¥åœ¨ä¸ re-renderâ€¦ </a></li><li><a href="https://www.linkedin.com/pulse/imperative-vs-declarative-programming-javascript-yehuda-margolis">Imperative vs Declarative Programming in JavaScript</a></li></ol></blockquote><h1>æ‘˜è¦</h1><ol><li>ä»€éº¼æ˜¯ ref ?</li><li>ref ä½¿ç”¨çš„æ™‚æ©Ÿ</li><li>ref çš„å¦ä¸€ç¨®å‹æ…‹ callback ref</li></ol><span id="more"></span><h1>ä»€éº¼æ˜¯ ref ?</h1><p>ref æä¾› React è³‡æ–™æµä»¥å¤–çš„æ“ä½œæ–¹å¼ï¼Œè®“æˆ‘å€‘å¯ä»¥æ”¹è®Š React Component çš„ instance (å¯¦ä¾‹)ï¼Œæˆ–è€…å®ƒä¾†ä¾†æ“ä½œ DOM å…ƒç´ ã€‚</p><p>ref å¯çœ‹ä½œæ˜¯ä¸€å€‹æ™®é€šçš„ JavaScript ç‰©ä»¶ï¼Œå…§éƒ¨å…·æœ‰ current çš„å±¬æ€§çš„æ±è¥¿ï¼Œå¯ä»¥ç›´æ¥ (mutable) æ”¹è®Šå®ƒã€‚ React ä¿è­‰å®ƒåœ¨ç”Ÿå‘½é€±æœŸ (render) å¾ªç’°ä¸­æ°¸é éƒ½æŒ‡å‘åŒä¸€å€‹ä½å€ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ref = &#123;current : ... &#125;;</span><br></pre></td></tr></table></figure><h1>ä¸éåº¦ä½¿ç”¨ ref</h1><p>ä½¿ç”¨ ref çš„ç¬¬ä¸€ç›´è¦ºä¸Šï¼Œæˆ‘å€‘å¯èƒ½æœƒæƒ³èªª ref <strong>è¦åœ¨å“ªè£¡ç™¼ç”Ÿ</strong> ( åƒæ˜¯ state æœƒæ”¾åˆ°éœ€è¦ç”¨åˆ°çš„å…ƒä»¶å…§)ï¼Œref ä¸å–®å–®æ˜¯æ‹¿ä¾†å­˜æ”¾ä¸æœƒå½±éŸ¿ re-render çš„å€¼ï¼Œä¸æ‡‰è©²è¢«éåº¦ä½¿ç”¨æ“ä½œæœ‰é—œ React è³‡æ–™æµçš„éƒ¨åˆ†ã€‚é€™æ™‚å€™æ‡‰è©²ä½¿ç”¨ stateï¼Œä¸¦ä¸”è€ƒæ…® <strong>å“ªå€‹ component æ‡‰è©²æ“æœ‰ç‹€æ…‹</strong>ï¼Œå¦‚æœæ˜¯è¦å…±åŒæ“æœ‰çš„ state è¦åšçš„æ˜¯ <em>æå‡ state</em>ã€‚</p><h1>ä½¿ç”¨ ref çš„æ™‚æ©Ÿ</h1><ol><li>focusã€é¸æ“‡æ–‡å­—æˆ–å½±éŸ³åª’é«”æ’­æ”¾ç­‰ç­‰</li><li>è§¸ç™¼å³æ™‚çš„å‹•ç•«</li><li>èˆ‡ç¬¬ä¸‰æ–¹ DOM å‡½å¼æ•´åˆ</li></ol><blockquote><p>å¦‚æœæ“ä½œå¯ä»¥ç”¨å®£å‘Šå¼ (declarative) æ“ä½œï¼Œé¿å…ä½¿ç”¨ ref</p></blockquote><p>ä¾‹å¦‚ : å°è©±è¦–çª—æˆ‘å€‘å¯ä»¥ä¸ç”¨æš´éœ² <code>open()</code> æˆ– <code>close()</code> æ–¹æ³• ï¼Œè€Œæ˜¯ä½¿ç”¨ <code>isOpen</code> ä½œç‚º props ä¾†æ“ä½œã€‚ æˆ‘å€‘ä¸ç”¨å‘Šè¨´æŸå…ƒä»¶è¦æ€éº¼åš (HOW) ï¼Œè€Œå‘Šè¨´å…¶çµæœ (WHAT) å°±å¥½ã€‚</p><h1>è£œå…… : Declarative v.s Imperative in JavaScript</h1><h2 id="Declarative-å®£å‘Šå¼">Declarative å®£å‘Šå¼</h2><p>è‘—é‡æ–¼ WHAT (æƒ³è¦æ‹¿åˆ°çš„çµæœæ˜¯ä»€éº¼)ï¼Œæ¯”è¼ƒæŠ½è±¡çš„æµç¨‹ï¼Œå¤šä½¿ç”¨è¡¨é”å¼ (expression)ï¼Œç‰¹è‰²æ˜¯å–®ç´”é‹ç®—ä¸”å…·æœ‰å›å‚³å€¼ã€‚åƒæ˜¯ functional programmingã€‚</p><p><strong>ç‰¹è‰² :</strong></p><ul><li>Stateless : å°ˆæ³¨å…§éƒ¨ç®—å¼ï¼Œä¸¦ä¸æœƒç›´æ¥æ”¹è®ŠåŸæœ¬å‚³å…¥çš„å€¼ï¼Œå–®ç´”è¼¸å…¥èˆ‡è¼¸å‡ºã€‚</li><li>ç„¡å‰¯ä½œç”¨ (side effect)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‡½å¼è¡¨é”ç›¸ä¹˜</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">multiple</span>(<span class="params">arr</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(arr.<span class="property">length</span>===<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">  <span class="comment">// å›å‚³ç›¸ä¹˜å¾Œçš„çµæœï¼Œå…¶ state åˆè¢«å¡é€²å…§éƒ¨å›å‚³æ–°çš„çµæœ</span></span><br><span class="line">  <span class="keyword">return</span> arr.<span class="title function_">map</span>(<span class="function"><span class="params">x</span> =&gt;</span> x*<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">multiple</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]))</span><br></pre></td></tr></table></figure><p>å°‡å…¶ function åç¨±ä»£è¡¨å›å‚³çš„æ„ç¾©æœƒä½¿ç¨‹å¼ç¢¼æ¯”è¼ƒäº†è§£ï¼Œä¹Ÿå¯ä»¥èªª <strong>å®šç¾© OO æ˜¯ä»€éº¼</strong>ã€‚</p><h2 id="Imperative-å‘½ä»¤å¼">Imperative å‘½ä»¤å¼</h2><p>è‘—é‡æ–¼ HOW (ç›®æ¨™åˆ°åº•è¦æ€éº¼åš)ï¼Œå…·é«”è¡¨ç¤ºæ‡‰è©²æ€éº¼åšä¾†é”åˆ°ç›®æ¨™ï¼Œä¸€æ­¥æ­¥æŒ‰ç…§æ­¥é©Ÿï¼Œå¸¸ä½¿ç”¨ statement æµç¨‹æ§åˆ¶ (if , while , for , switch) ç­‰ã€‚åƒæ˜¯ OOPã€‚</p><p><strong>ç‰¹è‰² :</strong></p><ul><li>Stateful :  state æ˜¯äº’ç›¸æœ‰é—œé€£æ€§çš„ã€‚</li><li>å¸¸æœƒæœ‰å‰¯ä½œç”¨ side effect ç™¼ç”Ÿ</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">multiple</span> = array =&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span>(array.<span class="property">length</span> == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">  <span class="keyword">const</span> result = [];</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;array.<span class="property">length</span>;i++)&#123;</span><br><span class="line">    result.<span class="title function_">push</span>(array[i]*<span class="number">2</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">multiple</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]))</span><br></pre></td></tr></table></figure><h2 id="å°çµ-8">å°çµ</h2><p>å¾ä¾‹å­ä¾†çœ‹ï¼Œå…©ç¨®æ–¹å¼éƒ½èƒ½é”åˆ°çµæœï¼Œåœ¨ Imperative ä¸­å¯ä»¥å¾ˆæ¸…æ¥šçœ‹è¦‹ state æ˜¯ â€œå¦‚ä½•è®ŠåŒ–â€ çš„ï¼Œç¶“éä¸€æ­¥æ­¥çš„æµç¨‹æ§åˆ¶å¾—å‡ºçµæœï¼›åœ¨ Declarative ä¸­è³‡æ–™çš„è®ŠåŒ–éƒ½è¢«è—åˆ°å…§éƒ¨å¦ä¸€å€‹å‡½å¼ä¸­ (é‚è¼¯è¢«æŠ½è±¡åŒ–)ï¼Œæˆ‘å€‘çœ‹åˆ°çš„æ˜¯ â€œçµæœâ€ã€‚</p><p>JavaScript ä½¿æˆ‘å€‘å¯ä»¥ç”¨å…©ç¨®æ–¹å¼ä¾†å¯¦ä½œï¼Œå…¶å„æœ‰å„ªç¼º :<br><strong>Imperative :</strong></p><ul><li>å„ªé» :<ol><li>èªæ³•å°æ–¼é–‹ç™¼äººå“¡æ¯”è¼ƒå¥½æŒæ¡ã€‚</li><li>åœ¨æµç¨‹æ§åˆ¶ä¸Šéƒ½æ˜¯åœ¨åŒä¸€å€‹å€å¡Šæ“ä½œï¼ŒåŒ…å«åœæ­¢æˆ–æš«åœ loop éƒ½å¯ä»¥æ ¹æ“šæƒ³è¦çš„æ“ä½œã€‚</li><li>åœ¨æŸäº›æƒ…æ³ä¸‹ï¼Œæ•ˆèƒ½æœƒæ¯”è¼ƒå¥½ã€‚</li></ol></li><li>ç¼ºé» :<ol><li>ç¨‹å¼ç¢¼é€šå¸¸è¼ƒå†—é•·ï¼ŒåŸå› æ˜¯é‚è¼¯éƒ½å¯«åœ¨åŒä¸€å¡Š</li><li>æ¯”è¼ƒé›£ä»¥é–±è®€</li></ol></li></ul><p><strong>Declarative :</strong></p><ul><li>å„ªé» :<ol><li>ç¨‹å¼ç¢¼é€šå¸¸éƒ½å¾ˆçŸ­ï¼Œè€Œä¸”æ•´æ½”ã€æ˜“è®€</li><li>å¾ˆé©åˆç”¨åœ¨ JavaScript ä¸€äº›æ¡†æ¶ä¸Šï¼Œåƒæ˜¯ React èˆ‡ç‹€æ…‹ç®¡ç†çš„ redux</li></ol></li><li>ç¼ºé» :<ol><li>é‹è¡Œçš„æ¯”è¼ƒæ…¢ä¸€é»ï¼Œä½†åœ¨å°å‹çš„æ‡‰ç”¨ç¨‹å¼ä¸æ˜¯å¤ªæ˜é¡¯ã€‚</li></ol></li></ul><h1>å»ºç«‹ ref</h1><p>åœ¨ class component å¯ä»¥åœ¨å»ºç«‹ (constructor)  æ™‚æ–°å»º refï¼Œå¯ä»¥æ˜¯ä»£è¡¨å±¬æ–¼æŸå€‹ instance çš„å±¬æ€§ï¼Œæˆ–è€…é€éå±¬æ€§ (attribute) ä¾é™„åœ¨ React elementï¼Œåœ¨æ•´å€‹ component è£¡é¢è¢«åƒè€ƒã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="comment">// 1. ç”¨ createRef() å»ºç«‹</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">myRef</span> = <span class="title class_">React</span>.<span class="title function_">createRef</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 2. ä½¿å…¶ç”¨ attr ä¾é™„åœ¨ node ä¸Šï¼Œé€é this.myRef å°±å¯ä»¥æ“ä½œ DOM å…ƒç´ </span></span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;this.myRef&#125;</span> /&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ function component ç”¨ Hooks å¯ä»¥ç›´æ¥åœ¨å…§éƒ¨å»ºç«‹ ref</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ref = <span class="title function_">useRef</span>(<span class="number">0</span>)</span><br><span class="line"><span class="comment">// ref = &#123; current : 0&#125;</span></span><br></pre></td></tr></table></figure><p><code>useRef</code> æ¯”ä¸€èˆ¬çš„ ref æ›´æœ‰ç”¨ï¼Œå®ƒå¯ä»¥å¾ˆæ–¹ä¾¿åœ°æŒæœ‰ä»»ä½• mutable çš„å€¼ (<code>useRef</code> å¯ä»¥æ˜¯ä»»ä½•çš„å€¼)ï¼Œè·Ÿ class ä¸­çš„ instance field é¡ä¼¼ã€‚</p><p>é™¤éåšå»¶é²åˆå§‹åŒ–<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>ï¼Œé¿å…åœ¨ render æ™‚è¨­å®š ref ï¼Œé€ æˆéé æœŸçš„è¡Œç‚ºï¼Œæ‰€ä»¥æˆ‘å€‘æ‡‰è©² <strong>åœ¨ event handler å’Œ effect ä¸­ä¿®æ”¹ ref</strong>ã€‚</p><h1>å­˜å– ref</h1><p>Ref çš„å€¼æœƒæ ¹æ“šç¯€é»çš„é¡å‹è€Œæœ‰æ‰€ä¸åŒï¼š</p><ol><li>å»ºç«‹çš„ ref ç”¨åœ¨ html å…ƒç´ ä¸Šçš„å±¬æ€§ï¼Œç­‰åŒæ–¼å–å¾— DOM å…ƒç´ æœ¬èº«ä½œç‚º current å±¬æ€§ã€‚</li><li>å®¢è£½åŒ–çš„ class component ä½¿ç”¨ ref æ™‚ï¼Œref ç­‰åŒæ–¼æ­¤ component mount ä¹‹å¾Œçš„å¯¦ä¾‹(instance) ç•¶ä½œ currentã€‚ (ç°¡å–®ä¾†èªª ref å¯ä»¥ç›´æ¥å‚³çµ¦ class component ä¸­çš„å­å…ƒä»¶ï¼Œä½† functional component ä¸è¡Œ)</li><li>ä¸èƒ½åœ¨ functional component ä¸Šä½¿ç”¨ refï¼Œå› ç‚ºä»–å€‘æ²’æœ‰å¯¦ä¾‹ (instance)ã€‚</li></ol><h2 id="åœ¨-DOM-Element-åŠ ä¸Š-Ref">åœ¨ DOM Element åŠ ä¸Š Ref</h2><p>åœ¨ DOM Element åŠ ä¸Š refï¼Œåˆ©ç”¨ ref ä¾†å„²å­˜å°æ–¼ DOM ç¯€é»çš„åƒè€ƒï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CustomTextInput</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="comment">// ç”¢ç”Ÿä¸€å€‹å¯ä»¥å„²å­˜ textInput DOM element çš„ ref</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">textInput</span> = <span class="title class_">React</span>.<span class="title function_">createRef</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">focusTextInput</span> = <span class="variable language_">this</span>.<span class="property">focusTextInput</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// focus æ–¹æ³•ï¼Œç›´æ¥å° DOM å…ƒç´ æ“ä½œ</span></span><br><span class="line">  <span class="title function_">focusTextInput</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">textInput</span>.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &#123;/* <span class="attr">åœ¨</span> <span class="attr">mount</span> <span class="attr">çš„æ™‚å€™å°‡</span> <span class="attr">DOM</span> <span class="attr">element</span> <span class="attr">è³¦å€¼åˆ°</span> <span class="attr">current</span> <span class="attr">å±¬æ€§</span>*/&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">ref</span>=<span class="string">&#123;this.textInput&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">type</span>=<span class="string">&quot;button&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&quot;Focus the text input&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onClick</span>=<span class="string">&#123;this.focusTextInput&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>React æœƒåœ¨ component mount çš„æ™‚å€™å°‡ DOM element è³¦å€¼åˆ° current å±¬æ€§ï¼Œä¸¦åœ¨ unmount æ™‚å°‡å®ƒæ¸…ç©ºå› null ã€‚ ref çš„æ›´æ–°ç™¼ç”Ÿåœ¨ç”Ÿå‘½é€±æœŸ <code>componentDidMount</code> æˆ– <code>componentDidUpdate</code> ä¹‹å‰ã€‚</p><h2 id="åœ¨-Class-Component-åŠ ä¸Š-Ref">åœ¨ Class Component åŠ ä¸Š Ref</h2><p>å¦‚æœæˆ‘å€‘æƒ³åœ¨çˆ¶å…ƒä»¶ mount ä¹‹å¾Œï¼Œè‡ªå‹•åš <code>focus</code> é€™ä»¶äº‹ï¼Œå¯ä»¥é€éçˆ¶å…ƒä»¶çš„ ref æ‹¿åˆ° <code>textInput</code> å¯¦ä¾‹æœ¬èº« (ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å…§éƒ¨çš„æ–¹æ³•)ï¼Œä¸¦åœ¨ <code>componentDidMount</code> å‘¼å«ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AutoFocusTextInput</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">textInput</span> = <span class="title class_">React</span>.<span class="title function_">createRef</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åœ¨å…ƒä»¶ mount ä¹‹å¾Œè‡ªå‹•åšé€™ä»¶äº‹ </span></span><br><span class="line">  <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// focusTextInput() æ˜¯ä¾†è‡ª CustomTextInput æœ¬èº« </span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">textInput</span>.<span class="property">current</span>.<span class="title function_">focusTextInput</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">CustomTextInput</span> <span class="attr">ref</span>=<span class="string">&#123;this.textInput&#125;</span> /&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„é€™ <strong>åªé©ç”¨æ–¼åˆ©ç”¨ class ä¾†å®£å‘Š</strong> <code>CustomTextInput</code> çš„æƒ…å½¢ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CustomTextInput</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Ref-å’Œ-Function-Component">Ref å’Œ Function Component</h2><p>ä¸èƒ½ç”¨ function component ä½¿ç”¨ ref ï¼Œå› ç‚ºæœ¬èº«æ²’æœ‰ instance ï¼Œä¸èƒ½åƒ class component ç›´æ¥å°‡ ref å‚³çµ¦ child componentã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* æ²’æœ‰é€™æ±è¥¿ */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Input</span>(<span class="params">&#123;ref&#125;</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>/&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* âŒä¸è¡Œï¼Œ Input æ²’æœ‰ instanceï¼Œä¸èƒ½æ¥æ”¶ ref */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Input</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦ä¸å°±åœ¨ child component ç›´æ¥ä½¿ç”¨ <code>useRef</code></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Input</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// âœ… é€™æ¨£å¯ä»¥</span></span><br><span class="line">  <span class="keyword">const</span> ref = <span class="title function_">useRef</span>(<span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>/&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœåœ¨çˆ¶å…ƒä»¶çœŸçš„æƒ³å°‡ ref äº¤éçµ¦å…¶ä»– function component ï¼ŒReact æœƒå»ºè­°ä½¿ç”¨ <strong>å‚³é€ ref</strong> (<code>forwardRef</code>) çš„æ–¹å¼ï¼Œ<strong>å‚³é€ Ref ä½¿å¾— component èƒ½å¤ é¸æ“‡è¦ä¸è¦æŠŠ child component çš„ ref ç•¶ä½œè‡ªå·±çš„ ref</strong> ã€‚ä¸éé€™æ¨£çš„æ–¹æ³•ä¸å¤ªå»ºè­°ï¼Œå› ç‚ºæœƒç ´å£ component çš„å°è£ã€‚ä½†æœ‰æ™‚å€™è§¸ç™¼ focus æˆ–æ¸¬é‡ child çš„ DOM ç¯€é»çš„å¤§å°ã€ä½ç½®æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚</p><h1>å¯¦å‹™ä¸Šçš„ ref</h1><ol><li>è¨ˆç®— render æ¬¡æ•¸ (å°‘)</li><li><strong>ç”¨ Imperatively æ–¹æ³•æ”¹è®Š DOM è·Ÿ Child Component (æœ€å¸¸)</strong></li><li>æƒ³æŠ“ Previous çš„å€¼ (å°‘)</li></ol><h2 id="è¨ˆç®—-render-æ¬¡æ•¸">è¨ˆç®— render æ¬¡æ•¸</h2><p>å¦‚æœç”¨ state ä¾†è¨ˆç®—ï¼Œé€™å€‹ä¾‹å­æœƒå°è‡´ç„¡çª®è¿´åœˆï¼Œ <code>setState</code> å°è‡´ re-render ï¼Œåš <code>setRenderCount</code> åˆä¸€è€Œå†åœ°è§¸ç™¼ï¼Œæ²’å®Œæ²’äº†ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [count,setCount] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> [renderCount,setRenderCount] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¯æ¬¡ render å°± ++</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">setRenderCount</span>(<span class="function"><span class="params">r</span> =&gt;</span> r+<span class="number">1</span>) </span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;count&#125;</span></span><br><span class="line"><span class="language-xml">      render : &#123;renderCount&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€™æ™‚å€™å¾ˆé©åˆä½¿ç”¨ <code>useRef</code> ï¼Œå› ç‚ºå®ƒä¸æœƒè§¸ç™¼ re-renderã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [count,setCount] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> countRef = <span class="title class_">React</span>.<span class="title function_">useRef</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¯æ¬¡ render å°± ++</span></span><br><span class="line">  <span class="title class_">React</span>.<span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    countRef.<span class="property">current</span> +=<span class="number">1</span> </span><br><span class="line">  &#125;,[count])</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;count&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span> setCount(count+1)&#125;&gt;+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      render : &#123;countRef.current&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç”¨-Imperatively-æ–¹æ³•æ”¹è®Š-DOM-è·Ÿ-Child-Component">ç”¨ Imperatively æ–¹æ³•æ”¹è®Š DOM è·Ÿ Child Component</h2><p>Imperative çš„æ„æ€åœ¨ [[#è£œå…… Declarative v s Imperative in JavaScript]] ç« ç¯€è§£é‡‹éã€‚å¦‚æœä½¿ç”¨<br>state çš„æ€è·¯ä¾†çœ‹ï¼Œæœƒåˆ©ç”¨ focus state ä¾†æ§åˆ¶å…ƒä»¶çš„ç‹€æ…‹ï¼ŒåŸºæ–¼å¥½å¥‡ï¼Œæˆ‘ä¹Ÿå°±å¯¦ä½œäº† state ç‰ˆæœ¬ã€‚</p><h3 id="å¯¦ä½œ-ä½¿ç”¨-state-ä¾†æ§åˆ¶-autofocus">å¯¦ä½œ : ä½¿ç”¨ state ä¾†æ§åˆ¶ autofocus</h3><p>åˆ©ç”¨ key çš„ç‰¹æ€§ï¼Œè®“ React æ›æ‰ç¯€é»ï¼Œç‚ºä»€éº¼ç”¨ key å¾Œé¢æœƒè§£é‡‹</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [autoFocus, setAutoFocus] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">key</span>=<span class="string">&#123;Number(autoFocus)&#125;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">autoFocus</span>=<span class="string">&#123;autoFocus&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setAutoFocus((f) =&gt; !f)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        é—œæ³¨</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ render ä¹‹å¾Œè‡ªå‹• Focus ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>useEffect</code> å†å¤šåšä¸€æ¬¡çš„ render</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="title function_">setAutoFocus</span>(<span class="literal">true</span>)</span><br><span class="line">&#125;,[])</span><br></pre></td></tr></table></figure><p>é‚„è¨˜å¾— key æ˜¯æ‹¿ä¾†åˆ¤æ–· DOM ç¯€é»æ˜¯å¦æ›¿æ›çš„ä¸€ç¨®æŒ‡æ¨™å— ? æˆ‘å€‘æœ€å¸¸ä½¿ç”¨åœ¨ array ä¸Šï¼Œä½†å…¶å¯¦ä¹Ÿå¯ä»¥å–®ç¨æ‹¿å‡ºä¾†ä½¿ç”¨ï¼Œå°¤å…¶å°æ–¼å¤§å€å¡Šçš„æ›´å‹•ã€‚</p><p>é€™éƒ¨åˆ†æ™‚åŸæœ¬æ¡å–é€™æ¨£çš„å¯«æ³•ï¼Œçµæœç™¼ç¾é›–ç„¶ state æœ‰æ”¹è®Šï¼Œä½†æ˜¯ <code>input</code> æ²’æœ‰è¢« focus :</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">&quot;text&quot;</span> autoFocus=&#123;autoFocus&#125; /&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setAutoFocus((f) =&gt; !f)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">  é—œæ³¨</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>é˜¿ ! çµæœå¿˜äº† React æ€éº¼å»æ¸²æŸ“é€™ä»¶åŸºæœ¬çš„äº‹ï¼Œè¨˜å¾—å—ğŸ˜µå®ƒæœƒåšæ·ºæ¯”è¼ƒï¼Œæ—¢ç„¶ input ç¯€é»æ²’æœ‰æ”¹è®Šï¼Œå®ƒåªæœƒä¿®æ”¹å±¬æ€§ã€‚åœ¨ä¾†èªªèªª <code>autofocus</code> ï¼Œå®ƒçš„è§¸ç™¼é»æ˜¯åœ¨ DOM ç¯€é»è¢«æ”¾åœ¨ä¸Šé¢ä¹‹å¾Œæ‰æœƒåš <code>focus()</code>ï¼Œé‚£ä¸Šé¢é€™æ®µæˆ‘å€‘ç¢ºå¯¦å¯ä»¥æŠŠ <code>autoFoucs</code> é€é state è®ŠåŒ–æ·»åŠ ä¸Šå»ï¼Œä½†æ˜¯ input æœ¬èº«æ˜¯æ²’æœ‰é‡æ–°å»ºç«‹é€™ä»¶äº‹ï¼Œå› ç‚º React æ·ºæ¯”è¼ƒè‡ªå‹•å¹«æˆ‘å€‘åšæ¸²æŸ“ä¸Šçš„å„ªåŒ–ï¼Œæ‰€ä»¥æˆ‘é€é key å¹«ç›´æ¥é‡æ–°ç”¢ç”Ÿ input ã€‚</p><p>åŸæœ¬æ˜¯é€éæ›¿æ›ä¸åŒçš„ html tagï¼Œå¯¦ä½œ <code>autoFocus</code> æˆåŠŸï¼Œä½†é€™ä¸æ˜¯æ­£ç¢ºçš„ç­”æ¡ˆï¼Œåˆçªç„¶æƒ³åˆ° key çš„ä½œç”¨ï¼Œçµæœå°±å‡ºä¾†äº†ã€‚</p><h3 id="ä½¿ç”¨-ref">ä½¿ç”¨ ref</h3><p>å›åˆ° ref ï¼Œå»ºç«‹ ref ç¶åœ¨ DOM element ä¸Šï¼Œä½¿æˆ‘å€‘å¯ä»¥ç›´æ¥æ“ä½œ DOMï¼Œæ¯”ä¸Šé¢çš„ç°¡å–®å¤šäº†ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = <span class="title function_">useRef</span>(<span class="literal">null</span>)</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    inputRef.<span class="property">current</span>.<span class="title function_">focus</span>()</span><br><span class="line">  &#125;,[])</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€™æ¨£çš„æ–¹å¼åœ¨è¡¨å–®å¾ˆå¸¸ä½¿ç”¨ï¼Œåœ¨ React ä¸­åˆ†æˆ controlled component å’Œ uncontrolled componentï¼Œ å‰è€…ä¾è³´ state ä¾†æ“ä½œï¼Œå¾Œè€…æ˜¯é€é ref ç›´æ¥è®€å– DOMã€‚</p><blockquote><p>ref ä¸¦ä¸æœƒå‡ºç¾åœ¨ <code>devtool</code> çš„æª¢æŸ¥è¦–çª—ä¸Šï¼Œå¯¦éš›çœ‹åˆ°çš„åªæœƒæ˜¯  <code>&lt;input type=&quot;text&quot;/&gt;</code></p></blockquote><h2 id="æŠ“-Previous-çš„å€¼">æŠ“ Previous çš„å€¼</h2><p>function component å› ç‚º closure çš„é—œä¿‚ï¼Œåªæœƒè¨˜ä½ç•¶æ¬¡ render çš„ state æˆ– props ç”šè‡³æ˜¯ä»»ä½•æ±è¥¿ï¼Œæˆ‘å€‘æ²’è¾¦æ³•æ‹¿åˆ°ä¸Šä¸€æ¬¡ render çš„å€¼ã€‚è€Œé€é ref  ä¾†å»ºç«‹ä¸æœƒéš¨ render è€Œæ”¹è®Šçš„ç›’å­ï¼Œè®“æˆ‘å€‘å¯ä»¥åœ¨ä¸‹ä¸€æ¬¡ effect å‘¼å«ä¹‹å‰å…ˆè¨˜ä½ä¸Šä¸€æ¬¡çš„å€¼ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [value,setValue] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line">  <span class="keyword">const</span> prevValue =<span class="title class_">React</span>.<span class="title function_">useRef</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="title class_">React</span>.<span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    prevValue.<span class="property">current</span> = value</span><br><span class="line">  &#125;,[value])</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;(e)</span>=&gt;</span> setValue(e.target.value)&#125;/&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>previous: &#123;prevValue.current&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¦éš›è·Ÿè‘—è·‘ä¸€æ¬¡ :</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬ä¸€æ¬¡ render</span></span><br><span class="line">  value = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment">// JSX(UIé¡¯ç¤º)</span></span><br><span class="line">  input value =<span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">previous</span>:</span><br><span class="line"><span class="comment">// effect åŸ·è¡Œ</span></span><br><span class="line">  prevValue.<span class="property">current</span> = value = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨è€…è¼¸å…¥ &quot;1&quot; re-render</span></span><br><span class="line">  value = <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="comment">// JSX(UIé¡¯ç¤º)</span></span><br><span class="line">  input value =<span class="string">&quot;1&quot;</span></span><br><span class="line">  <span class="attr">previous</span>:</span><br><span class="line"><span class="comment">// effect åŸ·è¡Œï¼Œä½†æ˜¯æ”¹è®Š ref ä¸¦ä¸æœƒé€ æˆ re-renderï¼Œæ­¤æ™‚æ²’æœ‰æ›´æ–°åœç•™åœ¨ previous:</span></span><br><span class="line">  prevValue.<span class="property">current</span> = value = <span class="string">&quot;1&quot;</span> </span><br></pre></td></tr></table></figure><p>å¯¦éš›ä¸Š <code>prevValue.current</code> ç­‰æ–¼ <code>value</code>ï¼Œä½†æ˜¯ render æ˜¯åœç•™åœ¨ç¬¬äºŒæ¬¡ï¼Œä¸¦æ²’æœ‰åˆ·æ–° UIï¼Œå› æ­¤åœ¨ç•«é¢ä¸Šçœ‹èµ·ä¾† <code>prevValue</code> åœç•™åœ¨å‰ä¸€æ¬¡çš„ renderï¼Œä½¿æˆ‘å€‘å¯ä»¥æ‹¿åˆ° previous å€¼ã€‚<br><img data-src="https://i.imgur.com/H2K46gT.png" alt="300x180"></p><h1>callback ref</h1><p>ref é‚„æœ‰å¦ä¸€ç¨®å½¢å¼ï¼Œä¸æ˜¯å°‡ <code>createRef()</code> æ‰€ç”¢ç”Ÿçš„ ref å‚³éä¸‹å»ï¼Œè€Œæ˜¯æŠŠä¸€å€‹ function å¾€ä¸‹å‚³ (function ä¹Ÿæ˜¯ä¸€ç¨® Object)ã€‚ function æœƒå°‡ React component çš„å¯¦ä¾‹ (instance) æˆ– HTML DOM ä½œç‚ºå®ƒçš„åƒæ•¸ï¼Œå„²å­˜ä¹‹å¾Œåœ¨åˆ¥çš„åœ°æ–¹ä½¿ç”¨ã€‚</p><ul><li>class component</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CustomTextInput</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="comment">// 1. å„²å­˜ callback ref å–å¾—çš„ node æˆ– instance çš„ç©ºé–“</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">textInput</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// 2. åƒæ•¸æ˜¯ html DOM æˆ–æ˜¯ component å¯¦ä¾‹</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">setTextInputRef</span> = <span class="function"><span class="params">element</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">textInput</span> = element;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">focusTextInput</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// åˆ©ç”¨åŸç”Ÿçš„ DOM API ä¾† focus æ–‡å­—è¼¸å…¥</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">textInput</span>) <span class="variable language_">this</span>.<span class="property">textInput</span>.<span class="title function_">focus</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// åœ¨ mount çš„æ™‚å€™è‡ªå‹• focus è¼¸å…¥</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">focusTextInput</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &#123;/* <span class="attr">ref</span> <span class="attr">å„²å­˜åƒè€ƒ</span> */&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">ref</span>=<span class="string">&#123;this.setTextInputRef&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">type</span>=<span class="string">&quot;button&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&quot;Focus the text input&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onClick</span>=<span class="string">&#123;this.focusTextInput&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>React æœƒåœ¨ component render æ™‚ç”¨ DOM element å‘¼å« ref callbackï¼Œç„¶å¾Œåœ¨ unmount æ™‚ç”¨ null å‘¼å«å®ƒã€‚</p><blockquote><p>Ref è¢«ä¿è­‰åœ¨ <code>componentDidMount</code> æˆ– <code>componentDidUpdate</code> è§¸ç™¼æ™‚èƒ½å¤ ç¶­æŒåœ¨æœ€æ–°çš„ç‹€æ…‹ã€‚</p></blockquote><h3 id="æœ‰-ref-effect-ç‚ºä»€éº¼é‚„éœ€è¦-callback-ref">æœ‰ ref + effect ç‚ºä»€éº¼é‚„éœ€è¦ callback ref</h3><p>ref å»ºç«‹/æ›´æ–°çš„æ™‚é–“é»æ˜¯åœ¨ render éšæ®µï¼Œä¸”åœ¨ <code>componentDidMount</code> æˆ– <code>componentDidUpdate</code> è§¸ç™¼æ™‚èƒ½å¤ ç¶­æŒåœ¨æœ€æ–°çš„ç‹€æ…‹ (åœ¨è£¡é¢ç²å– state æ˜¯æœ€æ–°çš„)ï¼Œæ›æˆ Hooks æ˜¯ <code>setState</code> ç•¶ä¸‹èƒ½æ‹¿åˆ°æœ€æ–°å€¼ï¼Œä¸¦ä¸”åœ¨ effect åŸ·è¡Œä¹‹å‰ç™¼ç”Ÿã€‚é€™é¿å…åœ¨é‚„æ²’ç²å–åˆ° DOM å…ƒç´ ä¹‹å‰æ‹¿åˆ° null ä¾†æ“ä½œã€‚ä»¥å¾€æˆ‘å€‘ç›´æ¥åœ¨ html tag åŠ ä¸Š ref åœ¨ effect æ“ä½œ ref æ™‚å°±å·²ç¶“æ‹¿åˆ° <code>ref.current</code> å­˜å–çš„ DOM å…ƒç´ æœ¬èº«ã€‚</p><p>åˆ°é€™è£¡å¥½åƒéƒ½æ²’å•é¡Œï¼Œä½†å¦‚æœæ˜¯ <strong>å­å…ƒä»¶çš„æ¢ä»¶å¼æ¸²æŸ“</strong> å‘¢ ? åœ¨å­å…ƒä»¶å·¢ç‹€çµæ§‹ä¸­ï¼Œçˆ¶å…ƒä»¶ä¸¦ä¸çŸ¥é“å­å…ƒä»¶çš„å·¢ç‹€å…ƒä»¶æ˜¯å¦å­˜åœ¨ (æˆ–æ˜¯å­˜åœ¨æ–¼ç¬¬ä¸€æ¬¡ render )ï¼Œå°è‡´ render ä¹‹å¾Œåœ¨çˆ¶å…ƒä»¶çš„ ref ä¸çŸ¥é“æœ‰æ²’æœ‰æŠ“åˆ°å°±åŸ·è¡Œ effectï¼Œè€Œå°è‡´éŒ¯èª¤ã€‚</p><blockquote><p>ç¯„ä¾‹ä¾†è‡ª : <a href="https://tkdodo.eu/blog/avoiding-use-effect-with-callback-refs#focus-with-an-effect">Avoiding useEffect with callback refs | TkDodoâ€™s blog</a></p></blockquote><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> ref = <span class="title class_">React</span>.<span class="title function_">useRef</span>(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">  <span class="title class_">React</span>.<span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ğŸš¨ ref.current æ°¸é æ˜¯ nullï¼Œé€™è¡Œæœƒå ±éŒ¯ </span></span><br><span class="line">    ref.<span class="property">current</span>?.<span class="title function_">focus</span>()</span><br><span class="line">  &#125;, [])</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Form</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> /&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Form</span> = <span class="title class_">React</span>.<span class="title function_">forwardRef</span>(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [show, setShow] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="literal">false</span>)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setShow(true)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        show</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      /* </span></span><br><span class="line"><span class="language-xml">      ref é™„åŠ åœ¨ input ä¸Šã€‚</span></span><br><span class="line"><span class="language-xml">      ä½†é€™æ˜¯æ¢ä»¶æ˜¯æ¸²æŸ“ï¼Œref.current åœ¨ show = false ä¸¦æ²’æœ‰æŠ“åˆ° input DOM</span></span><br><span class="line"><span class="language-xml">      */</span></span><br><span class="line"><span class="language-xml">      &#123;show &amp;&amp; <span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æˆ‘å¾Œä¾†åœ¨æƒ³é€™å€‹ä¾‹å­å¥½ä¸å¥½ğŸ¤”ï¼Œå…¶å¯¦æå‡ state å°±å¯ä»¥è§£æ±ºå•é¡Œäº†ã€‚ä½†æƒ³ä¸€æƒ³æˆ‘æéŒ¯äº†ğŸ˜µï¼Œç›®çš„æ˜¯ <strong>Form æœ¬èº«å»åˆ¤æ–· input å‡ºç¾å°± autofocus</strong>ï¼Œæ‡‰è©²æŠŠåŠŸèƒ½è·Ÿ Form ç¶åœ¨ä¸€èµ·ï¼Œä¸¦éé€éå¤–éƒ¨çš„å…ƒä»¶ä¾†æ§åˆ¶ï¼Œé€™æ¨£æœƒä½¿ APP è·Ÿè‘— re-render ï¼Œæ˜¯ä¸å¿…è¦çš„ï¼Œæ‰€ä»¥æ‡‰è©²æ˜¯ Form å…ƒä»¶æœ¬èº« state æ”¹è®Šï¼Œ input åŸ·è¡Œ <code>onfocus</code>ã€‚</p><p>è£œ : å¾Œä¾†æˆ‘åˆæƒ³äº†æƒ³ï¼Œæ‡‰è©²æ˜¯æŒ‡ ref å‚³ä¸‹å»ä¸çŸ¥é“æ˜¯ä¸æ˜¯æœ‰æŠ“åˆ°è©²å€¼ï¼Œç”±æ–¼ ref æ˜¯å¯ä»¥ç›´æ¥æ”¹è®Šçš„ï¼Œå¦‚æœåœ¨ render æœŸé–“æ”¹è®Šï¼Œæœƒé€ æˆçµæœä¸åŒğŸ¤”ã€‚</p><p>ç¬¬äºŒæ¬¡å˜—è©¦ï¼Œç›´è¦ºä¸Šæˆ‘å€‘æœƒåœ¨ Form å…ƒä»¶ç”¨ state é€é effect ä¾†æ“ä½œï¼Œé€™ä¹Ÿæ˜¯å¯ä»¥çš„ :</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> ref = <span class="title class_">React</span>.<span class="title function_">useRef</span>(<span class="literal">null</span>)</span><br><span class="line">  <span class="comment">// âŒ ä¸éœ€è¦ effect äº†</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Form</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> /&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Form</span> = <span class="title class_">React</span>.<span class="title function_">forwardRef</span>(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [show, setShow] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="literal">false</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ç”¨ effect ä¾†è£œé€™å€‹å•é¡Œ</span></span><br><span class="line">  <span class="title class_">React</span>.<span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(show)&#123;</span><br><span class="line">      ref.<span class="property">current</span>?.<span class="title function_">focus</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,[show]) <span class="comment">// ç•¶æŒ‰ä¸‹æŒ‰éˆ•å°±é¡¯ç¤ºï¼ŒåŸ·è¡Œ focus</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setShow(true)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        show</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;show &amp;&amp; <span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">  )</span><br></pre></td></tr></table></figure><p>æ©â€¦é›–ç„¶é€™å¯ä»¥è§£æ±ºå•é¡Œï¼Œä½† effect å…¶å¯¦ä¸å¿…é€™æ¨£æª¢æŸ¥ show ï¼Œä½•æ³ button åªè§¸ç™¼ä¸€æ¬¡çš„ <code>setShow</code>ğŸ¤”ï¼Œé›£é“ä¸èƒ½è®“å®ƒç”¢ç”Ÿçš„æ™‚å€™è‡ªå·±  focus å— ? ç•¶ input <code>mount</code> å°±è‡ªå·± focus ã€‚</p><p>å¦ä¸€å€‹è‘—æ‰‹é»å°±æ˜¯æŠŠ <code>autoFocus</code> è£ä¸Šå»ï¼Œ input åš <code>mount</code> åˆ <code>unmout</code> å° React ä¾†èªªéƒ½æ˜¯æ–°çš„ç¯€é»èª•ç”Ÿ :</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;show &amp;&amp; <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">autoFocus</span>/&gt;</span></span>&#125;</span><br></pre></td></tr></table></figure><p>ä¸éè¡ç”Ÿå•é¡Œå°±åœ¨ [[#å¯¦ä½œ ä½¿ç”¨ state ä¾†æ§åˆ¶ autofocus]] çš„éƒ¨åˆ†æœ‰è¨è«–éï¼Œå¦‚æœåœ¨ input æ˜¯ â€œå·²å‡ºç¾â€ çš„ç‹€æ³ä¸‹é€éæŒ‰éˆ•ä¾†æ§åˆ¶ <code>autoFocus</code> ï¼Œç”±æ–¼ React çš„æ·ºæ¯”è¼ƒå„ªåŒ–å°è‡´å…ƒä»¶åƒ…ä¿®æ”¹å±¬æ€§ï¼Œè€Œ  <code>autoFocus</code> åªæœƒåœ¨å…ƒä»¶ mount åŸ·è¡Œã€‚</p><p>æœ€å¾Œä¸€å€‹è§£æ±ºçš„å•é¡Œå°±æ˜¯é  <strong>callback ref</strong> è‡ªå·±å»åˆ¤æ–· Element node æ˜¯å¦å­˜åœ¨å»åŸ·è¡Œé‚è¼¯ :</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Form</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Form</span> = (<span class="params">props</span>)=&gt;&#123;</span><br><span class="line">  <span class="keyword">const</span> [show, setShow] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setShow(true)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        show</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;show &amp;&amp; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          // <span class="attr">ref</span> <span class="attr">æ¥æ”¶çš„æ˜¯ä¸€å€‹</span> <span class="attr">function</span>ï¼Œ<span class="attr">åƒæ•¸æœƒæ˜¯</span> <span class="attr">DOM</span> <span class="attr">ç¯€é»æœ¬èº«</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">ref</span>=<span class="string">&#123;(node)</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">            if (node) &#123;</span></span><br><span class="line"><span class="language-xml">              node.focus();</span></span><br><span class="line"><span class="language-xml">            &#125;</span></span><br><span class="line"><span class="language-xml">          &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        /&gt;</span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æª¢æŸ¥ node æ˜¯å¦å­˜åœ¨å†å‘¼å«ï¼Œå› ç‚º ref æ˜¯åœ¨ <code>componentDidMount</code> æˆ– <code>componentDidUpdate</code> æ‹¿åˆ°æœ€æ–°å€¼ï¼Œç°¡å–®ä¾†èªªå°±æ˜¯ render éšæ®µåŸ·è¡Œï¼Œåœ¨æˆ‘å€‘ <code>setShow</code> æ”¹è®Š show ç‚º true é€²åˆ° render éšæ®µï¼Œå¦‚æœæ²’æœ‰åŠ ä¸Šåˆ¤æ–·ï¼Œæœƒå°è‡´ <code>unmout</code> æ™‚åŸ·è¡ŒéŒ¯èª¤ã€‚</p><p>å¦‚æœæˆ‘å€‘ä¸åˆ¤æ–· node æ˜¯å¦å­˜åœ¨ï¼ŒåŸ·è¡Œé †åºä¸Šæ˜¯é€™æ¨£ :</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬ä¸€æ¬¡ render</span></span><br><span class="line"><span class="keyword">const</span> show = <span class="literal">false</span></span><br><span class="line">input callback ref ä¸æœƒåŸ·è¡Œ</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨è€…æŒ‰ä¸‹æŒ‰éˆ•è§¸ç™¼ setShow re-render</span></span><br><span class="line"><span class="keyword">const</span> show = <span class="literal">true</span></span><br><span class="line"><span class="comment">// input ref function åŸ·è¡Œï¼Œ function(node) åƒæ•¸æ˜¯è©² DOM å…ƒç´ </span></span><br><span class="line">node.<span class="title function_">focus</span>() <span class="comment">// âœ… åŸ·è¡ŒæˆåŠŸï¼Œnode ä¸æ˜¯ null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å†æŒ‰ä¸€æ¬¡æŒ‰éˆ• setShow re-render </span></span><br><span class="line"><span class="keyword">const</span> show = <span class="literal">false</span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">  input unmoutï¼Œref function åŸ·è¡Œï¼Œref å›åˆ° null ä»£è¡¨ç¯€é»æ¶ˆå¤±ï¼Œå…ƒç´ æ¶ˆå¤±äº† node = null </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">node.<span class="title function_">focus</span>() <span class="comment">//ğŸ˜µ åŸ·è¡Œå¤±æ•—</span></span><br></pre></td></tr></table></figure><p>callback ref æœƒåœ¨ component  <code>mount</code> è·Ÿ <code>unmout</code> éƒ½å„åŸ·è¡Œä¸€æ¬¡ï¼Œä½† <code>unmount</code> é‚£æ¬¡å°±ä¸æœƒæŠ“åˆ°åƒæ•¸æœ¬èº«ï¼Œå› ç‚º ref å›å‚³çš„æ˜¯ nullã€‚</p><p>å¯«æˆ inline çš„æ–¹å¼å°±æœƒä½¿å…ƒä»¶ re-render ä¹Ÿè·Ÿè‘—é‡æ–°å»ºç«‹ functionï¼Œå¯ä»¥ç”¨ <code>useCallback</code> æŠŠ function è¨˜èµ·ä¾†ï¼Œé¿å…ä¸å¿…è¦çš„ render :</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Form</span> = (<span class="params">props</span>)=&gt;&#123;</span><br><span class="line">  <span class="keyword">const</span> [show, setShow] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="comment">// 1. å»ºç«‹ function</span></span><br><span class="line">  <span class="keyword">const</span> inputRef = <span class="title class_">React</span>.<span class="title function_">useCallback</span>(<span class="function">(<span class="params">node</span>)=&gt;</span>&#123;</span><br><span class="line">    node?.<span class="title function_">focus</span>();</span><br><span class="line">  &#125;,[])</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setShow(true)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        show</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;show &amp;&amp; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          // <span class="attr">2.</span> <span class="attr">å¡«å…¥</span> <span class="attr">function</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1>callback ref çš„ä½¿ç”¨æ™‚æ©Ÿ</h1><ol><li>ç¯€é»æœƒæ¶ˆå¤±åˆå‡ºç¾ï¼Œéœ€è¦å‹•æ…‹çš„æ§åˆ¶å…ƒä»¶æœ¬èº«</li><li>æ¸¬é‡ DOM çš„ä½ç½®ã€å¤§å°</li></ol><p>callback ref æä¾›å‹•æ…‹çš„æ–¹å¼è®“æˆ‘å€‘å–å¾— DOM ç¯€é»ï¼Œä¸¦ä¸”åœ¨ browser painting ä¹‹å‰å¯ä»¥åšä¸€äº›äº‹ã€‚å¾ä¸Šé¢ <code>autofocus</code> å¯ä»¥è®“å…ƒä»¶å»ºç«‹åˆåš DOM çš„ <code>focus()</code>ã€‚</p><h2 id="å°å¯¦ä½œ">å°å¯¦ä½œ</h2><p>Accordion çš„å…§å®¹æœƒæŒ‰ç…§ <code>open</code> é–‹é—œå½±éŸ¿é«˜åº¦ï¼Œæˆ‘å€‘åªè¦åœ¨ <code>open</code> è§¸ç™¼ re-render æ™‚ï¼Œä¸€ä½µæŠŠæ¨£å¼æ”¹è®Šå°±å¯ä»¥è¼•é¬†åšåˆ°åŠŸèƒ½ã€‚<br>ğŸ‘‰<a href="https://codepen.io/shan473/pen/MWVxzPX">Collapsibles/Accordion React callback ref</a></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Accordion</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 1. é–‹é—œæ§åˆ¶</span></span><br><span class="line">  <span class="keyword">const</span> [open,setOpen] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="literal">false</span>)</span><br><span class="line">  <span class="comment">// 2. callback ref node å­˜åœ¨ä¸” open = true</span></span><br><span class="line">  <span class="keyword">const</span> panelRef = <span class="title class_">React</span>.<span class="title function_">useCallback</span>(<span class="function">(<span class="params">node</span>)=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(node &amp;&amp; open)&#123;</span><br><span class="line">        node.<span class="property">style</span>.<span class="property">maxHeight</span> =node.<span class="property">scrollHeight</span> +<span class="string">&#x27;px&#x27;</span></span><br><span class="line">      &#125;<span class="keyword">else</span> <span class="keyword">if</span>(node &amp;&amp; !open)&#123;</span><br><span class="line">        node.<span class="property">style</span>.<span class="property">maxHeight</span> =<span class="number">0</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;,[open])</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;accordion&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span> setOpen(open =&gt; !open)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        Section</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">className</span>=<span class="string">&quot;panel&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">ref</span>=<span class="string">&#123;panelRef&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do</span></span><br><span class="line"><span class="language-xml">          eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad</span></span><br><span class="line"><span class="language-xml">          minim veniam, quis nostrud exercitation ullamco laboris nisi ut</span></span><br><span class="line"><span class="language-xml">          aliquip ex ea commodo consequat.</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç•¶ç„¶é€™æ¨£çš„æ–¹å¼ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>useRef</code> æ­é… <code>useEffect</code> ä¾†å¯¦ä½œ :</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> panelRef = <span class="title class_">React</span>.<span class="title function_">useRef</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="title class_">React</span>.<span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line"> panelRef.<span class="property">current</span>.<span class="property">style</span>.<span class="property">maxHeight</span>= open ? panelRef.<span class="property">current</span>.<span class="property">scrollHeight</span> +<span class="string">&#x27;px&#x27;</span> : <span class="number">0</span></span><br><span class="line">&#125;,[open])</span><br></pre></td></tr></table></figure><p>ç›®å‰é‚„æƒ³ä¸åˆ°å¯¦éš›ä¸Šçš„å·®ç•°ï¼Œä½†è«–æ™‚é–“é»ä¾†èªªï¼ŒuseEffect æœƒåœ¨ render ä¹‹å¾Œæ‰åŸ·è¡Œï¼Œå¾ˆå¯èƒ½ç•«é¢æœƒé€ æˆä¸€ç¬é–“çš„é–ƒçˆï¼Œé€™æ™‚å€™æˆ‘å€‘å¯èƒ½æœƒç”¨ <code>useLayoutEffect</code> ä¾†è™•ç†ï¼Œåœ¨ painting ä¹‹å‰å°±åŸ·è¡ŒçµæŸï¼Œåƒæ˜¯æ¨£å¼çš„æ›´æ–°ï¼Œé€™ä¸æœƒè®“ä½¿ç”¨è€…çœ‹åˆ°ç•«é¢çªç„¶é–ƒä¸€ä¸‹è®ŠåŒ–ã€‚</p><p>é€šå¸¸ ref + <code>useEffect</code> éƒ½å¯ä»¥åšåˆ° callback ref åšåˆ°çš„äº‹ã€‚ä½†  <code>useEffect</code> å…·æœ‰ clean up functionï¼Œå‡å¦‚å…ƒä»¶å…·æœ‰ç›£è½äº‹ä»¶ä¸” <code>unmount</code> æ™‚ï¼Œéœ€è¦åšæ¸…é™¤çš„å‹•ä½œ (clean up function)ï¼Œeffect ä½¿æ™‚æˆ‘å€‘æ‹¿åˆ°çš„ <code>ref.current</code> ä¾èˆŠæ˜¯ä¸Šä¸€æ¬¡ render ï¼Œå° <code>ref.current</code> å–æ¶ˆç›£è½äº‹ä»¶æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ callback ref åœ¨ unmount æ™‚æœƒæŠŠ node å›æ­¸åˆ° nullï¼Œä¸èƒ½å° null å–æ¶ˆç›£è½äº‹ä»¶ã€‚</p><h2 id="æ³¨æ„-3">æ³¨æ„</h2><p>å¦‚æœ callback ref  æ˜¯è¢« inline function æ‰€å®šç¾©çš„ï¼Œæœƒåœ¨æ›´æ–°çš„æ™‚å€™è¢«å‘¼å«å…©æ¬¡ã€‚render ä¸€æ¬¡ï¼Œmount ä¸€æ¬¡ã€‚ç¬¬ä¸€æ¬¡ç”¨ null ç„¶å¾Œå†ç”¨ DOM element å‘¼å«ä¸€æ¬¡ã€‚é€™æ˜¯å› ç‚ºæ–°çš„ function çš„ instance æ˜¯åœ¨æ¯æ¬¡ render çš„æ™‚å€™è¢«ç”¢ç”Ÿï¼Œæ‰€ä»¥ React éœ€è¦å°‡èˆŠçš„ ref æ¸…æ‰ç„¶å¾Œè¨­å®šæ–°çš„ã€‚</p><p>å¯ä»¥å®šç¾© callback ref ç‚º class ä¸Šçš„ä¸€å€‹ bound method (<code>method.bind</code>) ä¾†é¿å…é€™ç¨®æƒ…å½¢ï¼Œä½†åœ¨å¤§å¤šæƒ…æ³ä¸‹ä»–ä¸¦æ²’æœ‰ä»»ä½•å½±éŸ¿ã€‚</p><blockquote><p>ç°¡å–®ä¾†èªª function ä¸è¦éš¨ render æ¯æ¬¡éƒ½ç”¢ç”Ÿæ–°çš„ï¼Œå°‡å…¶çµ¦è¨˜ä½ã€‚</p></blockquote><h1>ref ã€ effect èˆ‡ layouteffect</h1><p>ğŸ‘‰ <a href="https://codepen.io/shan473/pen/BarbEWJ?editors=0011">Box moving / multiple ref test with show null</a> æˆ‘è©¦åš <code>ref + useEffect</code> ã€ <code>ref + uselayoutEffect</code>  ï¼Œä¾†çœ‹çœ‹é€™ä¸‰è€…çš„æ™‚é–“é»ã€‚</p><p>æ ¹æ“šç¯„ä¾‹å°å‡º <code>render</code> ã€<code>mount</code>  ä»¥åŠ <code>unmout</code> æ™‚é–“ :</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// render</span></span><br><span class="line">callback ref call <span class="literal">undefined</span> (ä¸ç®¡æœ‰æ²’æœ‰ node)</span><br><span class="line">callback ref call <span class="literal">null</span> node <span class="literal">undefined</span></span><br><span class="line">callback ref render <span class="literal">undefined</span></span><br><span class="line">render effect <span class="literal">null</span></span><br><span class="line">render layout <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// mount </span></span><br><span class="line">callback ref call (ä¸ç®¡æœ‰æ²’æœ‰ node)</span><br><span class="line">  &lt;div <span class="keyword">class</span>=â€‹<span class="string">&quot;box one&quot;</span> style=â€‹<span class="string">&quot;top:â€‹ 100px;â€‹&quot;</span>&gt;â€‹callback refâ€‹&lt;/div&gt;â€‹</span><br><span class="line">callback ref call <span class="keyword">in</span> node </span><br><span class="line">  &lt;div <span class="keyword">class</span>=â€‹<span class="string">&quot;box one&quot;</span> style=â€‹<span class="string">&quot;top:â€‹ 100px;â€‹&quot;</span>&gt;â€‹callback refâ€‹&lt;/div&gt;â€‹</span><br><span class="line"><span class="keyword">in</span> effect layout </span><br><span class="line">  &lt;div <span class="keyword">class</span>=â€‹<span class="string">&quot;box three&quot;</span> style=â€‹<span class="string">&quot;top:â€‹ 100px;â€‹&quot;</span>&gt;â€‹layout effectâ€‹&lt;/div&gt;â€‹</span><br><span class="line"><span class="keyword">in</span> effect </span><br><span class="line">  &lt;div <span class="keyword">class</span>=â€‹<span class="string">&quot;box two&quot;</span> style=â€‹<span class="string">&quot;top:â€‹ 100px;â€‹&quot;</span>&gt;â€‹effectâ€‹&lt;/div&gt;â€‹</span><br><span class="line"></span><br><span class="line"><span class="comment">// unmount</span></span><br><span class="line">callback ref call <span class="literal">null</span> (ä¸ç®¡æœ‰æ²’æœ‰ node)</span><br><span class="line">callback ref call <span class="literal">null</span> node <span class="literal">null</span></span><br><span class="line">clean up layout </span><br><span class="line">  &lt;div <span class="keyword">class</span>=â€‹<span class="string">&quot;box three&quot;</span> style=â€‹<span class="string">&quot;top:â€‹ 100px;â€‹&quot;</span>&gt;â€‹layout effectâ€‹&lt;/div&gt;â€‹</span><br><span class="line">clean up effect <span class="literal">null</span></span><br></pre></td></tr></table></figure><ol><li>callback ref åœ¨ render æ™‚ call å† mount æ™‚åˆ call</li><li><code>layoutEffect</code> åœ¨ unmount æ™‚ ref é‚„æ²’æ¶ˆå¤±ğŸ¤”</li></ol><p>ç¶²è·¯ä¸Šå·²ç¶“æœ‰äººæŠŠå®ƒè£½æˆè¡¨æ ¼ï¼Œè€Œä¸”é‚„æœ‰ updating ğŸ˜„<br><img data-src="https://blog.thoughtspile.tech/images/react-ref-order-f455246e4b65dcd8bad4434384f2460e.png" alt="|400x180"></p><blockquote><p>åœ–æºè‡ª : <a href="https://blog.thoughtspile.tech/2021/05/17/everything-about-react-refs/">So you think you know everything about React refs</a></p></blockquote><p>effect åœ¨ unmount è®€å– node ä¹Ÿæœƒæ¶ˆå¤±ï¼Œä½†å¯ä»¥åˆ©ç”¨ closure çš„ç‰¹æ€§ï¼Œå»ºç«‹è®Šæ•¸å…ˆå°‡ node çµ¦è¨˜ä½ï¼Œåœ¨ <code>unmout</code> å‘¼å« clean up function æ™‚å–æ¶ˆç›£è½äº‹ä»¶ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">React</span>.<span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// åˆ»æ„è¨˜ä½ï¼Œå› ç‚º boxRef æ˜¯æœƒè®Šå‹•çš„</span></span><br><span class="line">  <span class="keyword">const</span> keepRef = boxRef.<span class="property">current</span></span><br><span class="line">  boxRef.<span class="property">current</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, changeColor);</span><br><span class="line">  boxRef.<span class="property">current</span>.<span class="property">style</span>.<span class="property">top</span> = <span class="string">&quot;100px&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// null , box two æœ¬èº«</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(boxRef.<span class="property">current</span>,keepRef.<span class="property">current</span>)</span><br><span class="line">    keepRef.<span class="property">current</span>.<span class="title function_">removeEventListener</span>(<span class="string">&quot;click&quot;</span>, changeColor);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><p>é‚£ <code>layoutEffect</code> å¯ä»¥ç›´æ¥åœ¨æ¸…é™¤åŸ·è¡Œå–æ¶ˆç›£è½å— ? é›–ç„¶ <code>ref.current</code> ä¾èˆŠå­˜åœ¨ï¼Œä½†é‚„æ˜¯ä¸å®‰å…¨çš„ï¼Œæœ€å¥½æ˜¯åƒ effect ä¸€æ¨£ï¼Œåˆ©ç”¨ closure çš„æ–¹å¼ä¾†å–æ¶ˆç›£è½äº‹ä»¶ã€‚</p><h1>callback ref çš„ clean up function</h1><blockquote><p>å®˜æ–¹è¨è«–ä¸² :  <a href="https://github.com/facebook/react/issues/15176">React callback ref cleanup function Â· Issue #15176 Â· facebook/react Â· GitHub</a></p></blockquote><p>åœ¨ React 18 é‡‹å‡ºä»¥å‰å·²ç¶“æœ‰æ¢è¨ callback ref clean up çš„å•é¡Œï¼Œä¸Šé¢æœ‰æåˆ°ç•¶ callback ref åœ¨ <code>unmount</code> å‘¼å«æ™‚æ˜¯ nullï¼Œå› æ­¤è¨»éŠ·ç›£è½äº‹ä»¶æ˜¯ä¸å®¹æ˜“çš„ï¼Œå› æ­¤æœ‰äººæå‡ºä¸€äº›è§£æ±ºæ–¹æ¡ˆï¼Œæœªä¾†ä¹Ÿå¯èƒ½å‡ºç¾æ–°çš„ API ä¾†è§£æ±ºæ­¤å•é¡ŒğŸ¤”ï¼Œå¤§æ¦‚çœ‹å®Œ RFC ç›®å‰æ‡‰è©²æ˜¯æ²’æœ‰æ‰“ç®—å»ºç«‹æ–° API ï¼Œçµå°¾éƒ½æŒ‡å‡ºé€™æ¨£çš„æ”¹è®Šå¯èƒ½å°è‡´æ–°èˆŠæœƒç”¢ç”Ÿè¡çªã€‚</p><p>ä¸éé€™éƒ¨åˆ†æˆ‘é‚„æ²’è©³è®€ğŸ˜µï¼Œå…ˆè¨˜éŒ„èµ·ä¾†ï¼Œä¹‹å¾Œæœƒå†å¯«æ–‡ç« ä¾†ç ”ç©¶ç ”ç©¶ğŸ¤”</p><ol><li>Dan å¤§æœ‰æåˆ°ï¼ŒuseCallback å¦‚æœå›å‚³ function ï¼Œç­‰åŒæ–¼åšå‡ºæ–°çš„è¡Œç‚ºï¼Œå°±ä¸æœƒæœ‰å‘¼å«åˆ° null å¾—çš„å•é¡Œï¼ŒğŸ¤”ã€‚ <a href="https://github.com/reactjs/rfcs/pull/205">RFC: Callback Ref Cleanup by KurtGokhan Â· Pull Request #205</a></li><li>æˆ‘è¦ºå¾—å¾ˆç„çš„å•é¡Œï¼Œ æ”¹è®Š ref ä¸ re-render ï¼Œä½†æ˜¯é€™å€‹éœ€æ±‚å»è¦æ±‚ ref è¦è·Ÿ state åšä¸€æ¨£çš„äº‹ğŸ¤”ï¼Œä¸éæœ€å¾Œä¹Ÿæ˜¯æåˆ° <code>return ()=&gt;&#123;&#125;</code> clean up function ã€‚<a href="https://github.com/facebook/react/issues/21903">React 18 letâ€™s make ref.currant to be reactive value Â· Issue #21903 </a></li><li>é€™ä¸€ä¸²è¨è«– Custom Hooks å°‡ ref å¤–å‚³ï¼Œç„¶å¾Œ <code>useEffect</code> çš„ deps æ˜¯æ”¾å…¥ <code>ref.current</code> é€™ä»¶äº‹ã€‚è½èµ·ä¾†æœ‰é»åè¨­è¨ˆï¼Œå› ç‚º ref ä¸æœƒè§¸ç™¼ re-render ï¼Œä½†æ˜¯å»æŠŠå®ƒæ”¾åœ¨ deps ä¸­ç›£è½æ˜¯å¦æœ‰æ”¹è®Šå†éš¨ re-render é‡æ–°å‘¼å«ğŸ¤” <a href="https://github.com/facebook/react/issues/16154">Accessing state/props in callback ref with hooks Â· Issue #16154</a></li><li>æ ¹æ“šç¬¬ä¸‰é»å®˜æ–¹æå‡ºçš„è§£æ±ºè¾¦æ³• : <a href="https://reactjs.org/docs/hooks-faq.html#how-to-read-an-often-changing-value-from-usecallback">Hooks FAQ â€“ How to read an often-changing value from useCallback?t</a></li></ol><p>ä»¥ä¸Šéƒ½æ˜¯è™•ç†é‚Šéš›æ¢ä»¶ (edge case) çš„è¨è«–ã€‚</p><h1>ç¸½çµ</h1><ol><li>ref å¯ä»¥çœ‹åšæ˜¯ä¸€å€‹æ™®é€š JavaScript ç‰©ä»¶ï¼Œå¸¶æœ‰ <code>current</code> å±¬æ€§ï¼ŒReact ç¢ºä¿æ”¹è®Šå®ƒä¸æœƒé€ æˆ re-renderï¼Œä¹Ÿä¸æœƒéš¨ç”Ÿå‘½é€±æœŸæ”¹è®Š ã€‚</li><li>ä¸èƒ½ä½¿ç”¨ <code>useRef</code> æ›¿ä»£ <code>useState</code>ã€‚ <code>useRef</code> ä¸æœƒè§¸ç™¼ re-render ï¼Œæ“ä½œå¾Œä¸ä¿è­‰èƒ½åŒæ­¥ UI (è³‡æ–™æ”¹äº†ä½†æ˜¯ React ä¸æœƒåˆ·æ–°ç•«é¢ï¼Œåƒè¦‹ : [[#æŠ“ Previous çš„å€¼]])ã€‚</li><li>æœ€å¥½åœ¨ effect æˆ–æ˜¯ event handler è£¡é¢æ›´æ–° ref ï¼Œå› ç‚º ref çš„å»ºç«‹èˆ‡æ›´æ–°çš„æ™‚é–“é»ã€‚</li><li>æœ€å¸¸æ‹¿ä¾†ç›´æ¥æ“ä½œ DOM å…ƒç´ ã€‚</li><li>callback ref å¸¸ç”¨ä¾†æ¸¬é‡ DOM çš„å¤§å°</li></ol><p>éç¨‹ä¸­å·®é»å¿˜è¨˜ä¸»è¦ç›®çš„æ˜¯èªè­˜ ref çš„ç”¨é€”ï¼Œä¸€ä¸å°å¿ƒæŒ–å¤ªæ·±ğŸ¤“ï¼ŒåŒæ™‚ä¹Ÿçœ‹åˆ°åŸä¾† callback ref æœ‰é€™éº¼å¤šå¯æ“´å±•çš„æ–¹å¼ï¼Œæˆ‘ä¸€é–‹å§‹ä¸å¤ªèƒ½ç†è§£ callback ref è¦æ€éº¼ä½¿ç”¨ ï¼Œå› ç‚º <code>useEffect + ref</code> éƒ½èƒ½è§£æ±ºå¤§éƒ¨åˆ†çš„å•é¡Œï¼Œåªæ˜¯éº»ç…©äº†é»ğŸ¤”ã€‚å¾ŒçºŒ ref çš„éƒ¨ä»½æœƒå†å¯«ä¸€ç¯‡å†æ·±å…¥ ref çš„æ–‡ç« ã€‚</p><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style:none; padding-left: 0;"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">1.</span><span style="display: inline-block; vertical-align: top;">å»¶é²åˆå§‹åŒ–æ˜¯æŒ‡åˆå§‹å€¼éœ€è¦ç¶“éè¨ˆç®—è€Œä¾†ï¼Œæˆ‘å€‘åªéœ€è¦åœ¨ render ä¸€æ¬¡å»ºç«‹å°±å¥½</span><a href="#fnref:1" rev="footnote"> â†©</a></li></ol></div></div>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ–‡ç« ä¾†è‡ª :&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://zh-hant.reactjs.org/docs/refs-and-the-dom.html&quot;&gt;Refs å’Œ DOM â€“ React&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://medium.com/hannah-lin/react-hook-%E7%AD%86%E8%A8%98-useref-c628cbf0d7fb&quot;&gt;React Hook ç­†è¨˜ useRef. useRef ç¥å¥‡çš„åœ°æ–¹é™¤äº†å¯ä»¥åœ¨ä¸ re-renderâ€¦ &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.linkedin.com/pulse/imperative-vs-declarative-programming-javascript-yehuda-margolis&quot;&gt;Imperative vs Declarative Programming in JavaScript&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;h1&gt;æ‘˜è¦&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;ä»€éº¼æ˜¯ ref ?&lt;/li&gt;
&lt;li&gt;ref ä½¿ç”¨çš„æ™‚æ©Ÿ&lt;/li&gt;
&lt;li&gt;ref çš„å¦ä¸€ç¨®å‹æ…‹ callback ref&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    <category term="Front-end" scheme="https://blog.rosa.tw/categories/Front-end/"/>
    
    <category term="React" scheme="https://blog.rosa.tw/categories/Front-end/React/"/>
    
    
    <category term="React" scheme="https://blog.rosa.tw/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>ç­†è¨˜ | React - é‡æ–°äº†è§£ useEffect</title>
    <link href="https://blog.rosa.tw/2022/08/React/react-useEffect-about-everythings"/>
    <id>https://blog.rosa.tw/2022/08/React/react-useEffect-about-everythings</id>
    <published>2022-08-14T03:27:57.000Z</published>
    <updated>2022-08-14T15:28:46.954Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ–‡ç« ä¾†è‡ª : <a href="https://overreacted.io/zh-hant/a-complete-guide-to-useeffect/">useEffect çš„å®Œæ•´æŒ‡å— â€” Overreacted</a></p></blockquote><h2 id="æ‘˜è¦-6">æ‘˜è¦</h2><ol><li>useEffect çš„åŸºç¤æ¦‚å¿µ</li><li>useEffect dependencies array çš„ä½¿ç”¨æ–¹å¼</li></ol><p>å¤§éƒ¨åˆ†éƒ½æ˜¯ä¾†è‡ªåŸæ–‡çš„å†ç¿»è­¯ï¼Œæˆ‘æœ‰äº›æ¯”è¼ƒä¸æ‡‚çš„éƒ¨åˆ†å°±ç”¨è‡ªå·±çš„æ–¹å¼å»è§£é‡‹ï¼Œä¹Ÿæœƒç”¨åŸå§‹çš„ JS å¯¦ä½œçš„æ–¹å¼ï¼Œè·Ÿè‘—ä¸€æ­¥æ­¥ç·¨è­¯ã€‚</p><p>æ›´é‡è¦çš„æ˜¯ï¼Œè¦ç”¨ React çš„æ€ç¶­ä¾†å»äº†è§£ <code>useEffect</code> çš„å…§æ¶µã€‚</p><span id="more"></span><h2 id="React-çš„æ¸²æŸ“æ©Ÿåˆ¶">React çš„æ¸²æŸ“æ©Ÿåˆ¶</h2><p>äº†è§£ useEffect ä¹‹å‰ï¼Œå…ˆä¾†äº†è§£ <code>setState</code> çš„æ™‚å€™æœƒç™¼ç”Ÿä»€éº¼äº‹ã€‚<br>ç•¶æˆ‘å€‘ <code>setState</code> æ™‚ï¼ŒReact æœƒé‡æ–°å‘¼å« Component functionï¼Œä¸¦æ›´æ–°å…¶å€¼ï¼Œæ¥è‘—<br>React æŠŠæˆ‘å€‘æœ€æ–°çš„å€¼æ›´æ–°åˆ° DOM ä¸Šã€‚</p><p>è€Œ <code>useEffect</code> åŸ·è¡Œçš„æ™‚é–“é»åœ¨ render ä¹‹å¾Œï¼Œç‚ºä»€éº¼ <code>useEffect</code> æœƒæ‹¿åˆ°èˆŠçš„ state è·Ÿ props ?</p><blockquote><p>æ¯ä¸€æ¬¡éƒ½æ¸²æŸ“éƒ½ä¿æœ‰è‡ªå·±çš„ state è·Ÿ props</p></blockquote><p>æˆ‘å€‘è©¦è‘—æŠŠæ¯æ¬¡ render æ‹†é–‹ä¾†</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// useState </span></span><br><span class="line"><span class="keyword">const</span> [count,setCount] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬ 1 æ¬¡ render æ˜¯é€™æ¨£</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> count = <span class="number">0</span></span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç¬¬ 2 æ¬¡ render</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> count = <span class="number">1</span></span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯æ¬¡ render é‡æ–°å‘¼å« <code>Counter()</code> ï¼ŒæŠŠ count æ¯æ¬¡é‡æ–°è³¦å€¼ï¼Œæ¯æ¬¡ render state éƒ½æœƒæ˜¯ç¨ç«‹çš„ã€‚</p><p>ä»€éº¼æ„æ€å‘¢ï¼ŸğŸ¤” å°±æ˜¯ä½ åœ¨ä¸€å‘¨ç›®çœ‹åˆ°çš„è³‡æ–™ï¼Œæ—¢ç„¶ä½ åœ¨ä¸€å‘¨ç›®å–è³‡æ–™ï¼Œé‚£ä¹Ÿåªæœƒæ‹¿åˆ°ä¸€å‘¨ç›®çš„è³‡æ–™ã€‚ä¸¦ä¸èƒ½ç›´æ¥å–äºŒã€ä¸‰å‘¨ç›®çš„æ±è¥¿ã€‚</p><p><code>useEffect</code> é›–ç„¶æ˜¯æ¸²æŸ“å¾ŒåŸ·è¡Œçš„ï¼Œä½†ä»–å…¶å¯¦é‚„æ˜¯å¾…åœ¨åŒä¸€å€‹æ™‚é–“ç·šçš„æ¸²æŸ“ (ä¹Ÿå°±æ˜¯åŒæ­¥çš„)ï¼Œä¸¦ä¸æ˜¯çœŸæ­£æ„å‘³ä¸Šçš„ã€Œæ¸²æŸ“ <strong>å¾Œ</strong>ã€ï¼Œåˆ¥è¢«æ–‡å­—ææ··äº†ã€‚</p><h2 id="render-function-å…§çš„-function">render function å…§çš„ function ?</h2><p>æ–‡ä¸­<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>ç¯„ä¾‹é †åºæ˜¯</p><ol><li>æŠŠ state åŠ åˆ° 3</li><li>æŒ‰ä¸‹ <code>alert</code> æŒ‰éµ ( <code>setTimeout</code> for <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">3</span></span></span></span> seconds , and é¡¯ç¤º state )</li><li>é¦¬ä¸ŠæŠŠ state åŠ åˆ° 5ï¼Œæœ€å¾Œé¡¯ç¤ºæ˜¯ ?</li></ol><blockquote><p>çµæœæ˜¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">3</span></span></span></span> ï¼Œé€™è£¡æ˜¯æŠ“åˆ° (capture) æŒ‰ä¸‹æŒ‰éˆ•çš„ <strong>ç•¶ä¸‹</strong></p></blockquote><p>å¯ä»¥æƒ³åƒæˆèŠå¤© app ï¼Œè·Ÿ A èŠå¤©é€å‡ºè¨Šæ¯ï¼Œæ¥è‘—é¦¬ä¸Šåˆ‡æ›è·Ÿ B è¼¸å…¥è¨Šæ¯ï¼Œç¢ºå¯¦æ˜¯ A æ”¶åˆ°è¨Šæ¯ï¼Œä¸¦ä¸æ˜¯ B æ”¶åˆ°ã€‚<br>åœ¨ class Component è·Ÿ functional Component å…©ç¨®è§£æ±ºä¸åŒçš„å•é¡Œ (é–‰åŒ…)</p><h3 id="function-å…§éƒ¨æ‰€å¼•ç”¨çš„-state-é—œä¿‚">function å…§éƒ¨æ‰€å¼•ç”¨çš„ state é—œä¿‚</h3><p>å¾æœ€æ ¹æœ¬çš„ JavaScript ä¾†çœ‹ï¼Œä¾‹å­æ˜¯å¾æ–‡ç« ä¾†çš„</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sayHi</span>(<span class="params">person</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> name = person.<span class="property">name</span>;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;Hello, &#x27;</span> + name);</span><br><span class="line">  &#125;, <span class="number">3000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> someone = &#123;<span class="attr">name</span>: <span class="string">&#x27;Dan&#x27;</span>&#125;;</span><br><span class="line"><span class="title function_">sayHi</span>(someone);</span><br><span class="line"></span><br><span class="line">someone = &#123;<span class="attr">name</span>: <span class="string">&#x27;Yuzhi&#x27;</span>&#125;;</span><br><span class="line"><span class="title function_">sayHi</span>(someone);</span><br><span class="line"></span><br><span class="line">someone = &#123;<span class="attr">name</span>: <span class="string">&#x27;Dominic&#x27;</span>&#125;;</span><br><span class="line"><span class="title function_">sayHi</span>(someone);</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° <code>person.name</code> ä¸€é–‹å§‹æ˜¯ â€˜Danâ€™ï¼Œä½†æ˜¯æ¯æ¬¡ <code>sayHi</code> éƒ½æœƒç¶“æ­·ä»¥ä¸‹æ­¥é©Ÿ :</p><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬ 1 æ¬¡ </span></span><br><span class="line"><span class="keyword">name</span> = Dan </span><br><span class="line">setTimout æ‹¿åˆ°çš„ <span class="keyword">name</span> æ˜¯å¤–éƒ¨çš„ <span class="keyword">name</span> = Dan</span><br><span class="line"><span class="comment">// ç¬¬ 2 æ¬¡</span></span><br><span class="line"><span class="keyword">name</span> = Yuzhi</span><br><span class="line">setTimout æ‹¿åˆ°çš„ <span class="keyword">name</span> æ˜¯å¤–éƒ¨çš„ <span class="keyword">name</span> = Yuzhi</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure><p>ç”¨ JavaScript ä¾†èªªå°±æ˜¯é–‰åŒ… (closure) çš„æ¦‚å¿µï¼ŒCall Stack åˆ° <code>setTimeout()</code> çš„æ™‚å€™ï¼Œ<code>sayHi</code> è£¡é¢å®£å‘Šçš„è®Šæ•¸æœƒè¢«å„²å­˜ä¸‹ä¾†ï¼Œå­˜åœ¨å…§éƒ¨ï¼Œä¸¦æ²’æœ‰è¢«å›æ”¶æ‰ï¼Œå› æ­¤ <code>setTimeout()</code>  ç•¶ä¸‹æ‹¿åˆ°çš„å€¼æ˜¯ <strong>å…§éƒ¨å·²ç¶“è¨ˆç®—å®Œä¸”è¢«è¨˜éŒ„èµ·ä¾†çš„å€¼</strong>ï¼Œæ‰æœƒæ˜¯æ•ç² (capture) ç•¶æ™‚çš„å€¼ã€‚</p><blockquote><p><code>setTimeout</code> æ‹¿åˆ°çš„å€¼æœƒæ˜¯ç•¶ä¸‹åŸ·è¡Œå®Œæ‰€è¨˜éŒ„ä¸‹çš„å€¼ï¼Œé€™ä¹Ÿèªªæ˜äº†ç‚ºä»€éº¼ useEffect æœƒæ‹¿åˆ°èˆŠçš„ state : <strong>ç•¶ä¸‹çš„ <code>setTimeout()</code> æ˜¯æ‹¿é–‰åŒ…çš„å€¼ã€‚</strong></p></blockquote><h3 id="å›é ­çœ‹-React-çš„-render-å…§éƒ¨çš„-function">å›é ­çœ‹ React çš„ render å…§éƒ¨çš„ function</h3><p>å·²ç¶“çŸ¥é“ <code>setTimeout</code> æœƒè¨˜éŒ„ä¸‹ç•¶æ¬¡ render çš„å€¼ï¼Œä¸ç®¡å“ªä¸€æ¬¡çš„ render ï¼Œå®ƒç•¶æ¬¡çš„ state èˆ‡ props éƒ½æœƒæ˜¯ä¸€æ¨£çš„ã€‚å¦‚æœæ˜¯ä¸åŒæ¬¡çš„ render ï¼Œå®ƒçš„ state å’Œ props æ˜¯ç¨ç«‹çš„ï¼Œåœ¨äº‹ä»¶ (event handler) æˆ–äº‹ä»¶å…§çš„éåŒæ­¥ (async/await) äº‹ä»¶ä¹Ÿéƒ½æ˜¯ä¸€æ¨£çš„åŸå‰‡ã€‚</p><p>ç¯„ä¾‹ç”¨ <code>inline function</code> æ˜¯å®‰å…¨çš„ (button çš„ click äº‹ä»¶)ï¼Œå› ç‚º state çš„ count ä¸æœƒæ¯æ¬¡éƒ½è¢«è®Šå‹• (æ„æ€æ‡‰è©²æ˜¯ <strong>ç”¢ç”Ÿæ–°çš„è¨˜æ†¶é«”ç©ºé–“</strong>ï¼ŒæŒ‡è·Ÿ object type çš„å·®åˆ¥)ï¼Œå¦‚æœ state æ˜¯ object type çš„é¡å‹ï¼Œå¿…é ˆç¢ºä¿ object æ˜¯ç”¨ <strong>Immutable</strong> çš„æ–¹å¼æ”¹è®Šã€‚</p><p>æ–‡ä¸­æåˆ° <code>setState(newObj)</code> æ˜¯åˆç†çš„ï¼Œç‚ºä»€éº¼é€™éº¼èªªå‘¢ ?<br>åªè¦<strong>è¨˜ä½æ¯æ¬¡ render éƒ½æœ‰è‡ªå·±çš„ state æˆ– props</strong> ï¼Œç›´æ¥æ”¹æ”¹æˆ <code>newObj</code>æ˜¯æ²’å•çš„ï¼Œå°æ–¼å‰ä¸€æ¬¡çš„ render ä¹Ÿæ˜¯å®Œæ•´çš„å€¼ã€‚<br>ğŸ‘‰  <a href="https://codepen.io/shan473/pen/jOzeWEb?editors=0011">codepen ç°¡æ˜“ç¯„ä¾‹ï¼Œè«‹çœ‹ useRef è®ŠåŒ–</a></p><p>ä¾‹å¦‚ : çµæ§‹é¡ä¼¼ï¼Œä½†æ˜¯å·¢ç‹€å…§éƒ¨æœ‰éƒ¨åˆ†æ”¹è®Š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‡å¦‚åŸæœ¬çš„ state</span></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  a : &#123;</span><br><span class="line">    b : <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> newState = &#123;</span><br><span class="line">  a : &#123;</span><br><span class="line">    b : <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// âœ… åˆ·æ–°æ•´ç­†è³‡æ–™ï¼Œé€™æ¨£æ²’å•é¡Œ</span></span><br><span class="line"><span class="title function_">setState</span>(newState)</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ ç›´æ¥å°å€¼å…§éƒ¨äº›å¾®èª¿æ•´ï¼ŒReact æ ¹æœ¬å¯Ÿè¦ºä¸åˆ°ï¼Œä¸æœƒ re-render</span></span><br><span class="line"><span class="title function_">setState</span>(<span class="function"><span class="params">prevState</span> =&gt;</span> &#123;</span><br><span class="line">  prevState.<span class="property">a</span>.<span class="property">b</span> = newState.<span class="property">a</span>.<span class="property">b</span></span><br><span class="line">  <span class="keyword">return</span> prevState</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ç•¶æˆ‘å€‘è¦è§¸ç™¼ <code>setState</code> æ™‚ï¼ŒReact æœƒå…ˆç¶“é state çš„æ·ºæ¯”è¼ƒ (shallow comparison)ï¼Œå¦‚æœç›´æ¥æ”¹è®Šä¸¦ä¸æœƒ re-renderã€‚</p><h2 id="æ¯ä¸€æ¬¡-render-éƒ½å®ƒè‡ªå·±çš„-Effect">æ¯ä¸€æ¬¡ render éƒ½å®ƒè‡ªå·±çš„ Effect</h2><p>React æœƒè¨˜ä½æ¯å€‹ <code>useEffect</code>ï¼Œè§¸ç™¼çš„æ™‚é–“é»æ˜¯æ¯æ¬¡æ”¹è®Š DOM ä¹‹å¾Œèˆ‡ browser æ¸²æŸ“å®Œä¹‹å¾Œæ‰æœƒå‘¼å«ã€‚</p><p>æ¦‚å¿µä¸Šä¾†èªªï¼Œeffect æ˜¯é€™æ¬¡ render å¾Œçš„çµæœ (render å¾Œæ‰åŸ·è¡Œçš„)ï¼Œä½† effect å…¶å¯¦ä¹Ÿè·Ÿä¸Šé¢æåŠçš„ [[#å›é ­çœ‹ React çš„ render å…§éƒ¨çš„ function]] ç« ç¯€ä¸€æ¨£çš„æ¦‚å¿µï¼Œå…¶ state è·Ÿ props æ˜¯éƒ½æ˜¯å±¬æ–¼ç•¶æ¬¡ render çš„ï¼Œeffect ä¹Ÿæ˜¯ã€‚</p><h2 id="æ¯ä¸€æ¬¡-render-ä¿æœ‰å®ƒçš„æ‰€æœ‰æ±è¥¿">æ¯ä¸€æ¬¡ render ä¿æœ‰å®ƒçš„æ‰€æœ‰æ±è¥¿</h2><p>ç¯„ä¾‹<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup> ã€‚<br>å·²ç¶“çŸ¥é“ function æ¯ä¸€æ¬¡çš„ render æœƒè¨ˆä¸‹ <code>useEffect</code>ï¼Œä¸¦ä¸”æ‹¿åˆ°å…§éƒ¨ <code>local state</code> çš„å€¼ã€‚</p><p>è·Ÿè‘— <code>setTimeout</code> è·‘ä¸€æ¬¡ :</p><ul><li>ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">1</span></span></span></span> æ¬¡ render<ol><li>state æ˜¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">0</span></span></span></span></li><li>React è¨˜ä¸‹ effect : 3 ç§’ä¹‹å¾Œ You clicked 0 times</li><li><code>Counter</code> å›å‚³æäº¤ UI çµ¦ React</li><li>React è·Ÿ DOM æºé€šä¸¦ä¸”ç€è¦½å™¨æ¸²æŸ“äº†ç•«é¢</li><li><code>useEffect</code> é€™æ™‚å€™å‘¼å« React æ‰€è¨˜ä¸‹çš„ effect ï¼Œç­‰åˆ° 3 ç§’ä¹‹å¾Œ : å°å‡º You clicked 0 times</li></ol></li></ul><p>æ¥è‘—æŒ‰ä¸‹ button è§¸ç™¼ <code>setCount</code> è®“ count + 1ï¼ŒReact é‡æ–°å‘¼å« <code>Counter()</code> ï¼Œé€²è¡Œç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">2</span></span></span></span> æ¬¡æ¸²æŸ“</p><ul><li>ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">2</span></span></span></span> æ¬¡ render<ol><li>state è®Šæˆ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">1</span></span></span></span></li><li>React è¨˜ä¸‹ effect : 3 ç§’ä¹‹å¾Œ You clicked 1 times</li><li><code>Counter</code> å›å‚³æäº¤ UI çµ¦ React</li><li>React è·Ÿ DOM æºé€šä¸¦ä¸”ç€è¦½å™¨æ¸²æŸ“äº†ç•«é¢</li><li><code>useEffect</code> é€™æ™‚å€™å‘¼å« React æ‰€è¨˜ä¸‹çš„ effect ï¼Œç­‰åˆ° 3 ç§’ä¹‹å¾Œ : å°å‡º You clicked 1 times</li></ol></li></ul><p>å¾Œé¢ä»¥æ­¤é¡æ¨ã€‚<br>function component æ˜¯é€™æ¨£æ“ä½œï¼Œä½†æ˜¯ class Component åœ¨è™•ç† effect æ™‚å»ä¸æ˜¯é€™æ¨£çš„ã€‚</p><h3 id="è·Ÿ-class-Component-çš„å·®åˆ¥">è·Ÿ class Component çš„å·®åˆ¥</h3><p>ç¯„ä¾‹<sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup><br>å‡¡æœ‰é—œ effect çš„æ“ä½œæœƒæ”¾åœ¨ <code>componentDidUpdate</code> é€™è£¡ï¼Œæ„æ€æ˜¯  <strong>state æˆ– props è®Šæ›´ä¹‹å¾Œè¦åšä»€éº¼äº‹</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">componentDidUpdate</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`You clicked <span class="subst">$&#123;<span class="variable language_">this</span>.state.count&#125;</span> times`</span>);</span><br><span class="line">  &#125;, <span class="number">3000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€™è£¡çš„ <code>this.state.count</code>  éƒ½æœƒæ˜¯ç¾åœ¨çš„ countï¼Œä¹Ÿå°±æ˜¯æŒ‰åˆ° 5 <code>setTimeout</code> æŠ“åˆ°çš„éƒ½æœƒæ˜¯ 5 ï¼Œè€Œä¸æ˜¯ <strong>ç•¶ä¸‹</strong> è§¸ç™¼çš„ countã€‚</p><p>æ¯ä¸€æ¬¡ render éƒ½æ˜¯å‘¼å«å…§éƒ¨çš„ <code>render()</code> function ï¼Œ state æ°¸é æ˜¯æŒ‡åƒå¯¦ä¾‹çš„ stateã€‚</p><p>è¤‡ç¿’ä¸€ä¸‹ class component çš„ React ç”Ÿå‘½é€±æœŸæ˜¯</p><blockquote><ol><li><strong>Mouting</strong> : constructor ğŸ‘‰ render ğŸ‘‰ capture refs and DOM ğŸ‘‰DidMount</li><li><strong>Updating</strong> : render ğŸ‘‰ capture refs and DOM ğŸ‘‰DidUpdate</li></ol></blockquote><p>è·Ÿè‘— <code>setTimeout</code> è·‘ä¸€æ¬¡ :</p><ul><li>ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">1</span></span></span></span> æ¬¡ render <strong>(Mounting)</strong><ol><li><code>constructor</code> åˆå§‹åŒ– ï¼Œstate = 0</li><li><code>render</code> è§¸ç™¼ Counter å…§éƒ¨çš„ render ï¼Œä¸¦æäº¤ UI çµ¦ React</li><li><code>capture refs and DOM</code> React è·Ÿ DOM æºé€šä¸¦ä¸”ç€è¦½å™¨æ¸²æŸ“äº†ç•«é¢</li><li><code>DidMount</code> è¢«å‘¼å«ï¼Œå°å‡º : You clicked 0 times</li></ol></li></ul><p>æ¥è‘—æŒ‰ä¸‹ button è§¸ç™¼è®“ count + 1ï¼ŒReact é‡æ–°å‘¼å« Counter çš„ <code>render()</code> ï¼Œé€²è¡Œç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">2</span></span></span></span> æ¬¡æ¸²æŸ“</p><ul><li>ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">2</span></span></span></span> æ¬¡ render <strong>(Updating)</strong><ol><li>æ­¤æ™‚ state çš„ count = 1ï¼Œ<code>setState</code> ç­‰åŒæ–¼åŸ·è¡Œåˆ° <code>Counter.state.count = 1</code> (æ³¨æ„ : ä½†é–‹ç™¼è€…ä¸èƒ½ç›´æ¥åœ¨å…ƒä»¶å…§éƒ¨é€™æ¨£åšï¼ŒReact å¹«æˆ‘å€‘åš )</li><li><code>render</code> è§¸ç™¼ Counter å…§éƒ¨çš„ render ï¼Œä¸¦æäº¤ UI çµ¦ React</li><li><code>capture refs and DOM</code> React è·Ÿ DOM æºé€šä¸¦ä¸”ç€è¦½å™¨æ¸²æŸ“äº†ç•«é¢</li><li>Counter å‘¼å« <code>componentDidUpdate</code>ï¼Œ3 ç§’ä¹‹å¾Œ Counter state æ˜¯ 1ï¼Œå°å‡º You clicked 1 times</li></ol></li></ul><p>å¥½ï¼Œé€™é‚Šçœ‹èµ·ä¾†æ²’å•é¡ŒğŸ¤”ã€‚</p><blockquote><p>é‚£éº¼ä¸é–“æ–·æŒ‰äº† 5 æ¬¡ï¼Œè€Œä¸”ä¸ç­‰æ¯æ¬¡ <code>setTimeout</code> çš„ç§’æ•¸è·‘å®Œå‘¢ ?</p></blockquote><p>ç­‰æ–¼ <code>Event Loop</code> ä¸­çš„ Call Stack é‚„åœ¨æ’éšŠçš„æƒ…æ³ï¼Œæœƒä¸€å€¼é‡è¤‡ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">1</span></span></span></span> ~ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">3</span></span></span></span> é€™å€‹å‹•ä½œï¼Œä½†æ˜¯åˆ°äº† <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">4</span></span></span></span> !!!</p><blockquote><p>Counter å‘¼å«  <code>componentDidUpdate</code>ï¼Œ3 ç§’ä¹‹å¾Œæ­¤æ™‚çš„ State æ˜¯ ???</p></blockquote><p>é€™æ™‚å€™ main thread ä¸Šçš„ Call Stack è·‘å®Œï¼ŒEvent Loop çš„ stack é–‹å§‹åŸ·è¡Œï¼Œæ­¤æ™‚çš„ <code>Counter.state.count =  5</code>ï¼ŒåŸ·è¡Œæ™‚å°å‡º <strong>You clicked 5 times</strong> ä¸¦ä¸”ä¾åºå°å‡º 5 æ¬¡</p><p>è¦è§£æ±ºæ­¤å•é¡Œå¾ˆç°¡å–®ï¼ŒæŠŠç•¶ä¸‹çš„ <code>this.state.count</code> å–ä¸‹ä¾†åŒ…çµ¦ <code>setTimeout</code> ï¼Œå…¶å¯¦ç­‰åŒæ–¼ <strong>closure</strong> çš„æ–¹å¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">componentDidUpdate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> count = <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">count</span>;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`You clicked <span class="subst">$&#123;count&#125;</span> times`</span>);</span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>ç•¶éåŒæ­¥é€²å…¥ <code>Event Loop</code> è·‘å»æ’éšŠçš„æ™‚å€™ï¼Œé€™é‚Šçš„ <strong>count å·²ç¶“è¢«è¨˜èµ·ä¾†äº†</strong>ï¼Œæ‰€ä»¥ç•¶ <code>setTimout</code> åˆ° Call Stack çš„æ™‚å€™ï¼Œå°±æœƒæ˜¯ç•¶æ¬¡ render çš„ countã€‚</p><p>Closures å¾ˆå¥½ç”¨ï¼Œç•¶æˆ‘å€‘æŠŠå€¼é—œåœ¨å…§éƒ¨ï¼Œå³ä½¿å®ƒè„«é›¢äº† function ï¼Œä¸‹æ¬¡å†å‘¼å« function æ™‚å…¶å€¼é‚„æ˜¯æœƒè¢«ä¿ç•™ä½ä¸æœƒæ”¹è®Šã€‚å¯ä»¥æƒ³æˆæŠŠå®ƒæƒ³æˆé›·åŒ <code>const</code> å¸¸æ•¸ã€‚</p><h2 id="å¦‚ä½•æ‹¿å–æœ€æ–°çš„-state">å¦‚ä½•æ‹¿å–æœ€æ–°çš„ state ?</h2><p>æŠŠæ¡ä¸Šé¢æ‰€æåŠçš„åŸå‰‡ï¼Œ<strong>æ¯ä¸€æ¬¡ component åŸ·è¡Œ render functionï¼ŒåŒ…å« äº‹ä»¶ã€effect ç”šè‡³ timeouts æˆ–æ˜¯å…¶ä»– API éƒ½æœƒè¨˜ä½ç•¶æ¬¡å®šç¾©çš„ props æˆ– stateã€‚</strong></p><p>é€™å…©å€‹ç¯„ä¾‹å…¶å¯¦æ˜¯ä¸€æ¨£çš„ :</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Example</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="comment">//ğŸ“ ç­‰åˆ° render ä¹‹å¾Œæ‰è®€å– counter</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(props.<span class="property">counter</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ğŸ“ ä¸€é–‹å§‹æŠŠ counter å­˜èµ·ä¾†</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Example</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> counter = props.<span class="property">counter</span>;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(counter);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸ç®¡æ˜¯å…ˆé‚„æ˜¯å¾Œå»è®€å–å€¼ï¼Œæ‹¿åˆ°çš„ state æ˜¯ç›¸åŒçš„<br><code>useEffect</code> å·²ç¶“è¨˜ä½ç•¶æ™‚çš„ state<br>state è·Ÿ props æ˜¯ä¸æœƒè®Šçš„</p></blockquote><p>å¦‚æœæˆ‘å€‘è©¦åœ–åœ¨ä¸Šä¸€æ¬¡çš„ render function å–å¾—æœ€æ–°çš„ props æˆ– stateï¼Œé€™æ¨£æ˜¯é€†æµè€Œä¸Š (æ–‡ç« é€™éº¼èªªçš„ğŸ¤”)ã€‚</p><p>æœ‰æ™‚å€™æˆ‘å€‘æœƒéœ€è¦åœ¨ effect ä¸­æ‹¿åˆ°æœ€æ–°çš„å€¼ï¼Œè€Œä¸æ˜¯ç•¶ä¸‹ render æ‰€è¨˜ä½çš„å€¼ï¼Œé€™ä¸¦ä¸æ˜¯ä»€éº¼éŒ¯èª¤çš„æ“ä½œï¼Œä½†æˆ‘å€‘å¯ä»¥ä½¿ç”¨ refs é”æˆç›®çš„ã€‚</p><p>refs ä¸æœƒä¿ƒä½¿ React re-renderï¼Œå› ç‚º React ç¢ºä¿å®ƒæ˜¯ä¸æœƒè¢«æ”¹è®Šçš„(æŒ‡ä¸æœƒå›  render ç”¢ç”Ÿæ–°çš„è¨˜æ†¶é«”ä½å€ï¼Œæ¯æ¬¡éƒ½æŒ‡å‘åŒä¸€å€‹å¯¦é«”)ã€‚ä¹Ÿå¯ä»¥æƒ³æˆ React å¹«æˆ‘å€‘å»ºç«‹ä¸€å€‹å…¨åŸŸçš„ç‰©ä»¶ï¼Œæˆ‘å€‘éƒ½æ˜¯å°åŒä¸€å€‹ç‰©ä»¶é€²è¡Œç›´æ¥æ“ä½œã€‚</p><blockquote><p>ç„¶è€Œé€†æµè€Œä¸Šæ˜¯ä»€éº¼æ„æ€å‘¢ ? ğŸ¤”</p></blockquote><p>functional component æ˜¯åˆ©ç”¨é–‰åŒ… (closure) çš„æ¦‚å¿µï¼Œå¾ JS çš„åŸºç¤æ¦‚å¿µä¾†çœ‹ï¼ŒåŸ·è¡Œå®Œ function å¾Œç”±æ–¼è£¡é¢çš„è®Šæ•¸é‚„æ˜¯å­˜åœ¨æ–¼ function å…§éƒ¨ (æ²’æœ‰è¢«å›æ”¶)ï¼Œä½†æ˜¯å­˜åœ¨å…§éƒ¨çš„è®Šæ•¸å¤–éƒ¨ä¸èƒ½ç›´æ¥æ“ä½œã€‚</p><p>å›åˆ° <code>setState</code> æœƒè§¸ç™¼ re-renderï¼Œé‡æ–°å‘¼å« component function ï¼Œä½†åœ¨ effect ä¸­ä»æ˜¯å±¬æ–¼ä¸Šä¸€æ¬¡ render çš„ï¼Œç•¶æˆ‘å€‘æƒ³åœ¨ effect å–å¾—æœ€æ–°çš„è³‡æ–™ä¾†æ“ä½œå°±åƒåœ¨å¤–éƒ¨å° closure å…§éƒ¨æ‹¿æŸè®Šæ•¸ï¼Œé€™æ˜¯ä¸è¡Œçš„ï¼Œå› ç‚ºå€¼è¢«å°è£åœ¨å…§éƒ¨ã€‚é™¤éæˆ‘å€‘åƒåœ¨å¤–éƒ¨å…ˆå»ºç«‹å¥½ä¸€å€‹å…¨åŸŸè®Šæ•¸ï¼Œä¸¦ä¸”ç›´æ¥æ‹¿å…¶å€¼é€²è¡Œæ“ä½œï¼Œæ²’éŒ¯ï¼Œé€™å°±ç­‰åŒæ–¼ refs çš„æ¦‚å¿µäº†ğŸ˜²</p><h2 id="ä½¿ç”¨-ref-ä¾†å–å¾—æœ€æ–°å€¼">ä½¿ç”¨ ref ä¾†å–å¾—æœ€æ–°å€¼</h2><p>å·²ç¶“çŸ¥é“ [[#è·Ÿ class Component çš„å·®åˆ¥|class component çš„è¡Œç‚º]] æœƒæ‹¿åˆ°æœ€æ–°çš„å€¼ï¼Œè€Œ function component å‰‡ä¸æœƒï¼Œè¦æ€éº¼ç”¨ function component å¾©åˆ» class çš„è¡Œç‚ºå‘¢ ?</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> latestCount = <span class="title function_">useRef</span>(count);</span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// æ‹¿åˆ°æœ€æ–°çš„ count</span></span><br><span class="line">  latestCount.<span class="property">current</span> = count;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// è®€å–æœ€æ–°çš„ count</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`You clicked <span class="subst">$&#123;latestCount.current&#125;</span> times`</span>);</span><br><span class="line">  &#125;, <span class="number">3000</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å¦‚æ­¤ä¸€ä¾†ï¼Œé€£æŒ‰ 5 æ¬¡ï¼Œå°±æœƒå‘ˆç¾æœ€å¾Œé€šé€šå°å‡º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>5</mn></mrow><annotation encoding="application/x-tex">5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">5</span></span></span></span> çš„çµæœã€‚<br><strong>ref</strong> å°±åƒåœ¨å¤–éƒ¨å»ºç«‹ä¸€å€‹ç›’å­ï¼Œå¯„æ”¾ä¸æœƒè¢«æ”¹è®Šçš„å€¼</p><p>é€™æ¨£çš„æ–¹å¼ä¸èƒ½ä¿è­‰æ¯æ¬¡ function call çš„é‚£å€‹æœŸé–“ï¼Œstate æ˜¯æ­£ç¢ºçš„ (state ä¸å±¬æ–¼é‚£å€‹ç•¶ä¸‹çš„æ™‚é–“é»)ã€‚ç”±æ–¼æ¯æ¬¡éƒ½è¢«ç›´æ¥æ”¹è®Š (class component åšçš„äº‹)ï¼Œæ‹¿åˆ°çš„å°±æœƒæ˜¯æœ€æ–°çš„ã€‚<br>é€™ä¹Ÿæ˜¯ç‚ºä»€éº¼ React é è¨­ä¸æ˜¯ ref çš„æ“ä½œï¼Œè€Œæ˜¯é¸æ“‡æ€§çš„ã€‚</p><p>é€™è£¡å¯ä»¥æ¯”è¼ƒ functional component è·Ÿ class  component å°æ–¼ render æ„ç¾©çš„ä¸åŒä¹‹è™• :</p><ul><li>class component å°‡æ¯æ¬¡ render åˆ†æˆä¸åŒéšæ®µä¾†æ±ºå®šç™¼ç”Ÿå“ªäº›äº‹ï¼Œä¹Ÿå°±æ˜¯ç”Ÿå‘½é€±æœŸã€‚åœ¨ A éšæ®µè®ŠåŒ–åˆ° B éšæ®µçš„éç¨‹ï¼Œè³‡æ–™ä¹Ÿæœƒéš¨æ™‚é–“ç™¼ç”Ÿè®ŠåŒ–ã€‚</li><li>functional component å‰‡æ˜¯æŠŠæ¯æ¬¡çš„ render æ˜¯ç¨ç«‹çš„ä¾†çœ‹ï¼Œé€™æ¬¡ render åªé—œæ³¨é€™æ¬¡è³‡æ–™çš„è®ŠåŒ–ï¼Œä¸¦ä¸”åŒæ­¥ä¸€åˆ‡çš„æ±è¥¿ã€‚</li></ul><h2 id="è«‡è«‡-clean-up">è«‡è«‡ clean up</h2><blockquote><p>clean up çš„æ˜¯èˆŠçš„ props é‚„æ˜¯ç•¶ä¸‹çš„ props ?</p></blockquote><p>å…ˆé‡æ¸… <code>clean up</code> çš„åŸ·è¡Œæ™‚é–“ï¼Œåœ¨ç•«é¢æ¸²æŸ“ä¹‹å¾Œï¼Œåœ¨ä¸‹ä¸€å€‹ effect åŸ·è¡Œä¹‹å‰ï¼ŒæœƒåŸ·è¡Œ clean up effectã€‚<br><img data-src="https://raw.githubusercontent.com/donavon/hook-flow/master/hook-flow.png" alt="|400x500"></p><p>æ„æ€æ˜¯</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">// 2ï¸âƒ£ åœ¨ return ä¹‹å¾Œæ‰æœƒåš</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// 1ï¸âƒ£ é€™è£¡æœƒå…ˆåŸ·è¡Œ</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æƒ…å¢ƒ : æœ‰ä¸€å€‹ state å¾ 10 æ”¹è®Šæˆ 20</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title class_">ChatAPI</span>.<span class="title function_">subscribeToFriendStatus</span>(props.<span class="property">id</span>, handleStatusChange);</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">ChatAPI</span>.<span class="title function_">unsubscribeFromFriendStatus</span>(props.<span class="property">id</span>, handleStatusChange);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä¸€é–‹å§‹å¯èƒ½æœƒé€™éº¼æƒ³ :</p><ol><li>React å…ˆæ¸…é™¤ (clean up) å¸¶æœ‰ <code>id = 10</code> çš„è¨‚é–±</li><li>state æ›´æ–°è‡³ 20ï¼ŒReact æäº¤ UI çµ¦ç€è¦½å™¨æ¸²æŸ“</li><li>React effect åŸ·è¡Œå¸¶æœ‰ <code>id = 20</code> çš„è¨‚é–±</li></ol><p>ğŸ¤”é€™ä¸æ˜¯æ­£ç¢ºçš„ï¼ŒWhy ?</p><p>å›åˆ° Flow é‚£å¼µåœ–ï¼Œå¯ä»¥çŸ¥é“ effect åŸ·è¡Œçš„æ™‚é–“é»æ˜¯ <strong>ç€è¦½å™¨å°‡å…ƒç´ æ”¾ä¸Š DOM (browser painting)</strong> ä¹‹å¾Œï¼Œç‚ºä»€éº¼ React è¦é€™éº¼è¨­è¨ˆ ? ğŸ¤”</p><blockquote><p>æ‰ä¸æœƒé˜»æ””è¢å¹•çš„æ›´æ–°</p></blockquote><p>effect å¾ˆå¸¸è™•ç† AJAX å–è³‡æ–™çš„äº‹æƒ…ï¼Œ å¦‚æœå–è³‡æ–™é€™ä»¶äº‹ä¸æ˜¯å®‰æ’åˆ° effect ä¸­è™•ç†ï¼Œè€Œæ˜¯åŒæ­¥è™•ç†å‘¢ ? ç€è¦½å™¨å°±å¿…é ˆç­‰åˆ°è³‡æ–™å›å‚³å†å»åš painting çš„å·¥ä½œï¼Œå¦‚æœå›å‚³æ™‚é–“æ‹‰é•·ï¼Œè¢å¹•å°±æœƒåƒè¢«å¡ä½ã€å‹•å½ˆä¸å¾—ã€‚</p><p>React æ‰æœƒæŠŠ effect åŸ·è¡Œçš„æ™‚é–“é»æ”¾åœ¨ç€è¦½å™¨ painting ä¹‹å¾Œï¼Œä»¥ä¸é˜»æ“‹è¢å¹•æ›´æ–°ç‡çš„æƒ…æ³ä¸‹ï¼Œæå‡ UI é«”é©—ã€‚è€Œ <strong>Effect çš„ clean up function ä¹Ÿæœƒè¢«å»¶é²</strong>ã€‚</p><p>æ‰€ä»¥ä¸Šé¢çœŸæ­£çš„æƒ…å¢ƒé †åº</p><ol><li>state æ›´æ–°è‡³ 20ï¼ŒReact æäº¤ UI çµ¦ç€è¦½å™¨æ¸²æŸ“</li><li>ç€è¦½å™¨æ¸²æŸ“äº†ï¼Œä½¿ç”¨è€…çœ‹è¦‹ 20 å‡ºç¾åœ¨è¢å¹•ä¸Š</li><li>React æ¸…é™¤ effect ï¼Œ <code>id = 10</code></li><li>React åŸ·è¡Œ effect ï¼Œ<code>id =  20</code></li></ol><p>å¥‡æ€ªçš„æ˜¯ï¼Œç‚ºä»€éº¼å¯ä»¥åœ¨ <code>id = 20</code> çš„æƒ…æ³ä¸‹ï¼Œå»æ¸…é™¤ <code>id = 10</code> çš„å€¼å‘¢ ? ğŸ¤”</p><blockquote><p>æ¯ä¸€å€‹åœ¨ render å…§éƒ¨å‘¼å«çš„ function (åŒ…å« handlers ã€effect ç­‰ç€è¦½å™¨ APIs )ï¼Œéƒ½æœƒæ‹¿åˆ°ç•¶ä¸‹å®šç¾©çš„ state ã€‚</p></blockquote><p>å¯¦éš›ä¸Šæ¸…é™¤èˆ‡åŸ·è¡Œ effect çš„ state éƒ½æ˜¯ä¾†è‡ªç•¶æ¬¡ render çš„è³‡æ–™ï¼Œ<strong>effect åŸ·è¡Œçš„ä¸¦ä¸æœƒæ‹¿åˆ°æœ€æ–°çš„è³‡æ–™</strong> ï¼Œè€Œæ˜¯èˆŠ (ç•¶ä¸‹)çš„ã€‚</p><p>What !?ğŸ¤·</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ…å¯¦éš›ä¸Šæ˜¯é€™æ¨£çš„</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title class_">ChatAPI</span>.<span class="title function_">subscribeToFriendStatus</span>(<span class="number">10</span>, handleStatusChange);</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">ChatAPI</span>.<span class="title function_">unsubscribeFromFriendStatus</span>(<span class="number">10</span>, handleStatusChange);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ ä¸æ˜¯é€™æ¨£çš„ï¼Œæˆ‘å€‘åœ¨æƒ³åƒçš„ clean up é›–ç„¶æ¸…é™¤çš„æ™‚é–“é» state å·²ç¶“æ”¹è®Šæˆ 20ï¼Œä½†ä»ç„¶æ˜¯å±¬æ–¼ id = 10 é‚£æ¬¡ render çš„</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title class_">ChatAPI</span>.<span class="title function_">subscribeToFriendStatus</span>(<span class="number">20</span>, handleStatusChange);</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">ChatAPI</span>.<span class="title function_">unsubscribeFromFriendStatus</span>(<span class="number">10</span>, handleStatusChange);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>clean up æ˜¯å»¶å¾ŒåŸ·è¡Œï¼Œä¸¦ä¸ä»£è¡¨æ˜¯å±¬æ–¼ä¸‹æ¬¡çš„ renderã€‚ React æŠŠ effect ç›¸é—œæ“ä½œæ˜¯åœ¨ç€è¦½å™¨æ¸²æŸ“ä¹‹å¾Œçš„åŸå› ï¼Œç›®çš„è®“åŸ·è¡Œæ¯”é è¨­çš„é‚„è¦å¿«ã€‚</p><p>è€Œåœ¨ clean up function è¢«å‘¼å«æ™‚ï¼ŒèˆŠçš„ props æ°¸é éƒ½å­˜åœ¨ï¼Œä»¥é˜²æˆ‘å€‘éœ€è¦ç”¨åˆ°å®ƒã€‚</p><p>ä¾‹å¦‚ç›£è½äº‹ä»¶ï¼Œå¦‚æœæŸæŒ‰éµå…ƒç´ æ¶ˆå¤±æ–¼ç•«é¢ï¼Œæˆ‘å€‘æ‡‰è©²å°‡å®ƒçš„ç›£è½äº‹ä»¶è¨»éŠ·æ‰ï¼Œä½†æ˜¯åœ¨ render ä¹‹å¾Œå…ƒç´ æ—©å·²ç¶“å¾ç•«é¢æ¶ˆå¤±ï¼Œæˆ‘å€‘è¦æ€éº¼è¨»éŠ·ä¸€å€‹å·²ç¶“ä¸åœ¨ DOM ä¸Šçš„å…ƒç´ ç›£è½äº‹ä»¶å‘¢ ?  clean up function è®“æˆ‘å€‘æŠŠèˆŠçš„ state æˆ– props é‚„å­˜åœ¨è‘—ï¼Œåœ¨ effect å‘¼å«ä¹‹å‰ï¼Œæˆ‘å€‘å°±å¯ä»¥æŠŠå®ƒè¨»éŠ·æ‰ã€‚</p><h2 id="åŒæ­¥åŸ·è¡Œä½†ä¸æ˜¯ç”Ÿå‘½é€±æœŸ">åŒæ­¥åŸ·è¡Œä½†ä¸æ˜¯ç”Ÿå‘½é€±æœŸ</h2><p>åœ¨ä½¿ç”¨ <code>useEffect</code> è¦è·³è„«ç”Ÿå‘½é€±æœŸçš„æ€è€ƒæ–¹å¼ï¼Œé‹ç”¨åŒæ­¥çš„æ¦‚å¿µã€‚</p><blockquote><p>ä¸€åˆ‡éƒ½æ˜¯è·Ÿçµæœæœ‰é—œï¼Œè€Œä¸æ˜¯éç¨‹</p></blockquote><p>é€™è·Ÿ JQuery å…ˆå‘¼å« <code>addClass</code> åˆå‘¼å« <code>removeClass</code> <strong>éç¨‹æ´¾åˆ¥</strong> æ˜¯ä¸åŒçš„ (æ„æ€æ˜¯ DOM æ–°å»ºç«‹æ±è¥¿ï¼Œåˆçµ¦å®ƒåˆªé™¤é€™æ¨£çš„è¡Œç‚º)ï¼Œé€™ä¹Ÿæ˜¯ç‚ºä»€éº¼ React çš„ CSS class å¿…é ˆæ”¾åœ¨ render ç¨‹å¼ç¢¼ä¹‹ä¸­ (åªåœ¨ä¹çµæœï¼Œä¸¦ä¸æ˜¯å¾ A è®Š B çš„éç¨‹ç¶“æ­·äº†ä»€éº¼ã€‚åˆ¤æ–·æ¨£å¼éƒ½æ˜¯çœ‹æœ€çµ‚çš„çµæœï¼Œä¸¦ééš¨æ™‚é–“è€Œæ”¹è®Š)</p><p>React æ ¹æ“šç•¶ä¸‹çš„è³‡æ–™æ˜¯åŒæ­¥è™•ç† DOM (è³‡æ–™è·Ÿ UI æ˜¯åŒæ­¥çš„) ï¼Œåœ¨ function component ä¸­ render çš„  <code>mount</code> è·Ÿ <code>updating</code> æ˜¯æ²’æœ‰å€åˆ¥çš„ã€‚é€™æ¨£ä½¿ <code>useEffect</code> è®“æˆ‘å€‘å¯ä»¥æ ¹æ“š props æˆ– state åŒæ­¥ React æ¨¹ç‹€ä»¥å¤–çš„æ±è¥¿ã€‚</p><p>å‡å¦‚æœ‰ä¸€å€‹ state å¾ 10 è®Šåˆ° 20ï¼Œè·Ÿä¸€é–‹å§‹å°±è³¦äºˆå®ƒ 20 ï¼Œæœ€çµ‚éƒ½æœƒæ˜¯ 20ã€‚è·Ÿ call API æ‹¿è³‡æ–™ä¸€æ¨£ï¼Œæœ€å¾Œçš„çµæœéƒ½æœƒæ˜¯ä¸€æ¨£çš„ã€‚æˆ‘å€‘çœ‹åˆ°çš„ UI è·Ÿè³‡æ–™æ˜¯åŒæ­¥çš„ï¼Œä¹Ÿåªæœƒé¡¯ç¤ºæœ€å¾Œè³‡æ–™çš„çµæœã€‚</p><p>ä½†æ˜¯å¦‚æœæ¯æ¬¡éƒ½ re-render æ˜¯å¾ˆæ²’æ•ˆç‡çš„ï¼Œç”šè‡³å°è‡´ç„¡é™å¾ªç’°ã€‚</p><h2 id="å‘Šè¨´-React-ä¸åŒ-effect-ä¹‹é–“çš„å·®åˆ¥">å‘Šè¨´ React ä¸åŒ effect ä¹‹é–“çš„å·®åˆ¥</h2><p>é¿å…æ¯æ¬¡ä¸å¿…è¦çš„è³‡æ–™éƒ½è·Ÿè‘— re-renderï¼Œå¿…é ˆå‘Šè¨´ React é‚£äº›è¦ re-renderã€‚ (å¯ä»¥æƒ³æƒ³ render ä¹‹å¾Œçš„æ­¥é©Ÿé †åº)</p><ol><li>state æ”¹è®Šï¼Œrender æ–°çš„ UI</li><li>React render ï¼Œæäº¤ UI çµ¦ DOM</li><li>DOM æ›´æ–°ï¼Œç¶“éä¸€ç³»åˆ—æ“ä½œï¼Œæœ€å¾Œæ”¾ä¸Šç•«é¢ (é€™ä¹Ÿç‚ºä»€éº¼èªª æ“ä½œ DOM å¾ˆæ˜‚è²´ï¼Œå› ç‚ºç‰½æ¶‰åˆ°å¤ªå¤šç•«é¢çš„ reflowã€repaintï¼Œå°¤å…¶æ˜¯ reflow)</li></ol><p>React é¿å… DOM æ˜‚è²´çš„æ“ä½œï¼Œåªæœƒæ›´æ–° DOM ç¢ºå¯¦æœ‰æ”¹è®Šçš„åœ°æ–¹ã€‚</p><p>React Element æ˜¯ä¸€å€‹ Object è£è¼‰å„ç¨®å±¬æ€§ã€‚å‡å¦‚æœ‰ä¸€å€‹å…ƒä»¶æŒ‡æ”¹å‹•äº† <code>props.name</code> (ä¸åŒ…å« state çš„æ“ä½œ) ï¼Œä¹Ÿå°±æ˜¯æ–‡å­—çš„éƒ¨åˆ†åƒ…æœ‰ children æ”¹è®Šäº†ï¼ŒReact åªæœƒæ”¹å‹• <code>domNode.innerText</code> çš„éƒ¨ä»½è€Œå·² (åšæ·ºæ‹·è²æ¯”è¼ƒ shallow comparisonï¼Œé€™è·Ÿ React çš„ Recoil æœ‰é—œ)</p><p>ç¯„ä¾‹ä¾†è‡ª Dan å¤§çš„æ–‡ç«  :</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> oldProps = &#123;<span class="attr">className</span>: <span class="string">&#x27;Greeting&#x27;</span>, <span class="attr">children</span>: <span class="string">&#x27;Hello, Dan&#x27;</span>&#125;;</span><br><span class="line"><span class="keyword">const</span> newProps = &#123;<span class="attr">className</span>: <span class="string">&#x27;Greeting&#x27;</span>, <span class="attr">children</span>: <span class="string">&#x27;Hello, Yuzhi&#x27;</span>&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>é‚£ React ä¹Ÿæœƒåœ¨ <code>useEffect</code> å¹«æˆ‘å€‘æª¢æŸ¥å— ?</p></blockquote><p><strong>ä¸æœƒã€‚</strong> React å°æ–¼æ²’æœ‰å‘¼å«çš„ functionï¼Œæ˜¯æ²’è¾¦æ³•å¹«æˆ‘å€‘æª¢æŸ¥ã€æ¯”è¼ƒã€‚</p><p>React ç‚ºäº†é¿å…ä¸€ç›´é‡è¤‡åŸ·è¡Œ effect æœ‰é—œçš„æ“ä½œï¼Œæä¾› <strong>dependency array</strong> (ä¹Ÿç¨± <strong>deps</strong> ) ï¼Œè®“æˆ‘å€‘åŠ å…¥è¦é—œæ³¨çš„è³‡æ–™çµ¦ <code>useEffect</code> åˆ¤æ–·ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">title</span> = <span class="string">&#x27;Hello, &#x27;</span> + name;</span><br><span class="line">&#125;, [name]); <span class="comment">// ğŸ‘ˆ deps</span></span><br></pre></td></tr></table></figure><p>é€éé€™å€‹ array å‘Šè¨´ React ï¼Œé€™è£¡é¢</p><blockquote><p>åªæœ‰åŒ…å« array çš„è³‡æ–™æ”¹è®Šäº†æ‰è¦åŸ·è¡Œï¼Œå…¶é¤˜çš„è³‡æ–™è·Ÿæˆ‘ç„¡é—œï¼Œä¸è¦å«æˆ‘è¬è¬ã€‚</p></blockquote><p>React æ¯æ¬¡ re-render æœƒæª¢æŸ¥ array ä¸­çš„è³‡æ–™ï¼Œå¦‚æœå‰å¾Œéƒ½é•·çš„ä¸€æ¨£ï¼Œå°±æœƒè·³é <code>useEffect</code>  ã€‚</p><p>åªè¦æ”¾å…¥ array ä¸­çš„è³‡æ–™ï¼Œå³ä½¿åªæœ‰ 1 å€‹æ”¹è®Šï¼Œä¹Ÿæœƒé‡æ–°åŸ·è¡Œ effect ï¼ŒReact å°±æœƒçŸ¥é“é€™æ˜¯ä¸èƒ½è·³éçš„ï¼Œå› ç‚º React æœƒåŒæ­¥æ‰€æœ‰äº‹æƒ…ã€‚</p><p>æ‰€ä»¥ä¸è¦æŠŠæ¯«ç„¡ç›¸é—œçš„æ”¾åœ¨ä¸€èµ·ï¼Œ<strong>é—œæ³¨æœƒæ”¹è®Šè€Œé‡æ–°å‘¼å«çš„è³‡æ–™ã€‚</strong></p><h2 id="ä¸è¦å°-dependencies-èªªè¬Š">ä¸è¦å° dependencies èªªè¬Š</h2><p>function Component ä¸­æ²’æœ‰ç”Ÿå‘½é€±æœŸï¼Œå¦‚æœæˆ‘å€‘åªæƒ³è¦åœ¨ <code>mount</code> åŸ·è¡Œä¸€æ¬¡å°±å¥½ï¼Œé€šå¸¸æœƒæŠŠ dependencies array å¯«æˆç©ºçš„ã€‚</p><p>ä¾‹å¦‚ : è¼‰å…¥è³‡æ–™</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">SearchResults</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// è¼‰å…¥è³‡æ–™</span></span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ajax æ˜¯ side effect æŠŠå®ƒæ“ºåœ¨ useEffect åŸ·è¡Œ</span></span><br><span class="line">    <span class="title function_">fetchData</span>();</span><br><span class="line">  &#125;, []); <span class="comment">// ğŸ‘ˆ æ”¾å…¥ç©ºé™£åˆ— </span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹èµ·ä¾†åˆç†å— ? å¦‚æœæœ‰ç‰½æ¶‰åˆ°å…¶ä»–çš„ props æˆ– state é€™è£¡å°±æœƒæœ‰å•é¡Œã€‚</p><h3 id="dependencies-èªªè¬Šäº†æœƒç™¼ç”Ÿä»€éº¼å•é¡Œ">dependencies èªªè¬Šäº†æœƒç™¼ç”Ÿä»€éº¼å•é¡Œ ?</h3><p>å¦‚æœä»¥è¨ˆæ™‚åŠŸèƒ½ (<code>setInterval</code>) åœ¨ class component ä¸­çš„å¯«æ³•æ€ç¶­ï¼Œåœ¨ function Component å°±è¦æ”¹è®Šé€™å€‹æƒ³æ³•ã€‚ <code>setInterval</code> é›–ç„¶åœ¨åŸºç¤çš„ JS å»ºç«‹ä¸€æ¬¡ï¼Œç€è¦½å™¨æœƒæŒçºŒè¨˜ä½ç›´åˆ°åˆªé™¤ id ç‚ºæ­¢ï¼Œä½†åœ¨ function Component æ¯ä¸€æ¬¡éƒ½æ“æœ‰è‡ªå·±çš„ scope ï¼Œæ‰€ä»¥å¿…é ˆé‡å°æ¯æ¬¡å‘¼å« render æ™‚ï¼Œå¦‚æœè¦æ”¹è®Šçš„è³‡æ–™å…·æœ‰å‰¯ä½œç”¨è¦å…ˆåˆªé™¤ï¼Œå†é‡æ–°ç”¢ç”Ÿï¼Œä¸ç„¶å°±æœƒä¸€ç›´å¾€ä¸Šç–ŠåŠ ï¼Œé€ æˆå•é¡Œã€‚</p><p>åœ¨ class Component ä¸­ï¼Œæœ‰é—œå‰¯ä½œç”¨çš„å•é¡Œæœƒåœ¨ <code>Mount</code> ç›£è½èˆ‡ <code>Unmout</code> è¨»éŠ·ç›£è½ï¼Œå¦‚æœåœ¨ä½¿ç”¨ <code>useEffect</code> ä¹Ÿæ˜¯åŒä¸€å€‹æ€ç¶­æ¨¡å¼å»æ€è€ƒï¼Œ æŠŠ dependencies array ç•¶ä½œæ˜¯ mount çš„è¡Œç‚ºï¼Œå°‡ array è¨­ç‚ºç©ºçš„ï¼Œä½†å…§éƒ¨å¦‚æœä½¿ç”¨åˆ°æœ‰é—œ props æˆ– state ï¼Œeffect åªæœƒåœ¨ render åŸ·è¡Œä¸€æ¬¡å¾Œå°±ä¸æœƒå†ç›´è¡Œäº†ã€‚</p><h3 id="èª å¯¦ä»¥å°-dependenciesï¼ŒæŠŠæœ‰é—œçš„æ”¾å…¥-array-ä¸­">èª å¯¦ä»¥å° dependenciesï¼ŒæŠŠæœ‰é—œçš„æ”¾å…¥ array ä¸­</h3><p>ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">1</span></span></span></span> ç¨®æ–¹å¼å°±æ˜¯æŠŠæ‰€æœ‰ç›¸é—œè³‡æ–™æ”¾å…¥ <code>useEffect</code> çš„ array ä¸­ï¼Œè®“ effect æŒ‰ç…§è³‡æ–™æ”¹è®Šå°±åŒæ­¥æ”¹è®Šã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> id = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setCount</span>(count + <span class="number">1</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(id);</span><br><span class="line">&#125;, [count]); <span class="comment">//ğŸ‘ˆ ç”¨åˆ°äº† count æ”¾å…¥ array</span></span><br></pre></td></tr></table></figure><p>ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">2</span></span></span></span> ç¨®æ˜¯æ”¹è®Š effect è£¡é¢çš„çµæ§‹ï¼Œä¸éœ€è¦æ¯è¼ª render éƒ½è¦æ¯”è¼ƒ array ä¸­çš„è³‡æ–™ï¼Œæ¸›å°‘ä¾è³´æ€§ï¼Œå¾€ä¸‹æœƒèªªæ˜æ€éº¼æ¸›å°‘ä¾è³´æ€§ã€‚</p><h2 id="æœ‰æ•ˆç‡çš„ä½¿ç”¨-useEffect">æœ‰æ•ˆç‡çš„ä½¿ç”¨ useEffect</h2><blockquote><p>å¦‚æœæˆ‘å€‘ä¸æƒ³æŠŠ state æ”¾å…¥ dependencies array å‘¢ ?</p></blockquote><blockquote><p>é€™ä¸æ˜¯å›ä¸å›é€†æˆ–æ˜¯åˆ»æ„æ“ä½œ<br>è€Œæ˜¯ <strong>React ä¸€å®šéœ€è¦é€éä¾è³´é™£åˆ—å»æ¯”è¼ƒé€™ç­†è³‡æ–™å— ?</strong>   effect æ‰€åŸ·è¡Œçš„æ˜¯å…·æœ‰å‰¯ä½œç”¨çš„æ“ä½œã€‚è€Œ React éƒ½èƒ½çŸ¥é“ç•¶æ¬¡ render çš„æ‰€æœ‰è³‡æ–™ï¼Œæœ‰å¿…è¦æ¯æ¬¡éƒ½å»ç‰¹åˆ¥å‘Šè¨´ React é€™ç­†æ˜¯å¦å…·æœ‰è®ŠåŒ–å‘¢ ?</p></blockquote><p>å¯ä»¥å…ˆæå•è‡ªå·± <strong>é€™ç­†è³‡æ–™çš„æ˜¯ç‚ºäº†ä»€éº¼ ?</strong><br>ä¾‹å¦‚ Counter ä¸­æ¯ç§’åš <code>setCount(count + 1)</code>ï¼Œä½†<strong>å…¶å¯¦æˆ‘å€‘æ ¹æœ¬ä¸éœ€è¦æ¯”è¼ƒæ¯æ¬¡ render çš„ count æ˜¯å¤šå°‘</strong>ï¼Œä¹‹å¾Œå† <code>+1</code> ã€‚</p><p>Why ? ğŸ¤”</p><p>å› ç‚º React å¯ä»¥å¹«æˆ‘å€‘æ‹¿å‡ºå‰ä¸€æ¬¡çš„ stateï¼Œè€Œ <code>setInterval</code> æ¯æ¬¡æ˜¯ä»°è³´ <strong>å‰ä¸€æ¬¡çš„ state å† <code>+1</code></strong> ï¼Œé‚£éº¼å¯ä»¥ä½¿ç”¨ <code>setState</code> çš„ç¬¬äºŒç¨®æ–¹å¼ï¼Œ<code>setState</code> è£¡é¢ä½¿ç”¨ callback function æ‹¿åˆ°æœ€æ–°çš„ state ä¸¦å›å‚³æ–° stateã€‚</p><blockquote><p><code>setState((previousState)=&gt; return state)</code></p></blockquote><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> id = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// åƒæ•¸ c æœƒæ‹¿åˆ°å‰ä¸€æ¬¡çš„ countï¼Œå›å‚³ count+1 çš„çµæœ</span></span><br><span class="line">    <span class="title function_">setCount</span>(<span class="function"><span class="params">c</span> =&gt;</span> c + <span class="number">1</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(id);</span><br><span class="line">&#125;, []); <span class="comment">//ğŸ‘ˆ é€™è£¡å°±ä¸ç”¨æ”¾ä¾è³´é™£åˆ—</span></span><br></pre></td></tr></table></figure><p>å³ä½¿ä¸å‘Šè¨´ React  æ­£ç¢ºçš„ dependencies arrayï¼Œ<code>setInterval</code> åœ¨ç¬¬ä¸€æ¬¡ render å¾Œéƒ½æœƒå­˜åœ¨ (ä¹Ÿå°±æ˜¯æœƒä¸æ–·çš„åŸ·è¡Œ)ï¼Œå› ç‚º <code>setInterval</code> æ˜¯å±¬æ–¼ <code>window</code> ä¹Ÿå°±æ˜¯ browser çš„ methodã€‚</p><p>åªæœ‰åœ¨ Component æœ¬èº« <code>unmout</code> æœƒåœä¸‹ä¾†ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢ <code>return</code> çš„éƒ¨ä»½ã€‚</p><p>è©¦è‘—è·‘ä¸€æ¬¡ :</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// effect ç¬¬ä¸€æ¬¡æœƒè¢«åŸ·è¡Œï¼Œå®ƒæœƒåœ¨ç¬¬ä¸€æ¬¡ render å¾Œéƒ½å­˜åœ¨</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> id = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setCount</span>(<span class="number">0</span> =&gt; <span class="number">0</span> + <span class="number">1</span>); <span class="comment">// æ‰€ä»¥é€™é‚Šæ˜¯ setCount(1)</span></span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(id);</span><br><span class="line">&#125;,[])</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬äºŒæ¬¡ render </span></span><br><span class="line"><span class="keyword">const</span> count = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// useEffect ä¸åŸ·è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// setInterval() é€™å€‹é‚„æ˜¯æœƒåŸ·è¡Œï¼Œå› ç‚ºå®ƒå­˜åœ¨æ–¼ browser  è€Œä¸æ˜¯æ¯æ¬¡ render function</span></span><br></pre></td></tr></table></figure><p>æ–‡ä¸­ç¨±æ˜¯ <strong>å¦å®šå¼ä¾è³´é—œä¿‚</strong> (false dependencies)ï¼Œå› ç‚º React <strong>çŸ¥é“æ¯æ¬¡ render çš„ state å€¼</strong>ï¼Œè€Œç¯„ä¾‹ä¸­ <code>setCount</code> åšçš„äº‹åªæœ‰å›å‚³ <code>count + 1</code>ï¼ŒReact ä¸¦ä¸ç”¨ç‰¹åˆ¥å»æª¢æŸ¥å‰å¾Œå…©æ¬¡çš„ count state æ˜¯å¦ä¸€æ¨£ï¼Œå†å»åŸ·è¡Œã€‚</p><p>å¯ä»¥çœ‹åšå‘Šè¨´ React :</p><blockquote><p>ç¸½ä¹‹å¹«æˆ‘æŠŠ  <code>c=&gt;c+1</code> çš„çµæœå›å‚³çµ¦æˆ‘ ï¼Œä¸è«– c æ˜¯ä»€éº¼ï¼ŒReact æ˜¯çŸ¥é“çš„ã€‚</p></blockquote><p>å°±åƒæŒ‡ç¤ºï¼Œé€™ç¨®  <code>function setState</code>  çš„æ–¹å¼å¦‚åŒæ‰¹æ¬¡ (batch) æ›´æ–°ä¸€æ¨£ã€‚</p><p>æˆ‘å€‘ç¢ºå¯¦ç§»é™¤ count æ¸›å°‘ä¾è³´æ€§ï¼Œä½†ä¸¦ä¸æ˜¯å° deps èªªè¬Šï¼Œåªæ˜¯æˆ‘å€‘çš„ effect æ²’æœ‰è®€å–ä¾†è‡ª render çš„ç¯„åœè£¡é¢çš„ countã€‚</p><h3 id="è©¦è‘—æ‹†è§£ä¸¦äº†è§£">è©¦è‘—æ‹†è§£ä¸¦äº†è§£</h3><p>æˆ‘ç”¨è‡ªå·±çš„è©±è§£é‡‹é€™æ®µï¼Œä¸€é–‹å§‹çœ‹çš„æ™‚å€™çœŸçš„å¾ˆåƒåŠ›ğŸ˜µ</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…ˆå›å‘³ä¸€ä¸‹åŸå§‹é•·ç›¸ï¼Œæˆ‘è¦é–‹å§‹å¹«å®ƒè®Šèº«å›‰ğŸ˜²</span></span><br><span class="line"><span class="keyword">const</span> [count,setCount] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> id = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setCount</span>(<span class="number">0</span> =&gt; <span class="number">0</span> + <span class="number">1</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(id);</span><br><span class="line">&#125;,[])</span><br></pre></td></tr></table></figure><p>ä¸Šé¢èªªåˆ° <code>setInterval</code> å…¶å¯¦å¯ä»¥çœ‹åšæŠŠ function æåˆ°å¤–éƒ¨ï¼Œå› ç‚º <code>useEffect</code> åª render ä¸€æ¬¡ï¼Œä»£è¡¨å…§éƒ¨çš„ function æ˜¯ä¸æœƒè®Šéš¨ render é‡æ–°å‘¼å« (æ”¹è®Š) çš„ï¼Œç­‰åŒæ–¼æŠŠ function æåˆ°å¤–é¢å­˜åœ¨ä¾†ã€‚</p><p>ç”±æ–¼ <code>setCount</code> æœ¬èº«å°±æ˜¯é€é <code>updater function</code> å›å‚³æ–°çš„ state  å°±æˆ‘å€‘æŒ‰ç…§ä»–çš„æ¶æ§‹å›å‚³ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setIterval çš„ callback function çœ‹ä½œæŠŠæ±è¥¿å¯«åœ¨ render function ä»¥å¤–</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">countSomething</span> = (<span class="params">setCount</span>) =&gt; &#123;</span><br><span class="line">  <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setCount</span>(<span class="function"><span class="params">c</span> =&gt;</span> c + <span class="number">1</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>æŠŠæå‡ºçš„ function å¡å›å»ï¼Œä¸¦ä¸æœƒå½±éŸ¿åŸæœ¬çš„æ“ä½œ</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ”¾å›å»</span></span><br><span class="line"><span class="keyword">const</span> [count,setCount] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// å¡å›å»ä¸€æ¨£å¯ä»¥åŸ·è¡Œ</span></span><br><span class="line">    <span class="keyword">const</span> id = <span class="title function_">countSomething</span>(setCount);</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(id);</span><br><span class="line">&#125;,[]) <span class="comment">// ğŸ‘ˆ ä¾è³´é™£åˆ—æ˜¯ç©ºçš„</span></span><br></pre></td></tr></table></figure><p>ä¾†æŒ‰ç…§æ­¥é©Ÿä¾†äººé«” render çœ‹çœ‹ï¼ŒæŒ‰ç…§ React æ¯æ¬¡ render éƒ½åŒæ­¥è³‡æ–™ä¾†çœ‹</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬ä¸€æ¬¡ render</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. count = 0 </span></span><br><span class="line"><span class="keyword">const</span> count  = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// 3. é€²è¡Œ effect</span></span><br><span class="line">    <span class="keyword">const</span> id = <span class="title function_">countSomething</span>(setCount);  </span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. é€™é‚Šå…ˆ clean ï¼Œä½†ç¬¬ä¸€æ¬¡çš„ id æ˜¯ null</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(id);</span><br><span class="line">&#125;,[])</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬äºŒæ¬¡ render</span></span><br><span class="line"><span class="keyword">const</span> count = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* é›–ç„¶ useEffect ä¸æœƒåŸ·è¡Œ </span></span><br><span class="line"><span class="comment">  ä½†å…§éƒ¨çš„ setInterval æœƒç¹¼çºŒåŸ·è¡Œï¼Œç›´åˆ°è¢«æ¸…é™¤</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// ä¸æ˜¯é€™æ¨£ function ä¸€ç›´è¢«å‘¼å«ï¼Œè€Œæ˜¯å…§éƒ¨çš„ setInterval é–“éš”è§¸ç™¼å®ƒçš„ callback function</span></span><br><span class="line"><span class="title function_">countSomething</span>(setCount);</span><br></pre></td></tr></table></figure><p><code>setInterval</code> ä¸ç®¡åœ¨å“ªè£¡å‘¼å«ï¼Œç”±æ–¼å®ƒæ˜¯å±¬æ–¼ window (ç€è¦½å™¨) åº•ä¸‹çš„ apiï¼Œå¦‚æœæ²’æœ‰æ¸…é™¤ï¼Œé‚£éº¼ <code>window</code> ä¸€æ¨£æœƒæ¯é–“éš” x ç§’å‘¼å«ã€‚é€™å€‹ä¾‹å­è­‰æ˜ä¸è«–æ”¾åœ¨ render function å…§éƒ¨æˆ–æ˜¯å¤–éƒ¨ï¼Œ<code>setInterval</code> éƒ½æœƒé¢¨é›¨ç„¡é˜»çš„åŸ·è¡Œã€‚</p><blockquote><p>æ³¨æ„<br>æˆ‘å€‘è®€å–çš„ count å€¼å·²ç¶“ä¸æ˜¯ä¾†è‡ªæ–¼ render ç¯„åœçš„</p></blockquote><p>é€™æ˜¯ä»€éº¼æ„æ€å‘¢ ? ğŸ¤”</p><p>ç¶“ç”±ä¸Šé¢çš„è®ŠåŒ–å²ï¼Œå·²ç¶“çŸ¥é“è„«é›¢äº† render function ä¾ç„¶å¯ä»¥åŸ·è¡Œï¼Œé‚£é€™è£¡çš„ <code>setCount (c=&gt;c+1)</code> è£¡é¢çš„ <strong><code>c=&gt; c+ 1</code></strong> åˆæ˜¯å¦ä¸€å€‹ callback functionï¼Œé‚£ <code>c</code> é€™å€‹åƒæ•¸ä¾†è‡ªèª°é‡è¦å— ?  æˆ‘å€‘æœ‰å¿…è¦å¡«å…¥é€™å€‹ c å€¼æ‰èƒ½è¨ˆç®—å— ? (æ„æ€æ˜¯ä¸€å®šè¦å¯«<code>setCount(anotherfunction(c))</code> æ‰èƒ½åŸ·è¡Œå— ?  )</p><p>æˆ‘å†æŠŠ <code>setCount</code> è£¡é¢çš„ callback function åˆæ‹†å‡º render ä»¥å¤–ï¼Œå« <code>plusOne</code>ï¼Œä¸¦ä¸”æˆ‘æŠŠé€™å€‹ <code>plusOne</code> çœ‹åšæˆ‘å€‘è¦å° <code>setCount</code> åšæŸäº‹çš„è—åœ–ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">countSomething</span> = (<span class="params">setCount</span>) =&gt; &#123;</span><br><span class="line">  <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setCount</span>(plusOne);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// å‘Šè¨´ React è³‡æ–™è¦åšçš„äº‹</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">plusOne</span>(<span class="params">c</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> c + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ğŸ‘‰  <a href="https://codesandbox.io/s/mystifying-williamson-s4799j?file=/src/index.js"> <code>codsandbox</code> ç¯„ä¾‹</a></p><p>åœ¨æŠŠé€™ä¸²æ”¾å›å»ï¼Œä¸€æ¨£å¯ä»¥åŸ·è¡Œã€‚<code>setState</code> å¦‚æœæ˜¯ä½¿ç”¨ callback function çš„æ–¹å¼ä½¿ç”¨ï¼Œå…§éƒ¨å…¶å¯¦æ˜¯å‘¼å« <strong>updater function</strong><sup id="fnref:4"><a href="#fn:4" rel="footnote">4</a></sup>ï¼Œå®ƒæœƒä¿è­‰æ‹¿åˆ°æœ€æ–°çš„ stateï¼Œè€Œæˆ‘å€‘çš„ <code>plusOne</code> åªæ˜¯ updater function çš„å¦ä¸€ç¨®è¡¨é”æ–¹å¼ã€‚</p><p>å›åˆ° React render çš„æ¦‚å¿µ : <strong>æ¯æ¬¡ render éƒ½ä¿æœ‰è‡ªå·±çš„è³‡æ–™</strong>ï¼Œæ‰€ä»¥æˆ‘å€‘ä¸ç”¨ç‰¹åˆ¥æ”¾å…¥ deps ä¾†å‘Šè¨´ React ï¼Œå› ç‚º React å°±å·²ç¶“çŸ¥é“ç•¶æ¬¡çš„ stateã€‚</p><p>é€™æ®µæœ‰é»é¥’å£ï¼Œä½†å¹«åŠ©æˆ‘é‡æ¸…åˆ°åº•ç‚ºä»€éº¼ä¸ç”¨åŠ å…¥ deps å…§ä¾ç„¶å¯ä»¥åŸ·è¡Œé€™å€‹å•é¡Œã€‚</p><h2 id="å¾-Google-æ–‡ä»¶çš„æ›´æ–°äº†è§£-function-updater">å¾ Google æ–‡ä»¶çš„æ›´æ–°äº†è§£ function updater</h2><p>å¦‚ä¸Šé¢çš„ç¯„ä¾‹ï¼ŒçŸ¥é“å¯ä»¥ä½¿ç”¨ <code>setCount(c =&gt; c + 1)</code>  é¿é–‹ deps å¡«å…¥ state ï¼Œä½† :</p><ol><li>ç‚ºä»€éº¼ä½¿ç”¨å‘¢ ?</li><li>è·ŸåŸæœ¬ <code>setCount( c + 1)</code> å·®åˆ¥åœ¨å“ª ?</li></ol><p>æ–‡ç« ä¸­èˆ‰ä¾‹ Google æ–‡ç« æ˜¯é›²ç«¯ç·¨è¼¯ã€‚ä¿®æ”¹çš„æ™‚å€™ï¼Œä¸¦ä¸æ˜¯æ¯æ¬¡éƒ½å‚³é€æ•´å€‹é é¢çš„å…§å®¹çµ¦ä¼ºæœå™¨ï¼Œæ–‡ç« å¦‚æœæª”æ¡ˆå¤§ï¼Œé‚£æ¨£å‚³é€è¦†è“‹å¤ªæ²’æ•ˆç‡äº†ã€‚é‚£æ€éº¼æºé€šçµ¦å¾Œç«¯è®“å®ƒè¨˜ä½æ–°å¢æˆ–ä¿®æ”¹çš„éƒ¨åˆ†å‘¢ ?</p><blockquote><p>é€éå‚³é <strong>å®šç¾©å¥½çš„è¡¨é”æ–¹å¼</strong></p></blockquote><p>å…¶å¯¦å¦‚æœä½¿ç”¨é redux å°±çŸ¥é“ dispatch èˆ‡ action çš„ç™¼è™Ÿæ–½ä»¤çš„æ¦‚å¿µï¼Œåªæœ‰å·²ç¶“å®šç¾©åˆ°çš„ action type å°æ‡‰ actions æ‰èƒ½å°è³‡æ–™å…§å®¹é€²è¡Œè®Šå‹•ã€‚é‚£ä¹Ÿå¯ä»¥æƒ³åƒ Google æ–‡ç« åœ¨ç·¨è¼¯æ™‚ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œ<em>ä½¿ç”¨è€…é»æ“ŠæŸå€‹æŒ‰éˆ•ï¼Œå¾Œç«¯å†åšå‹•ä½œ</em>ã€‚</p><p>å¦‚æ­¤ä¸€ä¾†é”åˆ° <strong>æ‰¾å‡ºæœ€å°åŒ–çš„è³‡æ–™ä¾†æ”¹è®Šé€™å€‹ component</strong> ï¼Œå¦‚åŒ Google æ–‡ä»¶ä¸æœƒé€æ•´é è³‡æ–™å‡ºå»æ”¹è®Šæ–‡ä»¶ã€‚</p><p>é€™ç¨®æ–¹å¼è·Ÿæ˜¯ React æ‰€å»ºè­°çš„åŸå‰‡ : <strong>å°‹æ‰¾æœ€å°åŒ–ä½†å®Œæ•´çš„ state</strong> çš„æ¦‚å¿µ (æ„æ€æ˜¯æœ‰äº›è³‡æ–™æ˜¯å¯ä»¥é€éè¨ˆç®—å‡ºä¾†çš„ï¼Œä¸ä¸€å®šæ‰€æœ‰è³‡æ–™éƒ½å¾—æ˜¯å…§éƒ¨çš„ stateï¼Œä¾‹å­è£œå……åœ¨å¾Œé¢)ï¼Œå·®åˆ¥æ˜¯é€™æ˜¯ update çš„ã€‚</p><p>æœ€å°åŒ–ä¸”å®Œæ•´çš„ state èˆ‰ä¾‹ :<br>ä»¥ todo list ç‚ºä¾‹ï¼Œæœ‰å­˜æ”¾æ‰€æœ‰ todo çš„é™£åˆ— state ï¼Œä½†æˆ‘æƒ³è¦å­˜å– todo çš„é•·åº¦ï¼Œä¸¦ä¸éœ€è¦å¦å¤–å„²å­˜çš„ state</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ ä¸ç”¨é€™æ¨£</span></span><br><span class="line"><span class="keyword">const</span> [length,setLength] = <span class="title function_">useState</span>(<span class="literal">null</span>)</span><br></pre></td></tr></table></figure><p>å› ç‚ºå¯ä»¥å¾ <code>state.todos.length</code>  å–å¾—ï¼Œé€™ç­†è³‡æ–™æ˜¯å¯ä»¥é€šéè¨ˆç®—å–å¾—ã€‚<br>é€™ä¹Ÿæ˜¯ç‚ºä»€éº¼ä¸Šé¢èªª  <code>c =&gt; c + 1</code> æ˜¯ä¸€å€‹è—åœ–ï¼Œå› ç‚ºå®ƒå‚³é”çš„æ˜¯å€‹è³‡æ–™çš„è¡¨é”æ–¹å¼ã€‚</p><p>é‚£ç‚ºä»€éº¼ <code>setCount(c =&gt; c + 1)</code> æ¯”è¼ƒå¥½å‘¢ ? ğŸ¤”</p><p>åœ¨æ–¼ <strong>å®ƒæ²’æœ‰ç›´æ¥æ”¹è®Š count æœ¬èº«</strong> (æ²’æœ‰æ±™æŸ“åˆ°è®Šæ•¸)ï¼Œé€™å€‹ä¾‹å­ç”¨æœ€åŸå§‹çš„ JavaScript ä¾†çœ‹ã€‚ç”±æ–¼æœ¬æ¬¡çš„ count æ˜¯ primitive typeï¼Œé€™é‚Šä¸¦ä¸è¨è«– object type (React ä¹‹æ‰€ä»¥æœƒå»ºè­°è§£æ§‹ object type æ˜¯æœ‰åŸå› çš„)ã€‚</p><ul><li><code>c =&gt; c+1</code> : ä¸¦æ²’æœ‰æ”¹è®Šåˆ°åŸå§‹çš„ count</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> count = <span class="number">0</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">plusOne</span>(<span class="params">count</span>)&#123;</span><br><span class="line">  count =  count + <span class="number">1</span></span><br><span class="line">  <span class="keyword">return</span> count</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> newCount = <span class="title function_">plusOne</span>(count) <span class="comment">// ç”¨è®Šæ•¸æ¥èµ·ä¾†</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newCount) <span class="comment">// 1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(count) <span class="comment">// 0</span></span><br></pre></td></tr></table></figure><ul><li><code>c + 1</code> : ç›´æ¥å° count é€²è¡Œæ“ä½œğŸ˜µ</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> count = <span class="number">0</span> </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">plusOne</span>(<span class="params"></span>)&#123;</span><br><span class="line">  count = count + <span class="number">1</span></span><br><span class="line">  <span class="keyword">return</span> count</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> newCount = <span class="title function_">plusOne</span>() </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(count) <span class="comment">// 1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newCount) <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><p>ä¸ç›´æ¥æ“ä½œè³‡æ–™ä¹Ÿæ˜¯é¿å…éé æœŸçš„çµæœç™¼ç”Ÿã€‚</p><p>é€™ç¨®æ–¹å¼ä¿è­‰æ›´æ–°å¤šå€‹ä¾†æº (äº‹ä»¶æˆ–æ˜¯å…·æœ‰å‰¯ä½œç”¨çš„æ“ä½œç­‰ç­‰) éƒ½å¯ä»¥è¢«åˆä½µæˆ <strong>å¯é æ¸¬çš„æ­£ç¢ºæ“ä½œ</strong>ã€‚ç„¶è€Œ <code>setCount(c =&gt; c + 1)</code> ä¸¦ä¸æ˜¯æœ€ä½³è§£æ³•ï¼Œé‡åˆ°ä»¥ä¸‹çš„æƒ…å¢ƒï¼Œå¯èƒ½æœƒç”¢ç”Ÿå¥‡æ€ªçš„å•é¡Œ :</p><ol><li>åŸ·è¡Œ effect åŒæ™‚ä¾è³´å¤šå€‹ state</li><li>é€é props è¨ˆç®—æ–°çš„ state</li></ol><p>é€™æ™‚å€™å¯ä»¥ä½¿ç”¨ <code>useReducer</code> ä¾†å¹«æˆ‘å€‘è§£æ±ºå•é¡Œã€‚</p><p><code>useReducer</code> å¯ä»¥çœ‹åšåŠ å¼·ç‰ˆçš„ useStateï¼Œè€Œäº‹å¯¦ä¸Š <code>useState</code> ä¹Ÿæ˜¯ <code>useReducer</code> ç°¡åŒ–éä¾†çš„ï¼Œæœ‰èˆˆè¶£å¯ä»¥åƒè€ƒé€™ç¯‡ <a href="https://medium.com/%E6%89%8B%E5%AF%AB%E7%AD%86%E8%A8%98/react-hooks-usestate-vs-usereducer-b14966ad37dd">React Hooks | æ—¢ç”Ÿ useState ä½•ç”Ÿ useReducer ? | by Airwaves | æ‰‹å¯«ç­†è¨˜ | Medium</a></p><h2 id="å°‡è³‡æ–™æ›´æ–°èˆ‡æ“ä½œåˆ†é›¢">å°‡è³‡æ–™æ›´æ–°èˆ‡æ“ä½œåˆ†é›¢</h2><p>ç¯„ä¾‹ä¸­ count æ˜¯è¢« step å½±éŸ¿ï¼Œæˆ‘å€‘ä¹Ÿç¢ºå¯¦å°‡æ­£ç¢ºçš„ deps æ”¾é€²å»ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [step, setStep] = <span class="title function_">useState</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> id = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setCount</span>(<span class="function"><span class="params">c</span> =&gt;</span> c + step);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(id);</span><br><span class="line">  &#125;, [step]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;step&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;e</span> =&gt;</span> setStep(Number(e.target.value))&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨ç™½è©±æ–‡è§£é‡‹ : ç•¶ step æ”¹è®Šæ™‚ï¼Œ effect æœƒå…ˆæ¸…é™¤ä¸Šä¸€å€‹è¨ˆæ™‚å™¨ï¼Œæ¥è‘—ç”¢ç”Ÿæ–°çš„è¨ˆæ™‚å™¨ã€‚</p><blockquote><p>ä½†æ˜¯å¦‚æœä¸æƒ³è¦æ”¹è®Š step å°±é‡å•Ÿ interval é‡æ–°è¨ˆæ™‚å‘¢ ? å¦‚æœæƒ³è¦å‹•æ…‹çš„æ”¹è®Š step åˆèƒ½æŒçºŒè¨ˆæ™‚å‘¢ ?</p></blockquote><p>é‚£éº¼å°±å¿…é ˆæŠŠ step å¾ deps ç§»é™¤ï¼Œé¿å… step æ”¹è®Šä¹Ÿæ¸…é™¤ effect åˆç”¢ç”Ÿæ–°çš„ <code>setInterval</code> é‡è¨ˆã€‚</p><p>é€™ç¨®æƒ…æ³æ˜¯å¤šå€‹è³‡æ–™äº’ç›¸ä¾è³´ <code>(count â‡’ step)</code>ï¼Œè€Œä¸”æ˜¯ A è³‡æ–™è·Ÿ B è³‡æ–™ç¾åœ¨çš„å€¼æœ‰é—œã€‚(count æ¯ç§’å¢åŠ çš„å€¼ï¼Œè·Ÿ step çš„å€¼æœ‰é—œ)</p><p>å¯ä»¥æ”¹ä½¿ç”¨ <code>useReducer</code> ç®¡ç†è¤‡é›œçš„è³‡æ–™æµã€‚<code>useState</code> é€šå¸¸åªèƒ½å°è‘—ä¸€ç­†è³‡æ–™æ“ä½œï¼Œå¦‚æœæœ‰å¾ˆå¤šç­†ï¼Œå¯èƒ½æœƒå»ºç«‹å¤šå€‹ <code>useState</code>ã€‚æˆ–æ˜¯ç™¼è¦ºæ“ä½œè³‡æ–™æ˜¯ <strong>æ ¹æ“šæ–¼å‰ä¸€æ¬¡çš„è³‡æ–™</strong>ï¼Œé€™æ™‚å€™å¾ˆé©åˆæ›æˆ <code>useReducer</code>ã€‚</p><blockquote><p>reducer å¯ä»¥è®“æˆ‘å€‘é€é <strong>action type å°æ‡‰ action å†å»æ›´æ–°è³‡æ–™</strong> ï¼Œè€Œä¸”ä¹Ÿå¯ä»¥åŒæ™‚å°å¤šç­†è³‡æ–™æ“ä½œã€‚</p></blockquote><p>ä»€éº¼æ„æ€å‘¢ ? é‚£ <code>useState</code> ä¸èƒ½åšé€™æ¨£çš„äº‹å— ?<br>å¯ä»¥ï¼Œä½†æ˜¯éå¸¸éº»ç…©ï¼Œæœƒä½¿é‚è¼¯è®Šå¾—è¤‡é›œğŸ¤”ã€‚</p><p>æˆ‘è©¦è‘—å¾©åˆ»é€™å…©ç¨®æ–¹å¼çš„æ“ä½œ :</p><ol><li>ç…§èˆŠåˆ†é–‹çš„å…©å€‹è³‡æ–™ï¼ŒåŒæ™‚æ›´æ–°</li><li>ç”±æ–¼å…©å€‹æ˜¯ç›¸ä¾æ€§çš„ï¼ŒæŠŠå®ƒæ”¾åœ¨åŒä¸€å€‹è³‡æ–™ç‰©ä»¶ä¸­ã€‚</li></ol><p>å¦å¤–å¤šå‡ºä¾†çš„æ˜¯å˜—è©¦å…¶ä»–ç¨®æ–¹å¼ã€‚</p><ol><li>åŸå§‹ç¯„ä¾‹ : <a href="https://codesandbox.io/s/zxn70rnkx">Dan å¤§æä¾›çš„ CodeSandbox</a></li><li>å¯¦ä½œç¯„ä¾‹ : <a href="https://codesandbox.io/s/zealous-monad-rco7nx?file=/src/index.js">æˆ‘è¤‡è£½æ”¹éçš„ CodeSandbox</a>ï¼Œç¯„ä¾‹æœƒçœ‹åˆ°å¤šå€‹ä¸åŒçš„å¯«æ³•ï¼Œä»¥ä¸‹æœƒä¸€å€‹å€‹èªªæ˜ã€‚</li></ol><h3 id="å¯¦é©—-åˆ†é–‹çš„å…©ç­†è³‡æ–™æ›´æ–°">å¯¦é©— : åˆ†é–‹çš„å…©ç­†è³‡æ–™æ›´æ–°</h3><p>é¦–å…ˆè¦é‡æ¸…æ”¹è®Šå…¶å€¼çš„è®Šå› ï¼Œcount æ˜¯ä¾è³´è‘— stepï¼Œä½†æ˜¯ step æ˜¯æ‰‹å‹•è¼¸å…¥å€¼æ‰€æ”¹è®Šçš„ï¼Œå› æ­¤ step é›–ç„¶æ”¹è®Šäº†ï¼Œä½†æ˜¯ count ä¸èƒ½æ‹¿åˆ°æœ€æ–°çš„ stepã€‚</p><ul><li>é€éä¸Šé¢èªªéçš„ updater functionï¼Œæˆ‘å€‘å¯ä»¥çŸ¥é“ <code>(c =&gt; c)</code> é€™æ¨£å¯ä»¥æ‹¿åˆ°æœ€æ–°å€¼ã€‚</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">const</span> [step, setStep] = <span class="title function_">useState</span>(<span class="number">1</span>);</span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> id = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setStep</span>(<span class="function">(<span class="params">s</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// æœ€æ–°çš„ step</span></span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(s);</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="title function_">setCount</span>(<span class="function">(<span class="params">c</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// é‚£é€™è£¡çš„ step å‘¢ ? ğŸ¤”</span></span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;step in count&quot;</span>, step);</span><br><span class="line">        <span class="keyword">return</span> c + step;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(id);</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><p>å…¶ä»–éƒ¨åˆ†è·ŸåŸç¯„ä¾‹ä¸€æ¨£æ²’æœ‰æ›´æ”¹ã€‚</p><blockquote><p>ç•¶ç„¶çµæœæ˜¯ä¸è¡Œçš„ã€‚</p></blockquote><p>è©¦è‘—ç”¨ <code>setStep</code> æ‹¿åˆ°æœ€æ–°çš„ stepï¼Œä¸¦ä¸ä»£è¡¨ç•¶ä¸‹å–å¾—çš„ step æœƒæ˜¯æœ€æ–°çš„ã€‚React æ–°æ‰‹æœ€å¸¸é™·å…¥çš„é™·é˜±æ˜¯åŸ·è¡Œ <code>setState</code> å¾Œé¦¬ä¸Šè®€å– state å€¼ï¼Œstate ä¸æœƒæ˜¯æ–°çš„ã€‚<br>é€™è·Ÿ <code>setState</code> æ˜¯éåŒæ­¥çš„æœ‰é—œä¿‚ã€‚</p><p>å›åˆ°é‚£å¥è©± : <strong>æ¯ä¸€æ¬¡ render éƒ½æ“æœ‰å®ƒå°ˆå±¬çš„ state æˆ– props</strong> ã€‚<br>æ‰€ä»¥  <code>setCount</code> è£é ­çš„ step é‚„åœç•™åœ¨ç¬¬ä¸€æ¬¡ render ï¼Œ<code>step = 1</code>ã€‚å³ä½¿ä¿®æ”¹ input çš„å€¼ï¼Œé›–ç„¶ <code>setStep</code> é‚£è¡Œå¯ä»¥æ‹¿åˆ°æœ€æ–°çš„ stepï¼Œä½†æ²’è¾¦æ³•åœ¨ <code>setCount</code> è£¡é¢æ‹¿åˆ°ã€‚</p><h3 id="å¯¦é©—-å†æŸç­†è³‡æ–™å…§éƒ¨æ‹¿åˆ°æœ€æ–°">å¯¦é©— :  å†æŸç­†è³‡æ–™å…§éƒ¨æ‹¿åˆ°æœ€æ–°</h3><p>é‚£åœ¨ <code>setStep</code> ä¸­æ‹¿åˆ°æœ€æ–° step åœ¨å‚³çµ¦ <code>setCount</code> ç¸½å¯ä»¥äº†å§ğŸ¤”</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line"><span class="keyword">const</span> id = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setStep</span>(<span class="function">(<span class="params">s</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setCount</span>(<span class="function">(<span class="params">c</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;step in count&quot;</span>, step);</span><br><span class="line">        <span class="keyword">return</span> c + s;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span> s;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(id);</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><p>è®Šå¾—è¶Šä¾†è¶Šè¤‡é›œäº†ï¼ŒèªçœŸæ‹†è§£çš„è©±å°±æ˜¯ callback hell äº†ã€‚åŒä¸Šé¢èªªçš„å¦‚æœ deps æ˜¯ç©ºçš„ï¼Œstate å†ä¹Ÿä¸æ˜¯å–è‡ª render function è£¡é¢ï¼ŒåŒæ¨£å¯ä»¥æŠŠé€™äº› method çœ‹ä½œå¯«åœ¨å¤–éƒ¨ã€‚</p><ul><li>ä¸Šé¢å°±åƒ :</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‹†è§£å†æ‹†è§£</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">countSomething</span> = (<span class="params">setCount</span>) =&gt; <span class="function">(<span class="params">setStep</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// callback å† callback</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setStep</span>(<span class="function">(<span class="params">s</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setCount</span>(<span class="function">(<span class="params">c</span>) =&gt;</span> c + s);</span><br><span class="line">      <span class="keyword">return</span> s;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line"> <span class="keyword">const</span> id = <span class="title function_">countSomething</span>(setCount)(setStep);</span><br><span class="line"> <span class="keyword">return</span> <span class="function">()=&gt;</span> <span class="title function_">cleanInterval</span>(id)</span><br><span class="line">&#125;,[])</span><br></pre></td></tr></table></figure><p>çœ‹èµ·ä¾†é‚„è¡ŒğŸ¤”ï¼Œä½†æˆ‘èªç‚ºé€™æ¨£çš„æ¶æ§‹ä¸å¥½è¢«æ“´å±•ï¼Œé™¤éè£¡é¢åˆå†æ‹†ï¼Œä¸éåŒæ™‚ä¹Ÿè®“æˆ‘æƒ³åˆ° HOC (Higher Order Component)ï¼Œé€™æ¨£çš„æ–¹æ³•æœƒæœ‰æ•ˆèƒ½ä¸Šçš„å•é¡Œã€‚</p><h3 id="å¯¦é©—-object-type-çš„-state">å¯¦é©— : object type çš„ state</h3><p>æˆ‘èªç‚ºé€™å€‹ä¾‹å­æ˜¯æœ€æ¥è¿‘ <code>useReducer</code> çš„ï¼ŒåŒæ™‚å¿…é ˆæŠŠçµæ§‹å¤§æ”¹ï¼Œä¸¦ä¸”ç”¨ immutable çš„æ–¹å¼æ”¹è®Šè³‡æ–™ã€‚</p><ul><li><code>useState</code> è¨­ç‚º object :</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 1. æŠŠæ‰€æœ‰ç›¸é—œçš„ state æ”¾å…¥åŒä¸€å€‹å®¹å™¨ä¸­</span></span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = <span class="title function_">useState</span>(&#123;</span><br><span class="line">     <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">     <span class="attr">step</span>: <span class="number">1</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> id = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 2. ä¸€æ¨£ä½¿ç”¨ updater function æ‹¿åˆ°æœ€æ–°å€¼</span></span><br><span class="line">    <span class="title function_">setValue</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> (&#123; ...v, <span class="attr">count</span>: v.<span class="property">count</span> + v.<span class="property">step</span> &#125;));</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(id);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* 3. step ä¹Ÿè¦ä¿®æ”¹ */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">value</span>=<span class="string">&#123;value.step&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span> setValue(&#123; ...value, step: Number(e.target.value) &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">      /&gt;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½åƒæ¯”ä¸Šé¢éƒ½æ›´ä¾†çš„ç²¾ç°¡ï¼Œåªæ˜¯æ”¹è®Š state è®Šæˆå¾ˆå›‰å”†ğŸ˜µ</p><h3 id="å¯¦é©—-æŠŠ-input-è®Šæˆ-uncontrolled-component">å¯¦é©— : æŠŠ input è®Šæˆ uncontrolled component</h3><p>åœ¨ [[#ä½¿ç”¨ ref ä¾†å–å¾—æœ€æ–°å€¼]] é€™ç« ç¯€å·²ç¶“æœ‰æåˆ°ï¼Œæ­é…ä¸Šè¡¨å–®çš„æ§åˆ¶ï¼Œå¯ä»¥è®“æˆ‘å€‘ä¸ re-render çš„æƒ…æ³ä¸‹ï¼Œä¾ç„¶æ‹¿åˆ° input çš„æœ€æ–°å€¼ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> stepRef = <span class="title function_">useRef</span>(<span class="number">1</span>);</span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> id = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setCount</span>(<span class="function">(<span class="params">c</span>) =&gt;</span> c + <span class="title class_">Number</span>(stepRef.<span class="property">current</span>.<span class="property">value</span>));</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(id);</span><br><span class="line">&#125;, []);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¹æˆ</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;stepRef&#125;</span> <span class="attr">defaultValue</span>=<span class="string">&#123;1&#125;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="å›åˆ°-useReducer">å›åˆ° useReducer</h2><ul><li>æŒ‰ç…§æ–‡ç« ä¸­æä¾›çš„ <code>useReducer</code> ç¯„ä¾‹</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹å€¼</span></span><br><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">step</span>: <span class="number">1</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">  <span class="comment">// è§£æ§‹ state</span></span><br><span class="line">  <span class="keyword">const</span> &#123; count, step &#125; = state;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ ¹æ“šä¸åŒçš„ action type ä¾†æ”¹è®Š stateï¼Œå¦‚æœ type ä¸€å¤šç”¨ switch case</span></span><br><span class="line">  <span class="keyword">if</span> (action.<span class="property">type</span> === <span class="string">&#x27;tick&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">count</span>: count + step, step &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (action.<span class="property">type</span> === <span class="string">&#x27;step&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; count, <span class="attr">step</span>: action.<span class="property">step</span> &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// useReducer </span></span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(reducer, initialState);</span><br><span class="line">  <span class="comment">// è§£æ§‹å€¼</span></span><br><span class="line">  <span class="keyword">const</span> &#123; count, step &#125; = state;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> id = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// dispatch ä¸€å€‹ action</span></span><br><span class="line">      <span class="title function_">dispatch</span>(&#123; <span class="attr">type</span>: <span class="string">&#x27;tick&#x27;</span> &#125;);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(id);</span><br><span class="line">  &#125;, [dispatch]); <span class="comment">//ğŸ‘ˆ deps æ”¾å…¥ dispatch</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;step&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        // ä¸€æ¨£ dispatch action</span></span><br><span class="line"><span class="language-xml">        dispatch(&#123;</span></span><br><span class="line"><span class="language-xml">          type: &#x27;step&#x27;,</span></span><br><span class="line"><span class="language-xml">          step: Number(e.target.value)</span></span><br><span class="line"><span class="language-xml">        &#125;);</span></span><br><span class="line"><span class="language-xml">      &#125;&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£é€™æœ‰æ¯”è¼ƒå¥½å— ? æ„æ€æ˜¯ deps æ”¾å…¥ dispatch ä¸æ˜¯æœƒå›åˆ° <code>setInterval</code> åˆé‡æ–°çš„ç‹€æ³å— ?</p><p>äº‹å¯¦ä¸Šå¯ä»¥é€™éº¼åšæ˜¯å› ç‚º <strong>React ä¿è­‰ dispatch æ°¸é è¢«ä¸æœƒæ”¹è®Š</strong>ï¼Œæ‰€ä»¥å®ƒä¸æœƒè®“ state æ”¹è®Šåˆé‡æ–°å•Ÿå‹•è¨ˆæ™‚ã€‚ç”±æ–¼ dispatch ä¸æœƒæ”¹è®Šï¼Œæ‰€ä»¥ <code>prevDispatch === nextDispatch</code>ã€‚</p><p><code>useEffect</code> çš„ deps å¯ä»¥å¿½ç•¥</p><ol><li><code>dispatch</code></li><li><code>setState</code></li><li><code>useRef</code> å®¹å™¨å€¼ : æŒ‡ <code>ref.current</code></li></ol><p>å› ç‚º React ä¿è­‰ä»–å€‘æ˜¯éœæ…‹çš„ï¼Œä¸æœƒè¢«æ”¹è®Šã€‚ä¸éæŒ‡å®šä»–å€‘ä¹Ÿä¸æœƒæ€éº¼æ¨£ã€‚</p><p>å›åˆ°å„ªé»çš„éƒ¨åˆ†ï¼Œæ¯”èµ·åœ¨ effect è£¡é¢ç›´æ¥è®€å– <code>state</code>ï¼Œ<strong>dispatch acition</strong> çµ¦äºˆä¸€å€‹è³‡æ–™è¡¨é”çš„æ–¹å¼ï¼Œä¸¦ä¸”åœ¨å¤–éƒ¨çš„ reducer æŒ‰ç…§ action type æ“ä½œè³‡æ–™ã€‚è®“ effect æŠŠ step é€™å€‹ state åˆ†é–‹ä¾†çœ‹å¾…ï¼Œcount è·Ÿ step çš„ä¾è³´æ€§å°±ä¸æœƒå› åœ¨ render function å°è‡´ä¸åŒæ­¥çš„å•é¡Œã€‚</p><p>effect ä¸é—œæ³¨æ€éº¼æ›´æ–° stateï¼Œè€Œæ˜¯ä»€éº¼å‹•ä½œè¦ç™¼ç”Ÿï¼Œä¸¦åœ¨ reducer é›†ä¸­è™•ç†é€™äº›è³‡æ–™é‚è¼¯ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; count, step &#125; = state;</span><br><span class="line">  <span class="comment">// æ”¶åˆ° tickï¼Œreducer å®šç¾© tick å°è³‡æ–™åšæŸä»¶äº‹ï¼Œå›å‚³ count : count + step</span></span><br><span class="line">  <span class="keyword">if</span> (action.<span class="property">type</span> === <span class="string">&#x27;tick&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">count</span>: count + step, step &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (action.<span class="property">type</span> === <span class="string">&#x27;step&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// æ”¶åˆ° stepï¼Œå° step è³‡æ–™åšé‡æ–°è³¦å€¼</span></span><br><span class="line">    <span class="keyword">return</span> &#123; count, <span class="attr">step</span>: action.<span class="property">step</span> &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç‚ºä»€éº¼-useReducer-æ˜¯-Hooks-çš„ä½œå¼Šæ–¹å¼">ç‚ºä»€éº¼ useReducer æ˜¯ Hooks çš„ä½œå¼Šæ–¹å¼ ?</h2><p>æ–‡ä¸­æå‡ºä¸€å€‹æƒ…å¢ƒ</p><blockquote><p>å¦‚æœæ˜¯ step é€é props å‚³ä¸‹ä¾†çš„å€¼å‘¢ ?</p></blockquote><ul><li>æ–‡ä¸­ç¯„ä¾‹</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨çˆ¶å…ƒä»¶æŠŠ step å¾€ä¸‹å‚³ </span></span><br><span class="line">&lt;<span class="title class_">Counter</span> step=&#123;<span class="number">1</span>&#125; /&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params">&#123; step &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, dispatch] = <span class="title function_">useReducer</span>(reducer, <span class="number">0</span>);</span><br><span class="line">  <span class="comment">// å› ç‚º step  æ˜¯ props ï¼Œè¦æŠŠ reducer æ¬é€²ä¾†æ‰èƒ½è®€å–åˆ°</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (action.<span class="property">type</span> === <span class="string">&#x27;tick&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> state + step;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é€™é‚Šéƒ½æ²’è®Š</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> id = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">dispatch</span>(&#123; <span class="attr">type</span>: <span class="string">&#x27;tick&#x27;</span> &#125;);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(id);</span><br><span class="line">  &#125;, [dispatch]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€™å€‹ç¯„ä¾‹æœ‰å„ªåŒ–ä¸Šçš„å•é¡Œï¼Œä¸è¦ç•¶ä½œåˆç†çš„ä½¿ç”¨æ–¹å¼ã€‚(æˆ‘è¦ºå¾—æ˜¯ reducer function ä¸æ–·æ–°ç”¢ç”Ÿçš„å•é¡Œï¼Œé€šå¸¸æœƒç”¨ <code>useCallback</code> é¿å…æ¯æ¬¡ render  é‡æ–°ç”¢ç”Ÿã€‚)</p><p>é€™å€‹ç¯„ä¾‹ dispatch ä¾ç„¶ä¸æœƒæ”¹è®Šï¼Œæ‰€ä»¥ effect è£é ­ä¸¦ä¸æœƒ re-renderã€‚å› ç‚º step ä¸å±¬æ–¼ <code>useReducer</code>  çš„ stateï¼Œ<code>reducer</code> æ€éº¼çŸ¥é“ props ç”¢ç”Ÿè®ŠåŒ–è€Œæ‹¿åˆ°æœ€æ–°çš„ props å‘¢ ?</p><p>ç”±æ–¼ effect ä¸æœƒå†åŸ·è¡Œï¼ŒReact æœƒè¨˜ä½ dispatch ä¸­çš„ actionï¼Œä½†é€™ä¾ç„¶æœƒåœ¨ä¸‹æ¬¡ re-render (state æˆ–æ˜¯ props æ”¹è®Š) å‘¼å« reducer ã€‚é€™æ™‚å€™ props æ˜¯æ–°çš„ï¼Œreducer æ¥æ”¶åˆ°çš„ props ä¹Ÿæ˜¯æ–°ï¼Œä½†ä¸æ˜¯åœ¨ effect æ‹¿åˆ°ã€‚</p><p>é€™ä¹Ÿå°±æ˜¯ç‚ºä»€éº¼ Dan å¤§èªª <code>useReducer</code> åƒæ˜¯ Hooks çš„ä½œå¼Šæ¨¡å¼ï¼Œå› ç‚º<strong>æŠŠæè¿°äº‹æƒ…è·Ÿæ›´æ–°é‚è¼¯æ“ä½œåˆ†é–‹äº†</strong>ã€‚å¦å¤–ä¸€æ–¹é¢ï¼Œå¯ä»¥ç§»é™¤ä¸€äº› effect ä¸­ä¸éœ€è¦çš„ depsï¼Œé¿å…ä¸å¿…è¦çš„ re-renderã€‚</p><h3 id="ç™½è©±ç¿»è­¯æ©Ÿ">ç™½è©±ç¿»è­¯æ©Ÿ</h3><p>å…ˆç¢ºå®šå¹¾ä»¶äº‹ :</p><ol><li>effect æ˜¯ä¸æœƒé‡æ–°å‘¼å«ï¼Œå› ç‚º dispatch æ°¸é éƒ½æ˜¯åŒä¸€å€‹</li><li>dispatch ç™¼é€çš„åªæ˜¯ä¸€å€‹ <code>action</code>ï¼Œè€Œä¸”ä¹Ÿä¸æœƒæ”¹è®Šã€‚è€Œ reducer æ˜¯æ¥æ”¶ action type ä¾†å° state æ“ä½œã€‚</li><li>reducer åœ¨ render function ç¯„åœå…§ï¼ŒæŒ‰ç…§åŸæœ¬æ¯ä¸€å€‹ render éƒ½æœ‰å®ƒçš„ state æˆ– props ï¼Œä¹Ÿå°±æ˜¯ç•¶ Counter å›  state æˆ– props æ”¹è®Šè€Œ re-render ï¼Œreducer ä¹Ÿæœƒç”¢ç”Ÿæ–°çš„ function ï¼Œä¹Ÿæœƒæ‹¿åˆ°ç•¶å‰ render  ç¯„åœçš„ propsã€‚</li><li><code>setInterval</code> ä¾ç„¶é–“éš”ç§’æ•¸åŸ·è¡Œã€‚</li></ol><p>å¦‚æœç”¨ redux çš„æƒ³æ³•ä¾†æ€è€ƒï¼Œæœƒçœ‹éé€™å¼µç¶“å…¸çš„åœ–ï¼Œæ¯”è¼ƒå®¹æ˜“ç†è§£ï¼Œdispatch æ¥æ”¶ä¸€å€‹ç‰©ä»¶ï¼Œä¸¦å†å‚³çµ¦ reducer è™•ç†æœ€å¾Œè¿”å› stateã€‚<br><img data-src="https://redux.js.org/assets/images/ReduxDataFlowDiagram-49fa8c3968371d9ef6f2a1486bd40a26.gif" alt="|300x230"></p><p>å¡ä½çš„è©±ï¼Œå†è©¦è‘—ä¸€æ­¥æ­¥æ‹†è§£ã€‚<br>æŠŠ dispatch çœ‹ä½œæ”¾åœ¨å¤–éƒ¨çš„ function æ¥æ”¶ actionï¼Œä¸¦ä¸”å…§éƒ¨å‘¼å« reducer<br>ğŸ‘‰ <a href="https://codepen.io/shan473/pen/mdxKvYj?editors=0010">å˜—è©¦ç”¨ <code>codepen</code> ä¸¦ç”¨ Vanilla JS å¾©åˆ» </a></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‡çš„ dispatch ğŸ‘‰ ä¸åœ¨ render function è£¡é¢</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fakedispatch</span>(<span class="params">action</span>) &#123;</span><br><span class="line">  <span class="comment">// éƒ½å‘¼å«ä¾†è‡ª component ä¸­çš„ reducerï¼Œæ›´æ–°ç›®å‰çš„ state</span></span><br><span class="line">  component.<span class="title function_">fakereducer</span>(component.<span class="property">state</span>,action);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Counter component : ç”±æ–¼ React Element æ˜¯ä¸€å€‹ Objectï¼Œæ‰€ä»¥æˆ‘è½‰æ›æˆç°¡åŒ–ä¸€äº› Object çµæ§‹ã€‚</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> step = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> prev = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">let</span> component = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// props æ¨¡ä»¿æ˜¯ç”±å¤–éƒ¨å‚³å…¥çš„ props</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params">props = <span class="literal">null</span></span>) &#123;</span><br><span class="line">  <span class="comment">// æ˜¯ä¸æ˜¯ç¬¬ä¸€æ¬¡ render</span></span><br><span class="line">  <span class="keyword">if</span>(component)&#123;</span><br><span class="line">       <span class="variable language_">this</span>.<span class="property">state</span> = component.<span class="property">state</span>;</span><br><span class="line">       <span class="variable language_">this</span>.<span class="property">props</span> = props || component.<span class="property">props</span>;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">state</span> = count;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">props</span> = props || &#123;step : step&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æŠŠ React Element çœ‹æˆä¸€å€‹ Object</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="variable language_">this</span>, &#123;</span><br><span class="line">    <span class="attr">state</span>: <span class="variable language_">this</span>.<span class="property">state</span>,</span><br><span class="line">    <span class="attr">props</span>: <span class="variable language_">this</span>.<span class="property">props</span>,</span><br><span class="line">    <span class="comment">// ğŸ˜² fakereducerï¼Œæ”¾åœ¨ render function å…§éƒ¨</span></span><br><span class="line">    <span class="attr">fakereducer</span>: <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (action.<span class="property">type</span> === <span class="string">&quot;tick&quot;</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> += <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">step</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(action.<span class="property">type</span> === <span class="string">&quot;reset&quot;</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = <span class="number">0</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Interval : è·Ÿä¹‹å‰çš„åœ¨ <code>useReducer</code> é¡ä¼¼ï¼Œåªæ˜¯åœ¨ dispatch ä¹‹å¾Œæ‰‹å‹• re-renderï¼Œå› ç‚ºæˆ‘å€‘æ”¹è®Šäº† state</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‡è£ç­‰æ–¼ useEffect(()=&gt;&#123;&#125;,[]) ,deps ç‚ºç©º</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">tick</span>(<span class="params"></span>) &#123;</span><br><span class="line">  id = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">fakedispatch</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;tick&quot;</span> &#125;);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¹è®Šä¸€ä¸‹ dispatch å…§éƒ¨</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fakedispatch</span>(<span class="params">action</span>) &#123;</span><br><span class="line">  prev = component</span><br><span class="line">  <span class="comment">// è¦è·Ÿ prev æ¯”è¼ƒçš„</span></span><br><span class="line">  <span class="keyword">let</span> temp = <span class="keyword">new</span> <span class="title class_">Counter</span>(prev.<span class="property">props</span>);</span><br><span class="line">  <span class="comment">// æ›´æ–° state</span></span><br><span class="line">  temp.<span class="title function_">fakereducer</span>(component.<span class="property">state</span>,action)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//  å‡è£ setState çš„æ¦‚å¿µï¼Œç”±æ–¼ state ä¸åŒï¼Œè€Œre-render</span></span><br><span class="line">  <span class="keyword">if</span>(temp.<span class="property">state</span> !== prev.<span class="property">state</span>)&#123;</span><br><span class="line">    <span class="comment">// é‡æ–°å‘¼å« component æ›´æ–°</span></span><br><span class="line">    component = temp  </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ›´æ–°ç•«é¢</span></span><br><span class="line">    title.<span class="property">textContent</span> = component.<span class="property">state</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä»£è¡¨ re-render</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;re-render&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è™•ç† <code>&lt;Counter step=&quot;1&quot;/&gt;</code> props æ”¹è®Šæ™‚ä¹Ÿ re-renderï¼Œç”±æ–¼æ˜¯ input çš„å€¼æ”¹è®Šå°è‡´ props æ”¹è®Š (re-render)ï¼Œæˆ‘å€‘å°±æ¨¡æ“¬é€™å€‹å‹•ä½œã€‚</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">input.<span class="title function_">addEventListener</span>(<span class="string">&quot;input&quot;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> result;</span><br><span class="line">  <span class="comment">// æª¢æŸ¥è¼¸å…¥æ˜¯ä¸æ˜¯æ•¸å­—</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="title class_">Number</span>.<span class="built_in">isNaN</span>(<span class="title class_">Number</span>(e.<span class="property">target</span>.<span class="property">value</span>)))&#123;</span><br><span class="line">    result =<span class="number">1</span>;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    result =<span class="title class_">Number</span>(e.<span class="property">target</span>.<span class="property">value</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// re-render ä¸¦å‚³å…¥ props</span></span><br><span class="line">  component = <span class="keyword">new</span> <span class="title class_">Counter</span>(&#123;<span class="attr">step</span>: result&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li>åŸ·è¡Œ</li></ul><h3 id="äººé«”ç·¨è­¯">äººé«”ç·¨è­¯</h3><p><code>useEffect</code> åœ¨ä¸Šé¢çš„ç« ç¯€èªªéï¼Œå¦‚æœ deps æ²’æœ‰ä»»ä½•æ±è¥¿ï¼Œeffect åªæœƒ render ä¸€æ¬¡ï¼Œå…¶ è³‡æ–™å·²ç¶“ä¸æ˜¯ä¾†è‡ªæ–¼ render function æœ¬èº«ï¼Œå¯ä»¥æŠŠå®ƒçœ‹ä½œæ‹¿åˆ° render å¤–éƒ¨ä¸€æ¨£ã€‚<br>æ‰€ä»¥æˆ‘å€‘è£½ä½œå‡çš„ <code>useEffect</code> æ˜¯å°æ‡‰ <code>tick()</code>ï¼Œ ä¸¦ä¸”åœ¨ component ç”Ÿæˆä¹‹å¾Œå‘¼å«ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">component = <span class="keyword">new</span> <span class="title class_">Counter</span>(&#123;step&#125;);</span><br><span class="line"><span class="title function_">tick</span>();</span><br></pre></td></tr></table></figure><ul><li>ç·¨è­¯ : é€™è£¡æœ‰å…©ç¨®æƒ…å¢ƒï¼Œ(1) æœ¬èº« state æ”¹è®Š ï¼›(2) å‚³å…¥çš„ props æ”¹è®Š</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ”¹è®Š Counter çš„ state</span></span><br><span class="line"><span class="keyword">const</span> count = <span class="number">0</span></span><br><span class="line"><span class="keyword">const</span> step = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¢ç”Ÿ fakereudcer </span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fakereducer</span>(<span class="params">action</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (action.<span class="property">type</span> === <span class="string">&quot;tick&quot;</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">state</span> += <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">step</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(action.<span class="property">type</span> === <span class="string">&quot;reset&quot;</span>)&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">state</span> = <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// tick() setInterval æ¯ç§’å‘¼å« dispatch ä¸¦é€ action çµ¦ fakereducer</span></span><br><span class="line"><span class="title function_">fakedispatch</span>(&#123;<span class="attr">type</span>: <span class="string">&#x27;tick&#x27;</span>&#125;) <span class="comment">//ğŸ‘‰ count = 0 + 1 </span></span><br><span class="line"><span class="comment">// component state æ”¹è®Šï¼Œre-render ã€ç•«é¢æ›´æ–°</span></span><br><span class="line">temp = <span class="keyword">new</span> <span class="title class_">Counter</span>(<span class="number">1</span>);</span><br><span class="line">component = temp</span><br><span class="line">title.<span class="property">textContent</span> = component.<span class="property">state</span>; <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¹è®Š props çš„ step = 4ï¼Œprops æ”¹è®Š re-render</span></span><br><span class="line">component = <span class="keyword">new</span> <span class="title class_">Counter</span>(&#123;<span class="attr">step</span>: <span class="number">4</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¢ç”Ÿæ–°çš„ fakereducer</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fakereducer</span>(<span class="params">action</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (action.<span class="property">type</span> === <span class="string">&quot;tick&quot;</span>) &#123;</span><br><span class="line">      <span class="comment">// é€™æ¬¡ render 1 += 4 = 5</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">state</span> += <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">step</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(action.<span class="property">type</span> === <span class="string">&quot;reset&quot;</span>)&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">state</span> = <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾Œé¢éƒ½æ˜¯å‘¨è€Œå¾©å§‹ã€‚é›–ç„¶ä¸æ˜¯å¾ˆæº–ç¢ºçš„æ¨¡ä»¿ React ï¼Œé€éæ‹†è§£çš„æ–¹å¼æˆ‘æ¯”è¼ƒå¥½ç†è§£ã€‚æˆ‘å€‘å¯ä»¥çŸ¥é“ reducer æ˜¯å› ç‚ºæ‹¿å– props çš„æœ€æ–°å€¼ï¼Œæˆ‘å€‘æ‰æŠŠå®ƒæ”¾åœ¨ component å…§éƒ¨ï¼Œä½†æ˜¯æœƒé€ æˆä¸ç®¡ props æ˜¯ä¸æ˜¯æœ‰æ”¹è®Šéƒ½æœƒç”¢ç”Ÿæ–°çš„ reducer ã€‚æˆ‘å¯èƒ½æœƒç”¨ <code>useCallback</code> è¨˜æ†¶èµ·ä¾†ï¼Œä¸¦åŠ ä¸Š <code>props.step</code> ä½œç‚º depsã€‚</p><p>è—‰ç”±é€™å€‹ä¾‹å­æˆ‘å€‘çŸ¥é“ dispatch åªè¦è² è²¬æŠŠ action å¸¶çµ¦ reducer å°±å¥½ï¼Œæˆ‘å€‘ä¸ç”¨åœ¨å…§éƒ¨å¯¦ä½œè©³ç´°é‚è¼¯ï¼Œè€Œæ˜¯äº¤çµ¦ reducer è™•ç†ï¼Œæ¸›å°‘åƒ <code>setState</code> ç›´æ¥åœ¨ effect ä¸­æŠŠè³‡æ–™æ‹†é–‹åˆå¡å›å»ï¼Œè€Œä¸”å¦‚æœæ˜¯å¤šçµ„è³‡æ–™é›†ä¸­æ–¼ä¸€å€‹ stateï¼Œç‰½ä¸€é«®å‹•å…¨èº«ğŸ˜µã€‚</p><h2 id="æŠŠ-function-ç§»åˆ°-useEffect-ä¸­">æŠŠ function ç§»åˆ° useEffect ä¸­</h2><p><code>useEffect</code> å¾ˆå¸¸æ‹¿ä¾†åš call API æ‹¿è³‡æ–™ï¼Œä¹Ÿå¾ˆå¸¸åªåšè¼‰å…¥é é¢çš„é‚£ä¸€æ¬¡ã€‚æŒ‰ç…§ effect åªåŸ·è¡Œä¸€æ¬¡ï¼Œæˆ‘å€‘çš„ deps æœƒæ˜¯ç©ºçš„ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">SearchResults</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [data, setData] = <span class="title function_">useState</span>(&#123; <span class="attr">hits</span>: [] &#125;);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">axios</span>(</span><br><span class="line">      <span class="string">&#x27;https://hn.algolia.com/api/v1/search?query=react&#x27;</span>,</span><br><span class="line">    );</span><br><span class="line">    <span class="title function_">setData</span>(result.<span class="property">data</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">fetchData</span>();</span><br><span class="line">  &#125;, []);</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çœ‹èµ·ä¾†æ˜¯å¯è¡Œçš„ï¼Œæ¯”è¼ƒä¸å¥½çš„é»åœ¨æ–¼  <code>fetchData</code> æ²’æœ‰ä¾é ä»»ä½• state æˆ– propsï¼Œæ¯ä¸€æ¬¡ render éƒ½æ˜¯é•·ä¸€æ¨£çš„ï¼Œä½†åˆæœƒæ¯æ¬¡ç”¢ç”Ÿæ–°çš„ functionğŸ¤”ã€‚</p><blockquote><p>å¦‚æœåªç”¨åˆ°å‡½æ•¸å…§éƒ¨çš„å€¼ï¼Œæ²’æœ‰ä¾é å¤–éƒ¨è³‡æ–™ï¼ŒæŠŠå®ƒæ”¾åˆ° effect function ä¸­</p></blockquote><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// æŠŠ function æ¬åˆ° effect å…§éƒ¨</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">getFetchUrl</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;https://hn.algolia.com/api/v1/search?query=react&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">axios</span>(<span class="title function_">getFetchUrl</span>());</span><br><span class="line">    <span class="title function_">setData</span>(result.<span class="property">data</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">fetchData</span>();</span><br><span class="line">&#125;, []); <span class="comment">// âœ… deps æ˜¯ç©ºçš„ä¹Ÿæ²’é—œä¿‚ï¼Œå› ç‚ºæ²’æœ‰ç”¨åˆ° state æˆ– props</span></span><br></pre></td></tr></table></figure><p>æˆ‘å€‘ä¸ç”¨å†æ“”å¿ƒ deps çš„å•é¡Œï¼Œå› ç‚ºç¢ºç¢ºå¯¦å¯¦ä¹Ÿæ²’æœ‰ä¾è³´ä»»ä½•å¤–éƒ¨è³‡æ–™ã€‚</p><p>ä½†æ˜¯ç•¶çµæ§‹é–‹å§‹è®Šçš„é¾å¤§ï¼Œè€Œä¸”æ¶‰åŠ state èˆ‡ propsï¼Œé€™æ™‚å€™å¦‚æœç•¶è³‡æ–™æ”¹è®Šäº†ï¼Œä½† effect ä¸¦ä¸æœƒæ›´æ–°ï¼Œä¾ç„¶åªæœƒåœç•™åœ¨ç¬¬ä¸€æ¬¡ render ä¸¦ä¸”ä¸æœƒå†åŸ·è¡Œäº†ğŸ˜µã€‚</p><blockquote><p>é‚£æŠŠ state æˆ– props åŠ å…¥ deps å‘¢ ?</p></blockquote><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [query, setQuery] = <span class="title function_">useState</span>(<span class="string">&#x27;react&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">getFetchUrl</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;https://hn.algolia.com/api/v1/search?query=&#x27;</span> + query;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">axios</span>(<span class="title function_">getFetchUrl</span>());</span><br><span class="line">    <span class="title function_">setData</span>(result.<span class="property">data</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">fetchData</span>();</span><br><span class="line">&#125;, [query]); <span class="comment">// âœ… é€™æ¨£æ˜¯åˆç†</span></span><br></pre></td></tr></table></figure><p>å¦‚æ­¤ä¸€ä¾†ç•¶ <code>query</code> æ”¹è®Šï¼Œeffect å°±æœƒé‡æ–°å‘¼å«ï¼Œæˆ‘å€‘æ‹¿åˆ°çš„è³‡æ–™ä¹Ÿéƒ½æœƒåŒæ­¥ã€‚</p><p>åŠ å…¥ deps ä¸åªæ˜¯è®“ React ä¸è¦ç™¼å‡ºè­¦å‘Šã€‚è€Œæ˜¯å»ç†è§£ç›¸é—œè³‡æ–™çš„è®ŠåŒ–ï¼Œä¾‹å¦‚ : æ‹¿å–è³‡æ–™æ˜¯ä¾é  <code>query</code> å­—ä¸²çš„è®ŠåŒ–ï¼ŒæŠŠ query æ”¾å…¥ deps å¯ä»¥è®“æˆ‘å€‘æ‹¿åˆ°ç•¶æ¬¡æ­£ç¢ºçš„è³‡æ–™ã€‚</p><p><code>useEffect</code> å¼·è¿«è®“æˆ‘å€‘æ³¨æ„è³‡æ–™æµæ‡‰è©²è¦æ€éº¼è®ŠåŒ–ï¼Œä¹Ÿå‘Šè¨´æˆ‘å€‘ä¹Ÿè¦è®“ effect ä¸€èµ·åŒæ­¥æ›´æ–°ï¼Œè€Œä¸æ˜¯å¿½ç•¥å®ƒï¼Œè®“ä½¿ç”¨è€…è™•è™•ç¢°åˆ° bugğŸ˜µ</p><h2 id="ä¸èƒ½æŠŠ-function-ç§»å…¥-useEffect-æ€éº¼è¾¦">ä¸èƒ½æŠŠ function ç§»å…¥ useEffect æ€éº¼è¾¦ ?</h2><p>å¦‚æœæœ‰ä¸€å€‹ function åœ¨ä¸åŒçš„ effect ä¸­é€²è¡Œï¼Œé‚£ function åœ¨æ¯æ¬¡ re-render éƒ½æœƒè¢«é‡æ–°å‰µé€ ï¼Œå¦‚æœåŠ å…¥ deps æœƒå°è‡´é »ç¹çš„æ›´æ–°ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ğŸ”´ re-render éƒ½æœƒä½¿ effect é‡æ–°ç”¢ç”Ÿä¸¦å‘¼å«ï¼Œæ³ä¸”é‚„ä¾é™„å…©å€‹ğŸ˜µ</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getFetchUrl</span>(<span class="params">query</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;https://hn.algolia.com/api/v1/search?query=&#x27;</span> + query;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> url = <span class="title function_">getFetchUrl</span>(<span class="string">&#x27;react&#x27;</span>);</span><br><span class="line">&#125;, [getFetchUrl]); <span class="comment">// ğŸš§ deps æ˜¯æ­£ç¢ºçš„ä½†æ˜¯æ”¹è®Šçš„å¤ªé »ç¹</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> url = <span class="title function_">getFetchUrl</span>(<span class="string">&#x27;redux&#x27;</span>);</span><br><span class="line">&#125;, [getFetchUrl]); <span class="comment">// ğŸš§ deps æ˜¯æ­£ç¢ºçš„ä½†æ˜¯æ”¹è®Šçš„å¤ªé »ç¹</span></span><br></pre></td></tr></table></figure><p>çµ•å°ä¸æœƒæƒ³æŠŠå®ƒè¤‡è£½è²¼åˆ° effect è£¡é¢ğŸ˜µã€‚æ‰€ä»¥è§£æ±ºçš„æ–¹å¼æœ‰å…©ç¨® :</p><ul><li>ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">1</span></span></span></span> ç¨® : å¦‚ä¸Šé¢ä¸€ç›´æåŠçš„ä¸€ç¨®æ–¹å¼ï¼ŒæŠŠå®ƒæåˆ° render function å¤–éƒ¨ã€‚å¦‚æœå¿˜è¨˜äº†å¯ä»¥å›æƒ³ä¸€ä¸‹  [[#æœ‰æ•ˆç‡çš„ä½¿ç”¨ useEffect]] ç« ç¯€ï¼Œæ¦‚å¿µä¸Šè³‡æ–™ä¾†æºæ˜¯ä¸å±¬æ–¼ render function ç¯„åœçš„ã€‚</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… æåˆ°å¤–éƒ¨ï¼Œä¸æœƒå†è¢« render å…§éƒ¨çš„è³‡æ–™å½±éŸ¿äº†</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getFetchUrl</span>(<span class="params">query</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;https://hn.algolia.com/api/v1/search?query=&#x27;</span> + query;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SearchResults</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="title function_">getFetchUrl</span>(<span class="string">&#x27;react&#x27;</span>);</span><br><span class="line">  &#125;, []); <span class="comment">// âœ… deps ç©ºçš„æ˜¯ OK çš„</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="title function_">getFetchUrl</span>(<span class="string">&#x27;redux&#x27;</span>);</span><br><span class="line">  &#125;, []); <span class="comment">// âœ… deps ç©ºçš„æ˜¯ OK çš„</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">2</span></span></span></span> ç¨®ï¼ŒæŠŠ function çµ¦è¨˜èµ·ä¾†ï¼Œç”±æ–¼æ¯æ¬¡ re-render éƒ½æœƒæ–°å»ºç«‹ functionï¼Œå¯ä»¥ä½¿ç”¨ <code>useCallback</code> è¨˜èµ·ä¾†ï¼Œä¸¦ä¸”æŒ‰ç…§å‚³å…¥çš„ deps å†é‡æ–°å»ºç«‹ functionï¼Œé¸æ“‡å†æœ‰å¿…è¦çš„æƒ…æ³å†æ›´æ–°ã€‚å¦‚æœæœ‰ä½¿ç”¨åˆ°ç›¸é—œçš„ state æˆ– props å°±èƒ½åŒæ­¥æ›´æ–°ã€‚</li></ul><ol><li>é¡ä¼¼æŠŠ function æåˆ°å¤–éƒ¨çš„è®ŠåŒ–å½¢æ…‹ :</li></ol>  <figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… è·ŸæŠŠ function æåˆ°å¤–éƒ¨é¡ä¼¼ï¼Œä½†æ˜¯åœ¨ render function å…§è®“å®ƒä¸è®Š</span></span><br><span class="line"><span class="keyword">const</span> getFetchUrl = <span class="title function_">useCallback</span>(<span class="function">(<span class="params">query</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;https://hn.algolia.com/api/v1/search?query=&#x27;</span> + query;</span><br><span class="line">&#125;, []);  <span class="comment">// âœ… callback deps ç©ºçš„æ²’é—œä¿‚ï¼Œå› ç‚ºå®ƒæ˜¯é å¸¶å…¥çš„åƒæ•¸ä¾†è®ŠåŒ–</span></span><br><span class="line">  </span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> url = <span class="title function_">getFetchUrl</span>(<span class="string">&#x27;react&#x27;</span>);</span><br><span class="line">&#125;, [getFetchUrl]); <span class="comment">// âœ… deps æ”¾å…¥ getFetchUrl æ²’å•é¡Œï¼Œå› ç‚º getFetchUrl å»ºç«‹å¾Œä¸æœƒéš¨ re-render é‡æ–°å»ºç«‹</span></span><br><span class="line">  </span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> url = <span class="title function_">getFetchUrl</span>(<span class="string">&#x27;redux&#x27;</span>);</span><br><span class="line">&#125;, [getFetchUrl]);  <span class="comment">// âœ… deps æ”¾å…¥ getFetchUrl æ²’å•é¡Œï¼Œå› ç‚º getFetchUrl å»ºç«‹å¾Œä¸æœƒéš¨ re-render é‡æ–°å»ºç«‹</span></span><br></pre></td></tr></table></figure><ol start="2"><li>ä¾è³´å…§éƒ¨çš„ state æˆ– props</li></ol><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [query, setQuery] = <span class="title function_">useState</span>(<span class="string">&#x27;react&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… getFetchUrl ç›´åˆ° query æœ‰æ”¹è®Šæ‰æœƒæ›´æ–°</span></span><br><span class="line"><span class="keyword">const</span> getFetchUrl = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;https://hn.algolia.com/api/v1/search?query=&#x27;</span> + query;</span><br><span class="line">&#125;, [query]);  <span class="comment">// âœ… callback deps æ ¹æ“š query state æ”¹è®Šè€Œé‡æ–°å»ºç«‹</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> url = <span class="title function_">getFetchUrl</span>();</span><br><span class="line">&#125;, [getFetchUrl]); <span class="comment">// âœ… deps æ˜¯ OK çš„ï¼Œè·Ÿ query æ˜¯åŒæ­¥æ›´æ–°</span></span><br></pre></td></tr></table></figure><p>è€Œ <code>useCallback</code> çš„æ–¹å¼ä¹Ÿé©ç”¨æ–¼çˆ¶å…ƒä»¶å‚³é function props çµ¦å­å…ƒä»¶çš„æ“ä½œ :</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [query, setQuery] = <span class="title function_">useState</span>(<span class="string">&#x27;react&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// âœ… ç›´åˆ° query æ”¹è®Šæ‰é‡æ–°å»ºç«‹ fetchData</span></span><br><span class="line">  <span class="keyword">const</span> fetchData = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="string">&#x27;https://hn.algolia.com/api/v1/search?query=&#x27;</span> + query;</span><br><span class="line">  &#125;, [query]);  <span class="comment">// âœ… callback deps æ ¹æ“š query state æ”¹è®Šè€Œé‡æ–°å»ºç«‹</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">/* å‚³çµ¦å­å…ƒä»¶ï¼Œè¨˜ä½ ! é€™é‚Šçš„ function æ›´æ–°æ¢ä»¶æ˜¯ queryï¼Œæ‰€ä»¥å‚³å…¥çš„ fetchData æœƒä¸€ç›´æ˜¯åŒä¸€å€‹ */</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Child</span> <span class="attr">fetchData</span>=<span class="string">&#123;fetchData&#125;</span> /&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params">&#123; fetchData &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> [data, setData] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">fetchData</span>().<span class="title function_">then</span>(setData);</span><br><span class="line">  &#125;, [fetchData]); </span><br><span class="line">  <span class="comment">/* </span></span><br><span class="line"><span class="comment">  âœ… deps æ˜¯ OKï¼Œå› ç‚ºå®ƒä¹Ÿç­‰ Parent æœ¬èº« query æ”¹è®Šæ‰æœƒé‡æ–°å‘¼å«ï¼Œå…¶é¤˜çš„æ™‚å€™ Child æœ¬èº«ç„¡æ³•å‹•åˆ° effect çš„ï¼Œå³ä½¿ setData æ”¹è®Šäº†ï¼Œé€™è£¡ä¹Ÿä¸æœƒé‡æ–°å‘¼å« </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="function-æ˜¯è³‡æ–™æµçš„ä¸€ç¨®å—">function æ˜¯è³‡æ–™æµçš„ä¸€ç¨®å— ?</h2><p>é€™ç¯€æåˆ° function è®Šæˆ props å‚³éçµ¦å­å…ƒä»¶è¦æ³¨æ„çš„é»ï¼Œå¦å¤–å‡¸é¡¯ class component è·Ÿ function component ä¹‹é–“çš„å·®åˆ¥ã€‚</p><p><code>useEffect</code> æˆ‘å€‘çŸ¥é“æ˜¯åœ¨ render ä¹‹å¾Œæ‰å‘¼å«çš„ï¼Œè€Œä¸”å…·æœ‰ 3 ç¨®ä¸åŒæƒ…å¢ƒ :</p><ol><li>å®Œå…¨æ²’æœ‰ deps arrayï¼Œè¡¨ç¤ºåªè¦ re-render ä¹‹å¾Œå°±è·Ÿè‘—åŸ·è¡Œ</li><li>deps ç‚ºç©ºï¼Œè¡¨ç¤ºåªåœ¨ mount (render) ä¹‹å¾Œåªåšä¸€æ¬¡</li><li>deps æ”¾æœ‰ç›¸é—œè³‡æ–™ï¼Œè¡¨ç¤ºæœ‰é—œè³‡æ–™çš„æ”¹è®Šå°±æœƒé‡æ–°å‘¼å« effect</li></ol><p>çœ‹èµ·ä¾† <code>useEffect</code> æ˜¯ç­‰åŒæ–¼ class component ç”Ÿå‘½é€±æœŸä¸­çš„ <code>componentDidMount</code> ä»¥åŠ <code>componentDidUpdate</code> ğŸ¤”ğŸ¤”ğŸ¤”</p><p>åœ¨é€™ä¹‹å‰ï¼Œè¤‡ç¿’ä¸€ä¸‹ class component çš„ç”Ÿå‘½é€±æœŸåœ– :<br><img data-src="https://i.imgur.com/cpFlaro.png" alt="|600x300"></p><ul><li>class component ä¸­å‚³é function propsï¼ŒæŠŠä¸Šé¢çš„ä¾‹å­è½‰æˆ class ç‰ˆæœ¬</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Parent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">  <span class="comment">// ç­‰åŒæ–¼ const [query, setQuery] = useState(&#x27;react&#x27;);</span></span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">query</span>: <span class="string">&#x27;react&#x27;</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// å®šç¾©äº† fetchData æ–¹æ³•</span></span><br><span class="line">  fetchData = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="string">&#x27;https://hn.algolia.com/api/v1/search?query=&#x27;</span> + <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">query</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// function é€é props å‚³çµ¦ Child </span></span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Child</span> <span class="attr">fetchData</span>=<span class="string">&#123;this.fetchData&#125;</span> /&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">  <span class="comment">// ç­‰åŒæ–¼ä¸Šé¢ let [data, setData] = useState(null);</span></span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">data</span>: <span class="literal">null</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// åœ¨ render ä¹‹å¾ŒåŸ·è¡Œ</span></span><br><span class="line">  <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// å¾ Parent ä¾†çš„ï¼Œæˆ‘å€‘åƒ functional component ä¸€æ¨£åœ¨ render ä¹‹å¾Œå‘¼å«</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">fetchData</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€™æ¨£åœ¨ç¬¬ä¸€æ¬¡ render ä¹‹å¾Œç¢ºå¯¦å¯ä»¥åŸ·è¡Œï¼Œä½†æ˜¯æ²’è¾¦æ³•åœ¨ Parent props æ”¹è®Šæ™‚é‡æ–°å‘¼å«ã€‚</p><p>å¦‚æœè¦é‡æ–°å‘¼å« <code>this.props.fetchData</code>ï¼Œå°±æœƒåœ¨ <code>updating</code> éšæ®µ render å®Œå¾Œå‘¼å« <code>componentDidUpdate</code> ä¾†æª¢æŸ¥å‰å¾Œçš„ props æ˜¯å¦æœ‰æ”¹è®Šã€‚ç¢ºå¯¦è·Ÿ effect å¾ˆé¡ä¼¼ğŸ¤”</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">componentDidUpdate</span>(<span class="params">prevProps</span>) &#123;</span><br><span class="line">  <span class="comment">// âŒ é€™å€‹æ¢ä»¶æ°¸é ä¸æœƒæˆç«‹</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">fetchData</span> !== prevProps.<span class="property">fetchData</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">fetchData</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ props çš„æ¯”è¼ƒä¸æœƒæˆç«‹ï¼Œç‚ºä»€éº¼å‘¢ ?</p><blockquote><p>class component æ˜¯æ¯æ¬¡éƒ½é‡æ–°å‘¼å« <code>render()</code>è€Œå·²ï¼Œä¸¦ä¸æ˜¯ new é‡æ–°å»ºç«‹å¯¦ä¾‹ï¼Œå·²ç¶“è¢«å»ºç«‹çš„ function æ˜¯éœæ…‹çš„ã€‚</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// class component</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ComponentA</span> = <span class="keyword">new</span> <span class="title class_">Parent</span>()</span><br><span class="line"><span class="title class_">ComponentA</span>.<span class="title function_">render</span>() <span class="comment">// re-render æ˜¯æŒ‡å‘¼å« class ä¸­çš„ render function</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸ‘‰ prev ComponentA.method ç­‰æ–¼ next ComponentA.method</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// functional component</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">ComponentB</span>  = (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> ()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">re-render æ˜¯æŒ‡å‘¼å« ComponentB() æœ¬èº«ï¼Œå…¶å…§éƒ¨çš„ function éƒ½æœƒé‡æ–°å»ºç«‹ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title class_">ComponentB</span>() </span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸ‘‰ prevComponentB ä¸ç­‰æ–¼ nextComponentB</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæŠŠ <code>if</code> æ¢ä»¶æ‹”æ‰ï¼Œä¹Ÿæ˜¯éŒ¯èª¤çš„ã€‚å°è‡´æ¯æ¬¡ re-render éƒ½é‡æ–°å‘¼å« <code>fetchData()</code> ï¼Œè€Œä¸”æ˜¯ä¸è«– query æ˜¯ä¸æ˜¯æœ‰æ”¹è®Šï¼Œé€™ä¸æ˜¯æˆ‘å€‘è¦çš„æ•ˆæœã€‚</p><p>é‚£è®“æˆ‘å€‘çš„å‚³éä¸‹å»çš„ <code>fetchData</code> æ˜¯æœƒè·Ÿè‘— query è®ŠåŒ–çš„ï¼Œä½¿ç”¨ inline functionï¼Œä¸¦ä¸”ç”¨ <code>bind</code> ç¶å®šçˆ¶å±¤çš„ this ï¼Œé¿å…å‚³åˆ° Child å¾Œç”¨ this å°è‡´æŒ‡å‘ä¸æ­£ç¢ºçš„å•é¡Œã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Child</span> <span class="attr">fetchData</span>=<span class="string">&#123;this.fetchData.bind(this,</span> <span class="attr">this.state.query</span>)&#125; /&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€™æ¨£å°è‡´ <code>this.props.fetchData !== prevProps.fetchData</code> å§‹çµ‚æˆç«‹ï¼Œå°è‡´æ¯æ¬¡ re-render éƒ½é‡æ–°å‘¼å« <code>fetchData()</code> ã€‚</p><p>è§£æ±ºå•é¡Œçš„æ–¹æ³•ï¼Œå°±æ˜¯ <strong>æŠŠ query ç•¶ props è·Ÿè‘—å‚³ä¸‹å»</strong>ï¼Œ</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Parent Component</span></span><br><span class="line"><span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Child</span> <span class="attr">fetchData</span>=<span class="string">&#123;this.fetchData&#125;</span> <span class="attr">query</span>=<span class="string">&#123;this.state.query&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Child Component</span></span><br><span class="line"><span class="title function_">componentDidUpdate</span>(<span class="params">prevProps</span>) &#123;</span><br><span class="line">  <span class="comment">// æ ¹æ“š props.query æ±ºå®š</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">query</span> !== prevProps.<span class="property">query</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">fetchData</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>function å¯ä»¥è¢«å‚³éé€²å»ï¼Œä½†æ˜¯ function å…§éƒ¨çš„æ”¹è®Šèˆ‡å¦æ˜¯ä¸èƒ½è¢«çœ‹è¦‹çš„ï¼Œå®ƒæ²’è¾¦æ³•ç›´æ¥æ‹¿ä¾†è¢«æ¯”è¼ƒã€‚å¦ä¸€å€‹åŸå› æ˜¯ï¼Œprops å‚³ä¾†çš„æ–¹æ³•å°é–‰äº† <code>this</code> (this æ˜¯çœ‹æ€éº¼è¢«å‘¼å«ï¼Œä»€éº¼æ„æ€å‘¢ ? çœ‹ä¸‹é¢è¨»è§£)ï¼Œæˆ‘å€‘ä¸èƒ½ç›´æ¥ä¾è³´å®ƒä¾†æ±ºå®šæ˜¯å¦æ›´æ–°ã€‚å°è‡´æˆ‘å€‘ <strong>å¿…é ˆå‚³éå…§éƒ¨ç›¸é—œæ‰€æœ‰çš„è³‡æ–™</strong>ï¼Œå°±ç‚ºäº†æª¢æŸ¥æ˜¯å¦æœ‰æ”¹è®Šå†æ±ºå®šè¦ä¸è¦å‘¼å«æ–¹æ³•ã€‚</p><blockquote><p>å°æ–¼ class component ä¾†èªªï¼Œ function props ä¸æ˜¯å±¬æ–¼è³‡æ–™æµçš„ä¸€éƒ¨åˆ†ã€‚</p></blockquote><p>æˆ‘å€‘ä¸çŸ¥é“ <code>this.props.fetchData</code> å¾ Parent å‚³éä¾†æ˜¯ä¸æ˜¯è·Ÿ state æœ‰é—œï¼Œæˆ–æ˜¯ state æ˜¯ä¸æ˜¯å·²ç¶“æ”¹è®Šäº†ã€‚(é€™å€‹ props çš„ stateless æœ‰é—œå— ? )</p><p>ä½¿ç”¨ <code>useCallback</code> è®“ function å¯ä»¥åŠ å…¥è³‡æ–™æµä¸­ï¼Œæˆ‘å€‘æ ¹æ“š function çš„è¼¸å…¥å€¼æ”¹è®Šï¼Œä»£è¡¨ function æœ¬èº«ä¹Ÿè¦æ”¹è®Šï¼Œåä¹‹äº¦ç„¶ï¼Œè¼¸å…¥æ²’æœ‰è®Šçš„è©±å°±ä¹Ÿä¸æœƒç”¢ç”Ÿæ–°çš„ functionã€‚æœ‰ <code>useCallback</code> çš„å”åŠ©ï¼Œæ”¹è®Š props çš„æ™‚å€™ï¼Œ<code>props.fetchData</code> ä¹Ÿæœƒè‡ªå‹•åœ°å‚³éä¸‹å»ï¼Œå› ç‚ºå®ƒæœ¬èº«æ˜¯è³‡æ–™æµçš„ä¸€éƒ¨åˆ†ã€‚</p><h3 id="æ³¨æ„-4">æ³¨æ„</h3><p>æŠŠä»»ä½• function éƒ½åŠ ä¸Š <code>useCallback</code> æ˜¯ä¸€ä»¶å¾ˆä¸ Ok çš„äº‹ï¼Œé€™ä¸æ˜¯ä¿è­‰æ˜¯æ•ˆèƒ½ä¸Šçš„å„ªåŒ–ã€‚</p><p>é›–ç„¶å®ƒæ˜¯ä¸€å€‹å¾ˆæœ‰æ•ˆçš„æ–¹æ³•ï¼Œå°æ–¼åŒæ™‚å‚³éçµ¦å¤šå€‹å­å…ƒä»¶ï¼Œä¸¦ä¸”æ‡‰ç”¨åœ¨å­å…ƒä»¶å…§éƒ¨çš„ effectï¼Œæ˜¯å¯ä»¥é¿å…å­å…ƒä»¶åšç„¡æ„ç¾© render çš„å•é¡Œã€‚ç•¶ç„¶ä¹Ÿå¯ä»¥åŒ…è£¹æˆ Hooks é¿å…å¤šå€‹ callbacks å‚³éæ•´å€‹ React æ¨¹ç‹€çµæ§‹ã€‚</p><p>ç”¨ä¸Šé¢çš„ <code>fetchData</code> ä¾†è©¦è‘—å¯«æˆ <code>useFetchData</code> ï¼Œé€™è£¡å¯ä»¥æ­é… <code>useContext</code>ï¼Œä½¿ç”¨ Provider åŒ…ä½çš„å…ƒä»¶å¯ä»¥æ ¹æ“š query æ”¹è®Šè€Œæ›´æ–°è³‡æ–™åŒ…ã€‚<br>ğŸ‘‰ <a href="https://codesandbox.io/s/festive-fermi-1cms7c?file=/src/index.js">codesandbox ç°¡æ˜“æŸ¥è©¢å„åœ‹ä»£ç¢¼ API</a></p><p>åˆ—å‡ºåŠŸèƒ½ :</p><ol><li>Provider åŒ…ä½çš„å…ƒä»¶ï¼Œä½¿ç”¨ <code>useFetchData</code> å°±å¯ä»¥æ‹¿åˆ°å›å‚³çš„è³‡æ–™ã€‚</li><li>ç•¶ query æ”¹è®Šæ™‚é‡æ–°ç²å–è³‡æ–™</li></ol><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createContext, useMemo, useState, useEffect, useContext &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŸºæœ¬ç¶²å€</span></span><br><span class="line"><span class="keyword">let</span> baseurl = <span class="string">&quot;https://restcountries.com/v3.1/name/&quot;</span>;</span><br><span class="line"><span class="comment">// å»ºç«‹ contextï¼Œå¦‚æ­¤ä¸€ä¾†åŒ…ä½çš„å…ƒä»¶éƒ½å¯ä»¥ç›´æ¥ç”¨ useFetchData å–çš„å…±äº«å€¼</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Context</span> = <span class="title function_">createContext</span>(<span class="literal">null</span>);</span><br><span class="line"><span class="comment">// ä¿®ä¸€ä¸‹åå­—æ–¹ä¾¿ debug</span></span><br><span class="line"><span class="title class_">Context</span>.<span class="property">displayName</span> = <span class="string">&quot;FetchDataContext&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å»ºç«‹ Provider å…ƒä»¶</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">DataProvider</span>(<span class="params">&#123; children &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [query, setQuery] = <span class="title function_">useState</span>(<span class="string">&quot;tw&quot;</span>);</span><br><span class="line">  <span class="comment">// é¿å…é€ æˆ value re-render ï¼ŒæŠŠ value è¨˜æ†¶èµ·ä¾†ï¼Œç›´åˆ°æ”¹è®Š query</span></span><br><span class="line">  <span class="keyword">const</span> value = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      query,</span><br><span class="line">      setQuery</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [query]);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Context.Provider</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">Context.Provider</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Custom Hooks </span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useFetchData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// é€™ä¸€æ®µä¸»è¦ç¢ºèªä¸Šæ–¹æ˜¯å¦æœ‰ Provider çš„é˜²å‘†</span></span><br><span class="line">  <span class="keyword">const</span> context = <span class="title function_">useContext</span>(<span class="title class_">Context</span>);</span><br><span class="line">  <span class="keyword">if</span> (context === <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;useCount must be used within a CountProvider&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç¢ºå®šæœ‰å¾ŒæŠŠ context è§£æ§‹æ¯”è¼ƒå¥½è®€</span></span><br><span class="line">  <span class="keyword">const</span> &#123; query, setQuery &#125; = context;</span><br><span class="line">  <span class="comment">// è®€å–å›ä¾†çš„è³‡æ–™</span></span><br><span class="line">  <span class="keyword">const</span> [data, setData] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="comment">// éŒ¯èª¤è™•ç†</span></span><br><span class="line">  <span class="keyword">const</span> [message, setMessage] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    (<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (query) &#123;</span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">fetch</span>(baseurl + query).<span class="title function_">then</span>(<span class="function">(<span class="params">r</span>) =&gt;</span> r.<span class="title function_">json</span>());</span><br><span class="line">        <span class="comment">// å›å‚³ä¸æ˜¯ 404 æ™‚åˆ¤æ–·</span></span><br><span class="line">        <span class="keyword">if</span> (!data.<span class="property">status</span>) &#123;</span><br><span class="line">          <span class="title function_">setData</span>(data);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// å›å‚³ status ç‚º 404 è¨­å®šéŒ¯èª¤è³‡è¨Š</span></span><br><span class="line">          <span class="title function_">setMessage</span>(data.<span class="property">message</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)();</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setMessage</span>(<span class="literal">null</span>); <span class="comment">// æ¸…é™¤éŒ¯èª¤è³‡è¨Š</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [query]); <span class="comment">// ğŸ‘ˆ deps æ”¾å…¥ query</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// å›å‚³éœ€è¦çš„å€¼</span></span><br><span class="line">  <span class="keyword">return</span> &#123; data, query, setQuery, message &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“åŒ…å›å‚³</span></span><br><span class="line"><span class="keyword">export</span> &#123; <span class="title class_">DataProvider</span>, useFetchData &#125;;</span><br></pre></td></tr></table></figure><p>å¯«æˆ Hooks æ™‚åœ¨ä½¿ç”¨å°±å¾ˆæ–¹ä¾¿ï¼Œåªè¦åœ¨åŒä¸€å±¤å…±äº«çš„éƒ¨ä»½åŠ ä¸Š Provider ï¼Œå…§éƒ¨å…ƒä»¶éƒ½ä½¿ç”¨ <code>useFetchData</code> å°±èƒ½æ‹¿åˆ°æƒ³è¦çš„å…§å®¹ğŸ‘</p><p>ç•¶ç„¶é€™å€‹ä¾‹å­å¯ä»¥å†æ”¹é€²ï¼Œä¾‹å¦‚ input çš„éƒ¨ä»½å¯ä»¥æ”¹ç”¨ optionï¼Œç”±ç¬¬ä¸€æ¬¡é€²å…¥ app å…ˆå–å¾—æ‰€æœ‰åœ‹å®¶åœ‹ç¢¼ï¼Œé€™æ¨£ä½¿ç”¨è€…å¯ä»¥ç”¨é¸å–®çš„æ–¹å¼é€²è¡Œã€‚</p><h2 id="è«‡è«‡ç«¶çˆ­æ¢ä»¶-race-condition">è«‡è«‡ç«¶çˆ­æ¢ä»¶ (race condition)</h2><p>ä»€éº¼æ˜¯ç«¶çˆ­æ¢ä»¶å‘¢ ?</p><p>åœ¨ JavaScript ä¸­è·Ÿç«¶çˆ­æ¢ä»¶æœ‰é—œçš„æ˜¯éåŒæ­¥çš„å•é¡Œï¼Œå¦‚ä¸Šé¢èˆ‰ä¾‹çš„ <code>fetchData</code> ã€‚<strong>å¦‚æœåœ¨éåŒæ­¥æ“ä½œçš„æœªå®Œæˆçš„æ™‚å€™ï¼Œä¸­é€”æ”¹è®Š state æˆ– props æœƒå°è‡´éé æœŸçš„äº‹æƒ…ç™¼ç”Ÿã€‚</strong><br>ğŸ‘‰ å¯ä»¥åƒè€ƒé€™ç¯‡æ–‡ç«  : <a href="https://toy9986619.medium.com/javascript-async-await-%E7%9A%84-race-condition-20927705569">JavaScript â€” async/await çš„ race condition</a></p><blockquote><p>ç°¡å–®ä¾†èªªè·ŸåŸ·è¡Œé †åºæœ‰é—œ</p></blockquote><p>ä»¥ <code>fetchData</code> ç‚ºä¾‹ï¼Œæˆ‘å€‘ç”¨ async/await ç°¡åŒ–éåŒæ­¥çš„è™•ç†ï¼Œå…§éƒ¨çš„ fetch æ˜¯ Promiseï¼Œå¦‚æœåœ¨ pending çš„æ™‚å€™åˆæ”¹è®Š state é‡æ–°ç²å–è³‡æ–™ï¼Œå°±æœƒç™¼ç”Ÿå•é¡Œã€‚</p><p>ä¾‹å¦‚ : ä¸€é–‹å§‹æœå°‹ usaï¼Œåœ¨çµæœé‚„æ²’è¿”å›æ™‚æ”¹æˆ peruï¼Œå‡è¨­ usa è³‡æ–™å…ˆå›ä¾†ä¸¦ä¸”é¡¯ç¤ºåœ¨ç•«é¢ä¸Šï¼Œéä¸€ä¸‹å­æœ€çµ‚ peru çš„ response æ‰æœƒå›ä¾† ã€‚<strong>ç•«é¢ç­‰å¾… peru è³‡æ–™å›å‚³æ™‚é¡¯ç¤º usa è³‡æ–™çš„æ™‚å€™ input æ˜¯ peru å‘€ !</strong>  é€ æˆ UI è·Ÿ state å°ä¸ä¸Šäº†ğŸ˜µã€‚</p><p>å¦‚æœè¦æ¨¡ä»¿æ­¤å‹•ä½œï¼Œå¯ä»¥åˆ° devtool çš„ network ä¸¦ä¸”è‡ªè¨‚é€Ÿåº¦ï¼Œé€™é‚Šæˆ‘è¨‚äº†ä¸€å€‹å« <code>superslow</code>ï¼ŒæŠŠ Download è¨­ç‚º 1kbï¼Œè®“å›å‚³é–“éš”è®Šé•·å°±æ¯”è¼ƒæ¸…æ¥šå•é¡Œã€‚<br><img data-src="https://i.imgur.com/Hh8l045.png" alt="|400x220"></p><p>æ€éº¼é¿å…æˆ–æ˜¯è§£æ±ºæ­¤ç‹€æ³å‘¢ ? ğŸ¤”</p><p>è¦çŸ¥é“ React çš„ <code>useEffect</code> ä¸¦ä¸æœƒå¹«æˆ‘å€‘è™•ç†é€™å€‹å•é¡Œï¼Œæœ€å¥½çš„æ–¹å¼æ˜¯å¯ä»¥è®“éåŒæ­¥è¢«ä¸­æ–· (abort)ï¼Œä¸¦ä¸”åœ¨ clean up çš„éšæ®µå–æ¶ˆã€‚å¦å¤–ä¸€å€‹æ–¹æ³•æ˜¯ï¼Œ<strong>åœ¨æŠŠå›å‚³è³‡æ–™æ”¾å…¥ state ä¹‹å‰ï¼Œç”¨ <code>boolean</code> æª¢æŸ¥ç›®å‰ç‹€æ…‹æ˜¯å¦è¦å–æ¶ˆã€‚</strong> å› ç‚ºåœ¨åŸ·è¡Œä¸‹ä¸€å€‹ effect ä¹‹å‰ï¼Œæœƒå…ˆåŸ·è¡Œ clean up functionã€‚</p><p>æ—¢ç„¶æˆ‘å€‘ä¸Šé¢æœ‰å¯¦ä½œï¼Œé‚£å°±ä¾†æ”¹é€ ä¸Šé¢çš„ä¾‹å­ :</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ğŸ‘‰ å»ºç«‹ç•¶æ¬¡ render çš„ didCancel</span></span><br><span class="line">    <span class="keyword">let</span> didCancel = <span class="literal">false</span>;</span><br><span class="line">    (<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (query) &#123;</span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">fetch</span>(baseurl + query).<span class="title function_">then</span>(<span class="function">(<span class="params">r</span>) =&gt;</span> r.<span class="title function_">json</span>());</span><br><span class="line">        <span class="comment">// æª¢æŸ¥æ˜¯ä¸æ˜¯æœ‰å–æ¶ˆ ?</span></span><br><span class="line">        <span class="keyword">if</span> (!didCancel) &#123;</span><br><span class="line">          <span class="title function_">setData</span>(data);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="title function_">setMessage</span>(data.<span class="property">message</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)();</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// åœ¨ä¸‹ä¸€å€‹ effect åŸ·è¡Œå‰ï¼Œç¢ºå®šå–æ¶ˆ</span></span><br><span class="line">      didCancel = <span class="literal">true</span>;</span><br><span class="line">      <span class="title function_">setMessage</span>(<span class="literal">null</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [query]);</span><br></pre></td></tr></table></figure><p>æƒ…å¢ƒ :</p><ol><li>é¡¯ç¤ºç•«é¢å¾Œæ”¹æœå°‹ usa</li><li>è³‡æ–™é‚„æ²’è¿”å›ï¼Œæ”¹æˆ peru</li></ol><p>æˆ‘å€‘ä¾†åŸ·è¡Œçœ‹çœ‹ï¼Œå¾ç¬¬ä¸€æ¬¡ render å®Œä¹‹å¾Œ :</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// input æ”¹æˆ usa</span></span><br><span class="line">setState query = <span class="string">&quot;usa&quot;</span></span><br><span class="line">re-render <span class="variable constant_">UI</span></span><br><span class="line"></span><br><span class="line">clean up æ¸…é™¤ tw å‰¯ä½œç”¨</span><br><span class="line">  state query <span class="string">&quot;tw&quot;</span></span><br><span class="line">  didCancel = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">effect åŸ·è¡Œ</span><br><span class="line">  state query <span class="string">&quot;usa&quot;</span></span><br><span class="line">  didCancel = <span class="literal">false</span></span><br><span class="line">  ğŸš€<span class="keyword">async</span> <span class="keyword">function</span> åŸ·è¡Œï¼Œé€²å…¥ pending ç‹€æ…‹</span><br><span class="line"></span><br><span class="line"><span class="comment">// input æ”¹æˆ peru</span></span><br><span class="line">  setState query = <span class="string">&quot;peru&quot;</span></span><br><span class="line">  re-render <span class="variable constant_">UI</span></span><br><span class="line"></span><br><span class="line">clean up æ¸…é™¤ usa å‰¯ä½œç”¨</span><br><span class="line">  state query <span class="string">&quot;usa&quot;</span></span><br><span class="line">  didCancel = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">effect åŸ·è¡Œ</span><br><span class="line">  state query <span class="string">&quot;peru&quot;</span></span><br><span class="line">  didCancel = <span class="literal">false</span></span><br><span class="line">  ğŸš€<span class="keyword">async</span> <span class="keyword">function</span>  åŸ·è¡Œï¼Œé€²å…¥ pending ç‹€æ…‹</span><br><span class="line"></span><br><span class="line">ğŸ‘‰ usa è³‡æ–™å›ä¾†äº†</span><br><span class="line">  usa clean effect å·²ç¶“è¢«å‘¼å«ï¼Œæ­¤æ™‚ didCancel æ˜¯ <span class="literal">true</span> ğŸ˜µ</span><br><span class="line">  âŒ setData ä¸æœƒè¢«åŸ·è¡Œ</span><br><span class="line"></span><br><span class="line">ğŸ‘‰ æœ€å¾Œ peru è³‡æ–™å›ä¾†äº†</span><br><span class="line">  didCancel æ˜¯ <span class="literal">false</span> </span><br><span class="line">  setData æœƒåŸ·è¡Œ</span><br><span class="line">  é¡¯ç¤º peru è³‡æ–™</span><br></pre></td></tr></table></figure><p>ä¸€é–‹å§‹å¾ä¸Šé¢çœ‹èµ·ä¾† <code>usa</code> è³‡æ–™å›ä¾†ç‚ºä»€éº¼ <code>didCancel = true</code> ğŸ¤”ï¼Œæ˜æ˜ <code>peru</code> çš„ effect åŸ·è¡Œäº† <code>didCancel = false</code>ã€‚å›åˆ°é †åºå•é¡Œï¼Œåœ¨ <code>usa</code> é€™å€‹ render æ™‚ï¼Œæˆ‘å€‘çš„ <code>didCancel</code> æœ€å¾Œæ˜¯ä»€éº¼ ?</p><p>æˆ‘ä¸€é–‹å§‹è¦ºå¾—å¾ˆå¾®å¦™ï¼Œæ‰€ä»¥å†å›å»è¤‡ç¿’ [[#è«‡è«‡ clean up]] é€™å€‹ç« ç¯€ã€‚</p><blockquote><p>æ¯ä¸€å€‹åœ¨ render å…§éƒ¨å‘¼å«çš„ function (åŒ…å« handlers ã€effect ç­‰ç€è¦½å™¨ APIs )ï¼Œéƒ½æœƒæ‹¿åˆ°ç•¶ä¸‹å®šç¾©çš„ state ã€‚</p></blockquote><p>å–®çœ‹åœ¨ <code>usa</code> é€™æ¬¡ render åŸ·è¡Œé †åºæ‡‰è©²æ˜¯ :</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">usa-didCancel = <span class="literal">false</span></span><br><span class="line">ğŸš€<span class="keyword">async</span> <span class="keyword">function</span> é€²è¡Œ fetch data</span><br><span class="line">  </span><br><span class="line">peru çš„åˆ°ä¾†è§¸ç™¼äº† use-clean up <span class="keyword">function</span></span><br><span class="line">  usa-didCancel = <span class="literal">true</span></span><br><span class="line">  </span><br><span class="line">usa è³‡æ–™å›ä¾† data = ...</span><br><span class="line"><span class="keyword">if</span> (usa-didCancel = <span class="literal">true</span>)</span><br><span class="line">âŒ setData é€™è¡Œä¸æœƒè¢«åŸ·è¡Œ</span><br></pre></td></tr></table></figure><p>åœ¨é‡æ¸…æ¦‚å¿µçš„éç¨‹ï¼Œæˆ‘æ˜¯ä½¿ç”¨ console åœ¨æ¯ä¸€å€‹éšæ®µå°å‡ºç•¶æ™‚çš„ query ï¼Œå¹«åŠ©è‡ªå·±äº†è§£ effect ä¸€å€¼æåˆ°çš„ <strong>åŒæ­¥</strong> æ¦‚å¿µ</p><h2 id="ç”¨æ­£ç¢ºçš„å¿ƒæ…‹å°å¾…-useEffect">ç”¨æ­£ç¢ºçš„å¿ƒæ…‹å°å¾… useEffect</h2><p><code>useEffect</code> é›–ç„¶å¾ˆå¸¸è¢«ç”¨åœ¨éåŒæ­¥è®€å–è³‡æ–™ï¼Œä½† <strong><code>useEffect</code> æ˜¯æ ¸å¿ƒæ€æƒ³æ˜¯ä¾†åšåŒæ­¥çš„æ“ä½œ</strong>ã€‚ side effects è®Šæˆè³‡æ–™æµçš„ä¸€éƒ¨åˆ†ï¼Œåªè¦æˆ‘å€‘çš„ç•¶æ¬¡ render çš„è³‡æ–™åŒæ­¥ï¼Œå–å¾—çš„è³‡æ–™ä¹Ÿæ˜¯ä¸€è‡´çš„ï¼Œå°æ–¼é‚Šéš›æ¢ä»¶ (edge case) çš„è™•ç†å°±æœƒæ¯”è¼ƒå®¹æ˜“ã€‚</p><p>ä¸é React åœ¨ 18 ç‰ˆæœ¬å°æ–¼è™•ç†éåŒæ­¥äº‹ä»¶æ¯”è¼ƒå»ºè­°ä½¿ç”¨ <strong>Suspense</strong>ã€‚Suspense æ˜¯ä¸€å€‹å¯ä»¥è®“é‚„æ²’æº–å‚™å¥½å¯ä»¥ render çš„ UI å¯ä»¥é¡¯ç¤ºé è¨­çš„ Component ï¼Œä¸»è¦è¦è§£æ±º 2 å€‹å•é¡Œ</p><ol><li>code splitting : ä¸ç”¨æŠŠä¸€æ¬¡æ‰€æœ‰ app å…ƒä»¶è¼‰ä¸‹ä¾†ï¼Œè€Œæ˜¯è¼‰å¿…è¦çš„</li><li>data fetching : è§£æ±ºåƒæ˜¯ä¸Šé¢æåˆ°çš„ race condition å•é¡Œ</li></ol><p>ä¸é Suspense æˆ‘ä¹Ÿé‚„æ²’èªçœŸç ”ç©¶é ğŸ˜µï¼Œå…ˆåˆ—å…¥è£œå‘å¤§éšŠçš„åå–®å§</p><h2 id="ç¸½çµ-29">ç¸½çµ</h2><ol><li><code>useEffect</code> æ˜¯ render èˆ‡ç€è¦½å™¨ painting ä¹‹å¾ŒåŸ·è¡Œï¼Œç›®çš„æ˜¯ä¸é˜»æ””è¢å¹•çš„æ›´æ–°ã€‚</li><li><code>useEffect</code> deps array å¦‚æœæ˜¯ç©ºçš„ï¼Œåƒ…åŸ·è¡Œä¸€æ¬¡ï¼Œå¦‚æœ array æœ‰ state æˆ– props ï¼Œæ ¹æ“šè³‡æ–™æ˜¯å¦æœ‰æ”¹è®Šï¼Œæœƒè·Ÿè‘—ç•¶æ¬¡ render ä¹‹å¾Œé‡æ–°å‘¼å«ã€‚</li><li>æ¯ä¸€æ¬¡ render éƒ½ä¿æœ‰å®ƒæ‰€æœ‰çš„æ±è¥¿ï¼ŒåŒ…å« event handlerã€éåŒæ­¥ (async/await)ã€effect æˆ–æ˜¯ API ï¼Œä»¥åŠç•¶æ¬¡ render çš„ state èˆ‡ propsã€‚</li><li>æƒ³æ‹¿åˆ°æœ€æ–°çš„å€¼å¯ä»¥ä½¿ç”¨ <code>refs</code>ï¼Œrefs å°±åƒæ”¾åœ¨å¤–éƒ¨çš„ç›’å­ï¼ŒReact ç¢ºä¿å®ƒéƒ½æŒ‡å‘åŒä¸€è¨˜æ†¶é«”ä½å€ï¼Œæ”¹è®Šå…¶å€¼ä¹Ÿä¸æœƒé€ æˆ re-renderã€‚</li><li>clean up function æœƒåœ¨ä¸‹ä¸€å€‹ effect å‘¼å«ä¹‹å‰å…ˆåŸ·è¡Œï¼Œæ³¨æ„ clean up æ‰€æ¸…é™¤çš„æ˜¯ä¸Šä¸€æ¬¡ render çš„å€¼ã€‚</li><li>ä¸è¦æ¬ºé¨™ deps arrayï¼Œé€šå¸¸ lint æœƒæé†’ï¼Œä½†æ˜¯é‡åˆ° object type çš„å€¼è¦å°å¿ƒï¼Œå¯èƒ½é€ æˆéåº¦é »ç¹æ›´æ–°ã€‚</li><li><code>useEffect</code> çš„ deps array æ˜¯å¦è¦æ”¾å…¥ç›¸é—œ state æˆ– props ï¼Œå¯ä»¥è¦– effect function ä¸­çš„ state è®ŠåŒ–æ˜¯å¦å¯ç”± <code>prevState</code> æ¨æ¸¬å‡ºä¾†ï¼Œå¦‚æœå¯ä»¥å¯ä½¿ç”¨ updater function ä¾†æ›´æ–°ã€‚</li><li>useReducer æ˜¯å¯ä»¥è®“è³‡æ–™è·Ÿé‚è¼¯åˆ†é–‹æ“ä½œçš„å¥½æ–¹æ³•ã€‚</li><li><code>useCallback</code> æ˜¯å¯ä»¥è¨˜ä½ render å…§çš„ functionï¼Œä½¿å…¶æ¯æ¬¡ä¸æ‡‰ re-render è€Œé‡æ–°å»ºç«‹ï¼Œæˆ–æ˜¯é€é callback çš„ deps array ä¾†å„ªåŒ–ã€‚å¦‚æœä¸æ˜¯ function å‰‡å¯ä»¥ä½¿ç”¨ <code>useMemo</code> è¨˜ä½æŸå€¼ã€‚</li><li>function åœ¨ function component èˆ‡ Hooks ä¸­æ˜¯ä¸€ç¨®è³‡æ–™æµã€‚å®ƒå¯ä»¥é€é props ä¾†å‚³éï¼Œä¹Ÿå¯ä»¥è¢«åˆ¤æ–·æ˜¯å¦ç‚º render çš„æ¢ä»¶ä¹‹ä¸€ã€‚è¨˜ä½ï¼Œæ­¤è¡Œç‚ºè·Ÿ class component ä¸ä¸€æ¨£ã€‚</li><li>useEffect æ˜¯è™•ç†åŒæ­¥çš„æ“ä½œï¼Œç¢ºä¿æ¯ä¸€æ¬¡ render  çš„ state æˆ– props èˆ‡ UI å…·æœ‰ä¸€è‡´æ€§ã€‚</li></ol><p>æœ¬ç¯‡é›–ç„¶è‘—é‡æ–¼ <code>useEffect</code>  ï¼Œä½†å°æ–¼æ–°æ‰‹ä¸€é€£è²«èªè­˜ React æ¦‚å¿µé‡æ¸…å¾ˆæœ‰å¹«åŠ©ã€‚è®€å®Œå¯ä»¥èªªæ˜¯é†é†çŒé ‚ï¼Œå¾ class Component åˆ° function Component çš„è½‰è®Šï¼Œå…¶è§£æ±ºçš„åŸå› ï¼›function Component ä½¿ç”¨çš„å¿ƒæ™ºæ¨¡å‹ (ä¹Ÿå°±æ˜¯æ ¸å¿ƒæ¦‚å¿µ)ï¼Œæ›´äº†è§£ Hooks çš„æ€ç¶­èˆ‡çµåˆ JavaScript closure çš„å¥§å¦™ï¼Œè®“äººè®€å®Œæœ‰ä¸€ç¨®</p><blockquote><p>ã€ŒåŸä¾†æ˜¯é€™æ¨£çš„é˜¿ !ã€</p></blockquote><p>é›–ç„¶é–±è®€éç¨‹å¾ˆè‰±è¾›ğŸ˜µï¼Œå› ç‚ºæˆ‘æ˜¯ç”Ÿå•ƒè‹±æ–‡ç‰ˆï¼Œæ²’æœ‰é¸æ“‡ä¸­æ–‡æ˜¯æ“”å¿ƒç„¡æ³•é ˜æœƒç¿»è­¯è€…çš„æ„æ€ï¼Œä¸æ˜¯æ€•ç¿»ä¸å¥½ï¼Œè€Œæ˜¯æ“”å¿ƒç¿»è­¯è€…æ°´å¹³å¤ªé«˜ï¼Œåè€Œæˆ‘çœ‹ä¸æ‡‚ğŸ¤£ã€‚å¹¸å¥½ Dan å¤§çš„æ–‡ç« æœ¬èº«å°å°ç™½å¾ˆå‹å–„ï¼Œå¾ˆå€¼å¾—ç”¨åŸæ–‡ä¸€è®€ğŸ‘</p><h3 id="é¡Œå¤–è©±">é¡Œå¤–è©±</h3><p>é€™æ®µæœŸé–“æ ¡æ­£æœ¬ç¯‡æ–‡ç« æ™‚ï¼ŒFB ç¤¾åœ˜ <a href="https://www.facebook.com/groups/reactjs.tw/">ReactJS.tw</a>  ä¹Ÿæ­£å¥½æœ‰å¤§ç¥åšåŒæ¨£çš„ä¸»é¡Œ <a href="https://slides.com/tz5514/useeffect-guide?fbclid=IwAR2VdZODJPO8Ex1Kd7PksCRA4dakIVvY-4aJ3X3ZtgfSwgq7hOGE6qHvcNc">éƒ½ 2022 å¹´äº†ä½ é‚„æ˜¯å¯èƒ½ä¸æ‡‚ useEffect</a>ã€‚æ•´ç†å‡ºçš„è„ˆçµ¡æ¸…æ™°ï¼Œä¹Ÿæœ‰æåˆ° React 18 ç‚ºä»€éº¼åš´æ ¼æ¨¡å¼æœƒåŸ·è¡Œå…©æ¬¡çš„å•é¡Œã€‚ç›®å‰æˆ‘é‚„æ²’å®Œå…¨çœ‹å®Œï¼Œä½†æˆ‘èªç‚ºçœ‹ä¸åŒçš„äººè§£é‡‹åŒç¯‡æ–‡ç« ä¹Ÿæ˜¯å¾ˆæœ‰å€¼å¾—å­¸ç¿’çš„åœ°æ–¹ï¼Œç•¢ç«Ÿæ–°æ‰‹è·Ÿè€æ‰‹çš„èªçŸ¥èµ·é»ä¸åŒğŸ˜‚ï¼Œå¾ˆæ…¶å¹¸æ­£å¥½åœ¨å­¸ç¿’ useEffect  åŒæ™‚é‡åˆ°å¤§ç¥çš„ç°¡å ±èˆ‡æ¼”è¬›ï¼Œé‡åˆ°è§€å¿µå¡ä½æ™‚ï¼Œæˆ‘ä¹Ÿæœƒç¿»åˆ°å¤§ç¥çš„ç°¡å ±å»å½Œè£œæˆ‘ä¸æ‡‚çš„åœ°æ–¹ã€‚</p><p>æœ‰ä¸€åº¦æƒ³ä»¥ç°¡å ±çš„å…§å®¹å»é‡æ–°æ•´ç†æ–‡ç« ï¼Œä½†æƒ³æƒ³é€™ä¹Ÿæˆ‘å­¸ç¿’ useEffect çš„åŸæ±åŸå‘³å­¸ç¿’éç¨‹ï¼Œå°±å…¨ä¿ç•™äº†ğŸ¤“ã€‚</p><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style:none; padding-left: 0;"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">1.</span><span style="display: inline-block; vertical-align: top;">render å…§éƒ¨ function çš„åŸ·è¡Œé» : <a href="https://codesandbox.io/s/w2wxl3yo0l">w2wxl3yo0l - CodeSandbox</a></span><a href="#fnref:1" rev="footnote"> â†©</a></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">2.</span><span style="display: inline-block; vertical-align: top;">function ç‰ˆæœ¬ : setTimeout ä¹‹ä¾åºå°å‡º state <a href="https://codesandbox.io/s/lyx20m1ol">lyx20m1ol - CodeSandbox</a></span><a href="#fnref:2" rev="footnote"> â†©</a></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">3.</span><span style="display: inline-block; vertical-align: top;">class ç‰ˆæœ¬ : setTimeout ä¹‹å…¨éƒ¨åŒæ™‚ä¸€æ¨£çš„ state <a href="https://codesandbox.io/s/kkymzwjqz3">kkymzwjqz3 - CodeSandbox</a></span><a href="#fnref:3" rev="footnote"> â†©</a></li><li id="fn:4"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">4.</span><span style="display: inline-block; vertical-align: top;"><a href="https://reactjs.org/docs/hooks-reference.html#functional-updates">Hooks API Reference â€“ React â€“ functional-updates</a></span><a href="#fnref:4" rev="footnote"> â†©</a></li></ol></div></div>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ–‡ç« ä¾†è‡ª : &lt;a href=&quot;https://overreacted.io/zh-hant/a-complete-guide-to-useeffect/&quot;&gt;useEffect çš„å®Œæ•´æŒ‡å— â€” Overreacted&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;æ‘˜è¦-6&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;useEffect çš„åŸºç¤æ¦‚å¿µ&lt;/li&gt;
&lt;li&gt;useEffect dependencies array çš„ä½¿ç”¨æ–¹å¼&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¤§éƒ¨åˆ†éƒ½æ˜¯ä¾†è‡ªåŸæ–‡çš„å†ç¿»è­¯ï¼Œæˆ‘æœ‰äº›æ¯”è¼ƒä¸æ‡‚çš„éƒ¨åˆ†å°±ç”¨è‡ªå·±çš„æ–¹å¼å»è§£é‡‹ï¼Œä¹Ÿæœƒç”¨åŸå§‹çš„ JS å¯¦ä½œçš„æ–¹å¼ï¼Œè·Ÿè‘—ä¸€æ­¥æ­¥ç·¨è­¯ã€‚&lt;/p&gt;
&lt;p&gt;æ›´é‡è¦çš„æ˜¯ï¼Œè¦ç”¨ React çš„æ€ç¶­ä¾†å»äº†è§£ &lt;code&gt;useEffect&lt;/code&gt; çš„å…§æ¶µã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Front-end" scheme="https://blog.rosa.tw/categories/Front-end/"/>
    
    <category term="React" scheme="https://blog.rosa.tw/categories/Front-end/React/"/>
    
    
    <category term="React" scheme="https://blog.rosa.tw/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>ç­†è¨˜ | React - render props</title>
    <link href="https://blog.rosa.tw/2022/07/React/Render-props"/>
    <id>https://blog.rosa.tw/2022/07/React/Render-props</id>
    <published>2022-07-30T21:35:00.000Z</published>
    <updated>2022-07-31T13:25:13.573Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ–‡ç« ä¾†è‡ª :</p><ol><li><a href="https://zh-hant.reactjs.org/docs/render-props.html">Render Props â€“ React</a></li><li><a href="https://gist.github.com/heygrady/f9bf3b6dd93fe3d87ba87430fd3c20d5">Avoiding HOC; Favoring render props Â· GitHub</a></li></ol></blockquote><h2 id="æ‘˜è¦-5">æ‘˜è¦</h2><ol><li>ä»€éº¼æ˜¯ render props</li><li>render props çš„æ‡‰ç”¨ç¯„ä¾‹</li><li>render props èˆ‡ HOC (higher order component) çš„å·®åˆ¥</li></ol><span id="more"></span><h2 id="ä»€éº¼æ˜¯-render-props">ä»€éº¼æ˜¯ render props</h2><p>render props æ˜¯ä¸€ç¨®æŠŠ props ç•¶ä½œ render function çš„æ¦‚å¿µã€‚<br>æ“æœ‰ render props çš„ Component ä¸æœƒåŸ·è¡Œè‡ªå·±çš„ render é‚è¼¯ï¼Œæˆ–æ˜¯å¯ä»¥æƒ³æˆæŠŠ children ç•¶æˆ function å‘¼å«å¾Œå›å‚³ä¸€å€‹ <code>React.Element</code> ã€‚</p><ul><li>é€™æ˜¯ä¸€ç¨® : ä½†æ˜¯ä¸è¦‹å¾—ä¸€å®šè¦ç”¨ <code>props.children</code></li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">AComponent</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;props =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">        /* æŠŠ children å¯«æˆ function å¸¶å…¥*/</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¯¦éš›ä¸Šåªè¦ props æ˜¯ function ï¼Œè€Œä¸”åœ¨ render function å…§éƒ¨è¢«å‘¼å«</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">AComponent</span>(<span class="params">props</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Wrapper</span> <span class="attr">render</span>=<span class="string">&#123;props</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">/* ç›´æ¥æŠŠ function æ‹†é–‹ä¾†ï¼Œå¯ä»¥ç›´æ¥æ¥æ”¶ AComponent çš„ state èˆ‡ props*/</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">&#125;&#125;/&gt;</span></span><br><span class="line">)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç›´æ¥æŠŠ props.render åœ¨å…§éƒ¨å‘¼å«</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Wrapper</span>(<span class="params">props</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">&#123;props.render(props)&#125;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å«ä¸å« <code>render</code> éƒ½æ²’é—œä¿‚ï¼Œé€™æ˜¯ç¨®å‘½åä¸Šçš„æ…£ä¾‹è€Œå·²ã€‚</p><p>å¦‚æœä½¿ç”¨é <a href="https://blog.rosa.tw/2022/07/React/React-Context">Context Consumer</a>ï¼ŒConsumer çš„å¦ä¸€å€‹å‹æ…‹å°±æ˜¯ :</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line"><span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Context.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">&#123;props =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">/* æ”¾åœ¨é€™è£¡é¢çš„ Component éƒ½èƒ½é€é props æ‹¿åˆ° context value*/</span></span><br><span class="line"><span class="language-xml">&#125;&#125;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">Context.Consumer</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>å¥½è™•æ˜¯å¯ä»¥åŒæ™‚æ“æœ‰å¤šå€‹ Provider ä¾†ä½¿ç”¨ï¼Œå„ªé»å°±é¡¯ç¤ºåœ¨å‹•æ…‹ä¸Šçš„è³‡æ–™çµæ§‹ã€‚</p><h2 id="render-props-çš„çµæ§‹">render props çš„çµæ§‹</h2><p>æŠŠ props ç•¶ä½œ function ç›´æ¥å‚³å…¥ <code>(props)=&gt; &lt;Component &#123;å‚³å…¥æƒ³è¦çš„ props èˆ‡ state&#125;/&gt;</code></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">somethingwithToggle</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">render</span>=<span class="string">&#123;(props)</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-xml">return (</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">&#123;/* âœ…åœ¨é€™è£¡å°±å¯ä»¥ç›´æ¥æ¥æ”¶åˆ°è³‡æ–™ï¼Œä¸ç”¨å†ç¶“éå¦å¤–çš„ Container åŒ…ä½*/&#125;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">AnthorComponent</span> <span class="attr">somevalue</span>=<span class="string">&#123;value&#125;</span> <span class="attr">someprop</span>=<span class="string">&#123;props.OOO&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">)</span></span><br><span class="line"><span class="language-xml">&#125;&#125;/&gt;</span></span><br><span class="line">)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘è‡ªå·±çœ‹ä½œ <strong>ç›´æ¥åœ¨ props æŠŠ function çµæ§‹æ‰“é–‹</strong> åˆ°çˆ¶å…ƒä»¶ç›´æ¥ä½¿ç”¨ï¼Œåœ¨å…§éƒ¨çš„ Element å¯ä»¥ç›´æ¥æ¥æ”¶åˆ° props èˆ‡ stateã€‚è·Ÿ HOC æ¯”è¼ƒè€Œè¨€ï¼Œåœ¨ä½¿ç”¨çµæ§‹ä¸Šæ›´ä¸€ç›®äº†ç„¶ã€‚</p><p>ç”±æ–¼ HOC æ˜¯å°‡ Component ç”¨ function åŒ…èµ·ä¾†ï¼Œé‚è¼¯åŒ…åœ¨ function å…§éƒ¨ (å°è£èµ·ä¾†)ï¼Œå¦‚æœè¦çŸ¥é“å‚³å…¥çš„ props name é‚„è¦æŠŠ HOC æ‰€åœ¨çš„è…³æœ¬æ‰“é–‹ä¾†çœ‹ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ çœ‹ä¸å‡ºä¾† Toggle è£¡é¢å‚³ä»€éº¼æ±è¥¿çµ¦ Navbar </span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">NavbarwithToggle</span>  = <span class="title function_">withToggle</span>(<span class="title class_">Navbar</span>)</span><br></pre></td></tr></table></figure><p>å¦ä¸€å€‹æ˜¯å‹•æ…‹èˆ‡éœæ…‹çš„é—œä¿‚ï¼Œrender props çš„ render éƒ¨åˆ†å¯ä»¥æƒ³å¡«å…¥ä»»ä½•çµæ§‹çš„ JSXï¼Œè€Œ HOC é¡ä¼¼ <strong>å›ºå®šçš„æ¨¡æ¿</strong> (Container)ï¼Œåªèƒ½æŒ‰ç…§å®šç¾©çš„æ ¼å¼å¡«å…¥ã€‚</p><ul><li>HOC</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœ€ç°¡å–®çš„ HOCï¼Œé€™é‚Šåªèƒ½å›å‚³è¢«åŒ…ä½çš„çµæ§‹</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">withToggle</span> = (<span class="params">Component</span>)=&gt; <span class="function">(<span class="params">props</span>) =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span></span><br><span class="line"><span class="comment">// ç”¢ç”Ÿå‡ºä¾†çš„çµæ§‹ ğŸ‘‰ </span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Navbar</span>/&gt;</span></span></span><br></pre></td></tr></table></figure><ul><li>render props</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">ToggleComponent</span> = (<span class="params"></span>)=&gt;&#123;</span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Toggle</span> <span class="attr">render</span>=<span class="string">&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">(<span class="attr">props</span>)=&gt;</span>(</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">// ä»»ä½•çµæ§‹ï¼Œä¸€å€‹ä¹Ÿå¯ä»¥</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">OnlyComponent</span> <span class="attr">open</span>=<span class="string">&#123;props.open&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">// Nested ä¹Ÿè¡Œ</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">NestedContainer</span> &#123;/*<span class="attr">ä¹Ÿå¯ä»¥æ’å…¥</span> <span class="attr">props</span> */&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Component</span> <span class="attr">open</span>=<span class="string">&#123;props.open&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">NestedContainer</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">)</span></span><br><span class="line"><span class="language-xml">&#125;/&gt;</span></span><br><span class="line"><span class="language-xml">)</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="å¯¦éš›ç¯„ä¾‹">å¯¦éš›ç¯„ä¾‹</h2><p>å¯ä»¥å…ˆè¤‡ç¿’ HOC çš„éƒ¨ä»½ï¼Œæœƒæ”¹å¯«ä¾†è‡ª <a href="https://blog.rosa.tw/2022/07/React/Higher-Order-Component">HOC å¯¦ä½œç·´ç¿’</a>ã€‚</p><p>æ¥ä¸‹ä¾†æˆ‘è¦åšçš„ :</p><ol><li>å°‡ <code>withToggle</code> æ”¹æˆ render props æ ¼å¼ï¼Œå« <code>&lt;Toggle/&gt;</code></li><li>ç”¨ <code>&lt;Toggle/&gt;</code> æŠŠ Navbar èˆ‡ Accordion åŒ…èµ·ä¾†</li><li>å¯¦ä½œ Push Canvas Navbar</li></ol><p>å…¶å¯¦åœ¨ HOC æ™‚æœ‰ä¸€ç¨® Navbar ä¸å¤ªå¥½åšåˆ°ï¼Œé‚£å°±æ˜¯å‘æ•´å€‹ç•«é¢æ¨çš„ Navbarï¼Œå› ç‚º HOC å°‡çµæ§‹çµ¦ç¶ä½äº†ï¼Œçµæœåªèƒ½æ§åˆ¶ Component æœ¬èº«ï¼Œé›–ç„¶å¯ä»¥ç”¨åˆ¤æ–·çš„æ–¹å¼ (conditional rendering)ï¼Œä½†æœƒä½¿å¾—çµæ§‹æ”é•· ğŸ˜µï¼Œæ¥è‘—æœƒä½¿ç”¨ <strong>render props</strong> å‰µå»º Push Canvas Navbarã€‚</p><p>åœ¨å¯«é€™ç¯‡çš„åŒæ™‚ï¼Œæˆ‘ä¹Ÿåœ¨ HOC ä¹Ÿæœ‰è£œä¸Š Push Canvas Navbar çš„å¯«æ³• ğŸ‘‰ <a href="https://codepen.io/shan473/pen/WNzjdmJ">React - HOC practice</a></p><h3 id="æ°æ°-withToggle-ğŸ‘‹">æ°æ° withToggle ğŸ‘‹</h3><p>é€šé€šç æ‰ HOC çš„éƒ¨åˆ†ï¼Œæ”¹æˆ Component çš„å½¢å¼</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. props.render æ˜¯ä¸€å€‹ functionï¼Œrender children</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Toggle</span>(<span class="params">&#123;render&#125;</span>) &#123;</span><br><span class="line"><span class="comment">// 2. é¡ä¼¼é‚è¼¯çš„ open èˆ‡ togglehandler</span></span><br><span class="line">  <span class="keyword">const</span> [open, setOpen] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">togglehandler</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">setOpen</span>(<span class="function">(<span class="params">prevOpen</span>) =&gt;</span> !prevOpen);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">/* 3. ğŸ‘‡ é‡é»åœ¨é€™è£¡ render æ˜¯ä¸€å€‹ function è² è²¬æ¸²æŸ“ React Elementï¼Œåƒæ•¸æ˜¯å¸¶çµ¦ Element </span></span><br><span class="line"><span class="comment">  çš„ props</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;render(&#123; open, togglehandler &#125;)&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åƒæ•¸ä½¿ç”¨ object æ¯”èµ·ä½¿ç”¨ array ï¼Œç”¨è§£æ§‹æ™‚ä¸ç”¨ç®¡é †åºçš„å•é¡Œã€‚</p><h3 id="åŠ ä¸Šå®¢è£½åŒ–çš„-Navbar">åŠ ä¸Šå®¢è£½åŒ–çš„ Navbar</h3><p>åŸºæœ¬ä¸Šå…©å€‹å…ƒä»¶çš„çµæ§‹ä¸¦æ²’æœ‰å‹•åˆ°ï¼Œè€Œæ˜¯å°‡ HOC ä¸­çš„ <code>withNavbarType</code> æ”¹æˆ <code>&lt;CustomNavbar/&gt;</code>ï¼Œä¸¦ä¸”æ”¹æˆå‚³å…¥çš„ type ä¾†åˆ¤æ–· <code>width</code> çš„å€¼</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">CustomNavbar</span>(<span class="params">&#123; type &#125;</span>) &#123;</span><br><span class="line"><span class="comment">// 1. displayName æ˜¯å¹«åŠ© devtool è¾¨åç¨±ï¼Œä½†æ˜¯é€™è£¡æœ‰ BUG ğŸ˜µğŸ˜µğŸ˜µï¼Œä¸‹é¢æœƒèªªæ˜</span></span><br><span class="line">  <span class="title class_">CustomNavbar</span>.<span class="property">displayName</span> = type + <span class="string">&quot;Navbar&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">  <span class="comment">// 2. æŠŠ Toggle å…ƒä»¶ render function å±•é–‹ï¼Œä¸¦ä¸”æŠŠ props ç›´æ¥å‚³çµ¦ Navbar</span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Toggle</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">render</span>=<span class="string">&#123;(props)</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        return <span class="tag">&lt;<span class="name">Navbar</span> <span class="attr">type</span>=<span class="string">&#123;type&#125;</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span>;</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    /&gt;</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å¯¦æœ‰é»å¤šæ­¤ä¸€èˆ‰ï¼Œä¸éæˆ‘åŸæœ¬æ˜¯æƒ³è¦åŠ ä¸Š displayName ï¼Œä½†é€™é‚Šå‡º BUG ğŸ˜µ</p><h3 id="çµ„åˆ">çµ„åˆ</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  &#123;/* 1. å…©ç¨® Navbar */&#125;</span></span><br><span class="line"><span class="language-xml">      Overlay:</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">CustomNavbar</span> <span class="attr">type</span>=<span class="string">&quot;Overlay&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      FullNavbar:</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">CustomNavbar</span> <span class="attr">type</span>=<span class="string">&quot;Full&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* 2. Accordion */&#125;</span></span><br><span class="line"><span class="language-xml">        &#123;Array.from(&#123; length: 3 &#125;).map((_, i) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">          return (</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Toggle</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">key</span>=<span class="string">&#123;i&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">render</span>=<span class="string">&#123;(props)</span> =&gt;</span> <span class="tag">&lt;<span class="name">Accordion</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">index</span>=<span class="string">&#123;i&#125;</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">            /&gt;</span></span><br><span class="line"><span class="language-xml">          );</span></span><br><span class="line"><span class="language-xml">        &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å¯¦ Navbar ä¹Ÿå¯ä»¥ä¸€èµ·æ‹†é–‹ï¼Œå› ç‚ºåªæœ‰åŒ…ä½ Navbar è€Œå·²ã€‚å¦‚æ­¤ä¸€ä¾†ï¼Œåœ¨çµæ§‹ä¸Šå°±å¯ä»¥çœ‹çš„å‡ºä¾†åœ¨åšä»€éº¼</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;/* 1. é€é Navtype ç›´æ¥å– name ç”Ÿæˆï¼Œç”±æ–¼ Push Navbar è™•ç†æ–¹å¼ä¸ä¸€æ¨£å°±å¦å¤–ç”¨*/&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;Object.keys(Navtype).map((name, i) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">        if (i === 2) return null;</span></span><br><span class="line"><span class="language-xml">        return (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;name&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Toggle</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">key</span>=<span class="string">&#123;name&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">render</span>=<span class="string">&#123;(props)</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                return <span class="tag">&lt;<span class="name">Navbar</span> <span class="attr">type</span>=<span class="string">&#123;name&#125;</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span>;</span></span><br><span class="line"><span class="language-xml">              &#125;&#125;</span></span><br><span class="line"><span class="language-xml">            /&gt;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">      &#125;)&#125;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">      &#123;<span class="comment">/* 2. é€™è£¡çš„ Accordion æ²’ä»€éº¼å·®åˆ¥ï¼Œä½†æ¯” HOC å°‘ä¸€å±¤åŒ…è£ */</span>&#125;</span><br><span class="line">        &#123;<span class="title class_">Array</span>.<span class="title function_">from</span>(&#123; <span class="attr">length</span>: <span class="number">3</span> &#125;).<span class="title function_">map</span>(<span class="function">(<span class="params">_, i</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">Toggle</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">key</span>=<span class="string">&#123;i&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">render</span>=<span class="string">&#123;(props)</span> =&gt;</span> <span class="tag">&lt;<span class="name">Accordion</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">index</span>=<span class="string">&#123;i&#125;</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">            /&gt;</span></span><br><span class="line">          );</span><br><span class="line">        &#125;)&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€å¾Œæ•ˆæœè·Ÿ HOC ä¸€æ¨£ï¼Œä¸é render props æ˜¯åœ¨çµæ§‹ä¸Šå°±å¾ˆæ¸…æ¥šçœ‹è¦‹è‡ªå·±åœ¨åšä»€éº¼ğŸ‘Œ(çœ‹ devtools çš„åœ°æ–¹)<br><img data-src="https://i.imgur.com/YJChQnc.gif" alt="|420x400"></p><h3 id="Push-ç‰ˆæœ¬çš„Navbar">Push ç‰ˆæœ¬çš„Navbar</h3><p>Push ç‰ˆæœ¬éœ€è¦æŠŠ <em>æ•´å€‹ç•«é¢å¾€å³æ¨</em>ï¼Œåœ¨çµæ§‹ä¸Šæ˜¯é•·åœ¨ <code>root Element</code> çš„é„°å±…ï¼Œæ‰€ä»¥å¿…é ˆé€é <strong>Portal</strong> ä¾†å¹«æˆ‘å€‘ç›´æ¥åœ¨ <code>root</code> ä»¥å¤–çš„ç¯€é»ç”Ÿæˆ DOM ã€‚</p><p>é¦–å…ˆåœ¨ <code>html</code> åŠ ä¸Šè¦é•·å‡ºçš„ <code>container</code>ï¼Œå« <code>push-navbar</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;push-navbar&quot;</span>&gt;</span>Push:<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åªæœ‰ Push çš„ Navbar çµæ§‹ä¸åŒï¼Œæˆ‘å¸Œæœ›æŠŠå®ƒç¨ç«‹å‡ºä¾†</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 1. æ‹¿åˆ° Container çš„ DOM */</span></span><br><span class="line"><span class="keyword">const</span> pushEl = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;push-navbar&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">PushNavbar</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">/* 2. ReactDOM.createPortal å¯ä»¥åœ¨æŒ‡å®šçš„ Container ç”Ÿæˆ element */</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">ReactDOM</span>.<span class="title function_">createPortal</span>(</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Toggle</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">render</span>=<span class="string">&#123;(props)</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">      /* 4. æ ¹æ“š open è®“ root å¾€å³æ¨ç§»ã€‚æˆ‘é¸æ“‡ä¸åœ¨ Navbar è£¡é¢åˆ¤æ–·ï¼ŒæŠŠå®ƒæåˆ°é€™è£¡ */</span></span><br><span class="line"><span class="language-xml">        React.useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">          if (props.open) &#123;</span></span><br><span class="line"><span class="language-xml">            document.getElementById(&quot;app&quot;).style.marginLeft = &quot;250px&quot;;</span></span><br><span class="line"><span class="language-xml">          &#125; else &#123;</span></span><br><span class="line"><span class="language-xml">            document.getElementById(&quot;app&quot;).style.marginLeft = 0;</span></span><br><span class="line"><span class="language-xml">          &#125;</span></span><br><span class="line"><span class="language-xml">          /* 5. è¨˜å¾—åŠ ä¸Š dependencies */</span></span><br><span class="line"><span class="language-xml">        &#125;, [props.open]);</span></span><br><span class="line"><span class="language-xml">        </span></span><br><span class="line"><span class="language-xml">    /* 6. render props Navbar ï¼Œä¸¦ä¸”æŠŠ Toggle çš„è³‡æ–™å¡å›å»ï¼Œä¸€æ¨£è¦åŠ ä¸Š type */</span></span><br><span class="line"><span class="language-xml">        return <span class="tag">&lt;<span class="name">Navbar</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">type</span>=<span class="string">&quot;Push&quot;</span> /&gt;</span>;</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    /&gt;</span>,</span><br><span class="line">    <span class="comment">/* 3. ç¬¬äºŒå€‹åƒæ•¸æ”¾ Container */</span></span><br><span class="line">    pushEl</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€å¾ŒæŠŠä»–åŠ åœ¨ <code>&lt;App/&gt;</code> è£¡é¢ï¼Œé›–ç„¶åœ¨è£¡é¢ï¼Œ Portal åªæœƒåœ¨æŒ‡å®šçš„ Container ç”Ÿæˆã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;/* åœ¨é€™è£¡åŠ ä¸Š */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">PushNavbar</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* ... ç•¥ */&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•ˆæœ :<br><img data-src="https://i.imgur.com/zh8X6fB.gif" alt="|580x400"></p><h3 id="é‡åˆ°çš„å•é¡Œ-CustomNavbar-çš„-displayName-éŒ¯èª¤">é‡åˆ°çš„å•é¡Œ :  CustomNavbar çš„ displayName éŒ¯èª¤</h3><p>å› ç‚º CustomNavbar æ˜¯ç”¨åœ¨åªæœ‰å›ºå®šç§»å‹•å¯¬åº¦çš„ Navbar ä¸Šï¼Œç‚ºäº†æ–¹ä¾¿ debug åŠ ä¸Šäº† displayName ï¼Œä½†æ˜¯æ°¸é åªæœƒé¡¯ç¤ºæ’åœ¨æœ€å¾Œé¢æ”¹éåçš„ Navbar ï¼Œæˆ‘ç”¨ console å°å‡º displayName æ˜¯å…©å€‹ä¸åŒçš„ï¼Œä¸éåœ¨ React devtools å»é¡¯ç¤ºä¸€æ¨£çš„ğŸ˜µ ï¼Œå¯¦éš›ä¸Šæˆ‘ä¹Ÿä¸çŸ¥é“ç™¼ç”Ÿä»€éº¼å•é¡Œâ€¦</p><blockquote><p>å¦‚æœæœ‰è§£ç­”çš„å¤§ç¥ï¼Œç…©è«‹å¯«ä¿¡å‘Šè¨´æˆ‘ğŸ˜¢</p></blockquote><p><img data-src="https://i.imgur.com/2X0ATS6.png" alt="600x280"></p><h2 id="æ³¨æ„-render-props-ä½¿ç”¨åœ¨-Pure-Component">æ³¨æ„ : render props ä½¿ç”¨åœ¨ Pure Component</h2><p>props æ”¾å…¥ functionï¼ŒObject Type æ”¾åœ¨ render æœƒå°è‡´æ¯æ¬¡ re-render ï¼Œé€™åœ¨ [[â€¦/React - å·¢ç‹€ Component å„ªåŒ– &amp; anti-pure Pattern | Component å„ªåŒ–çš„å•é¡Œ]] æœ‰æéï¼Œæ‰€ä»¥ä½¿ç”¨ render props çš„æ–¹å¼ï¼Œåœ¨ render å±•é–‹çš„ function æœ¬èº«å°±ä¸æœƒæ˜¯ Pure çš„ï¼Œå¦‚æœè£æœ‰ render props çš„å…ƒä»¶è¦è®Šæˆ Pure Component å¯ä»¥æŠŠå‚³å…¥ function æå‡ºä¾†ï¼Œè€Œä¸æ˜¯æ¯æ¬¡ re-render ç”¢ç”Ÿæ–°çš„ functionã€‚</p><blockquote><p>ç°¡å–®ä¾†èªª : <code>&#123; &#125; !== &#123; &#125;</code></p></blockquote><p>æŠŠ render function æ°¸é æŒ‡å‘ç›¸åŒçš„ functionï¼Œä»¥  <code>&lt;Toggle/&gt;</code> ç‚ºä¾‹</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. æŠŠ render function æå‡ºä¾†ï¼ŒğŸ¤” æ˜¯ä¸æ˜¯è·Ÿ HOC æœ‰ 87% åƒ</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">renderNavbar</span>(<span class="params">type</span>) &#123;</span><br><span class="line"><span class="comment">// 2. é€™é‚Šå›å‚³çš„æ˜¯ä¸€å€‹ function ä¸æ˜¯ elementï¼Œå› ç‚ºæˆ‘å€‘è¦æŠŠ type è·Ÿ props åŒæ™‚å¸¶é€²å»</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">props</span>) =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Navbar</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">type</span>=<span class="string">&#123;type&#125;/</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 3. æŠŠé€™å€‹å¸¶ type çš„ function è¨˜èµ·ä¾†</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">FullwithToggle</span> = <span class="title function_">renderNavbar</span>(<span class="string">&quot;Full&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">CustomNavbar</span>(<span class="params">&#123; type &#125;</span>) &#123;</span><br><span class="line">  <span class="title class_">CustomNavbar</span>.<span class="property">displayName</span> = type + <span class="string">&quot;Navbar&quot;</span>;</span><br><span class="line"><span class="comment">// 4. âœ… è¨˜ä½å‚³é€²å»çš„æ˜¯ä¸€å€‹ function ï¼Œä¸æ˜¯ &quot;å‘¼å«çš„&quot;</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Toggle</span> <span class="attr">render</span>=<span class="string">&#123;FullwithToggle&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ ä¸èƒ½é€™æ¨£ï¼Œå› ç‚ºå‚³å…¥çš„é‚„æ˜¯å›å‚³æ–°çš„ functionï¼Œ</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">CustomNavbar</span>(<span class="params">&#123; type &#125;</span>) &#123;</span><br><span class="line">  <span class="title class_">CustomNavbar</span>.<span class="property">displayName</span> = type + <span class="string">&quot;Navbar&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Toggle</span> <span class="attr">render</span>=<span class="string">&#123;renderNavbar(type)&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘æº–å‚™å…©å€‹ä¸€æ¨£çš„ä»‹é¢ï¼Œä¸€å€‹ Toggle å‚³å…¥çš„ function æœ‰è¢«è¨˜æ†¶èµ·ä¾†ï¼Œå¦ä¸€å€‹æ²’æœ‰ã€‚<br>ç”¨ devtools ä¾†çœ‹ï¼ŒApp  state æ”¹è®Š ï¼Œ<code>&lt;CustomNavbar/&gt;</code> ä¹Ÿæœƒ re-renderã€‚ç•¶ render props çš„ function è¢«æå‡ºä¾†ï¼Œ <code>&lt;Toggle/&gt;</code> é€™é‚Šä¸æœƒé€²è¡Œ re-renderï¼Œåªæœƒé¡¯ç¤º <code>parent render</code>ï¼›å¦ä¸€çµ„å‰‡æ˜¯æœƒå¯« <code>props changed(render)</code>ã€‚<br><img data-src="https://i.imgur.com/DB2jLnQ.png" alt=""><br>æˆ‘è¦ºå¾—é€™æ¨£çš„æ–¹æ³•å¾ˆé¡ä¼¼ HOC ï¼Œçµæ§‹ä¸Šæ²’æœ‰å¤ªå¤§çš„å»¶å±•æ€§ï¼Œ render è£¡é¢çš„çµæ§‹è®Šæˆå›ºå®šçš„ï¼Œä¸éä¾ç„¶æ¯” HOC å¥½ä¸€é»ã€‚</p><h2 id="HOC-render-props-çš„çµ„åˆæŠ€">HOC + render props çš„çµ„åˆæŠ€</h2><p>ç•¶ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ HOC åŒ…ä½ render props çš„æ–¹å¼ï¼Œ<strong>ä½†åä¹‹æ˜¯ä¸è¡Œçš„</strong>ï¼Œé€™ä¹Ÿæ˜¯ç‚ºä»€éº¼ HOC é€æ¼¸ä¸å‚™å—ç”¨ï¼Œè€Œå¤§éƒ¨åˆ†æ¨å¾ render props çš„åŸå› ã€‚</p><p>åœ¨ <strong>react-router v5</strong> çš„<code> withRouter</code> å°±æ¡å– HOC åŒ…ä½ render props çš„æ–¹å¼ï¼ŒHOC åŒ…å‡ºå»çš„æ˜¯ Pure Component ã€‚åœ¨ <code>withRouter</code> çš„éƒ¨ä»½ï¼Œæœƒæ”¹è®Š historyAPI ä¹Ÿå°±æ˜¯é¡¯ç¤ºçš„ç¶²å€ (SPA ä¸¦éçœŸçš„åŸ·è¡Œè·³è½‰çš„è¡Œç‚ºï¼Œè€Œæ˜¯æ”¹è®Š url çš„é•·ç›¸)</p><p><code>withRouter</code> çš„çµæ§‹<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup> :</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">withRouter</span> = (<span class="params">Component</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">C</span> = (<span class="params">props</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; wrappedComponentRef, ...remainingProps &#125; = props</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">render</span>=<span class="string">&#123;routeComponentProps</span> =&gt;</span> (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...remainingProps</span>&#125; &#123;<span class="attr">...routeComponentProps</span>&#125; <span class="attr">ref</span>=<span class="string">&#123;wrappedComponentRef&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      )&#125;/&gt;</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>ä½†åœ¨ v6 å¾Œ <code>withRouter</code> å°±æ¶ˆå¤±äº†ï¼Œç¾ä»Šéƒ½æ”¹æˆ Hooks ç‰ˆæœ¬ï¼Œå› ç‚º Hooks å¾ˆé¦™é˜¿ (X</p><h2 id="render-props-v-s-HOCs">render props v.s HOCs</h2><p>ç•¶æˆ‘å­¸ç¿’ HOC æ™‚ï¼Œå¾ˆå¤šæ–‡ç« æŒ‡å‡º render props æ˜¯æ¯” HOC æ›´å¥½çš„å¯¦ä½œæ–¹å¼ï¼Œå¾ä¸Šé¢çš„å¯¦ä½œå¤§ç•¥çŸ¥é“è¶…è¶Šçš„å„ªé»ï¼Œæ¥è‘—è¦ä¾†æ·±å…¥æ›´å…·é«”çš„åŸå› ã€‚</p><p>æ ¹æ“šé€™ç¯‡æ–‡ç« <sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>ï¼Œä¾†é‡æ¸…å¹¾å€‹ HOC çš„å•é¡Œ</p><h2 id="HOC-è¢«æ·˜æ±°çš„åŸå› ">HOC è¢«æ·˜æ±°çš„åŸå› </h2><ol><li>HOC å»£æ³›çš„è¢«æ¿«ç”¨ï¼Œé€ æˆä»»ä½•çµæ§‹ç›¸åŒéƒ½å¾—ç”¨ä¾†åŒ…ã€‚æœ‰äº›åŒ…è£æˆ HOC å»<strong>æ²’æœ‰å¯¦è¡Œå‚³é props æˆ– method çš„åŠŸèƒ½</strong>ï¼Œå¤±å»å®ƒçš„æ ¸å¿ƒæ„ç¾©ã€‚</li><li>é€ æˆ React tree è®Šå¾—æ›´è¤‡é›œã€‚é€™å€‹æ¦‚å¿µå°±æ˜¯ function è£¡é¢ä¸æ–·åŒ… functionï¼ŒCall Stack ä¸æ–·å¾€ä¸Šç–ŠåŠ ï¼ŒåŠ é‡æ•ˆèƒ½ä¸Šçš„è² æ“”ã€‚</li><li>éœ€è¦é¡å¤–çš„å‹•ä½œå…¼å®¹åŸå§‹ Component çš„è¡Œç‚ºã€‚<ol><li>ref çš„å•é¡Œã€‚ä¸èƒ½ç›´æ¥åŠ åœ¨ HOC ç”¢ç”Ÿçš„ Component ä¸Šï¼Œå¿…é ˆé€é <strong>forwardref</strong> æ‰¿æ¥ refï¼Œå†å¤šåŒ…ä¸€å±¤å¾€ä¸‹å‚³éè‡³ <code>WrappedComponent</code></li><li>Class Component çš„ method ä¸æœƒè¢«å‚³éï¼Œå¿…é ˆæå‡éœæ…‹ (static) çš„ function åˆ° HOC ä¸Šä¾†æ“´å……ã€‚</li></ol></li></ol><p>é€™äº›ç¼ºé»éƒ½æœ‰åœ¨ React å®˜æ–¹è¢«æåŠ<sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup>ï¼Œä¹Ÿéƒ½æœ‰è£œæ•‘çš„æ–¹å¼ã€‚<br>æ›´ç°¡å–®ä¾†èªªï¼Œä½¿ç”¨ HOC è¦åƒè£œä¸ä¸€æ¨£ï¼Œæ±è£œè¥¿è£œæŠŠå®ƒå›é‚„åŸæˆåŸæœ¬ Component æ‡‰æœ‰çš„æ±è¥¿ï¼Œåœ¨æœ‰äº›æ™‚å€™å¤šæ­¤ä¸€èˆ‰äº†ã€‚</p><ul><li>ä»¥æ–‡ç« çš„ <code>Row</code> ç‚ºä¾‹</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PropTypes</span> <span class="keyword">from</span> <span class="string">&#x27;prop-types&#x27;</span></span><br><span class="line"><span class="keyword">import</span> hoistStatics <span class="keyword">from</span> <span class="string">&#x27;hoist-non-react-statics&#x27;</span></span><br><span class="line"><span class="keyword">import</span> classnames <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./row.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getDisplayName</span> = (<span class="params">WrappedComponent</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">WrappedComponent</span>.<span class="property">displayName</span> || <span class="title class_">WrappedComponent</span>.<span class="property">name</span> || <span class="string">&#x27;Component&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">row</span> = (<span class="params">&#123; backgroundColor, className, style &#125;</span>) =&gt; <span class="function">(<span class="params">WrappedComponent</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ç”¢ç”Ÿåˆä½µçš„ Component</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">Row</span> = (<span class="params">&#123; wrappedComponentRef, ...otherProps &#125;</span>) =&gt; (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&#123;classnames(styles.row,</span> <span class="attr">className</span>)&#125; <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">backgroundColor</span>, <span class="attr">...style</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">WrappedComponent</span> <span class="attr">ref</span>=<span class="string">&#123;wrappedComponentRef&#125;</span> &#123;<span class="attr">...otherProps</span>&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. displayNameï¼Œå› ç‚ºç”± HOC åŒ…å‡ºä¾†çš„å…ƒä»¶é€šå¸¸ä¸å…·å</span></span><br><span class="line">  <span class="title class_">Row</span>.<span class="property">displayName</span> = <span class="string">`Row(<span class="subst">$&#123;getDisplayName(WrappedComponent)&#125;</span>)`</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. å®šç¾©å‹åˆ¥ : forward refs </span></span><br><span class="line">  <span class="title class_">Row</span>.<span class="property">propTypes</span> = &#123;</span><br><span class="line">    <span class="attr">wrappedComponentRef</span>: <span class="title class_">PropTypes</span>.<span class="property">func</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1. æŠŠ WrappedComponent éœæ…‹çš„æ–¹æ³•æå‡ä¸¦ç¹¼æ‰¿éä¾†</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">hoistStatics</span>(<span class="title class_">Row</span>, <span class="title class_">WrappedComponent</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> row</span><br></pre></td></tr></table></figure><p>HOC è®Šå¾—è¦éµå®ˆé¡å¤–è¨±å¤šè¦å‰‡ï¼Œå› ç‚ºæœ¬èº«çªç ´ React çš„åŸºç¤è¦å®šï¼Œå°è‡´è¦èŠ±å…¶ä»–çš„åŠŸèƒ½å¹«å¿™æŠŠ React çš„åŠŸèƒ½è£œå›å»ğŸ˜µğŸ˜µğŸ˜µã€‚</p><p>ä¸å¦‚ç›´æ¥ä½¿ç”¨ <code>&lt;Row&gt;</code> å…ƒä»¶åŒ…è£¹è£¡é¢çš„æ±è¥¿</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Somewhere</span> = (<span class="params"></span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;/* âœ… é‚è¼¯ç›´æ¥åœ¨é€™è£¡æ‹†é–‹ï¼Œä¸ç”¨åˆ»æ„åŒ…è£åˆ° HOCï¼Œç›´æ¥å°‘ä¸€å±¤çµæ§‹ */&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Row</span> <span class="attr">backgroundColor</span>=<span class="string">&quot;green&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">MyThing</span> <span class="attr">name</span>=<span class="string">&quot;hello&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Row</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>äº¦æˆ–è€…æ”¹æˆ render props :</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">MyThing</span> = (<span class="params">&#123; className, name, style &#125;</span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Row</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">backgroundColor</span>=<span class="string">&#x27;green&#x27;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">className</span>=<span class="string">&#123;className&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">style</span>=<span class="string">&#123;style&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &#123;/* <span class="attr">render</span> */&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">render</span>=<span class="string">&#123;(&#123;</span> <span class="attr">visible</span> &#125;) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">      if (!visible) &#123;</span></span><br><span class="line"><span class="language-xml">        return null</span></span><br><span class="line"><span class="language-xml">      &#125;</span></span><br><span class="line"><span class="language-xml">      return `Hello, $&#123;name&#125;!`</span></span><br><span class="line"><span class="language-xml">    &#125;&#125;</span></span><br><span class="line"><span class="language-xml">  /&gt;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>ä¸é <code>visible</code> åœ¨é‚£è£åˆ¤æ–· <code>null</code>ï¼Œæˆ‘æ„Ÿè¦ºä¸å¤ªå¥½ğŸ¤”ï¼Œæ‡‰è©²åœ¨ <code>Row</code> é‚„æ²’ return ä¹‹å‰å°±è¦ç›´æ¥è·³å‡ºäº†ï¼Œåœ¨è£¡é¢åˆ¤æ–·æœƒå°è‡´ <code>Mything</code> å·²ç¶“ <code>mount</code> åˆå¤šä¸€æ¬¡æ¸²æŸ“ <code>unmout</code> æ‰ã€‚</p><h2 id="å°çµ-7">å°çµ</h2><p>æˆ‘è¦ºå¾—é€™ç¯‡é‚„æœ‰æåˆ°ä¸€å€‹æœ‰è¶£çš„å•é¡Œï¼Œ<strong>React-redux <code>connect</code> ç‚ºä»€éº¼ä¸æ”¹ç‚º render props ?</strong>ï¼Œ å› ç‚º connect å…§éƒ¨é‚„æ˜¯ HOC ï¼Œå› æ­¤æœ‰äººç™¼èµ·è¨è«–å¸Œæœ›å¯ä»¥æ”¹æˆ render props ï¼Œç”¨ Component çš„æ–¹å¼åŒ…è£ï¼Œä½†æ˜¯è¢«é§å›äº†<sup id="fnref:4"><a href="#fn:4" rel="footnote">4</a></sup>ã€‚ä¸»è¦ç•¶æ™‚ Hooks çš„èˆˆèµ·ï¼Œåœ˜éšŠæ¯”è¼ƒå‚¾å‘æ”¹ç‚º Hooks ï¼Œå¦å¤–é—œéµçš„é»åœ¨æ–¼ render props ä¸æ˜¯ Pure çš„ï¼Œæœƒå°è‡´æ¯æ¬¡ re-render éƒ½ç”¢ç”Ÿæ–°çš„ <code>connect</code> ï¼Œé€ æˆæ•ˆèƒ½å•é¡Œï¼Œä¹‹å¾Œæœ‰æ™‚é–“å†æ…¢æ…¢ç ´è§£å…§éƒ¨çš„ funciton ã€‚</p><h2 id="ç¸½çµ-27">ç¸½çµ</h2><ol><li>å‚³å…¥çš„ props æ˜¯ä¸€å€‹ functionï¼Œä¸¦ä¸” render React Elementï¼Œç­‰åŒæ–¼ <code>props.children</code> ä½œç‚º function ä¸¦ä¸”å‚³å…¥ props  ç‚ºåƒæ•¸ã€‚</li><li>render props è¦è¬¹æ…ä½¿ç”¨ Pure Componentï¼Œå› ç‚º props æ”¾å…¥ function æ¯æ¬¡ re-render éƒ½æ˜¯æ–° function ï¼Œæœ¬èº«å°±ä¸ Pureã€‚</li><li>render props &gt; HOCsã€‚ React  composition Design Pattern çš„é¸æ“‡æ˜¯ <strong>Hooks &gt; render props &gt; Hocs</strong></li></ol><p>HOC èˆ‡ render props</p><ul><li><strong>HOC</strong> : ä¸€å€‹ function åŒ…ä½è¦æ“æœ‰åŠŸèƒ½çš„ Componentï¼Œä¸¦ä¸”ç”¢ç”Ÿæ–°çš„åŠ å¼·ç‰ˆ Componentã€‚</li><li><strong>render props</strong> : ä¸€å€‹ Component ç›´æ¥å°‡å…¶ä¸­ä¸€å€‹ props ä½œç‚º functionï¼Œä¸¦å¸¶ä¸Š props ä½œç‚ºåƒæ•¸çµ¦å…§éƒ¨ä½¿ç”¨ã€‚</li></ul><h2 id="è£œå……é–±è®€">è£œå……é–±è®€</h2><ol><li>React é—œæ–¼ Design Pattern çš„æ­·å²è£œå…… : <a href="https://segmentfault.com/a/1190000018811476?utm_source=sf-similar-article">ã€Reactæ·±å…¥ã€‘ä»Mixinåˆ°HOCå†åˆ°Hook - SegmentFault æ€å¦</a></li><li>ä¸€äº›é—œæ–¼ render props å¸¸è¦‹çš„å•é¡Œ : <a href="https://kentcdodds.com/blog/answers-to-common-questions-about-render-props#question-1-performance">Answers to common questions about render props</a></li></ol><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style:none; padding-left: 0;"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">1.</span><span style="display: inline-block; vertical-align: top;"><a href="https://github.com/remix-run/react-router/blob/v5.3.3/packages/react-router/modules/withRouter.js#L11">react-router/withRouter.js at v5.3.3 Â· remix-run/react-router Â· GitHub</a></span><a href="#fnref:1" rev="footnote"> â†©</a></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">2.</span><span style="display: inline-block; vertical-align: top;"><a href="https://gist.github.com/heygrady/f9bf3b6dd93fe3d87ba87430fd3c20d5">Avoiding HOC; Favoring render props Â· GitHub</a></span><a href="#fnref:2" rev="footnote"> â†©</a></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">3.</span><span style="display: inline-block; vertical-align: top;"><a href="https://zh-hant.reactjs.org/docs/higher-order-components.html#static-methods-must-be-copied-over">Higher-Order Components â€“ React</a></span><a href="#fnref:3" rev="footnote"> â†©</a></li><li id="fn:4"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">4.</span><span style="display: inline-block; vertical-align: top;"><a href="https://github.com/reduxjs/react-redux/issues/799">Render props version of connect Â· Issue #799 Â· reduxjs/react-redux Â· GitHub</a></span><a href="#fnref:4" rev="footnote"> â†©</a></li></ol></div></div>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ–‡ç« ä¾†è‡ª :&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://zh-hant.reactjs.org/docs/render-props.html&quot;&gt;Render Props â€“ React&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://gist.github.com/heygrady/f9bf3b6dd93fe3d87ba87430fd3c20d5&quot;&gt;Avoiding HOC; Favoring render props Â· GitHub&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;æ‘˜è¦-5&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;ä»€éº¼æ˜¯ render props&lt;/li&gt;
&lt;li&gt;render props çš„æ‡‰ç”¨ç¯„ä¾‹&lt;/li&gt;
&lt;li&gt;render props èˆ‡ HOC (higher order component) çš„å·®åˆ¥&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    <category term="Front-end" scheme="https://blog.rosa.tw/categories/Front-end/"/>
    
    <category term="React" scheme="https://blog.rosa.tw/categories/Front-end/React/"/>
    
    
    <category term="React" scheme="https://blog.rosa.tw/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>ç­†è¨˜ | React - Context API</title>
    <link href="https://blog.rosa.tw/2022/07/React/ContextAPI"/>
    <id>https://blog.rosa.tw/2022/07/React/ContextAPI</id>
    <published>2022-07-30T21:31:43.000Z</published>
    <updated>2022-07-31T10:17:44.968Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ–‡ç« ä¾†è‡ª :</p><ol><li><a href="https://www.taniarascia.com/using-context-api-in-react/">Using Context API in React (Hooks and Classes) | Tania Rascia</a></li><li><a href="https://reactjs.org/docs/context.html#gatsby-focus-wrapper">Context â€“ React</a></li></ol></blockquote><h2 id="æ‘˜è¦-3">æ‘˜è¦</h2><p>ä¸»è¦ä»¥ Class Component ç‚ºä¸»</p><ol><li>ä½¿ç”¨ Context çš„æ™‚æ©Ÿ</li><li>å¦‚ä½•ä½¿ç”¨ class Component çš„ ContextAPI</li><li>Context ç¼ºé»</li></ol><span id="more"></span><h2 id="ä»€éº¼æ™‚å€™ç”¨-Context">ä»€éº¼æ™‚å€™ç”¨ Context ?</h2><p>åœ¨ React ä¸­ï¼Œç•¶é€™å€‹å€¼æƒ³è¦å…±äº«çš„ç¯„åœå¾ˆå»£ï¼Œæ“´åŠå¤šå€‹ Component ï¼Œæ„å‘³è‘—è®Šæˆ <strong>global</strong> ï¼Œå¯ä»¥ä½¿ç”¨ Context ä¾†é¿å… props å‚³éè‡³å¤ªæ·±çš„åœ°æ–¹ (åˆç¨± <code>props drilling</code>)ã€‚</p><p>å¸¸è¦‹ä½¿ç”¨ Context ç¯„ä¾‹ :</p><ul><li>ä½¿ç”¨è€…ç™»å…¥çš„ç‹€æ…‹ã€è³‡æ–™ : å…ƒä»¶æ“ä½œä¹‹æ¬Šé™</li><li>ç¶²é ä¸»é¡Œ (theme) : ä¸åŒå…ƒä»¶éœ€è¦æ›´æ›é¡è‰²</li><li>åå¥½èªè¨€ : æ–‡å­—è³‡æ–™åˆ‡æ›</li></ul><h2 id="æˆ–è¨±ä¸ç”¨-Context">æˆ–è¨±ä¸ç”¨ Context</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœ€ä¸Šå±¤æ¥æ”¶ props å¾Œå¾€ä¸‹å‚³</span></span><br><span class="line">&lt;<span class="title class_">Page</span> user=&#123;user&#125; avatarSize=&#123;avatarSize&#125; /&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸­é–“å¹«å¿™å‚³éè€Œå·²</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">PageLayout</span> <span class="attr">user</span>=<span class="string">&#123;user&#125;</span> <span class="attr">avatarSize</span>=<span class="string">&#123;avatarSize&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">NavigationBar</span> <span class="attr">user</span>=<span class="string">&#123;user&#125;</span> <span class="attr">avatarSize</span>=<span class="string">&#123;avatarSize&#125;</span> /&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…§éƒ¨çµ‚æ–¼æ‹¿åˆ° props</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&#123;user.permalink&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">Avatar</span> <span class="attr">user</span>=<span class="string">&#123;user&#125;</span> <span class="attr">size</span>=<span class="string">&#123;avatarSize&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><code>user</code> è·Ÿ  <code>avatarSize</code> ä¸æ–·åœ°è¢«é‡è¤‡æåˆ°ã€‚<br>å¦‚æœåªæ˜¯é¿å…å‚³é props åˆ°æ¯ä¸€å±¤ï¼Œä½ æ‡‰è©²åšçš„æ˜¯ <strong>æå‡ºä¾†ä¸¦é‡æ§‹<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup></strong> (component composition)ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ Context ã€‚</p><h2 id="Context-createContext">Context.createContext</h2><p>å»ºç«‹ Contextï¼Œä¸»è¦æ˜¯å»ºç«‹ <code>Provider</code> èˆ‡ <code>Consumer</code></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MyContext</span> = <span class="title class_">React</span>.<span class="title function_">createContext</span>(defaultValue);</span><br></pre></td></tr></table></figure><p>defaultValue å¯ä»¥è¨­å®šé è¨­å€¼ï¼Œä¾‹å¦‚å°æ–¼ <strong>ä¸»é¡Œ</strong> ä¾†èªªï¼Œå¯ä»¥å…ˆé è¨­ <code>theme.dark</code></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> theme = &#123;</span><br><span class="line">   <span class="attr">light</span>: &#123;</span><br><span class="line">      background : <span class="string">&#x27;#fff&#x27;</span>;</span><br><span class="line">      text : <span class="string">&#x27;#000&#x27;</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">dark</span>:&#123;</span><br><span class="line">      background : <span class="string">&#x27;#000&#x27;</span>;</span><br><span class="line">      text : <span class="string">&#x27;#fff&#x27;</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ThemeContext</span> = <span class="title class_">React</span>.<span class="title function_">createContext</span>(theme.<span class="property">dark</span>);</span><br></pre></td></tr></table></figure><p>ä¸¦ä¸” <strong>defaultValue æ˜¯çµ¦æ²’æœ‰è¢« Provider åŒ…ä½ Component</strong>ï¼Œå° Consumer ä¸¦æ²’æœ‰å½±éŸ¿ã€‚</p><blockquote><p>Note: passing <strong>undefined</strong> as a Provider value does not cause consuming components to use defaultValue.<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup></p></blockquote><p>å¦‚æœæŠŠ Provider çš„ value è¨­æˆ <code>undefined</code>ï¼Œä¹Ÿä¸æœƒæ˜¯ defaultValue</p><p>ğŸ‘‰è©¦è‘—å¯¦ä½œ <a href="https://codepen.io/shan473/pen/XWEjrQy">React Context Provider value as undefined</a>ã€‚</p><h3 id="default-Value-çš„ç”¨æ„">default Value çš„ç”¨æ„</h3><p>é‚£æˆ‘å°±å¥½å¥‡äº†ï¼Œdefalut value çš„ç”¨æ„åœ¨å“ªè£¡ ?<br>æˆ‘æ‰¾åˆ°é€™ç¯‡</p><blockquote><p>This is helpful for testing components in isolation without wrapping them, or testing it with different values from the Provider.<sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup></p></blockquote><p>default value  æ˜¯ä¸åœ¨ Provider è£¡é¢çš„ componentï¼Œå¦‚æœè©¦åœ–ç”¨ Context æœƒæ‹¿åˆ° createContext defalutValue çš„å€¼ã€‚</p><p>ğŸ‘‰è©¦è‘—å¯¦ä½œ <a href="https://codepen.io/shan473/pen/LYdRYZV?editors=0010">React Context - out of Provider component get Context</a></p><p>å¥½è™•æ˜¯æé«˜æ¸¬è©¦æ€§ï¼Œå¯ä»¥ç¨ç«‹æ¸¬è©¦ componentã€‚</p><h2 id="Context-Provider">Context.Provider</h2><p>Context ç¿»è­¯æ˜¯ä¸Šä¸‹æ–‡ï¼Œä¸Šæœ‰ Provider ä¸‹æœ‰ Consumerã€‚<br>Provider å¯ä»¥å°‡æä¾› value çµ¦ Consumer ä½¿ç”¨ :</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Primative type</span></span><br><span class="line">&lt;<span class="title class_">Context</span>.<span class="property">Provider</span> value=&#123;<span class="string">&#x27;hello world&#x27;</span>&#125;&gt;</span><br><span class="line">   <span class="comment">//...</span></span><br><span class="line">&lt;/<span class="title class_">Context</span>.<span class="property">Provider</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Object type : æ³¨æ„ç‰©ä»¶å‹åˆ¥çš„å•é¡Œ</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Context.Provider</span> <span class="attr">value</span>=<span class="string">&#123;[1,2,3]&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">   //...</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">Context.Provider</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>æ¯ä¸€å€‹ Consumer éƒ½æœƒç›£è½ Provider value çš„è®ŠåŒ–ã€‚<br>ä¸€å€‹ Provider åº•ä¸‹å¯ä»¥æœ‰å¾ˆå¤šå€‹ Consumerï¼Œä¹Ÿå¯ä»¥è¢«åº•ä¸‹çš„å…¶ä»–çš„ Provider è¦†å¯«ã€‚</p><h3 id="render-çš„å•é¡Œ">render çš„å•é¡Œ</h3><blockquote><p>ç•¶ Provider çš„ value æ”¹è®Šæ™‚ï¼Œæ‰€æœ‰çš„ Consumer (åŒ…å«ä½¿ç”¨ contextType èˆ‡ useContext) éƒ½æœƒè¢«å¼·è¿« re-renderã€‚</p></blockquote><p>è®ŠåŒ–æ˜¯å‚³éåˆ°æ‰€æœ‰ Consumer å…ƒä»¶ï¼Œé€™ç¨®æ›´æ–°æ˜¯ä¸å— shouldComponentUpdate æ§åˆ¶ï¼Œå³ä½¿çˆ¶å±¤æ²’æœ‰è®ŠåŒ–ï¼Œé‚„æ˜¯æœƒè¢«è¿«æ›´æ–°ï¼Œ</p><p>æ±ºå®š value æ”¹è®Šçš„æ¯”è¼ƒæ–¹å¼æ˜¯ <code>Object.is</code>ã€‚</p><blockquote><p>[!NOTE] <strong><a href="http://Object.is">Object.is</a></strong> v.s === &amp; ==</p><ul><li><strong>==</strong> æœƒå¼·åˆ¶è½‰å‹ï¼Œundefinedã€null ç­‰ç­‰æœƒè¢«å¼·åˆ¶è½‰ç‚º falsy</li><li><strong>===</strong> æ¯” == å¤šæ¯”è¼ƒå‹åˆ¥ï¼Œä½†èˆ‡ <a href="http://Object.is">Object.is</a> ä¸åŒçš„æ˜¯</li></ul></blockquote><table><thead><tr><th>æ¯”è¼ƒç›¸åŒ</th><th style="text-align:center">Number.NaN &amp; NaN</th><th style="text-align:center">+0 &amp; -0</th></tr></thead><tbody><tr><td><a href="http://Object.is">Object.is</a></td><td style="text-align:center">true</td><td style="text-align:center">false</td></tr><tr><td>===</td><td style="text-align:center">false</td><td style="text-align:center">true</td></tr><tr><td>==</td><td style="text-align:center">false</td><td style="text-align:center">true</td></tr></tbody></table><p>å¦‚æœ value æ˜¯ Object type æœƒè®“åº•ä¸‹çš„å­å­«ä»£ component å¼·è¿« re-renderï¼Œç°¡å–®ä¾†èªª <code>&#123;&#125; !== &#123;&#125;</code> æˆ–æ˜¯ <code>[] !== []</code>ã€‚</p><h3 id="value-æ˜¯-Object-Type-çš„å•é¡Œ">value æ˜¯ Object Type çš„å•é¡Œ</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Context</span>.<span class="property">Provider</span> value=&#123;[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]&#125;&gt;</span><br><span class="line">   <span class="comment">//...</span></span><br><span class="line">&lt;/<span class="title class_">Context</span>.<span class="property">Provider</span>&gt;</span><br></pre></td></tr></table></figure><p>value å¦‚æœæ˜¯ç‰©ä»¶å‹åˆ¥ï¼Œæ¯æ¬¡ render éƒ½æœƒé‡æ–°å»ºç«‹ï¼Œå¦‚æœæ˜¯é »ç¹è®Šå‹•çš„ context ï¼Œå¯ä»¥æŠŠæ§åˆ¶æ¬Šäº¤çµ¦ React çš„ stateï¼Œ<strong>æå‡ state åˆ° parent component</strong>ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">      <span class="attr">value</span>: &#123;<span class="attr">something</span>: <span class="string">&#x27;something&#x27;</span>&#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">Context.Provider</span> <span class="attr">value</span>=<span class="string">&#123;this.state.value&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Toolbar</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Context.Provider</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Consumer">Consumer</h2><p>Consumer ä½¿ç”¨çš„ context æ˜¯åœ¨æ¨¹ç‹€ä¸­æœ€é„°è¿‘ Provider çš„ valueã€‚<br>class Component å»ºç«‹ Consumer æœ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">2</span></span></span></span> ç¨®æ–¹å¼ï¼Œä¸¦ä¸”ç”¨æ–¼ä¸åŒæƒ…å¢ƒ</p><ol><li><code>&lt;Context.Consumer&gt;</code> :<ul><li>åƒ…æœ‰ <code>render()</code> å¯ä»¥ä½¿ç”¨</li><li>å¯ä»¥åŒæ™‚ä½¿ç”¨å¤šå€‹ Context</li><li>å„ªåŒ– Context ï¼Œæ‹†åˆ†æˆå¥½å¹¾å€‹ Consumer</li></ul></li><li><code>contextType</code> :<ul><li>æ‰€æœ‰ç”Ÿå‘½é€±æœŸå…§å¯ä»¥ä½¿ç”¨ï¼Œä¸¦ä½¿ç”¨ <code>this.context</code> å–å¾—å€¼</li><li>åªèƒ½æ‡‰ç”¨ä¸€å€‹ context</li></ul></li></ol><p>åœ¨ Hooks ä¸­åªè¦ç”¨åˆ° <code>useContext</code> å°±å¯ä»¥æ‹¿åˆ° context valueã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> value = <span class="title function_">useContext</span>(<span class="title class_">MyContext</span>)</span><br></pre></td></tr></table></figure><h3 id="Class-contextType">Class.contextType</h3><p><strong>åœ¨ç”Ÿå‘½é€±æœŸå…§ä½¿ç”¨ context</strong>ï¼Œå¯ä»¥åœ¨ class å…§éƒ¨åŠ ä¸Š static çš„ contextTypeï¼Œæˆ–æ˜¯åœ¨å¤–éƒ¨åŠ ã€‚<br>ä½¿ç”¨æ™‚å¯ä»¥ç›´æ¥ç”¨ <code>this.context</code> å–å¾— value çš„å€¼ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">MyContext</span> <span class="keyword">from</span> <span class="string">&#x27;./MyContext&#x27;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> value = <span class="variable language_">this</span>.<span class="property">context</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">componentDidUpdate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> value = <span class="variable language_">this</span>.<span class="property">context</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">componentWillUnmount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> value = <span class="variable language_">this</span>.<span class="property">context</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> value = <span class="variable language_">this</span>.<span class="property">context</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åœ¨å¤–éƒ¨æŒ‡å®š</span></span><br><span class="line"><span class="title class_">MyClass</span>.<span class="property">contextType</span> = <span class="title class_">MyContext</span>;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ class ä¸­çš„ <code>static</code></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">   <span class="keyword">static</span> contextType = <span class="title class_">MyContext</span></span><br><span class="line">   <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">       <span class="keyword">let</span> value = <span class="variable language_">this</span>.<span class="property">context</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Context-Consumer">Context.Consumer</h3><p>æœ‰åˆ¥æ–¼ <code>this.context</code> çš„æ–¹å¼ï¼Œ<code>Context.Consumer</code> æ˜¯é€é <strong>props</strong> å–çš„ context çš„å€¼ï¼Œå°±åƒ functional component ä¸€æ¨£ï¼Œä½¿ç”¨ props ä¸¦ return React Nodeã€‚<br>é€™ç¨®æ–¹å¼æ˜¯ Render Props<sup id="fnref:4"><a href="#fn:4" rel="footnote">4</a></sup> çš„æŠ€å·§ï¼Œç­‰åŒæŠŠ React Element ç•¶ä½œ props ä¾†å‚³éã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">   <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="keyword">return</span>(</span><br><span class="line">         <span class="language-xml"><span class="tag">&lt;<span class="name">MyContext.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           &#123; props =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">                 return (</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                       &#123;props.value&#125;</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                 )</span></span><br><span class="line"><span class="language-xml">              &#125;   </span></span><br><span class="line"><span class="language-xml">           &#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">MyContext.Consumer</span>&gt;</span></span></span><br><span class="line">      )</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Context-displayName">Context.displayName</h2><p>æ›¿ context å–åˆ¥åï¼Œåœ¨ React çš„é–‹ç™¼å·¥å…·ä¹‹ä¸‹ï¼Œæœƒä½¿ç”¨ displayName çš„å€¼ä¾†é¡¯ç¤ºé€™å€‹ contextã€‚<br>æˆ‘æ¯”è¼ƒå¸¸çœ‹è¦‹åœ¨ UI å‡½å¼åº«çœ‹åˆ°é€™æ¨£çš„ç”¨æ³•ï¼Œä¾‹å¦‚ : <a href="https://github.com/react-bootstrap/react-bootstrap/blob/master/src/AccordionContext.ts">React-Boostrap - Accordion</a></p><p>ç¯„ä¾‹ :</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> context = <span class="title class_">React</span>.<span class="property">createContext</span>&lt;<span class="title class_">AccordionContextValue</span>&gt;(&#123;&#125;);</span><br><span class="line">context.<span class="property">displayName</span> = <span class="string">&#x27;AccordionContext&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> context;</span><br></pre></td></tr></table></figure><p>å¦‚æœåœ¨åŒä¸€å€‹ Component æœ‰å¤šå€‹ Provider ï¼Œåœ¨ DevTools åªæœƒå‡ºç¾ <code>Context.Provider</code><br><img data-src="https://i.imgur.com/TCVpxYH.png" alt="#small"><br>é‡è¤‡çš„ Context.Provider é€ æˆ Debug å›°é›£ï¼Œé€™æ™‚å€™å¯ä»¥ä½¿ç”¨ displayName å°‡ä¸åŒ context åˆ†é–‹ã€‚</p><h2 id="Multiple-Context">Multiple Context</h2><p>æœ€å¥½ä¸è¦æŠŠæ‰€æœ‰ç”¨åˆ°çš„å€¼éƒ½å¡é€²åŒä¸€å€‹ Contextï¼Œé€™å°±æœƒå°è‡´éç›¸é—œçš„ component å¼·åˆ¶æ›´æ–°ï¼Œå„ªåŒ–çš„æ–¹å¼å°±æ˜¯æ‹†æˆå¥½å¹¾å€‹ Provider èˆ‡ Consumer ï¼Œå°‡æ˜ç¢ºçš„ç•Œç·šåŠƒåˆ†å‡ºä¾†ã€‚</p><p>ç¯„ä¾‹ :  theme è·Ÿ user åˆ†é–‹æˆä¸åŒçš„ context</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Content</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ThemeContext.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;theme =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">UserContext.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;user =&gt; (</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">ProfilePage</span> <span class="attr">user</span>=<span class="string">&#123;user&#125;</span> <span class="attr">theme</span>=<span class="string">&#123;theme&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">          )&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">UserContext.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ThemeContext.Consumer</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Context-çš„å„ªç¼ºé»">Context çš„å„ªç¼ºé»</h2><ul><li>å„ªé»<ol><li>æ”¹å–„ props drilling çš„å•é¡Œï¼Œè·³é intermediate component ï¼ŒæŠŠå€¼ç›´æ¥çµ¦æƒ³è¦çš„ componentã€‚</li><li>åœ¨å°å‹çš„ APP ä¸­ï¼Œå¯ä»¥å¿«é€Ÿè§£æ±º global çš„å•é¡Œï¼Œä¸ç”¨ç”¨åˆ° React-Redux</li></ol></li><li>ç¼ºé»<ol><li>æ•ˆèƒ½ä¸Šçš„å•é¡Œï¼Œåªè¦ value ä¸­çš„å€¼æ›´æ–°ï¼Œå…¶åº•ä¸‹æ‰€æœ‰å¥—ä¸Š Consumer çš„å…ƒä»¶ä¹Ÿæœƒè¢«å¼·è¿«æ›´æ–°</li><li>ç•¶ APP æ“´å±•å…±äº«å€¼è¶Šå¤šæ™‚ï¼Œä½¿ç”¨ Context æœƒé€ æˆæ•ˆèƒ½ä¸Šçš„å•é¡Œã€‚</li><li>ä¸é©åˆç”¨ <strong>é »ç¹</strong> æ”¹è®Šçš„å€¼</li><li>è€¦åˆæ€§é«˜ï¼Œä¸å¥½åšæ¸¬è©¦</li></ol></li></ul><h2 id="å¦‚ä½•æ”¹å–„-Context-çš„æ•ˆèƒ½å•é¡Œ">å¦‚ä½•æ”¹å–„ Context çš„æ•ˆèƒ½å•é¡Œ</h2><p>Dan å¤§æä¾› <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">3</span></span></span></span>  ç¨®å„ªåŒ– Context çš„æ–¹å¼<sup id="fnref:5"><a href="#fn:5" rel="footnote">5</a></sup>ï¼Œä¸»è¦ä»¥ Hooks ç‚ºä¸»ã€‚</p><ol><li>åˆ†é–‹ä¸åŒçš„ Contextï¼Œè·Ÿä¸Šé¢ [[#Multiple Context | å¤šå€‹ Context]] æ˜¯ä¸€æ¨£çš„æ„æ€ï¼Œåªæœ‰ç”¨åˆ° theme å°±æ‹†æˆ themeContextï¼Œä¸è¦è·Ÿå…¶ä»– Context åŒ…åœ¨ä¸€èµ·ã€‚<strong>åˆ†é–‹ Context é€™æ˜¯æœ€å¥½çš„æ–¹å¼</strong></li><li><code>memo</code> ä½œç‚º component çš„ props è§€å¯Ÿéœ€è¦<strong>éœ€è¦è®ŠåŒ–çš„ value</strong>ã€‚<br>Button ä¸»è¦æ˜¯æ¥æ”¶ Context çš„å®¹å™¨ï¼Œå°‡ theme çµ¦åˆ†é›¢å‡ºä¾†ã€‚</li></ol> <figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params"></span>) &#123;</span><br><span class="line">   <span class="keyword">let</span> appContextValue = <span class="title function_">useContext</span>(<span class="title class_">AppContext</span>);</span><br><span class="line">   <span class="comment">// æŠŠ theme å¾ Context æå–å‡ºä¾†</span></span><br><span class="line">   <span class="keyword">let</span> theme = appContextValue.<span class="property">theme</span>;</span><br><span class="line">   <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">ThemedButton</span> <span class="attr">theme</span>=<span class="string">&#123;theme&#125;</span> /&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç•¶ theme æ²’æœ‰æ”¹è®Šçš„æ™‚å€™ï¼Œå°±ä¸æœƒ re-render</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ThemedButton</span> = <span class="title function_">memo</span>(<span class="function">(<span class="params">&#123; theme &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="comment">// å‰©ä¸‹çš„é‚è¼¯</span></span><br><span class="line">   <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">ExpensiveTree</span> <span class="attr">className</span>=<span class="string">&#123;theme&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ol start="3"><li><code>useMemo</code> : å¦‚æœå…¨éƒ¨å¡åœ¨åŒä¸€å€‹åœ°æ–¹ï¼Œé€™è£¡çš„ <code>useMemo</code> è¨˜ä½ React Elementï¼Œä¸¦ç›£è½ theme æ˜¯ä¸æ˜¯æœ‰æ”¹è®Šã€‚<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> appContextValue = <span class="title function_">useContext</span>(<span class="title class_">AppContext</span>);</span><br><span class="line">  <span class="keyword">let</span> theme = appContextValue.<span class="property">theme</span>; <span class="comment">// Your &quot;selector&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// The rest of your rendering logic</span></span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">ExpensiveTree</span> <span class="attr">className</span>=<span class="string">&#123;theme&#125;</span> /&gt;</span></span>;</span><br><span class="line">  &#125;, [theme])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p><code>memo</code> èˆ‡ <code>useMemo</code> éƒ½æ˜¯é¡å¤–äº¤çµ¦ React è™•ç†ï¼Œå› æ­¤æ•ˆèƒ½ä¸Šä¸ä¸€å®šä¿è­‰èƒ½å„ªåŒ–ï¼Œæ˜¯éœ€è¦å»æ¬Šè¡¡çš„ (React å°‡å„ªåŒ–æµç¨‹çš„æ–¹å¼ç¨±ä½œ <strong>bailout</strong>)ã€‚</p><h2 id="ç¸½çµ-20">ç¸½çµ</h2><ul><li>å»ºç«‹ Context ä½¿ç”¨ <code>createContext()</code></li><li>Context æä¾› <code>Provider</code> èˆ‡ <code>Consumer</code>ï¼ŒProvider çš„ <code>value</code> props å°±æ˜¯å‚³éä¸‹å»çš„å€¼ï¼›æ¥ä½å€¼ä½¿ç”¨ Consumer ã€‚</li><li>å¦‚æœ value æ˜¯ Object type ï¼Œæœ€å¥½æåˆ° Component ä¹‹å¤–å»ºç«‹ï¼Œæˆ–è€…åªç”¨ state ã€‚</li><li>ä¸ç›¸å¹²çš„ Context æœ€å¥½åˆ†é–‹ä¾†ï¼Œé¿å…é€ æˆæ•ˆèƒ½ä¸Šä¸å¿…è¦çš„ render</li></ul><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style:none; padding-left: 0;"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">1.</span><span style="display: inline-block; vertical-align: top;"><a href="https://reactjs.org/docs/composition-vs-inheritance.html#containment">Composition vs Inheritance â€“ React</a></span><a href="#fnref:1" rev="footnote"> â†©</a></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">2.</span><span style="display: inline-block; vertical-align: top;"><a href="https://reactjs.org/docs/context.html#reactcreatecontext">Context -  default Value â€“ React</a></span><a href="#fnref:2" rev="footnote"> â†©</a></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">3.</span><span style="display: inline-block; vertical-align: top;">default çš„ç”¨æ„ :  <a href="https://stackoverflow.com/questions/49949099/react-createcontext-point-of-defaultvalue">javascript - React.createContext point of defaultValue? - Stack Overflow</a></span><a href="#fnref:3" rev="footnote"> â†©</a></li><li id="fn:4"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">4.</span><span style="display: inline-block; vertical-align: top;">æŠŠ React Element ç•¶ä½œ props å‚³é<a href="https://reactjs.org/docs/render-props.html">Render Props â€“ React</a></span><a href="#fnref:4" rev="footnote"> â†©</a></li><li id="fn:5"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">5.</span><span style="display: inline-block; vertical-align: top;">Context é é˜² re-render : <a href="https://github.com/facebook/react/issues/15156#issuecomment-474590693">Preventing rerenders with React.memo and useContext hook. Â· Issue #15156 Â· facebook/react Â· GitHub</a></span><a href="#fnref:5" rev="footnote"> â†©</a></li></ol></div></div>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ–‡ç« ä¾†è‡ª :&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://www.taniarascia.com/using-context-api-in-react/&quot;&gt;Using Context API in React (Hooks and Classes) | Tania Rascia&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://reactjs.org/docs/context.html#gatsby-focus-wrapper&quot;&gt;Context â€“ React&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;æ‘˜è¦-3&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;p&gt;ä¸»è¦ä»¥ Class Component ç‚ºä¸»&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨ Context çš„æ™‚æ©Ÿ&lt;/li&gt;
&lt;li&gt;å¦‚ä½•ä½¿ç”¨ class Component çš„ ContextAPI&lt;/li&gt;
&lt;li&gt;Context ç¼ºé»&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    <category term="Front-end" scheme="https://blog.rosa.tw/categories/Front-end/"/>
    
    <category term="React" scheme="https://blog.rosa.tw/categories/Front-end/React/"/>
    
    
    <category term="React" scheme="https://blog.rosa.tw/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>ç­†è¨˜ | React - Higher Order Component (HOC)</title>
    <link href="https://blog.rosa.tw/2022/07/React/Higher-Order-Component"/>
    <id>https://blog.rosa.tw/2022/07/React/Higher-Order-Component</id>
    <published>2022-07-26T22:30:10.000Z</published>
    <updated>2022-07-31T10:19:43.042Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ–‡ç« ä¾†è‡ª :</p><ol><li><a href="https://zh-hant.reactjs.org/docs/higher-order-components.html">Higher-Order Components â€“ React</a></li></ol></blockquote><h2 id="æ‘˜è¦-4">æ‘˜è¦</h2><ol><li>äº†è§£ HOC çš„é‹ä½œåŸç†ï¼Œä»¥åŠæ„ç¾©</li><li>HOC çš„æ¶æ§‹èˆ‡å¯¦ä½œ</li><li>HOC æ‡‰ç”¨ä¸Šçš„æ³¨æ„äº‹é …</li></ol><span id="more"></span><h2 id="ä»€éº¼æ˜¯-Higher-Order-Component">ä»€éº¼æ˜¯ Higher Order Component  ?</h2><p>HOC æ˜¯ä¸€å€‹ functionï¼ŒæŠŠå¦ä¸€å€‹å…ƒä»¶çš„é‚è¼¯åŒ…èµ·ä¾†ï¼Œç”¢ç”Ÿæ–°çš„ <strong>åŠ å¼·ç‰ˆ</strong> å…ƒä»¶ï¼Œ ä½¿å…ƒä»¶å…§éƒ¨çš„é‚è¼¯å¯ä»¥é‡è¤‡ä½¿ç”¨ã€‚è€Œä¸”ä¸æœƒå‹•åˆ°åŸæœ¬ Component çš„çµæ§‹ï¼Œè€Œæ˜¯åŠ ä¸Š HOC å¸¶ä¾†çš„åŠŸèƒ½ã€‚</p><p>è¢«å…±ç”¨çš„é‚è¼¯æ˜¯å°è£åœ¨è£¡é¢ï¼Œå¤§éƒ¨åˆ†ç¬¬ä¸‰æ–¹ library éƒ½æ˜¯é€™éº¼ä½¿ç”¨ã€‚<br>ä¾‹å¦‚ : react-redux è£¡ <code>connect()</code> å°±æ˜¯ä¸€å€‹ HOCã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">NewComponent</span> = <span class="title function_">connect</span>(<span class="title class_">StoreProp</span>,<span class="title class_">StateProps</span>)(<span class="title class_">Component</span>);</span><br></pre></td></tr></table></figure><blockquote><p>HOC çš„é‡é»æ˜¯æ¸›å°‘é¡ä¼¼åŠŸèƒ½å…ƒä»¶çš„ <strong>é‡è¤‡é‚è¼¯</strong>ï¼Œæé«˜å…ƒä»¶çš„é‡ç”¨æ€§ (reusable)ã€‚</p></blockquote><p>èˆ‰å€‹å¯¦éš›ä¾‹å­ï¼Œtodolist å…·æœ‰ toggle åŠŸèƒ½ï¼Œä¹Ÿå¾ˆå¤šå€‹ button ä¹Ÿæœ‰ (åˆ‡æ›èƒŒæ™¯é¡è‰²å•¦ç­‰ç­‰)ï¼Œå…©è€…å…·æœ‰ <code>open State</code> ä¸¦ä¸” <code>setOpen</code> åªè² è²¬åˆ‡æ› true &amp; false ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€™ä¸€æ®µé‚è¼¯ä¸æ–·çš„é‡è¤‡æ’°å¯«ï¼ŒæŠŠå®ƒæå‡ºä¾† åšæˆ withToggleï¼ŒæŠŠ toggle åŠŸèƒ½å°è£</span></span><br><span class="line"><span class="keyword">const</span> [open,setOpen] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleToggle</span> = (<span class="params"></span>)=&gt;&#123;</span><br><span class="line"><span class="title function_">setOpen</span>(<span class="function">(<span class="params">prevOpen</span>)=&gt;</span> !prevOpen)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>toggle é€™å€‹é‚è¼¯è¦è¢«æŠ½æˆå¯é‡è¤‡æ€§çš„é‚è¼¯ï¼Œæ‰€ä»¥ HOC å¯ä»¥æ˜¯ä¸€å€‹å« <code>withtoggle(&lt;Component/&gt;)</code>ï¼Œåˆç¨±å…·æœ‰ toggle åŠŸèƒ½, çš„ Componentã€‚</p><h2 id="HOC-çš„æ¶æ§‹">HOC  çš„æ¶æ§‹</h2><p>æœ€åŸºæœ¬çš„æ¶æ§‹æ˜¯åŒ…è£¹è‘—å¦ä¸€å€‹ Componentï¼Œå›å‚³çš„æ˜¯ä¸€å€‹æ–°çš„ Componentã€‚å…¶ä»–åƒæ•¸å¯ä»¥è‡ªè¨‚ï¼Œä¹Ÿå¯ä»¥å‚³å…¥æƒ³è¦å…±åŒä½¿ç”¨ dataã€‚</p><blockquote><p>HOC æ˜¯ä¸€å€‹ pure function (same input ,same output)ï¼Œä¸å…·æœ‰å‰¯ä½œç”¨ (side effects)</p></blockquote><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">NewComponent</span> = <span class="title function_">higherFunction</span>(<span class="title class_">WrappedComponent</span>);</span><br></pre></td></tr></table></figure><p>HOC <strong>ä¸æ˜¯ç”¨ç¹¼æ‰¿çš„æ–¹å¼</strong> ä¾†ç”¢ç”Ÿæ–°çš„ Component ï¼Œè€Œæ˜¯ <strong>composed</strong> (é‡çµ„)ã€‚<br>å¯ä»¥çœ‹æ˜¯ä¸€å€‹æ–°å®¹å™¨ (Container)ã€‚å…¶åƒæ•¸æ˜¯ä¸é™çš„ï¼Œå¦å¤– HOC ä¸ç®¡è³‡æ–™çš„ä¾†æºå‡ºè™•ï¼Œå®ƒåªæ˜¯è² è²¬é–‹ä¸€å€‹é€šé“ï¼Œè®“è¢«åŒ…ä½çš„ Component çœå»åšé‡è¤‡å‹•ä½œã€‚</p><p>functional Component</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">EnhancedComponent</span> = (<span class="params">WrappedComponent</span>) =&gt;&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">props</span>)&#123;</span><br><span class="line"><span class="comment">// è¨˜å¾—æŠŠ props é‚„å›å»</span></span><br><span class="line"><span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">WrappedComponent</span> &#123;<span class="attr">...props</span>&#125;/&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>class Component</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">EnhancedComponent</span> = (<span class="params">WrappedComponent</span>) =&gt;&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">class</span> <span class="title class_">extends</span> <span class="title class_">React</span>.<span class="property">Component</span>&#123;</span><br><span class="line"><span class="keyword">return</span>()&#123;</span><br><span class="line"><span class="comment">// ä¸€æ¨£è¦æŠŠ props é‚„å›å»</span></span><br><span class="line"><span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">WrappedComponent</span> &#123;<span class="attr">...props</span>&#125;/&gt;</span></span></span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€™è£¡çš„ <code>&#123;...props&#125;</code> æ˜¯ <code>&lt;NewComponent&gt;</code> å‚³å…¥çš„ propsã€‚</p><p>ä¾‹ : <code>&lt;WithToggleCompoent index=&quot;1&quot;/&gt;</code> åƒæ˜¯ index é€™å€‹ propsï¼Œåœ¨ä¸å½±éŸ¿åŸæœ¬ <code>&lt;WrappedComponent/&gt;</code>æƒ…æ³ä¸‹æŠŠ <code>props</code> éƒ½å¡å›å»ã€‚å¦‚æœæ²’æœ‰ <code>&#123;...props&#125;</code> é€™æ­¥é©Ÿï¼Œå°±ä¸æœƒæ¥æ”¶åˆ° HOC åŒ…è£¹çš„æ•ˆæœã€‚</p><h2 id="æ©«åˆ‡é—œæ³¨é»-Cross-cutting-concern">æ©«åˆ‡é—œæ³¨é» (Cross-cutting concern)</h2><p>é‚è¼¯æ˜¯é€é HOC æ”œå¸¶çš„ï¼Œä¸¦ä¸æ˜¯ç¡¬ç”Ÿç”ŸåµŒå…¥åœ¨æŸå…ƒä»¶çš„ç¨‹å¼ç¢¼ä¸­ï¼Œæœ‰åŠ©æ–¼ <strong>æ©«åˆ‡é—œæ³¨é»</strong>ã€‚</p><p>ç¯„ä¾‹æƒ…å¢ƒ :</p><ol><li>æœ‰ä¸€ a å…ƒä»¶éœ€è¦é™„å¸¶ A åŠŸèƒ½ï¼ŒåŠŸèƒ½ A è¢«é–‹ç™¼ï¼Œç”±æ–¼ç›®å‰åªæœ‰ a å…ƒä»¶éœ€è¦ï¼Œç›´æ¥å°‡é‚è¼¯å¯«æ­»åœ¨ a å…ƒä»¶ä¸Šã€‚</li><li>æŸä¸€å¤© a å…ƒä»¶éœ€è¦è¢«æ›´æ–°æ”¹æˆ b å…ƒä»¶ï¼Œå…¶ä¸­ A åŠŸèƒ½éœ€è¦è¢«ä¿ç•™ï¼Œå…¶é¤˜éƒ½ä¸è¦ï¼Œé€™æ™‚å€™éœ€è¦æŒ–å‡º A åŠŸèƒ½çš„ä»£ç¢¼ä¸¦é€²è¡Œé‡æ§‹ã€‚</li><li>é‚£å¦‚æœæŸå¤© b å…ƒä»¶åˆä¸è¦ A åŠŸèƒ½å‘¢ ?</li></ol><blockquote><p>å°è‡´å…ƒä»¶çš„ä»£ç¢¼å°±æœƒä¸€ç›´è¢«é‡æ§‹ğŸ˜µï¼Œæ˜¯å¾ˆç³Ÿçš„è¡Œç‚º</p></blockquote><p>æ©«åˆ‡é—œæ³¨é»çš„æ¦‚å¿µä½¿å¾— A åŠŸèƒ½è¢«æŠ½å–å‡ºä¾†ï¼Œä¸¦æ¡ç”¨ <strong>æ·»åŠ </strong> çš„æ–¹å¼åŠ åˆ°éœ€è¦çš„å…ƒä»¶èº«ä¸Šã€‚é‚è¼¯è¢«åˆ†é–‹çš„ç‹€æ³ï¼Œå¦‚æœçªç„¶ä¸æƒ³è¦ A åŠŸèƒ½éš¨æ™‚éƒ½æŠ½å–æ‰ï¼ŒåŸæœ¬çš„å…ƒä»¶ä¹Ÿä¸æœƒè¢«å—å½±éŸ¿ã€‚</p><p>HOC ä¹‹æ‰€ä»¥èªªæ˜¯åŠ å¼·ç‰ˆçš„å…ƒä»¶ï¼Œå®ƒè¿½åŠ æ–°çš„åŠŸèƒ½åœ¨åŸæœ¬çš„å…ƒä»¶ä¸Šï¼Œä½†ä¹Ÿä¸å½±éŸ¿åŸæœ¬çš„å…ƒä»¶ã€‚</p><h2 id="å¯¦ä½œç·´ç¿’">å¯¦ä½œç·´ç¿’</h2><p>codepen ğŸ‘‰ <a href="https://codepen.io/shan473/pen/WNzjdmJ">React - HOC practice</a></p><p>å‡¡æ˜¯æœ‰æ“ä½œé–‹é–‹é—œé—œçš„ Component ï¼ŒåŒ…æˆ <code>withToggle</code> çš„ HOCï¼ŒæŠŠåŒæ¨£çš„ <strong>é–‹é—œé‚è¼¯</strong> æŠ½å‡ºä¾†ã€‚ä»¥ W3school çš„ <a href="https://www.w3schools.com/howto/howto_js_sidenav.asp">Navbar</a> èˆ‡ <a href="https://www.w3schools.com/howto/howto_js_accordion.asp">Accordion</a> ç‚ºä¾‹ã€‚</p><h3 id="HOC-withToggle">HOC withToggle</h3><ul><li>å»ºç«‹ä¸€å€‹ HOC - <code>withToggle</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">withToggle</span> = (<span class="params">Component</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">props</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> [open,setOpen] =<span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">togglehandler</span> = (<span class="params"></span>)=&gt; &#123;<span class="title function_">setOpen</span>(<span class="function"><span class="params">prevOpen</span> =&gt;</span> !prevOpen)&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">Component</span> <span class="attr">open</span>=<span class="string">&#123;open&#125;</span> <span class="attr">togglehandler</span>=<span class="string">&#123;togglehandler&#125;</span> &#123;<span class="attr">...props</span>&#125;/&gt;</span></span> </span><br><span class="line">    )</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ </span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AccordionWithToggle</span> =  <span class="title function_">withToggle</span>(<span class="title class_">Accordion</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">NavbarWithToggle</span> = <span class="title function_">withToggle</span>(<span class="title class_">Navbar</span>);</span><br></pre></td></tr></table></figure><p>ä¸»è¦å‚³å…¥çš„ props æ˜¯ <code>open</code> çš„ state ï¼Œèˆ‡ <code>togglehandler</code> é€™å€‹ method</p><h3 id="Accordion">Accordion</h3><p>åŸºæœ¬çš„ Accordion (æ‰‹é¢¨ç´)ï¼Œæ‰‹é¢¨ç´æœ€é‡è¦çš„å°±æ˜¯æ”¹è®Š <code>maxheight</code> è®“å…§å®¹ä¼¸ç¸®ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Accordion</span>(<span class="params">&#123;open,togglehandler,index&#125;</span>)&#123;</span><br><span class="line"><span class="comment">// 1. å…§å®¹çš„é«˜åº¦è³‡æ–™</span></span><br><span class="line"> <span class="keyword">const</span> [panelheight,setPanelHeight] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line"> <span class="comment">/* </span></span><br><span class="line"><span class="comment"> 2. ä½¿ç”¨ callback refï¼Œé€é ref æ‹¿åˆ° DOM å…§å®¹çš„é«˜åº¦ï¼Œä¸¦æ ¹æ“š é–‹é—œ open ä¾†æ±ºå®šé«˜åº¦</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">  <span class="keyword">const</span> panelref = <span class="title class_">React</span>.<span class="title function_">useCallback</span>(<span class="function">(<span class="params">node</span>)=&gt;</span>&#123;</span><br><span class="line">     <span class="keyword">if</span>(node!==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!open)&#123;</span><br><span class="line">          <span class="title function_">setPanelHeight</span>(node.<span class="property">scrollHeight</span>)</span><br><span class="line">       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">         <span class="title function_">setPanelHeight</span>(<span class="number">0</span>)</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;,[open])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml">  &#123;/* 3. å¡«å…¥ HOC å‚³å…¥çš„ togglehandler */&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;accordion&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;togglehandler&#125;</span>&gt;</span>Section &#123;index+1&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">&#123;/* 4. æ”¹è®Š maxHeight */&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;panel&quot;</span> <span class="attr">ref</span>=<span class="string">&#123;panelref&#125;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">maxHeight:</span> <span class="attr">panelheight</span>+&#x27;<span class="attr">px</span>&#x27;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Navbar-fullwidth">Navbar fullwidth</h3><p>é‡é»æ˜¯æ”¹è®Š <code>width</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Navbar</span>(<span class="params">&#123;open,togglehandler,type&#125;</span>)&#123;</span><br><span class="line"><span class="comment">// 1. width çš„ state </span></span><br><span class="line">  <span class="keyword">const</span> [width,setWidth] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 2. ç›£è½ open çš„è®ŠåŒ–</span></span><br><span class="line">  <span class="title class_">React</span>.<span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(open)&#123;</span><br><span class="line">      <span class="title function_">setWidth</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="title function_">setWidth</span>(<span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,[open])</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">   &#123;/* 3. æ”¹è®Š width */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;sidenav&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">width</span> <span class="attr">:</span> <span class="attr">width</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> <span class="attr">className</span>=<span class="string">&quot;closebtn&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;togglehandler&#125;</span>&gt;</span><span class="symbol">&amp;times;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>About<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Services<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Clients<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Contact<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* 4. å¡«å…¥ HOC å‚³å…¥çš„ togglehandler */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;togglehandler&#125;</span>&gt;</span>open<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•ˆæœ">æ•ˆæœ</h3><p><img data-src="https://i.imgur.com/6tr37Nj.gif" alt=""><br>å¦‚æ­¤ä¸€ä¾†æˆ‘å€‘åªè¦å¹«å…ƒä»¶åŒ…ä¸Š <code>withToggle</code> éƒ½å¯ä»¥æ“æœ‰é–‹é–‹é—œé—œçš„åŠŸèƒ½ã€‚<br>çœ‹åˆ° w3school çš„ Navbar ç¯„ä¾‹æœ‰å¾ˆå¤šæ¬¾ï¼Œæˆ‘æ±ºå®šå†ä¾†å¯¦ä½œå¯ä»¥ä¾ç…§ä¸åŒé¡å‹ç”¢ç”Ÿå®¢è£½åŒ–çš„ NavbarğŸ˜ã€‚</p><h3 id="å†åŒ…è£-Navbar-withNavbarType">å†åŒ…è£ Navbar : withNavbarType</h3><p>ä¸åŒçš„ type ï¼Œ width ä¸ä¸€æ¨£ã€‚ä¸€é–‹å§‹æ–°å¢ type çš„åƒæ•¸ä¾†é”æˆæ•ˆæœã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ©ç”¨ Object bracket notation çš„ç‰¹æ€§ï¼Œå¸¶å­—ä¸²ç•¶ç´¢å¼•</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Navtype</span> = &#123;</span><br><span class="line">  <span class="title class_">Full</span> : <span class="string">&#x27;100%&#x27;</span>,</span><br><span class="line">  <span class="title class_">Overlay</span>: <span class="string">&#x27;250px&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">withNavbarType</span> =(<span class="params">CoreComponent,type</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">props</span>)=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">CoreComponent</span> <span class="attr">type</span>=<span class="string">&#123;Navtype[type]&#125;</span> &#123;<span class="attr">...props</span>&#125;/&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">FullNavbar</span> = <span class="title function_">withNavbarType</span>(<span class="title function_">withToggle</span>(<span class="title class_">Navbar</span>,<span class="string">&#x27;Full&#x27;</span>))</span><br></pre></td></tr></table></figure><p>ä½†åˆè¦ºå¾—é€™æ¨£å¾ˆä¸å„ªé›…ğŸ˜µï¼Œæƒ³è®Šæˆ <code>const FullNavbar = customNavbar(type)</code> ï¼Œè®“æ¯æ¬¡è¼¸å…¥éƒ½åªå‰©ä¸€å€‹åƒæ•¸ (æŸ¯é‡ŒåŒ–)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Navtype</span> = &#123;</span><br><span class="line">  <span class="title class_">Full</span> : <span class="string">&#x27;100%&#x27;</span>,</span><br><span class="line">  <span class="title class_">Overlay</span>: <span class="string">&#x27;250px&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. è®“ type æˆç‚ºæœ€å¾Œä¸€å€‹åƒæ•¸ï¼Œåªè¦æ·»å…¥å°æ‡‰å­—ä¸²å°±å¥½</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">withNavbarType</span> =(<span class="params">CoreComponent</span>)=&gt; <span class="function">(<span class="params">type</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">props</span>)=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">CoreComponent</span> <span class="attr">type</span>=<span class="string">&#123;Navtype[type]&#125;</span> &#123;<span class="attr">...props</span>&#125;/&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 2. æŠŠåŸæœ¬çš„åŠŸèƒ½åŠ ä¸€åŠ ï¼Œè®Šæˆ å®¢è£½åŒ–çš„ Navbar</span></span><br><span class="line"><span class="keyword">const</span> customNavbar = <span class="title function_">withNavbarType</span>(<span class="title function_">withToggle</span>(<span class="title class_">Navbar</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. å¸¶å…¥æƒ³è¦çš„ style string å°±å¯ä»¥ç”¢ç”Ÿå°æ‡‰çš„ Navbar</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">FullNavbar</span> = <span class="title function_">customNavbar</span>(<span class="string">&#x27;Full&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">OverlayNavbar</span> = <span class="title function_">customNavbar</span>(<span class="string">&#x27;Overlay&#x27;</span>)</span><br></pre></td></tr></table></figure><p>æ¥è‘—ä¿®æ”¹ <code>&lt;Navbar/&gt;</code> çš„å…¶ä¸­ä¸€å€‹éƒ¨ä»½</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">React</span>.<span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(open)&#123;</span><br><span class="line"><span class="comment">// æ”¹æˆæŒ‰ç…§ prop å‚³å…¥çš„ type æ”¹è®Š width</span></span><br><span class="line"><span class="title function_">setWidth</span>(type)</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="title function_">setWidth</span>(<span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;,[open])</span><br></pre></td></tr></table></figure><p>æ­å•¦ ! å°±å¯ä»¥æ“æœ‰ä¸åŒçš„å®¢è£½åŒ– Navbarã€‚<br><img data-src="https://i.imgur.com/Hq7kYZg.gif" alt=""><br>å¥½è™•æ˜¯ <strong>ä¸ç”¨åœ¨åŸæœ¬çš„ Navbar å…ƒä»¶å…§åˆ¤æ–· type æ˜¯ä»€éº¼æ‰åšä¸åŒçš„ width è®ŠåŒ–</strong> ï¼Œåªè¦å°ˆæ³¨åœ¨ Navbar çš„åŠŸèƒ½å°±å¥½ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ æˆ‘è¦ºå¾—ä¸æ˜¯å¾ˆå¥½çš„ pattern</span></span><br><span class="line"><span class="title class_">React</span>.<span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line"><span class="comment">// ğŸ˜µ å¦‚æœæ²’æœ‰æŠ½å‡ºä¾†ï¼Œåœ¨å…ƒä»¶è£¡é¢åˆ¤æ–·</span></span><br><span class="line"><span class="keyword">let</span> finallywitdh;</span><br><span class="line"><span class="keyword">switch</span>(type)&#123;</span><br><span class="line"> <span class="keyword">case</span> <span class="string">&#x27;Full&#x27;</span>:</span><br><span class="line"> finallywitdh = <span class="string">&#x27;100%&#x27;</span></span><br><span class="line"> <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;Overlay&#x27;</span>:</span><br><span class="line">finallywitdh = <span class="string">&#x27;250px&#x27;</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(open)&#123;</span><br><span class="line"><span class="title function_">setWidth</span>(finallywitdh)</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="title function_">setWidth</span>(<span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;,[open])</span><br></pre></td></tr></table></figure><p>åœ¨é€™å€‹ Navbar ä¾‹å­ä¸­ï¼Œæˆ‘ä½¿ç”¨ HOC åœ¨åŒ…è£¹è‘—å¦ä¸€å€‹ HOCï¼Œè®“å…ƒä»¶å¯ä»¥å¾€ä¸Šè¿½åŠ æƒ³è¦çš„è³‡æ–™æˆ–åŠŸèƒ½ã€‚</p><h2 id="æ…£ä¾‹-ä½¿ç”¨-HOC-å‚³éä¸ç›¸é—œçš„-props">æ…£ä¾‹ : ä½¿ç”¨ HOC å‚³éä¸ç›¸é—œçš„ props</h2><p>æ…£ä¾‹æ˜¯ React å®˜æ–¹å»ºè­°çš„æ“ä½œç¿’æ…£ã€‚<br><a href="https://zh-hant.reactjs.org/docs/higher-order-components.html#convention-pass-unrelated-props-through-to-the-wrapped-component">ğŸ”—ç« ç¯€é€£çµ</a></p><p>æœ‰äº› props å‚³é€²ä¾†å¯èƒ½æ˜¯ <strong>ä½œç‚ºé‹ç®—ä½¿ç”¨</strong>ï¼Œå‚³å…¥çš„ props ä¸¦éå…¨éƒ¨éƒ½è¦å‚³é€² <code>&lt;WrappedComponent/&gt;</code> è€Œæ˜¯ç¶“éä¸€äº›é‹ç®—å¾Œç•™ä¸‹ <code>&lt;WrappedComponent/&gt;</code> éœ€è¦çš„ã€‚</p><p>é€šå¸¸æœƒå‚³çµ¦ <code>&lt;WrappedComponent/&gt;</code> çš„ props é€šå¸¸æ˜¯ state æˆ–æ˜¯åœ¨ HOC å®šç¾©çš„ methodã€‚</p><blockquote><p>é‡é»åœ¨æ–¼ <strong>åªé—œæ³¨æƒ³è¦çš„è³‡æ–™</strong>ï¼Œå¯ä»¥åœ¨ HOC å‚³å…¥ä¸ç›¸é—œçš„æ²’é—œä¿‚ï¼ŒHOC çš„ props å‚³è‡³ <code>&lt;WrappedComponent/&gt;</code> ä¹‹å‰å¯ä»¥ç¯©é¸å‡ºå“ªäº› props è¦ç¹¼çºŒå‚³ä¸‹å»ã€‚</p></blockquote><p>é€™æ¨£çš„å¥½è™•æ˜¯è®“ HOC æ›´åŠ å½ˆæ€§åŒ–ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">/* </span></span><br><span class="line"><span class="comment">  props å‚³é€²ä¾†çš„ä¸ä¸€å®šè·Ÿ WrappedComponent æœ‰ç›´æ¥é—œä¿‚ï¼ŒHOC æ˜¯ä¸€å€‹å®¹å™¨ï¼Œå°‡é—œæ³¨æ–¼æƒ³è¦çš„è³‡æ–™å‚³çµ¦ WrappedComponent</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">const</span> &#123; extraProp, ...passThroughProps &#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* </span></span><br><span class="line"><span class="comment">  ç‰¹åˆ¥æå‡ºè¦è¢«å‚³å…¥çš„ propsï¼Œé€šå¸¸æ˜¯ state æˆ–æ˜¯ methods </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">const</span> injectedProp = someStateOrInstanceMethod;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç”¨ props å‚³çµ¦ WrappedComponent</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">WrappedComponent</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">injectedProp</span>=<span class="string">&#123;injectedProp&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &#123;<span class="attr">...passThroughProps</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥å®˜æ–¹çš„ä¾‹å­ä¾†èªªï¼ŒHOC åŒ…å«è³‡æ–™ï¼Œä½†æ˜¯è³‡æ–™åœ¨ A å…ƒä»¶ä¸­åªè¦ a éƒ¨åˆ†ï¼ŒB å…ƒä»¶ä¸­åªè¦ b éƒ¨åˆ†ï¼Œä½†ä»–å€‘çš„ <strong>ä¾†æºéƒ½æ˜¯åŒä¸€å€‹è³‡æ–™</strong>ã€‚</p><p>é€™æ™‚å€™å¯ä»¥é€éå‚³å…¥çš„ prop æ‹¿å‡ºä¸åŒçš„è³‡æ–™ï¼Œå‚³é€² <code>&lt;WrappedComponent/&gt;</code>ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">withData</span> = (<span class="params">Component,data</span>)=&gt;&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="function">(<span class="params">props</span>)=&gt;</span>&#123;</span><br><span class="line"><span class="comment">// 1. ä¸åŒçš„ props æŠ½å‡ºä¾†</span></span><br><span class="line"><span class="keyword">const</span> &#123;dataType,...restprops&#125; = props</span><br><span class="line"><span class="comment">// 2. æŒ‰ç…§ type å†ä¾†å–å‡ºä¸åŒçš„ data</span></span><br><span class="line"><span class="keyword">const</span> needData = data.<span class="title function_">filter</span>( <span class="function"><span class="params">x</span> =&gt;</span> x === dataType)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Component</span> <span class="attr">data</span>=<span class="string">&#123;needData&#125;</span> &#123;<span class="attr">...restprops</span>&#125;/&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€é–‹å§‹æˆ‘æœ‰é»çœ‹ä¸æ‡‚é€™å€‹ä¾‹å­ï¼Œæƒ³ä¸åˆ°æ‡‰ç”¨çš„ä¾‹å­ã€‚åŸæœ¬åªçŸ¥é“å¯ä»¥ <strong>åŠ åŠŸèƒ½</strong>ï¼Œä½†æ²’æœ‰æƒ³éé¡ä¼¼åˆ†é¡ç¯©çš„æ¦‚å¿µï¼Œç¶“éå¹¾æ¬¡çš„å¯¦ä½œçªç„¶å°±æ‚Ÿäº†ğŸ˜‚ã€‚</p><h2 id="æ…£ä¾‹-æœ€å¤§åŒ–çš„å¯çµ„åˆæ€§-Maximizing-Composability">æ…£ä¾‹ : æœ€å¤§åŒ–çš„å¯çµ„åˆæ€§ (Maximizing Composability)</h2><p>HOC çš„å¯«æ³•å¯ä»¥åªå›å‚³ä¸€å€‹åƒæ•¸ï¼Œä¹Ÿå¯ä»¥å›å‚³å¥½å¹¾å€‹åƒæ•¸ã€‚HOC ä¸¦æ²’æœ‰ç‰¹åˆ¥é™åˆ¶å‚³éçš„åƒæ•¸é‡ï¼Œä½†æ˜¯é‚£é¡¯å¾—å¾ˆå†—é•·ï¼Œç›¡å¯èƒ½è®“ HOC åªæ¥æ”¶ä¸€å€‹åƒæ•¸ã€‚</p><p>åƒ React-reduxï¼Œä½¿ç”¨ <code>connect()()</code> é€™æ¨£å‘ˆç¾</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">ConnectedComment</span> = <span class="title function_">connect</span>(commentSelector, commentActions)(<span class="title class_">CommentList</span>);</span><br></pre></td></tr></table></figure><p>æŠŠä¸Šé¢çš„åˆ†é–‹è§£æ :</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// connect æ˜¯ä¸€å€‹ function ï¼ŒåŠŸèƒ½æ˜¯å›å‚³å¦ä¸€å€‹ function</span></span><br><span class="line"><span class="keyword">const</span> enhance = <span class="title function_">connect</span>(commentListSelector, commentListActions);</span><br><span class="line"><span class="comment">// å›å‚³çš„æ˜¯ä¸€å€‹ HOCï¼Œæ˜¯è·Ÿ Redux store é€£çµçš„ Component</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ConnectedComment</span> = <span class="title function_">enhance</span>(<span class="title class_">CommentList</span>);</span><br></pre></td></tr></table></figure><blockquote><p>ç°¡å–®ä¾†èªª : HOC åŒ…ä½å¦ä¸€å€‹ HOC</p></blockquote><p>å¦‚æœ HOC æ•¸é‡ä¸€å¤šï¼Œå¯«èµ·ä¾†å°±æœƒè®Šå¾—å¾ˆå†—é•·ï¼Œé€™æ™‚å€™å¯ä»¥é‹ç”¨ compose (çµ„åˆ) çš„æ¦‚å¿µ</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ğŸ˜µ ä¸æ‡‰è©²ä¸€å±¤åŒ…ä¸€å±¤</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">EnhancedComponent</span> = <span class="title function_">withRouter</span>(<span class="title function_">connect</span>(commentSelector)(<span class="title class_">WrappedComponent</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯ä»¥é‹ç”¨ä¸€å€‹ function å°‡å‚³å…¥çš„ HOC æ‰“åŒ…æˆæ†ï¼Œcompose æ˜¯åˆ¥è™•åœ°å®šç¾©çµ„åˆ function çš„æ–¹æ³•</span></span><br><span class="line"><span class="keyword">const</span> enhance = <span class="title function_">compose</span>(</span><br><span class="line">  <span class="comment">// é€™é‚Šçš„ HOC åªæ¥æ”¶ä¸€å€‹åƒæ•¸</span></span><br><span class="line">  withRouter,</span><br><span class="line">  <span class="title function_">connect</span>(commentSelector)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">EnhancedComponent</span> = <span class="title function_">enhance</span>(<span class="title class_">WrappedComponent</span>)</span><br></pre></td></tr></table></figure><p>ä¹Ÿæœ‰å…¶ä»–çš„ library å¯ä»¥å¹«åŠ©æŠŠ HOCs æ‰“åŒ…æˆæ†ï¼Œä¾‹å¦‚ :</p><ul><li>lodash.flowRight</li><li>Redux</li><li>Ramda</li></ul><h2 id="æ…£ä¾‹-ç”¨-displayName-å–åå­—å¹«åŠ©-Debug">æ…£ä¾‹ : ç”¨ displayName å–åå­—å¹«åŠ© Debug</h2><p>HOCs æ˜¯ Container çš„æ¦‚å¿µï¼Œå¦‚æœçµæ§‹ä¸Šæ˜¯ä½¿ç”¨ :</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">withToggle</span> = (<span class="params">WrappedComponent</span>)=&gt; <span class="function">(<span class="params">props</span>)=&gt;</span> &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">WrappedComponent</span> &#123;<span class="attr">...props</span>&#125;/&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒ¿åçš„ arrow functionï¼Œåœ¨ Debug æœƒå‚»å‚»æä¸æ¸…æ¥šã€‚</p><p>å¾å¯¦ä½œç¯„ä¾‹æ‰“é–‹ devtool ä¾†çœ‹ï¼Œç”¨ HOC åŒ…éçš„å…ƒä»¶éƒ½åªé¡¯ç¤º <strong>Anonymous</strong><br><img data-src="https://i.imgur.com/V4Uk0fb.png" alt="|200x250"></p><p>Navbar æœ‰ <code>Full</code> è·Ÿ <code>Overlay</code> å…©ç¨®ï¼Œä½†åœ¨é€™é‚Šæ˜¯çœ‹ä¸å‡ºä¾†çš„ã€‚ä¸»è¦åŸå› å°±æ˜¯ä¸Šé¢æåˆ°çš„çµæ§‹ï¼Œé‡é»æ˜¯ <strong>è®“å…§éƒ¨çš„ function æ“æœ‰åå­—</strong>ï¼Œå¿…é ˆç¨ç«‹å‡ºä¾†ã€‚å¯ä»¥å…ˆæŠŠå®ƒä¸€æ­¥æ­¥çµ¦è§£é–‹ä¾†</p><ul><li>åœ¨å…§éƒ¨å–å :</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">withToggle</span> = (<span class="params">WrappedComponent</span>)=&gt; &#123;</span><br><span class="line"><span class="comment">// ç¬¬ä¸€ç¨® : ç›´æ¥å¯«æˆ function statements</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">newComponent</span>(<span class="params">props</span>)&#123;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">WrappedComponent</span> &#123;<span class="attr">...props</span>&#125;/&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç¬¬äºŒç¨® : å¯«æˆ function expressions</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">newComponent</span> = (<span class="params">props</span>)=&gt;&#123;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">WrappedComponent</span> &#123;<span class="attr">...props</span>&#125;/&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1. è®“è¢«åŒ…æˆ HOC çš„å…ƒä»¶æ‹¿åˆ°åŸæœ¬ WrappedComponent çš„åç¨±(ä¾‹å¦‚ : &quot;Navbar&quot;)</span></span><br><span class="line">newComponent.<span class="property">displayName</span> = <span class="string">`withNavbarType(<span class="subst">$&#123;getDisplayName(WrappedComponent)&#125;</span>)`</span></span><br><span class="line"><span class="keyword">return</span> newComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 2. å®˜æ–¹å¯«æ³• : è®€å–åˆ°è¢«åŒ…è£¹çš„å…ƒä»¶åŸåç¨± */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getDisplayName</span>(<span class="params">WrappedComponent</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">WrappedComponent</span>.<span class="property">displayName</span> || <span class="title class_">WrappedComponent</span>.<span class="property">name</span> || <span class="string">&#x27;Component&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¤–éƒ¨å‘½å : ç›´æ¥æ›¿ç”Ÿç”¢å‡ºä¾†çš„ HOC å‘½å</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬ä¸€ç¨® : ç›´æ¥é™„åŠ å±¬æ€§</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AccordionwithToggle</span> =  <span class="title function_">withToggle</span>(<span class="title class_">Accordion</span>);</span><br><span class="line"><span class="title class_">AccordionWithToggle</span>.<span class="property">displayName</span> = <span class="string">&quot;withToggleAccordion&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬äºŒç¨® : Object.assignï¼Œç‰©ä»¶ä¸Š + ç‰©ä»¶å±¬æ€§</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AccordionwithToggle</span> = <span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="title function_">withToggle</span>(<span class="title class_">Accordion</span>),&#123;</span><br><span class="line"><span class="attr">displayName</span>: <span class="string">&#x27;withToggleAccordion&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img data-src="https://i.imgur.com/e3103Wo.png" alt="|250x250"><br><code>withToggle</code> æˆ‘æ²’æœ‰åœ¨å…§éƒ¨å‘½åï¼Œè€Œæ˜¯åœ¨ <code>Accordion</code> HOC ä¸Šå‘½åï¼Œæ‰€ä»¥è‡ªç„¶åœ¨ <code>Navbar</code> withToggle æœƒçœ‹åˆ°åŒ¿åã€‚</p><p>displayName é€™å€‹å±¬æ€§æ˜¯ React æä¾›æˆ‘å€‘æ›¿ Component å–ä¸åŒçš„åç¨±æ™‚ï¼Œåœ¨ devtools ä¸Šè§€å¯Ÿï¼Œæ–¹ä¾¿ Debugã€‚<br>å¦‚æœæœ‰ä½¿ç”¨ Context API ï¼Œå…¶å¯¦ä¹Ÿæ˜¯åŒå€‹æ¦‚å¿µï¼ŒContext ä¸­çš„ Provider å¯ä»¥æ”¾åœ¨ APP ä»¥ä¸‹çš„æ¨¹ç‹€ä½ç½®ï¼Œä¹Ÿå¯èƒ½å‡ºç¾è¤‡æ•¸å€‹ï¼Œé€™æ™‚å€™å¯ä»¥æ›¿ Context å‘½åæ–¹ä¾¿æŸ¥çœ‹ã€‚</p><p>åœ¨å…§éƒ¨å–åå°±æ˜¯è®“ function éœ²å‡ºåå­—ï¼Œé›–ç„¶ <code>function expressions</code> å°æ–¼å…§éƒ¨æ˜¯åŒ¿åçš„ï¼Œä½†æˆ‘å€‘åªåœ¨ä¹æœ€å¤–éƒ¨ function çš„åç¨±ã€‚</p><p>å¦å¤–åƒä¸Šé¢å¯«çš„ <code>withNavbarType()</code> é€™æ¨£åŒ…è£¹èµ·ä¾†ï¼Œæ‹¬è™Ÿä»¥å¤–çš„æœƒåœ¨å¤–éƒ¨ (åœ–ä¸­ç°è‰²æ–¹å¡Šå€)ï¼Œé¡ä¼¼ Component çš„é™„åŠ è¨Šæ¯ï¼Œä½†è¢«æ‹¬è™ŸåŒ…è£¹ä½çš„æœ€è£¡é¢æ‰æ˜¯é¡¯ç¤ºå…ƒä»¶çš„ displayNameã€‚</p><h2 id="æ³¨æ„-ä¸è¦ç›´æ¥ä¿®æ”¹åˆ°åŸæœ¬çš„-Component">æ³¨æ„ : ä¸è¦ç›´æ¥ä¿®æ”¹åˆ°åŸæœ¬çš„ Component</h2><ul><li><p>å‡å¦‚æˆ‘å€‘è¦æ“ä½œæœ‰é—œå…ƒä»¶çš„ç”Ÿå‘½é€±æœŸï¼Œä¸æ‡‰è©²ç›´æ¥ä¿®æ”¹å…ƒä»¶çš„ prototype</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ å£é€äº†</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">logProps</span>(<span class="params">InputComponent</span>) &#123;</span><br><span class="line">  <span class="title class_">InputComponent</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">componentDidUpdate</span> = <span class="keyword">function</span>(<span class="params">prevProps</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Current props: &#x27;</span>, <span class="variable language_">this</span>.<span class="property">props</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Previous props: &#x27;</span>, prevProps);</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="comment">// InputComponent æœ¬èº«å·²ç¶“è¢«æ”¹è®Š</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">InputComponent</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// EnhancedComponent will log whenever props are received</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">EnhancedComponent</span> = <span class="title function_">logProps</span>(<span class="title class_">InputComponent</span>);</span><br></pre></td></tr></table></figure><p>å°è‡´æ‰€æœ‰å‚³é€²ä¾†çš„ Component  è¢«æ”¹è®Šï¼Œ<code>componentDidUpdate</code> é€™å€‹æ–¹æ³•éƒ½è¢« ä¿®æ”¹/è¦†å¯« äº†ï¼ŒHOC ä¸èƒ½è¢«é‡è¤‡ä½¿ç”¨ï¼Œå› ç‚º function component ä¸¦æ²’æœ‰ç”Ÿå‘½é€±æœŸçš„æ–¹æ³•ã€‚</p></li><li><p>åˆ©ç”¨ composition çš„æ¦‚å¿µ</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… composition</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">logProps</span>(<span class="params">WrappedComponent</span>) &#123;</span><br><span class="line"><span class="comment">// ç”¨æ–°çš„ Component åŒ…è£¹å‚³å…¥çš„ Componentï¼Œä¸å»å½±éŸ¿åˆ°åŸæœ¬çš„ Component</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">class</span> <span class="title class_">extends</span> <span class="title class_">React</span>.<span class="property">Component</span> &#123;</span><br><span class="line">    <span class="title function_">componentDidUpdate</span>(<span class="params">prevProps</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Current props: &#x27;</span>, <span class="variable language_">this</span>.<span class="property">props</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Previous props: &#x27;</span>, prevProps);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">WrappedComponent</span> &#123;<span class="attr">...this.props</span>&#125; /&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="æ³¨æ„-ä¸è¦åœ¨-render-function-ä½¿ç”¨-HOC">æ³¨æ„ : ä¸è¦åœ¨ render function ä½¿ç”¨ HOC</h2><p>function æ˜¯ Object çš„ä¸€ç¨®ï¼Œæ¯æ¬¡ re-render éƒ½æ˜¯æ–°çš„ function (object)ï¼Œé€ æˆæ•ˆèƒ½ä¸Šçš„æµªè²»ã€‚æ‰€ä»¥è¦åœ¨å¤–éƒ¨ç”¢ç”Ÿ HOC å†å¸¶å…¥æ–°çš„ Component ä¸­ã€‚</p><blockquote><p>ç°¡å–®ä¾†èªª : <strong>{ } !== { }</strong>ï¼Œè¦é¿å…é€™ç¨®æƒ…æ³ç™¼ç”Ÿ</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… é€™æ˜¯ ok çš„ï¼ŒAccordionwithToggle ä¸æœƒå› ç‚º App re-render è€Œæ”¹è®Š</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AccordionwithToggle</span> = <span class="title class_">React</span>.<span class="title function_">memo</span>(<span class="title function_">withToggle</span>(<span class="title class_">Accordion</span>))</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="keyword">const</span> [count,setCount] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">AccordionwithToggle</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123; setCount(count+1) &#125;&#125;&gt;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ æ¯æ¬¡ App re-render éƒ½æ˜¯é‡æ–°å‘¼å« function,ç”¢ç”Ÿæ–°çš„ Accordionï¼ŒReact æœƒå°‡å…¨éƒ¨æ›¿æ›ï¼Œå› ç‚ºè·Ÿä¸Šä¸€æ¬¡çš„ Accordion ä¸ä¸€æ¨£ã€‚</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="keyword">const</span> [count,setCount] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line"><span class="comment">// æ¯æ¬¡éƒ½æ˜¯æ–°çš„</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AccordionwithToggle</span> = <span class="title class_">React</span>.<span class="title function_">useMemo</span>(<span class="title function_">withToggle</span>(<span class="title class_">Accordion</span>),[])</span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">AccordionwithToggle</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123; setCount(count+1) &#125;&#125;&gt;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>codepen ä¸­é è¨­çš„å¼•å…¥çš„ React script æ˜¯ production modeï¼Œæ˜¯ä¸èƒ½ä½¿ç”¨ React çš„ profilerâ€¦ çš„ã€‚<br>è¦éº¼æ”¹æˆ developmentï¼Œåœ¨ html æ·»åŠ é€™å…©è¡Œï¼Œä¸¦ä¸”æŠŠç·¨è¼¯å™¨çš„ <code>External Scripts/Pens</code> å–æ¶ˆã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">crossorigin</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/react@18/umd/react.development.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">crossorigin</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/react-dom@18/umd/react-dom.development.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>in render<br><img data-src="https://i.imgur.com/GgF9oDS.gif" alt="|600x350"></li><li>outside<br><img data-src="https://i.imgur.com/j4Uec3j.gif" alt="|600x350"></li></ul><p>ä»¥è‚‰çœ¼ä¾†çœ‹ï¼Œç•¶ App çš„ state æ”¹è®Šï¼Œé€²è¡Œ re-renderï¼Œå¦‚æœæ˜¯åœ¨ render ç”¢ç”Ÿçš„ <code>&lt;Accordion/&gt;</code>æœƒé–ƒä¸€ä¸‹ï¼Œå› ç‚ºå° App ä¾†èªª <code>&lt;Accordion/&gt;</code> æ˜¯æ–°ç‰©ä»¶ï¼Œç­‰åŒæ–¼ç”¢ç”Ÿæ–°çš„ DOM ç¯€é» ä¸¦ä¸” repaint ã€‚æ”¾åœ¨å¤–éƒ¨çš„è©±ï¼Œå°±æ²’æœ‰é€™å€‹å•é¡Œã€‚</p><h2 id="æ³¨æ„-refs-ä¸¦ä¸æœƒè¢«å‚³é">æ³¨æ„ : refs ä¸¦ä¸æœƒè¢«å‚³é</h2><p><strong>refs</strong> ä¸æ˜¯ props çš„ä¸€ç¨®ï¼Œå°±åƒ <code>key</code>ï¼Œæ˜¯ç”± React ä¾†æ§åˆ¶çš„ã€‚å°±åƒä½ ä¸èƒ½åœ¨å­å…ƒä»¶ä¸­æ‹¿åˆ° <code>âŒprops.key</code>ã€‚å¦‚æœåœ¨ HOC ä½¿ç”¨ refï¼Œæ¥æ”¶åˆ° ref çš„ä¸æœƒæ˜¯ WrappedComponentï¼Œè€Œæ˜¯ HOC æœ¬èº«ã€‚</p><p>è¦ä½¿ WrappedComponent èƒ½å¤ æ¥æ”¶ ref ï¼Œå¿…é ˆä½¿ç”¨ <code>React.forwardRef</code><sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>ã€‚</p><p><code>React.forwardRef</code> åŒ…ä½çš„ Component å¯ä»¥æ¥æ”¶ <strong>ref</strong> (é€™è£¡çš„ ref æ˜¯ forwardRef åˆ»æ„ç‚ºä¹‹)ã€‚</p><ul><li><code>withtoggle</code> ç‚ºä¾‹ï¼Œæ”¹æˆ <strong>withToggle2</strong></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">withToggle2</span> = (<span class="params">Component</span>) =&gt; &#123;</span><br><span class="line"><span class="comment">/* æ¥ä½ä¸Šå±¤å‚³ä¸‹ä¾†çš„ ref */</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">React</span>.<span class="title function_">forwardRef</span>(<span class="function">(<span class="params">props, ref</span>)=&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [open, setOpen] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">togglehandler</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="title function_">setOpen</span>(<span class="function">(<span class="params">prevOpen</span>) =&gt;</span> !prevOpen);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">/* ğŸ˜µ Wrapped Component ä¸èƒ½ä½¿ç”¨ ref é€™å€‹å­—çœ¼æ¥ ref ï¼Œè¦å–åˆ¥åæ¥ */</span></span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Component</span> <span class="attr">open</span>=<span class="string">&#123;open&#125;</span> <span class="attr">togglehandler</span>=<span class="string">&#123;togglehandler&#125;</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">forwardRef</span>=<span class="string">&#123;ref&#125;</span> /&gt;</span></span>;</span><br><span class="line">    &#125;) </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// App ç”¢ç”Ÿæ–°çš„ ref</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">SpecialRef</span> = <span class="title class_">React</span>.<span class="title function_">useRef</span>(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* ä½¿ç”¨ ref ç›´æ¥å‚³ */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">AccordionwithToggle2</span> <span class="attr">index</span>=<span class="string">&quot;special&quot;</span> <span class="attr">ref</span>=<span class="string">&#123;SpecialRef&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ Wrapped Component å¾ prop æ¥æ”¶ ref </span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Accordion</span>(<span class="params">&#123; open, togglehandler, index,forwardRef &#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// ç•¥</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(forwardRef) <span class="comment">// çµæœ hello</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">  <span class="comment">//...ç•¥</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰åœ¨ç”¢ç”Ÿ Ref çš„åŒä¸€å±¤å¯ä»¥ç›´æ¥ä½¿ç”¨ ref ï¼Œä¾‹å¦‚ :</p><ul><li>App åœ¨é€™è£¡ <code>createref / useRef</code> ğŸ‘‰  <code>&lt;AccordionwithToggle2 ref=&#123;âœ…&#125; /&gt;</code></li><li>HOC è£¡é¢çš„ <code>&lt;WrappedComponent/&gt;</code> ä¸èƒ½ä½¿ç”¨ ref å‚³ï¼Œè¦å–åˆ¥åã€‚ HOC ğŸ‘‰<code>&lt;WrappedComponent ref=&#123;âŒ&#125; forwardref=&#123;âœ…&#125; /&gt;</code></li></ul><h2 id="ç¸½çµ-26">ç¸½çµ</h2><p>é—œæ–¼ HOC çš„ç‰¹é»</p><ol><li>æ˜¯ä¸€å€‹ Design Pattern ï¼Œå¯ä»¥æé«˜ Component é‡è¤‡æ€§</li><li>æ˜¯ä¸€å€‹ function ï¼ŒåŒ…è£¹å¦ä¸€å€‹ Componentï¼Œå›å‚³æ–°çš„ Componentï¼Œåˆç¨± <strong>åŠ å¼·ç‰ˆ Component</strong>ï¼Œä¸¦ä¸”ä¸æœƒå½±éŸ¿åˆ°åŒ…ä½çš„ Component ã€‚</li></ol><p>HOC æœ€å¸¸æ¯”è¼ƒçš„é‚„æœ‰ render props é€™å€‹ Patternï¼Œå·®åˆ¥å¯ä»¥åƒè€ƒ</p><ul><li><a href="https://medium.com/frochu/hoc-%E8%88%87renderprops-%E8%AB%87%E6%88%91%E5%BE%9E%E5%A5%B9%E5%80%91%E8%BA%AB%E4%B8%8A%E5%AD%B8%E5%88%B0%E4%BB%80%E9%BA%BC-2681ab4cc453">HOC èˆ‡Render Propsï¼Œè«‡æˆ‘å¾å¥¹å€‘èº«ä¸Šå­¸åˆ°ä»€éº¼. å‰è¨€ | by Wendell Liu | Frochu | Medium</a></li><li><a href="https://gist.github.com/heygrady/f9bf3b6dd93fe3d87ba87430fd3c20d5">Avoiding HOC; Favoring render props Â· GitHub</a></li></ul><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style:none; padding-left: 0;"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">1.</span><span style="display: inline-block; vertical-align: top;">è£œå…… HOC çš„ ref å•é¡Œ : <a href="https://zh-hant.reactjs.org/docs/forwarding-refs.html#forwarding-refs-in-higher-order-components">å‚³é€ Ref â€“ React</a></span><a href="#fnref:1" rev="footnote"> â†©</a></li></ol></div></div>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ–‡ç« ä¾†è‡ª :&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://zh-hant.reactjs.org/docs/higher-order-components.html&quot;&gt;Higher-Order Components â€“ React&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;æ‘˜è¦-4&quot;&gt;æ‘˜è¦&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;äº†è§£ HOC çš„é‹ä½œåŸç†ï¼Œä»¥åŠæ„ç¾©&lt;/li&gt;
&lt;li&gt;HOC çš„æ¶æ§‹èˆ‡å¯¦ä½œ&lt;/li&gt;
&lt;li&gt;HOC æ‡‰ç”¨ä¸Šçš„æ³¨æ„äº‹é …&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    <category term="Front-end" scheme="https://blog.rosa.tw/categories/Front-end/"/>
    
    <category term="React" scheme="https://blog.rosa.tw/categories/Front-end/React/"/>
    
    
    <category term="React" scheme="https://blog.rosa.tw/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>ç­†è¨˜ | JavaScript - fetch ç²å–é ç«¯è³‡æ–™</title>
    <link href="https://blog.rosa.tw/2022/06/JavaScript/JavaScript-fetch"/>
    <id>https://blog.rosa.tw/2022/06/JavaScript/JavaScript-fetch</id>
    <published>2022-06-22T04:45:11.000Z</published>
    <updated>2022-07-28T03:57:32.120Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€-45">å‰è¨€</h2><p>æƒ³è¦ç²å–é ç«¯çš„è³‡æ–™å¯ä»¥ä½¿ç”¨ AJAX ï¼Œåœ¨ ES6 ä¹‹å‰å¤§å¤šæœƒä½¿ç”¨ JQuery çš„ <code>$.ajax</code>  æˆ–è€…åŸç”Ÿçš„ XHRï¼Œè€Œåœ¨ HTML5 å‰‡æä¾› fetch ä½¿ç”¨ï¼Œæ›´å¤šæ™‚å€™æœƒä½¿ç”¨ axios å¥—ä»¶ã€‚<br>æœ¬ç¯‡è¨˜éŒ„ fetch çš„ä½¿ç”¨æ–¹å¼èˆ‡å¸¸è¦‹çš„ä½¿ç”¨èª¤å€ã€‚</p><span id="more"></span><h2 id="fetch">fetch</h2><p>fetch æ˜¯ HTML5 åŸç”Ÿç²å–é ç«¯çš„æ–¹å¼ï¼Œå…¶æ“ä½œä¹Ÿååˆ†ç°¡å–®</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(url)</span><br><span class="line"><span class="title function_">fetch</span>(url,&#123;obj&#125;) <span class="comment">// ç¬¬äºŒå€‹åƒæ•¸ç‚º options</span></span><br></pre></td></tr></table></figure><p>æ²’æœ‰ options çš„ç‰©ä»¶ï¼Œåªæœ‰ç¶²å€çš„è©±æ˜¯ <code>GET</code>ã€‚<br>fetch å›å‚³çš„æ˜¯ä¸€å€‹ Promise ç‰©ä»¶ï¼ŒPromise ç°¡å–®ä¾†èªªæ˜¯ <strong>è™•ç†éåŒæ­¥æ“ä½œçš„ç‰¹æ®Šç‰©ä»¶</strong>ï¼Œæœ‰é—œæ–¼ Promise ä¹‹å¾Œæœƒå†è£œå……ã€‚</p><h3 id="then-catch">then &amp; catch</h3><p>å¦‚æœè¦æ‹¿åˆ°å›å‚³çš„ response ï¼Œå¯ä»¥é€é <code>then</code>ã€‚è¦æ¥ .then å‰é¢çš„ç‰©ä»¶å¿…è¦é¡å‹ç‚º Promiseï¼Œè€Œ <code>fetch()</code> å›å‚³çš„å°±æ˜¯ä¸€å€‹ Promise ç‰©ä»¶ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> endPoint = <span class="string">&#x27;https://restcountries.com/v3.1/name/Taiwan&#x27;</span></span><br><span class="line"><span class="title function_">fetch</span>(endPoint).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span>&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(response)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>æ˜¯ <code>fetch().then</code> è€Œä¸æ˜¯ <strong>fetch.then</strong>ï¼Œæ˜¯ fetch é€™å€‹å‡½å¼è£¡é¢å›å‚³ Promise</p></blockquote><p>then æ¥æ”¶çš„åƒæ•¸æ˜¯ Promise ä¸­ resolve æˆ–æ˜¯ reject çš„å‡½å¼é‹è¡Œçš„çµæœï¼Œé€šå¸¸æ˜¯ resolveï¼Œå¦‚æœæ˜¯ reject å‰‡æœƒç”¨ <code>.catch</code> ä¾†ä½œéŒ¯èª¤è™•ç†ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(endPoint).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span>&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(response)</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æœƒè¢«ä¸Ÿé€² catch è™•ç†çš„ err ä¸¦ä¸æ˜¯åƒ XHR status 404 æˆ– 500 é€™é¡çš„ï¼Œè€Œæ˜¯å¯èƒ½ç¶²è·¯é€£ç·šéŒ¯èª¤æˆ–è€…ç¶²å€æœ‰èª¤å°è‡´ä¸èƒ½ç™¼å‡º request ã€‚</p><h3 id="HTTP-ç‹€æ…‹ç¢¼è™•ç†-Response-status-Response-ok">HTTP ç‹€æ…‹ç¢¼è™•ç† Response.status &amp;  Response.ok</h3><p>åªè¦æ˜¯ HTTP ç‹€æ…‹ç¢¼ 400 ä»¥ä¸Šçš„æˆ‘å€‘é€šå¸¸æœƒåœ¨ XHR åšéŒ¯èª¤è™•ç†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xhr.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params">err</span>)&#123;...&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ fetch ä¸ç®¡ç‹€æ…‹ç¢¼å¤šå°‘ï¼Œåªè¦æœ‰æ­£ç¢ºçš„ç™¼å‡ºè«‹æ±‚å¾Œå›å‚³çš„ response éƒ½æœƒé€²å…¥ resolve ï¼Œå¦‚æœè¦è™•ç†åƒ onerror çš„éŒ¯èª¤å¯ä»¥é€é .then ä¸­ response çš„ status æˆ– okã€‚</p><ul><li>response.status : å›å‚³çµæœçš„ HTTP code</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(endPoint).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span>&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(response.<span class="property">status</span>) <span class="comment">// 200 ä»£è¡¨æˆåŠŸ</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>response.ok : å›å‚³ boolean ï¼Œå¦‚æœ HTTP code åœ¨ 200~299 å°±å›å‚³ true</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(endPoint).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(response.<span class="property">ok</span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">&#125; </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Response-text-json">Response.text() &amp; .json()</h3><p>å¯ä»¥å°‡ response è§£ææˆæƒ³è¦çš„å½¢å¼</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(endPoint).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span>&#123;</span><br><span class="line"><span class="keyword">return</span> response.<span class="title function_">text</span>()</span><br><span class="line"><span class="comment">// return response.json() å…©è€…æ“‡ä¸€</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li><code>.text()</code> : ç›´æ¥å°å‡ºæ–‡å­—</li><li><code>.json()</code> : è‡ªå‹•å¹«æˆ‘å€‘è§£æ json æ ¼å¼çš„è³‡æ–™</li></ul><p>å…¶ä»–ç¨®é¡çš„æ ¼å¼ :</p><ul><li><code>.blob()</code>ï¼šæŠŠè³‡æ–™è½‰æˆBlobç‰©ä»¶</li><li><code>.formData()</code>ï¼šæŠŠè³‡æ–™è½‰æˆFormDataç‰©ä»¶</li><li><code>.arrayBuffer()</code>ï¼šæŠŠè³‡æ–™è½‰æˆäºŒé€²åˆ¶æ•¸çµ„</li></ul><blockquote><p>é€™äº›æ–¹æ³• <strong>åªèƒ½æ“‡ä¸€</strong>ï¼Œä¸€ä½†è¢«è§£æéå°±ä¸èƒ½é‡è¤‡å†ä½¿ç”¨å…¶ä»–çš„å‡½å¼è§£æäº†ã€‚</p></blockquote><h2 id="POST">POST</h2><p>POST ä¹Ÿå¾ˆç°¡å–®ï¼Œè·Ÿ <code>$.ajax()</code> çš„æ“ä½œå¾ˆåƒ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬äºŒå€‹åƒæ•¸å¯ä»¥æ”œå¸¶ header ã€body æˆ– Http ç­‰è³‡è¨Š</span></span><br><span class="line"><span class="keyword">const</span> data = &#123;<span class="attr">name</span>:<span class="string">&#x27;Rosa&#x27;</span>&#125;</span><br><span class="line"><span class="title function_">fetch</span>(endPoint,&#123;</span><br><span class="line"><span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">  <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data),</span><br><span class="line">  <span class="attr">headers</span>: <span class="keyword">new</span> <span class="title class_">Headers</span>(&#123;</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>)=&gt;</span>&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(response)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>fetch çš„ options é‚„æœ‰åŒ…å«å…¶ä»–å¸¸è¦‹çš„ HTTP è™•ç†ï¼Œ<br>åœ¨ body ä¸­å¦‚æœæˆ‘å€‘è¦ä¸Šå‚³çš„æ ¼å¼æ˜¯ JSON æª”ï¼Œè¨˜å¾—è¦å°‡å…§å®¹è½‰æ›æˆ JSON æ ¼å¼ã€‚</p><blockquote><p><strong>GET èˆ‡ HEAD æ˜¯æ²’æœ‰ body çš„</strong></p></blockquote><h2 id="fetch-çš„-Headers">fetch çš„ Headers</h2><p>ä»¥å¾€åœ¨ XHR è¦åŠ ä¸Š Header</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">XMLHttpRequest</span>.<span class="title function_">setRequestHeader</span>(header, value);</span><br></pre></td></tr></table></figure><p>åœ¨ fetch è¦åŠ ä¸Š Headerï¼Œå¯ä»¥ç›´æ¥åŠ ï¼Œæˆ–è€… new å‡ºä¸€å€‹ Header å®¹å™¨ä¾†æ”¾ç½®æ‰€éœ€çš„å…§å®¹ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç›´æ¥ä½¿ç”¨ headers</span></span><br><span class="line"><span class="title function_">fetch</span>(url,&#123;</span><br><span class="line"><span class="attr">headers</span>:&#123;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//é€éå¯¦ä¾‹å‡ºä¸€å€‹ Headers</span></span><br><span class="line"><span class="title function_">fetch</span>(url,&#123;</span><br><span class="line"><span class="attr">headers</span>: <span class="keyword">new</span> <span class="title class_">Headers</span>(&#123;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">&#125;),</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="Content-Type">Content Type</h3><p>è¡¨å–® æˆ–æ˜¯ JSON æ ¼å¼è³‡æ–™</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//JSON</span></span><br><span class="line">&#x27;Content-Type&#x27;<span class="punctuation">:</span> &#x27;application/json&#x27;</span><br><span class="line"><span class="comment">// è¡¨å–®</span></span><br><span class="line">&#x27;Content-Type&#x27;<span class="punctuation">:</span> &#x27;application/x-www-form-urlencoded&#x27; </span><br></pre></td></tr></table></figure><h3 id="credentials">credentials</h3><p>é è¨­ä¸Šä¸æœƒè‡ªå‹•å¸¶ä¸Šæˆ–æ¥æ”¶ä»»ä½• cookiesï¼Œå¦‚æœç¶²ç«™ä¾è³´ session æœƒå°è‡´è«‹æ±‚å›å‚³æœªç¶“èªè­‰ï¼Œæƒ³æŠŠ cookies ä¸€èµ·å¸¶ä¸Šï¼Œè¦åŠ </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(url,&#123;</span><br><span class="line"><span class="attr">credentials</span>: <span class="string">&#x27;include&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="å°-mode-çš„èª¤è§£">å° mode çš„èª¤è§£</h2><p>ç™¼é€ request å¯èƒ½æœƒé‡åˆ° CORS çš„é™åˆ¶ï¼Œfetch ä¸­mode æä¾› <code>'no-cors'</code> çš„æ–¹æ³•ï¼Œä¹çœ‹ä¹‹ä¸‹æœƒä»¥ç‚ºèƒ½çªç ´ CORS é™åˆ¶ï¼Œæ—¢ä¸æœƒè·³å‡ºéŒ¯èª¤ (ä¸æœƒè·³åˆ° .catch)ï¼Œä¹Ÿèƒ½ç™¼å‡º request ï¼Œä½† <strong>response çš„ status æ˜¯ 0 ï¼Œbody æ˜¯ç©ºçš„</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(url,&#123;</span><br><span class="line"><span class="attr">method</span>:<span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line"><span class="attr">headers</span>: <span class="keyword">new</span> <span class="title class_">Headers</span>(&#123;</span><br><span class="line"><span class="string">&#x27;Content-Type&#x27;</span>:<span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">&#125;),</span><br><span class="line"><span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;Rosa&#x27;</span>&#125;),</span><br><span class="line">mode : <span class="string">&#x27;no-cors&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="title function_">json</span>())</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err))</span><br></pre></td></tr></table></figure><blockquote><p>éº»ç“œç¿»è­¯æ©Ÿ :<br>ä¸æœƒå›å‚³éŒ¯èª¤ï¼Œä¹Ÿä¸æœƒçªç ´ CORS çš„é™åˆ¶<br>é¿å…ç™¼ç”ŸéŒ¯èª¤ï¼Œç¡¬è¦ä¸Ÿå‡ºä¸€å€‹ request ï¼Œé‚„ä½ ä¸€å€‹å®‰å¿ƒ responseï¼Œè£¡é¢åŒ…å«æ²’æ±è¥¿çš„ body ä»¥åŠ status ç‚º 0 ã€‚</p></blockquote><p>CORS çš„é™åˆ¶æ˜¯å¾Œç«¯è¦è§£æ±ºï¼Œå‰ç«¯ç„¡æ³•ç›´æ¥å¯¦ç¾æ›è·¨ CORSã€‚</p><h2 id="ç‚ºä»€éº¼-XMLHttpRequest-é‚„æ˜¯å­˜åœ¨">ç‚ºä»€éº¼ XMLHttpRequest é‚„æ˜¯å­˜åœ¨ ?</h2><p>æˆ‘å€‘éƒ½çŸ¥é“ XHR å¯«èµ·ä¾†æœ‰é»å›‰å—¦ï¼Œåœ¨ fetch å•ä¸–ä¹‹å¾Œï¼Œé™¤äº†æ”¯æ´èˆŠçš„ç€è¦½å™¨æœƒä½¿ç”¨åˆ° XHRï¼Œç¾ä»£é–‹ç™¼å¤§å¤šé‚„æ˜¯ä½¿ç”¨ fetchï¼Œä½†æ˜¯ XMLHttpRequest ä¸¦æ²’æœ‰è¢«å»¢æ£„ï¼Œå› ç‚º fetch é‚„æ˜¯æœ‰äº›åŠŸèƒ½æ˜¯ç„¡æ³•åšåˆ°çš„ã€‚</p><p>**fetch åšä¸åˆ° : **</p><ol><li>ä¸Šå‚³é€²åº¦è¿½è¹¤ï¼Œfetch å¿…é ˆæ­é…å…¶ä»–çš„ API æ‰èƒ½åšåˆ°ï¼Œ</li><li>éŒ¯èª¤çš„å›æ‡‰è™•ç†<br>fetch ä¸ç®¡ HTTP 404 é‚„æ˜¯ 500 ï¼Œä¹Ÿé‚„æ˜¯æœƒ resolveï¼Œä»£è¡¨ <strong>ä½ ç¢ºå¯¦æœ‰é€å‡º request</strong>ï¼Œ<code>.catch</code> æœƒæŠ“åˆ°çš„éŒ¯èª¤åªæœƒæ˜¯ <strong>ç¶²è·¯éŒ¯èª¤æˆ–å…¶ä»–æœƒä¸­æ–· request çš„æƒ…æ³</strong>ã€‚å°æ–¼éŒ¯èª¤çš„è™•ç†ä¸æ˜¯é‚£éº¼ç›´è¦ºã€‚</li><li>ä¸­æ–·  (absort) fetch<br>ç›®å‰æ²’æœ‰ç›´æ¥ä¸­æ–· fetch (Promise) çš„æ–¹æ³•ï¼Œä¸åƒ XHR æä¾› <code>.absort()</code>ï¼Œä½†æ˜¯ WebAPIs æœ‰æä¾› <a href="https://developer.mozilla.org/zh-TW/docs/Web/API/AbortController#browser_compatibility">AbortController</a> å¯ä»¥è®“ fetch åšåˆ°ä¸­æ–·ï¼Œç›®å‰ç‚ºå¯¦é©—æ€§(?)<br><a href="https://mdn.github.io/dom-examples/abort-api/">MDN æä¾›çš„ç¯„ä¾‹</a>ï¼Œè®“ä½ çªç„¶ä¸æƒ³çœ‹å½±ç‰‡çš„æ™‚å€™ï¼Œåœæ­¢ç™¼å‡º requestã€‚</li><li>é€¾æ™‚è™•ç† (timeout)<br>XHR é€¾æœŸçš„æ™‚å€™å¯ä»¥æš«åœç™¼å‡ºè«‹æ±‚ï¼Œç¬¬ä¸‰é»ä¹Ÿæåˆ° fetch å› ç‚ºæ²’æœ‰ä¸­æ–·çš„åŠŸèƒ½ï¼Œç„¡æ³•åšåˆ°ã€‚</li></ol><h2 id="è£œå……-å¹¾ç¨®ç™¼-request-çš„æ–¹æ³•">è£œå…… : å¹¾ç¨®ç™¼ request çš„æ–¹æ³•</h2><p>ä»¥ä¸‹éƒ½æœƒä½¿ç”¨ GET ç‚ºä¾‹</p><ol><li>XHR <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">xhr.<span class="title function_">open</span>(url)</span><br><span class="line">xhr.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params">response</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(response.<span class="property">state</span>&gt;=<span class="number">200</span> &amp;&amp; response.<span class="property">state</span> &lt;=<span class="number">400</span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">xhr.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">xhr.<span class="title function_">send</span>()</span><br></pre></td></tr></table></figure></li><li>JQuery <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">method : <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">url : url</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">done</span>(<span class="keyword">function</span>(<span class="params">response</span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(response)</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">fail</span>(<span class="keyword">function</span>(<span class="params">error</span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(error)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li>fetch <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(url).<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>)=&gt;</span>&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(response)</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>)=&gt;</span>&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(error)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li>axios <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">axios.<span class="title function_">get</span>(url)</span><br><span class="line"> .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line"> &#125;)</span><br><span class="line"> .<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure></li></ol><h2 id="çµèª-14">çµèª</h2><p>åœ¨æˆ‘å­¸ç¿’ JavaScript é€™æ®µæœŸé–“ï¼Œè¬›åˆ°é ç«¯å–è³‡æ–™ï¼Œå¾ˆå¤šæ•™å­¸ä¸¦ä¸æœƒæåˆ° fetch æˆ–æ˜¯ XMLHttpRequestï¼Œåè€Œæ˜¯å«ä½ ç›´æ¥ä½¿ç”¨ axiosï¼Œç•¢ç«Ÿé‡æ–°é€ è¼ªå­æ˜¯å¾ˆéº»ç…©çš„ ğŸ¥´ï¼Œä¸é fetch ç„¡ç–‘çš„æ˜¯æœƒè¶Šä¾†è¶Šå®Œå–„ï¼Œä¸è«–æ˜¯ç”¨ä½•è€…å·¥å…·æˆ–æ‰‹æ³•å¿…æœ‰ä¸€å®šèª•ç”Ÿçš„ç†ç”±ï¼Œäº†è§£åŸç†å¾Œé–‹ç™¼éƒ½å¯ä»¥æ›´å¾—å¿ƒæ‡‰æ‰‹ã€‚</p><p>æˆ‘è »å–œæ­¡<a href="https://www.ithome.com.tw/voice/121435">è‰¯è‘›æ ¼ ä¸‹çš„é€™ç•ªçµè«–</a></p><blockquote><p>èˆŠæ±è¥¿èª•ç”Ÿåœ¨èˆŠçš„æ™‚ä»£ï¼Œé©æ™‚åœ°è§£æ±ºäº†ç•¶æ™‚çš„å•é¡Œï¼Œè€Œå¾Œå¾ä¸­ç´¯ç©äº†ä¸å°‘çš„ä½¿ç”¨ç¶“é©—ï¼Œå› è€Œèª•ç”Ÿäº†æ–°çš„æŠ€è¡“ã€æ¦‚å¿µæˆ–è¦ç¯„ï¼Œæ€¥è‘—é è¨€èˆŠæ±è¥¿å°‡æœƒé€å»ï¼Œä¸¦ä¸æœƒè®“é–‹ç™¼è€…çœ‹èµ·ä¾†æ›´ç‚ºè€€çœ¼ï¼Œåªæœƒè®“é–‹ç™¼è€…çœ‹ä¸æ¸…æ¥šæ–°æ±è¥¿çš„æœ¬è³ªç½·äº†ã€‚</p></blockquote><h2 id="åƒè€ƒ-19">åƒè€ƒ</h2><ol><li>å¾ fetch è§£æ±ºä»€éº¼å•é¡Œä¾†çœ‹ : <a href="https://www.ithome.com.tw/voice/121435">å¾XHRåˆ°Fetch | iThome</a></li><li>Huli å¤§çš„ fetch ç³»åˆ—å½±ç‰‡<ul><li><a href="https://youtu.be/_8cLWMAQe3A">Fetch èˆ‡ Promise è£œå……ç³»åˆ—ï¼ˆä¸€ï¼‰ï¼šåˆæ¢ Fetch</a></li><li><a href="https://youtu.be/Ovv9tPhiW_0">Fetch èˆ‡ Promise è£œå……ç³»åˆ—ï¼ˆäºŒï¼‰ï¼šfetch çš„ POST èˆ‡éŒ¯èª¤è™•ç†</a></li><li><a href="https://youtu.be/5A9ogWY7J7w">Fetch èˆ‡ Promise è£œå……ç³»åˆ—ï¼ˆä¸‰ï¼‰ï¼šfetch çš„ä½¿ç”¨æ³¨æ„äº‹é …</a></li></ul></li><li>XHR v.s fetchï¼Œå–®ç´”åªæ˜¯å¥½å¥‡æŸ¥è©¢ XD <a href="https://blog.openreplay.com/ajax-battle-xmlhttprequest-vs-the-fetch-api">Ajax Battle: XMLHttpRequest vs the Fetch API </a></li><li><a href="https://zh.javascript.info/fetch">Fetch</a></li><li>å¾ˆæ¨çš„è©³ç´°æ–‡å­—ç‰ˆå­¸ç¿’ : <a href="https://eyesofkids.gitbooks.io/javascript-start-from-es6/content/part4/ajax_fetch.html">AJAXèˆ‡Fetch API Â· å¾ES6é–‹å§‹çš„JavaScriptå­¸ç¿’ç”Ÿæ´» (gitbooks.io)</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€-45&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;æƒ³è¦ç²å–é ç«¯çš„è³‡æ–™å¯ä»¥ä½¿ç”¨ AJAX ï¼Œåœ¨ ES6 ä¹‹å‰å¤§å¤šæœƒä½¿ç”¨ JQuery çš„ &lt;code&gt;$.ajax&lt;/code&gt;  æˆ–è€…åŸç”Ÿçš„ XHRï¼Œè€Œåœ¨ HTML5 å‰‡æä¾› fetch ä½¿ç”¨ï¼Œæ›´å¤šæ™‚å€™æœƒä½¿ç”¨ axios å¥—ä»¶ã€‚&lt;br&gt;
æœ¬ç¯‡è¨˜éŒ„ fetch çš„ä½¿ç”¨æ–¹å¼èˆ‡å¸¸è¦‹çš„ä½¿ç”¨èª¤å€ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Front-end" scheme="https://blog.rosa.tw/categories/Front-end/"/>
    
    <category term="JavaScript" scheme="https://blog.rosa.tw/categories/Front-end/JavaScript/"/>
    
    
    <category term="fetch" scheme="https://blog.rosa.tw/tags/fetch/"/>
    
    <category term="AJAX" scheme="https://blog.rosa.tw/tags/AJAX/"/>
    
  </entry>
  
  <entry>
    <title>ç­†è¨˜ | JavaScript - Event Loop äº‹ä»¶å¾ªç’° (I)</title>
    <link href="https://blog.rosa.tw/2022/06/06/JavaScript-Event-Loop-01"/>
    <id>https://blog.rosa.tw/2022/06/06/JavaScript-Event-Loop-01</id>
    <published>2022-06-17T16:54:45.000Z</published>
    <updated>2022-07-28T02:04:00.273Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€-30">å‰è¨€</h2><p>åœ¨ JavaScript ä¸­ï¼ŒéåŒæ­¥çš„æ“ä½œæ˜¯å¾ˆå¸¸è¦‹çš„ï¼Œèˆ‰å‡¡æ»‘é¼ äº‹ä»¶ã€ç™¼å‡ºè«‹æ±‚ç²å–è³‡æ–™â€¦ç­‰ï¼Œåéä¾†å•ï¼Œå¦‚æœé€™äº›æ“ä½œæ˜¯ <strong>åŒæ­¥</strong> çš„ï¼Œä½ å¯èƒ½æ“ä½œå¾Œï¼Œç•«é¢å°±åƒè¢«å¡ä½äº†ï¼Œè¦ç­‰åˆ°ç›®å‰çš„ç¨‹å¼åŸ·è¡Œå®Œç•¢æ‰èƒ½ç¹¼çºŒç€è¦½ã€‚</p><p>Event Loop çš„æ¦‚å¿µå¦‚ä½•å¹«æˆ‘å€‘äº†è§£é€™ä»¶äº‹ï¼Œå…·é«”æ€éº¼åšå‘¢ ? æœ¬ç¯‡ä¸»è¦æ˜¯å¹«åŠ©æˆ‘è‡ªå·±é‡æ¸… Event Loop çš„æ¦‚å¿µã€‚</p><span id="more"></span><h2 id="ç‚ºä»€éº¼æœƒæœ‰-Event-Loop">ç‚ºä»€éº¼æœƒæœ‰ Event Loop ?</h2><p>JS çš„èªè¨€ç‰¹æ€§æ˜¯</p><ol><li>Single Thread (å–®ç·šç¨‹)</li><li>Synchronous (åŒæ­¥)</li></ol><p>æœ‰æ™‚å€™èªæ„ä¸Šå¾ˆä»¤äººèª¤è§£ï¼ŒåŒæ­¥ <strong>ä¸¦ä¸æ˜¯åŒæ™‚åšå¾ˆå¤šäº‹</strong>ï¼Œè€Œæ˜¯ä½ åªèƒ½ä¸€æ¬¡åšä¸€ä»¶äº‹ã€‚é‚£ç‚ºä»€éº¼æˆ‘å€‘å¯ä»¥åœ¨ <strong>ç€è¦½å™¨</strong> ä¸­æ“ä½œæŒ‰éˆ•ç²å–è³‡æ–™çš„åŒæ™‚åˆèƒ½åšåˆ¥çš„äº‹ ?</p><p>æ²’éŒ¯ï¼Œç‰¹åˆ¥æŒ‡å‡º <strong>ç€è¦½å™¨</strong>ï¼Œå› ç‚ºåœ¨ä¸åŒçš„åŸ·è¡Œç’°å¢ƒä¸‹ï¼Œæ‰èƒ½è®“æˆ‘å€‘åŸ·è¡ŒéåŒæ­¥çš„æ“ä½œã€‚(node ä¹Ÿæ˜¯ä¸€ç¨® JavaScript åŸ·è¡Œç’°å¢ƒï¼Œå…¶ä¸­ä¹Ÿæœ‰æä¾›éåŒæ­¥çš„ API ä¾†æ“ä½œ)</p><p>JavaScript åœ¨ Runtime (åŸ·è¡Œç’°å¢ƒ) æ˜¯åŒæ­¥çš„ï¼Œè€Œæ˜¯ç€è¦½å™¨æä¾› Web APIs è®“æˆ‘å€‘é€é Event Loop æ­é…éåŒæ­¥æ“ä½œï¼Œæ‰èƒ½&quot;åŒæ™‚&quot;è™•ç†å¾ˆå¤šäº‹ã€‚</p><h3 id="é—œæ–¼-Event-Loop-çš„åè©">é—œæ–¼ Event Loop çš„åè©</h3><h4 id="Stack-å †ç–Š">Stack (å †ç–Š)</h4><p>Stack æ˜¯è³‡æ–™çµæ§‹çš„ä¸€ç¨®ï¼Œéµå®ˆ LIFO (Last In,First Out)ã€‚</p><p>JavaScript ä¸­çš„ Call Stack æœƒè¨˜éŒ„ç›®å‰åŸ·è¡Œåˆ°ç¨‹å¼çš„éƒ¨åˆ†ï¼Œå› ç‚º JavaScript æ˜¯ Single Thread (å–®ç·šç¨‹) ï¼Œåªæœƒæœ‰ä¸€å€‹ Call Stackã€‚</p><p><strong>é‚£ Call Stack æ€éº¼é‹ä½œå‘¢ ?</strong><br>ç•¶åŸ·è¡ŒæŸå€‹å‡½å¼ï¼Œæœƒå°‡ç›®å‰åŸ·è¡Œçš„å‡½å¼æ”¾åœ¨ Stack çš„æœ€ä¸Šå±¤ï¼Œå¦‚æœå‡½å¼åŸ·è¡Œ <code>return</code> å°±æœƒå¾ Stack æœ€ä¸Šæ–¹æŠ½é›¢ã€‚</p><p><strong>ç¯„ä¾‹</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">b</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line"><span class="title function_">a</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">c</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line"><span class="title function_">b</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">c</span>();</span><br></pre></td></tr></table></figure><p>è·Ÿè‘—ç¨‹å¼èµ° :</p><ol><li>åŸ·è¡Œ c() ï¼ŒæŠŠ c() æ”¾å…¥ Call Stack ä¸­ 1</li></ol><table><thead><tr><th>order</th><th>stack</th></tr></thead><tbody><tr><td>1</td><td>c () <strong>(now)</strong></td></tr></tbody></table><ol start="2"><li>å°å‡º â€˜câ€™ï¼Œæ¥è‘—åŸ·è¡Œ b()ï¼ŒæŠŠ b() æ”¾å…¥ Call Stack ä¸­</li></ol><table><thead><tr><th>order</th><th>stack</th></tr></thead><tbody><tr><td>2</td><td>b() <strong>(now)</strong></td></tr><tr><td>1</td><td>c ()</td></tr></tbody></table><ol start="3"><li>å°å‡º â€˜bâ€™ï¼Œæ¥è‘—åŸ·è¡Œ a()ï¼ŒæŠŠ a() æ”¾å…¥ Call Stack ä¸­</li></ol><table><thead><tr><th>order</th><th>stack</th></tr></thead><tbody><tr><td>3</td><td>a() <strong>(now)</strong></td></tr><tr><td>2</td><td>b()</td></tr><tr><td>1</td><td>c ()</td></tr></tbody></table><ol start="4"><li>å°å‡º â€˜aâ€™ï¼Œa() å¾Œé¢æ²’æœ‰ç¨‹å¼ç¢¼ï¼Œä»£è¡¨åŸ·è¡Œå®Œç•¢ï¼ŒæŠ½é›¢ Stack ä¸­</li></ol><table><thead><tr><th>order</th><th>stack</th></tr></thead><tbody><tr><td><s>3</s></td><td><s>a() ----&gt; æŠ½é›¢</s></td></tr><tr><td>2</td><td>b()</td></tr><tr><td>1</td><td>c ()</td></tr></tbody></table><ol start="5"><li>å¾Œé¢è·Ÿæ­¥é©Ÿ 4 ä¸€æ¨£ï¼Œä¾åºæŠ½é›¢ï¼Œç›´åˆ° c() åŸ·è¡Œå®Œç•¢ï¼Œå¾Œé¢ä¹Ÿæ²’æœ‰ç¨‹å¼ç¢¼ï¼Œæœ€å¾Œ Call Stack ç‚ºç©º</li></ol><p>è§£é‡‹äº†ä¸Šé¢æåŠçš„ Stack <strong>Last In,First Out</strong> çš„åŸå› ã€‚</p><h4 id="Task-Queue-ä»»å‹™ä½‡åˆ—">Task Queue (ä»»å‹™ä½‡åˆ—)</h4><p>åˆç¨±ä½œ Callback Queueï¼Œåœ¨ Web APIs çš„ function åŸ·è¡Œå®Œå¾Œï¼ŒæŠŠ callback (æ¥è‘—è¦åŸ·è¡Œçš„ function) æ”¾åˆ° Task Queue ç­‰å¾…ã€‚</p><p>ğŸ‘‰<a href="http://latentflip.com/loupe/?code=JC5vbignYnV0dG9uJywgJ2NsaWNrJywgZnVuY3Rpb24gb25DbGljaygpIHsKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gdGltZXIoKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1lvdSBjbGlja2VkIHRoZSBidXR0b24hJyk7ICAgIAogICAgfSwgMjAwMCk7Cn0pOwoKY29uc29sZS5sb2coIkhpISIpOwoKc2V0VGltZW91dChmdW5jdGlvbiB0aW1lb3V0KCkgewogICAgY29uc29sZS5sb2coIkNsaWNrIHRoZSBidXR0b24hIik7Cn0sIDUwMDApOwoKY29uc29sZS5sb2coIldlbGNvbWUgdG8gbG91cGUuIik7!!!PGJ1dHRvbj5DbGljayBtZSE8L2J1dHRvbj4%3D">åƒè€ƒ Loupe è¦–è¦ºåŒ–å·¥å…·</a></p><p>åœ¨é€™å€‹ä¾‹å­ä¸­ï¼Œæœ‰ setTimeout èˆ‡ click äº‹ä»¶ã€‚ç•¶ç¨‹å¼åŸ·è¡Œæ™‚ :</p><ol><li>Button äº‹ä»¶ä¸¦æ²’æœ‰è§¸ç™¼ï¼Œcallback function ä¸¦ä¸æœƒåŸ·è¡Œï¼Œå…ˆæ”¾ç½®åˆ° Web APIs ç­‰å¾…</li><li>ç¬¬ 7 è¡Œæ’é€² Call Stack ï¼Œå°å‡º â€˜Hi !â€™ï¼ŒåŸ·è¡Œå®Œç•¢ç§»å‡º Call Stack å¤–</li><li>setTimeOut æ”¾ç½®åˆ° Web APIs ç­‰å¾…ï¼Œä¸¦ä¸”é–‹å§‹ç®— 5 ç§’é˜</li><li>ç¬¬ 13 è¡Œæ’é€² Call Stack ï¼Œå°å‡º â€˜Welcome to loupe.â€™ï¼ŒåŸ·è¡Œå®Œç•¢ç§»å‡º Call Stack å¤–ï¼Œåˆ°é€™é‚Šéœæ…‹çš„ç¨‹å¼ç¢¼éƒ½åŸ·è¡Œå®Œç•¢ï¼ŒCall Stack è®Šæˆç©ºçš„ ã€‚(åŒä¸€æ™‚é–“ setTimeOut é‚„åœ¨è·‘ç§’æ•¸)</li><li>éäº†å¤§æ¦‚ 5 ç§’é˜ï¼Œ æŠŠç¬¬ 9 è¡Œ setTimeOut çš„ callback <code>timeout()</code> æ”¾åˆ° Callback Queueã€‚</li><li><strong>æ­¤æ™‚ Call Stack ç‚ºç©ºçš„ï¼ŒæŠŠ Task Queue ç¬¬ä¸€é †ä½çš„ timeout() æ¬åˆ° Call Stack åŸ·è¡Œ</strong> (æ­¤æ™‚æœƒçœ‹è¦‹æ©˜è‰²çš„æ—‹è½‰éˆ•è½‰å‹•ï¼Œä»£è¡¨ Event Loop)</li><li>ç¬¬ 10 è¡Œæ’é€² Call Stack ï¼Œå°å‡º â€˜Click the buttonâ€™ï¼Œtimeout() åŸ·è¡Œå®Œç•¢ï¼Œç§»å‡º Call Stack å¤–ï¼ŒStack åˆè®Šæˆç©ºçš„ã€‚</li></ol><p><strong>å¦‚æœé€™æ™‚å€™æŒ‰ä¸‹æŒ‰éˆ•å‘¢ ?</strong></p><ol><li>æŒ‰ä¸‹å¾Œï¼ŒonClick äº‹ä»¶åŸ·è¡Œï¼Œæ’é€² Call Stack</li><li>åŸ·è¡Œç¬¬ 2 è¡Œ setTimeout ï¼ŒæŠŠ setTimeout æ”¾ç½®åˆ° Web APIs ç­‰å¾…ï¼Œä¸¦ä¸”é–‹å§‹ç®— 2 ç§’é˜ï¼ŒonClick äº‹ä»¶åŸ·è¡Œå®Œç•¢ï¼Œç§»å‡º Call Stack å¤–ï¼ŒStack åˆè®Šæˆç©ºçš„</li><li>éäº†å¤§æ¦‚ 2 ç§’é˜ï¼Œ æŠŠ setTimeOut çš„ callback <code>timer()</code> æ”¾åˆ° Callback Queueã€‚</li><li><strong>æ­¤æ™‚ Call Stack ç‚ºç©ºçš„ï¼ŒæŠŠ Task Queue ç¬¬ä¸€é †ä½çš„ timer() æ¬åˆ° Call Stack åŸ·è¡Œ</strong></li><li>ç¬¬ 3 è¡Œæ’é€² Call Stackï¼Œå°å‡º â€˜You click the button !â€™ï¼ŒåŸ·è¡Œå®Œç•¢ï¼Œç§»å‡º Call Stack å¤–ï¼ŒStack åˆè®Šæˆç©ºçš„ã€‚</li></ol><p>ä»¥ä¸Šæ˜¯ä¸€æ­¥æ­¥è·Ÿè‘—çš„ Event Loop çš„åŸºæœ¬é‹ä½œ</p><h4 id="Blocking-é˜»å¡">Blocking (é˜»å¡)</h4><blockquote><p>é‚£å¦‚æœä¸€ç›´æŒ‰æŒ‰éˆ•å‘¢ ?</p></blockquote><p>æœƒç™¼ç¾ä¸€å€‹å€‹ onClick äº‹ä»¶çš„ callback æœƒè¢«æ’é€² Callback Queue æ­£åœ¨æ’éšŠç­‰å¾…ï¼ŒsetTimeout åŒæ™‚ä¹Ÿåœ¨æ’éšŠï¼Œä¹Ÿè¦ç­‰å¾… onClick äº‹ä»¶çµæŸï¼Œç§»å‡º Call Stack å¤–ï¼Œé€é Event Loop æª¢æŸ¥ Call Stack æ˜¯å¦ç‚ºç©ºâ€¦(ç•¥)ï¼Œé‡è¤‡ä¸€ç›´åŸ·è¡Œã€‚</p><p>é€™æ™‚å€™ç•«é¢å°±å¥½åƒéœæ­¢äº†ï¼ŒsetTimeout çš„ 2 ç§’ä¹Ÿä¸æ˜¯å¾ˆç²¾æº–ï¼Œé€™å°±æ˜¯ç™¼ç”Ÿäº† Blocking ã€‚</p><p>å¦‚æœæœƒä»¥ç‚ºåŒæ™‚å°å‡ºï¼Œè¦å›æƒ³ <strong>JavaScript æ˜¯åŒæ­¥çš„</strong> é€™å¥è©±ï¼ŒåŸ·è¡Œçš„çµæœæœƒæ˜¯ä¾åºå‡ºç¾ï¼Œä¸æœƒä¸€ä¸‹å­ â€œå•ª!â€ å…¨éƒ¨å‡ºä¾†ã€‚</p><h5 id="é˜»å¡å¸¸è¦‹çš„ä¾‹å­-ç„¡é™æ»¾å‹•è¼‰å…¥è³‡æ–™">é˜»å¡å¸¸è¦‹çš„ä¾‹å­ : ç„¡é™æ»¾å‹•è¼‰å…¥è³‡æ–™</h5><p>å¦‚æœç›´æ¥ :</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;scroll&#x27;</span>,<span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="comment">// Ajax ç²å–è³‡æ–™</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ç™¼ç¾æ¯ä¸€æ»‘ï¼Œéƒ½æœƒè§¸ç™¼ callback ã€‚å°±åƒä½ ä¸€ç›´æŒ‰æŒ‰éˆ•ï¼Œç„¶å¾Œç™¼å‡ºè«‹æ±‚è³‡æ–™ï¼Œæ’é€² Web APIs ä¸¦ä¸”ç­‰å¾…è³‡æ–™çš„ response ï¼Œå†æ’é€² Callback Queueï¼Œé€™æ™‚å€™æœƒé€ æˆ Blockingã€‚ç‚ºé¿å…ä¸€ç›´è§¸ç™¼ scroll äº‹ä»¶ï¼Œé€šå¸¸æœƒæ­é… lodash çš„ debounceã€‚</p><h3 id="å°çµ-Event-Loop-æ˜¯â€¦">å°çµ : Event Loop æ˜¯â€¦</h3><p>ä¸€ç¨®æ©Ÿåˆ¶ï¼Œè®“ JavaScript å¯ä»¥åŒæ™‚åšå¾ˆå¤šäº‹</p><blockquote><p>ç•¶ Call Stack ç‚ºç©ºæ™‚ï¼ŒæŠŠ Callback Queue ç­‰å¾…çš„ callback function æ”¾é€² Call Stack ä¾†åŸ·è¡Œ</p></blockquote><h2 id="å¹¾å€‹-Event-Loop-çš„ä¾‹å­">å¹¾å€‹ Event Loop çš„ä¾‹å­</h2><p>ä¾†è‡ª <a href="https://www.youtube.com/watch?v=8aGhZQkoFbQ">What the heck is the event loop anyway?</a> æåˆ°çš„ç¯„ä¾‹</p><h3 id="æ²’é‚£éº¼ç²¾æº–çš„-setTimeout-èˆ‡-setInterval">æ²’é‚£éº¼ç²¾æº–çš„ setTimeout èˆ‡ setInterval</h3><p>setTimeout èˆ‡ setInterval éƒ½æ˜¯ Web APIs ï¼Œæœƒæ’é€² Callback Queue ä¸¦ä¸”ç­‰åˆ° Call Stack ç‚ºç©ºçš„æ™‚å€™æ‰åŸ·è¡Œã€‚æ‰€ä»¥ä¸èƒ½ä¿è­‰ä¸€å®šç²¾æº– x ç§’å¾ŒåŸ·è¡Œï¼Œä½†è‡³å°‘åŸ·è¡Œé–“è·çš„æœ€å°ç§’æ•¸æ˜¯ x ç§’ã€‚</p><p><strong>å¸¸è¦‹çš„ 0 ç§’ setTimeout</strong><br>ä¹çœ‹ä¹‹ä¸‹æœƒä»¥ç‚º 0 ç§’æ˜¯ç«‹å³åŸ·è¡Œï¼Œå…¶å¯¦ä¸ç„¶ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">&#125;,<span class="number">0</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hi&#x27;</span>)</span><br></pre></td></tr></table></figure><p>çµæœæ˜¯ <code>hi</code> å…ˆå°å‡ºï¼Œå†å°å‡º <code>hello</code>ã€‚</p><p>è·Ÿè‘—æ­¥é©Ÿèµ° :</p><ol><li>setTimeout æ”¾å…¥ Web APIs ç­‰å¾… 0 ç§’å¾Œï¼Œæ”¾å…¥ Task Queue ç­‰å¾…</li><li><code>console.log('hi')</code> æ’é€² Call Stackï¼Œä¸¦ä¸”åŸ·è¡Œ</li><li>å°å‡º â€˜hiâ€™ ï¼ŒåŸ·è¡ŒçµæŸï¼Œç§»å‡º Stack å¤–</li><li>æ­¤æ™‚çš„ Call Stack æ˜¯ç©ºçš„ï¼Œè€Œä¸” Task Queue çš„ç¬¬ä¸€ä½æ˜¯ setTimeout çš„ callback ï¼Œæ’é€² Call Stack</li><li>åŸ·è¡Œ <code>console.log('hello')</code></li><li>å°å‡º â€˜helloâ€™ï¼ŒåŸ·è¡ŒçµæŸï¼Œç§»å‡º Stack å¤–</li><li>ç¨‹å¼ç¢¼åŸ·è¡ŒçµæŸ</li></ol><p>é€™ä¹Ÿæ˜¯ç‚ºä»€éº¼ setTimeout  æ²’é‚£éº¼ ç²¾æº–çš„åŸå› ï¼Œå› ç‚ºå¿…é ˆç­‰åˆ°  Call Stack ç‚ºç©ºæ‰æœƒåŸ·è¡Œï¼Œå°è‡´ä¸­é–“å¯èƒ½æœƒæœ‰èª¤å·®ã€‚</p><h3 id="å¤šå€‹-setTimeout">å¤šå€‹ setTimeout</h3><p>é‡åˆ° setTimeout å¸¸æœƒå• console.log çš„çµæœæ˜¯ ?</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span> <span class="title function_">timeout</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hi&#x27;</span>)</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span> <span class="title function_">timeout</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hi&#x27;</span>)</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span> <span class="title function_">timeout</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hi&#x27;</span>)</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span> <span class="title function_">timeout</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hi&#x27;</span>)</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure><ol><li>æ¯é–“éš” 1 ç§’å¾Œï¼Œä¾åºå°å‡º â€˜hiâ€™ (1 ç§’ â€˜hiâ€™ï¼Œéš” 1 ç§’ â€˜hiâ€™â€¦)</li><li>åœ¨ 4 ç§’å¾Œï¼ŒåŒæ™‚å°å‡º <figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">4 </span>(hi)</span><br></pre></td></tr></table></figure></li><li>è‡³å°‘é–“è· 1 ç§’ä»¥å¾Œï¼Œä¸€æ¬¡å°å‡º 4 æ¬¡çš„ <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hi</span><br><span class="line">hi</span><br><span class="line">hi</span><br><span class="line">hi</span><br></pre></td></tr></table></figure></li></ol><p>.<br>.<br>.<br>.<br>.<br>.<br>.<br>çµæœæ˜¯<strong>è‡³å°‘é–“è· 1 ç§’ä»¥å¾Œï¼Œä¸€æ¬¡å°å‡º 4 æ¬¡çš„ hi</strong> ã€‚ç¶“é 1 ç§’å¾Œå³ä½¿å·²ç¶“æ’å®šåˆ° Callback Queueï¼Œä½†æ˜¯å¦‚æœé€™æ™‚å€™ Call Stack é‚„ä¸æ˜¯ç©ºçš„ï¼ŒQueue å°±æœƒç™¼ç”Ÿ Blocking å¡è»Šåœ¨é€™è£¡ç­‰å¾…ï¼Œç­‰åˆ° Stack ç©ºå†ä¾åºå°å‡º hiã€‚å¦‚æœ 1 ç§’çŸ­åˆ°çœ‹ä¸è¦‹ï¼Œå¯ä»¥èª¿æˆæ›´ä¹…çš„æ™‚é–“ã€‚</p><h3 id="åŒæ­¥èˆ‡éåŒæ­¥çš„-callback">åŒæ­¥èˆ‡éåŒæ­¥çš„ callback</h3><p>æˆ‘è¦ºå¾—é€™å€‹ä¾‹å­å¾ˆæœ‰æ„æ€ï¼Œæˆ‘å€‘çŸ¥é“é »ç¹çš„å‘¼å« callback function æœƒé€ æˆ Blocking çš„æƒ…å½¢ï¼Œä½†æ˜¯ <strong>Call Stack å¡è»Šæˆ–æ˜¯ Callback Queue å¡è»Šæœ‰ä»€éº¼å·®åˆ¥å‘¢ ?</strong></p><p>é€éé€™å€‹ä¾‹å­æˆ‘è‡ªå·±è¦ºå¾—æ›´æ¸…æ¥šçŸ¥é“æœ‰äº† Event Loop åˆ°åº•å¹«åŠ©åœ¨å“ªã€‚</p><p>åœ¨é€™è£¡çš„ callback function æœ‰å…©ç¨®</p><ol><li>åœ¨å‡½å¼ä¸­å‘¼å«å¦ä¸€å€‹å‡½å¼ (åŒæ­¥çš„ callbackï¼Œéƒ½åœ¨ Call Stack åŸ·è¡Œå®Œç•¢) <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>].<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">i</span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(i)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li>åƒæ˜¯è·Ÿ Web APIs æœ‰é—œçš„ï¼Œä¾‹ : click äº‹ä»¶å¾Œçš„ callback function ä¸æœƒé¦¬ä¸ŠåŸ·è¡Œï¼Œè€Œæ˜¯ç­‰åˆ° Event Loop å¾Œæ‰æœƒã€‚<br>(éåŒæ­¥çš„ callback  å·®åˆ¥åœ¨æ–¼ï¼Œæœ‰æ’éšŠåˆ° Callback Queue å†åˆ° Call Stack) <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>].<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">i</span>)&#123;</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(i)</span><br><span class="line">&#125;,<span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ol><h4 id="åŒæ­¥çš„-callback-ç™¼ç”Ÿäº†ä»€éº¼äº‹">åŒæ­¥çš„ callback ç™¼ç”Ÿäº†ä»€éº¼äº‹</h4><p>å¦‚ä¸Šé¢çš„ç¬¬ä¸€å€‹ callback ç¯„ä¾‹ï¼Œæˆ‘å€‘å¿…é ˆç­‰åˆ° forEach å°å®Œæ‰€æœ‰å…ƒç´ ï¼Œæ‰èƒ½åšå…¶ä»–çš„äº‹ã€‚é€™æ®µæ™‚é–“é€ æˆ Call Stack çš„ Blockingï¼Œå°è‡´ç•«é¢ä¸èƒ½å‹•ä½œã€‚</p><p>ä¸€èˆ¬ä¾†èªªï¼Œç€è¦½å™¨æœƒåœ¨æ¯ 16.6 æ¯«ç§’çš„æ™‚å€™é‡æ–°æ¸²æŸ“ç•«é¢ï¼Œä½†é€™æ™‚å€™ Call Stack é‚„åœ¨è™•ç†äº‹æƒ…ï¼Œå°è‡´ç•«é¢çš„è§£æè¢«å»¶é²ï¼Œåœ¨å½±ç‰‡ä¸­è¬›è€…æœ‰é–‹å•Ÿæ¨¡æ“¬ç•«é¢ render çš„æ¨¡æ“¬ï¼Œrender ä¸€ç›´è¢«å æ“šç´…ç·šã€‚</p><h4 id="æ”¹æˆéåŒæ­¥çš„-callback-å·®åˆ¥åœ¨å“ª">æ”¹æˆéåŒæ­¥çš„ callback å·®åˆ¥åœ¨å“ª ?</h4><p>ä¸Šé¢ä¸æ–·å¼·èª¿ Event Loop æ˜¯ Call Stack ç‚ºç©ºæ™‚ï¼Œæ‰æœƒæŠŠ Callback Queue æ¨ä¸Š Stack åŸ·è¡Œã€‚è€Œåœ¨ Call Stack ç©ºçš„æœŸé–“ï¼Œæä¾›ç€è¦½å™¨åŸ·è¡Œç•«é¢é‡æ–°æ¸²æŸ“çš„æ©Ÿæœƒï¼Œæ‰ä¸æœƒå› ç‚ºå¿™ç¢Œå°è‡´å¡ä½ã€‚</p><blockquote><p>ç°¡å–®ä¾†èªª : <strong>ç•«é¢æ¸²æŸ“çš„å„ªå…ˆåº¦æ˜¯é«˜æ–¼ Callback Queue çš„ callback function</strong></p></blockquote><p>é€™ä¹Ÿæ˜¯ç‚ºä»€éº¼åœ¨å½±ç‰‡è¬›è€…æåˆ°ä¸è¦é€ æˆè€—æ™‚çš„ç¨‹å¼ç¢¼æ”¾åœ¨ Call Stack ï¼Œå› ç‚º Call Stack è³½è»Šæ²’è¾¦æ³•é‡æ–°æ¸²æŸ“ç•«é¢ã€‚</p><p>ä¹Ÿå¯ä»¥åƒè€ƒé€™ç¯‡ Jack å¤§çš„å¯¦ä½œç¯„ä¾‹äºŒï¼Œæ–‡ç« ä¹Ÿæœ‰æåˆ°ä»€éº¼æ™‚å€™æœƒ renderingï¼ŒåŠ©æ–¼ç­è§£æ•´å€‹æµç¨‹<br>ğŸ‘‰ <a href="https://yu-jack.github.io/2020/02/03/javascript-runtime-event-loop-browser/#%E7%AF%84%E4%BE%8B%E4%BA%8C">Event Loop é‹è¡Œæ©Ÿåˆ¶è§£æ - ç€è¦½å™¨ç¯‡ - æŠ€è¡“é›œè¨˜ Technology Notes - Jack Yu | å‚‘å…‹</a></p><h2 id="çµèª-11">çµèª</h2><p>ç›®å‰æåˆ°ç€è¦½å™¨çš„ Event Loop ï¼Œè‡³æ–¼ Node çš„ Event Loop æˆ‘é‚„æ²’ç ”ç©¶ï¼Œæœªä¾†æœƒå†ç ”ç©¶è£œå……ã€‚ä¸éé‚„æœ‰ mircoTask èˆ‡ macroTask é‚„æ²’è£œå®Œ QQï¼Œæ‰èƒ½ç®—æ˜¯äº†è§£ Event Loopã€‚</p><p>å¦‚æœæœ‰èª¤éº»ç…©è«‹å¯„ä¿¡å‘Šè¨´æˆ‘ï¼Œæˆ‘æœƒéå¸¸æ„Ÿè¬</p><h2 id="åƒè€ƒ">åƒè€ƒ</h2><ol><li><a href="https://pjchender.blogspot.com/2017/08/javascript-learn-event-loop-stack-queue.html">[ç­†è¨˜] ç†è§£ JavaScript ä¸­çš„äº‹ä»¶å¾ªç’°ã€å †ç–Šã€ä½‡åˆ—å’Œä½µç™¼æ¨¡å¼ | PJCHENder é‚£äº›æ²’å‘Šè¨´ä½ çš„å°ç´°ç¯€</a></li><li>è¬›è§£ Event Loop çš„å½±ç‰‡(æœ‰ä¸­æ–‡å­—å¹•) : <a href="https://www.youtube.com/watch?v=8aGhZQkoFbQ">What the heck is the event loop anyway? | Philip Roberts | JSConf EU - YouTube</a></li><li>æ¨¡æ“¬ Event Loop çš„ç¶²é  : <a href="http://latentflip.com/loupe/?code=JC5vbignYnV0dG9uJywgJ2NsaWNrJywgZnVuY3Rpb24gb25DbGljaygpIHsKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gdGltZXIoKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1lvdSBjbGlja2VkIHRoZSBidXR0b24hJyk7ICAgIAogICAgfSwgMjAwMCk7Cn0pOwoKY29uc29sZS5sb2coIkhpISIpOwoKc2V0VGltZW91dChmdW5jdGlvbiB0aW1lb3V0KCkgewogICAgY29uc29sZS5sb2coIkNsaWNrIHRoZSBidXR0b24hIik7Cn0sIDUwMDApOwoKY29uc29sZS5sb2coIldlbGNvbWUgdG8gbG91cGUuIik7!!!PGJ1dHRvbj5DbGljayBtZSE8L2J1dHRvbj4%3D">latentflip.com</a></li><li><a href="https://yu-jack.github.io/2020/02/03/javascript-runtime-event-loop-browser/#%E7%AF%84%E4%BE%8B%E4%BA%8C">Event Loop é‹è¡Œæ©Ÿåˆ¶è§£æ - ç€è¦½å™¨ç¯‡ - æŠ€è¡“é›œè¨˜ Technology Notes - Jack Yu | å‚‘å…‹</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€-30&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;åœ¨ JavaScript ä¸­ï¼ŒéåŒæ­¥çš„æ“ä½œæ˜¯å¾ˆå¸¸è¦‹çš„ï¼Œèˆ‰å‡¡æ»‘é¼ äº‹ä»¶ã€ç™¼å‡ºè«‹æ±‚ç²å–è³‡æ–™â€¦ç­‰ï¼Œåéä¾†å•ï¼Œå¦‚æœé€™äº›æ“ä½œæ˜¯ &lt;strong&gt;åŒæ­¥&lt;/strong&gt; çš„ï¼Œä½ å¯èƒ½æ“ä½œå¾Œï¼Œç•«é¢å°±åƒè¢«å¡ä½äº†ï¼Œè¦ç­‰åˆ°ç›®å‰çš„ç¨‹å¼åŸ·è¡Œå®Œç•¢æ‰èƒ½ç¹¼çºŒç€è¦½ã€‚&lt;/p&gt;
&lt;p&gt;Event Loop çš„æ¦‚å¿µå¦‚ä½•å¹«æˆ‘å€‘äº†è§£é€™ä»¶äº‹ï¼Œå…·é«”æ€éº¼åšå‘¢ ? æœ¬ç¯‡ä¸»è¦æ˜¯å¹«åŠ©æˆ‘è‡ªå·±é‡æ¸… Event Loop çš„æ¦‚å¿µã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="2022" scheme="https://blog.rosa.tw/categories/2022/"/>
    
    <category term="06" scheme="https://blog.rosa.tw/categories/2022/06/"/>
    
    
    <category term="JavaScript" scheme="https://blog.rosa.tw/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>ç­†è¨˜ | JavaScript - é‹ç®—å­ ?. èˆ‡ ??</title>
    <link href="https://blog.rosa.tw/2022/06/06/JavaScript-null-undefined-operator"/>
    <id>https://blog.rosa.tw/2022/06/06/JavaScript-null-undefined-operator</id>
    <published>2022-06-15T06:31:13.000Z</published>
    <updated>2022-07-27T14:15:29.614Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€-31">å‰è¨€</h2><p>å°æ–¼ undefined æˆ–æ˜¯ null çš„è™•ç†ï¼Œæˆ‘æ¯”è¼ƒå¸¸ä½¿ç”¨ <code>||</code> (OR) æˆ–æ˜¯ <code>&amp;&amp;</code> (AND) çš„å¯«æ³•ï¼Œæ‰¾è³‡æ–™çš„æ™‚å€™å¾ˆå¸¸çœ‹è¦‹ <code>??</code> ä»¥åŠ <code>?.</code> çš„å¯«æ³•ã€‚å¯¦åœ¨æ˜¯å¤ªå¥½å¥‡äº†ï¼Œæ–¼æ˜¯æ‰¾äº†è³‡æ–™å­¸ç¿’ä¸¦ä¸”è¨˜éŒ„ä¸‹ä¾† ã€‚</p><span id="more"></span><h2 id="Optional-chaining">Optional chaining (?.)</h2><p>å¦‚æœè¦æŸ¥æ‰¾ <strong>Object çš„æŸé …æ˜¯å¦å­˜åœ¨</strong>ã€‚æˆ‘å€‘å¯èƒ½æœƒéæ­·æ•´å€‹ç‰©ä»¶ï¼Œä½†ä¸ç”¨é€™éº¼éº»ç…©ï¼Œå¯ä»¥ä½¿ç”¨ <code>obj?.</code> ï¼Œå¦‚æœç‰©ä»¶æ˜¯ null æˆ–æ˜¯ undefined å°±åšåˆ¥çš„è™•ç†ï¼Œåœ¨åˆ¤æ–·å€¼å­˜åœ¨èˆ‡å¦å°±å¾ˆå¥½ç”¨ã€‚</p><p>ä¾‹ :</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;<span class="attr">a</span>: <span class="number">1</span>&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj?.<span class="property">b</span>) <span class="comment">// undefined</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">a</span> + (obj?.<span class="property">b</span> || <span class="number">2</span>)) <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><p>é‚£åœ¨å·¢ç‹€çš„çµæ§‹ä¸­å¦‚æœä¸ç”¨ <code>?.</code> ï¼Œå¿…é ˆå…ˆåˆ¤æ–·å‰é¢çš„æ˜¯ä¸æ˜¯å­˜åœ¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">a</span> &amp;&amp; obj.<span class="property">a</span>.<span class="property">b</span>) <span class="comment">// obj.a å­˜åœ¨æ‰å¾€ä¸‹ä¸€æ­¥</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">a</span>?.<span class="property">b</span>) <span class="comment">// ä½¿ç”¨ ?.</span></span><br></pre></td></tr></table></figure><p>é€é (?.) çš„æ–¹å¼ JavaScript å…§éƒ¨æœƒé€ééš±å¼ (implicitly) å»ç¢ºèª obj.a æ˜¯ä¸æ˜¯ null æˆ–æ˜¯ undefinedï¼Œè€Œä¸ç”¨é¡¯å¼ (explicitly) ç¢ºèª obj.a å­˜ä¸å­˜åœ¨å†å»åˆ¤æ–·ä¸‹ä¸€å€‹ã€‚</p><h3 id="ç‚ºä»€éº¼è¦æœ‰">ç‚ºä»€éº¼è¦æœ‰ (?.)</h3><p>å¾ä¸€èˆ¬çš„åˆ¤æ–·ä¾†èªªï¼Œæˆ‘å€‘å¯ä»¥ç”¨ <code>||</code>  ä¾†æ±ºå®šå€¼å­˜ä¸å­˜åœ¨ï¼Œå› è€Œä¾†è¨­å®š <strong>é è¨­å€¼</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> product =&#123;</span><br><span class="line">name : <span class="string">&#x27;Rosa&#x27;</span>,</span><br><span class="line">cost : <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> total = product.<span class="property">cost</span> || <span class="number">50</span> <span class="comment">// ?</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(total)</span><br></pre></td></tr></table></figure><p>é›–ç„¶ <code>||</code> å¾ˆå¥½ç”¨ï¼Œä½†æ˜¯ <code>||</code> æœƒå¼·åˆ¶è½‰å‹ï¼Œä¹Ÿå°±æ˜¯ falsy ã€‚æ•¸å­— 0 åœ¨åˆ¤æ–·ä¸­æœƒè¢«è½‰ç‚º false ï¼Œå› æ­¤åœ¨ä¸Šé¢çš„ä¾‹å­ï¼Œæ•¸å­— 0 ä¹Ÿæœƒè¢«åˆ¤æ–·æˆ false è€Œé è¨­æˆ 50ã€‚</p><p>å¯èƒ½æœƒæƒ³èªªé‚£åˆ¤æ–· <code>&gt;=0</code> ä¸å°±å¯ä»¥äº† ?</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> total = product.<span class="property">cost</span> &gt;= <span class="number">0</span> ? product.<span class="property">cost</span> : <span class="number">50</span> </span><br></pre></td></tr></table></figure><p>æ˜¯å¯ä»¥ï¼Œä½†æœƒé‡è¤‡å¯«å…©æ¬¡ <code>product.cost</code>ğŸ¥´ã€‚<br>BUT !!! å¦‚æœæœ‰ <strong>è² æ•¸</strong> å‘¢ ? ç¸½ä¸èƒ½åˆ¤æ–·ä¸æ˜¯ 0 å§ã€‚<br>é‚è¼¯å¯«æ³•å°±æ›´ç¶æ‰‹ç¶è…³ï¼Œä½†æˆ‘å€‘å¯¦éš›åªç¢ºèªæ˜¯ä¸æ˜¯ç©ºå€¼æˆ–æ˜¯ç‚ºè³¦å€¼è€Œå·²ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> total = (product.<span class="property">cost</span> === <span class="literal">null</span> || product.<span class="property">cost</span> === <span class="literal">undefined</span>) ? <span class="number">50</span> : product.<span class="property">cost</span></span><br></pre></td></tr></table></figure><p>å› æ­¤ short-hand çš„ <code>?.</code> èª•ç”Ÿï¼Œè®“æˆ‘å€‘å¯ä»¥æ›´å¿«åˆ¤æ–·ã€‚</p><blockquote><p>IE ä¸¦ä¸æ”¯æ´ <code>?.</code> ï¼Œå¦‚æœè¦ä½¿ç”¨å°±æ˜¯ <strong>ä¾åºåˆ¤æ–·æ˜¯å¦ç‚º null æˆ–æ˜¯ undefined</strong></p></blockquote><h3 id="fuction-call-çš„">fuction call çš„ (?.)</h3><p>MDN æœ‰æåˆ°æ˜¯å¦‚æœä½¿ç”¨å¥—ä»¶çš„ APIï¼Œå¯ä»¥ä½¿ç”¨é€™ç¨®æ–¹å¼ï¼Œå¯ä»¥ç¢ºèª function æ˜¯å¦å­˜åœ¨å†åŸ·è¡Œï¼Œä»¥å…ç™¼ç”ŸéŒ¯èª¤ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sayhello = &#123;</span><br><span class="line"><span class="title function_">hello</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sayhello.<span class="property">hi</span>?.()) <span class="comment">// undefined ï¼Œä¸æœƒç™¼ç”ŸéŒ¯èª¤</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sayhello?.<span class="title function_">hello</span>()) <span class="comment">// hello</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœ hi æœ¬èº«ä¸¦ä¸æ˜¯ function å°±æœƒç™¼ç”Ÿ <code>is not a function</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sayhello.<span class="property">hi</span> = <span class="string">&#x27;123&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sayhello.<span class="property">hi</span>?.()) <span class="comment">// hi is not a function</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sayhello?.<span class="title function_">hello</span>()) <span class="comment">// ä¸æœƒåŸ·è¡Œï¼Œå› ç‚ºä¸Šé¢å‡ºç¾éŒ¯èª¤</span></span><br></pre></td></tr></table></figure><p>æ‰‹å‹•çŸ¯æ­£ :</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sayhello.<span class="property">hi</span> = <span class="string">&#x27;123&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> sayhello.<span class="property">hi</span>=== <span class="string">&#x27;function&#x27;</span> ? sayhello.<span class="title function_">hi</span>() : sayhello.<span class="property">hi</span> ) <span class="comment">// &#x27;123&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sayhello?.<span class="title function_">hello</span>())  <span class="comment">// hello</span></span><br></pre></td></tr></table></figure><h3 id="ä»€éº¼æ™‚å€™ä¸æ‡‰è©²ç”¨">ä»€éº¼æ™‚å€™ä¸æ‡‰è©²ç”¨ (?.)</h3><ol><li>æ²’æœ‰è¢« <strong>å®£å‘Š</strong> çš„è®Šæ•¸ : å°è®Šæ•¸ä½¿ç”¨ï¼Œæœƒç™¼ç”ŸéŒ¯èª¤ï¼Œå› ç‚º a ä¸¦ä¸å­˜åœ¨ (is not defined)ï¼Œä¸¦ä¸èƒ½é€™æ¨£åˆ¤æ–·ã€‚ <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a?.<span class="property">b</span>) <span class="comment">// a is not defined</span></span><br></pre></td></tr></table></figure></li><li>é‡æ–°è³¦å€¼ (left-hand side) : ä¸èƒ½é€™æ¨£ä½¿ç”¨ <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;<span class="attr">a</span>: <span class="number">2</span>&#125;</span><br><span class="line">obj?.<span class="property">a</span>  = <span class="number">1</span>  <span class="comment">// Invalid left-hand side in assignment</span></span><br></pre></td></tr></table></figure></li><li>æœ¬èº«æ˜¯ null <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="literal">null</span></span><br><span class="line"><span class="keyword">let</span> x = <span class="number">0</span></span><br><span class="line"><span class="keyword">let</span> prop = a?.[x++]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(x) <span class="comment">// 0 ä¸¦ä¸æœƒå¢åŠ </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a) <span class="comment">// null</span></span><br></pre></td></tr></table></figure>é€™é‚Šæˆ‘æœ‰é»ä¸å¤ªäº†è§£ï¼Œå› æ­¤æˆ‘è©¦äº†ç©ºç‰©ä»¶ï¼Œx éå¢æ˜¯  1 ğŸ¤”ï¼Œa ä¾ç„¶æ˜¯ç©ºç‰©ä»¶ã€‚å¾Œä¾†æˆ‘æ‰¾åˆ° <a href="https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Operators/Operator_Precedence">é‹ç®—å­å„ªå…ˆåº - JavaScript | MDN (mozilla.org)</a>ï¼Œç°¡å–®ä¾†èªª <strong>è¶Šé«˜éšçš„é‹ç®—å­æœƒæŒ‰ç…§è¦å‰‡å…ˆåŸ·è¡Œ</strong>ã€‚<br><code>?.</code> æ˜¯ 18 ,åˆ¤æ–·æ˜¯å¾å·¦è‡³å³ã€‚a å·²ç¶“æ˜¯ null äº†ï¼Œæ‰€ä»¥ä¸æœƒåŸ·è¡Œã€‚ä½†æ˜¯å¦‚æœæ˜¯ç©ºç‰©ä»¶ <code>&#123;&#125;</code>ï¼Œ?. æœƒåŸ·è¡Œï¼Œä¸æ˜¯ null ä¹Ÿä¸æ˜¯ undefinedã€‚è€Œ<code>[ ]</code> è·Ÿ <code>?.</code> çš„å±¤ç´šç›¸åŒï¼Œ<code>[x]</code> å­˜åœ¨æ‰€ä»¥ä¹ŸæœƒåŸ·è¡Œ ï¼Œ <code>++</code> ä¹ŸæœƒåŸ·è¡Œã€‚(é€™é‚Šæœ‰é»ä¸å¤ªç¢ºå®šï¼Œå¾…è£œ)</li></ol><p>å¦ä¸€å€‹æœ‰é—œå„ªå…ˆåºçš„å¸¸è¦‹ä¾‹å­æ˜¯ <code>(function()&#123;var a = b = 5&#125;)()</code>ï¼Œåœ¨éåš´æ ¼æ¨¡å¼ä¸‹ï¼Œ global ä¾åºå°å‡º b è·Ÿ a ï¼Œb æ˜¯ 5 ï¼Œa æ˜¯ is not definedã€‚å› ç‚º <code>=</code> æ˜¯ right-to-leftï¼Œä¹Ÿå°±æ˜¯ b åœ¨æœªå®£å‘Šä¸‹è³¦å€¼ï¼Œ<code>var  a</code> å› ä½œç”¨åŸŸçš„é—œä¿‚ï¼Œè‡ªç„¶åœ¨ global æ˜¯ not definedã€‚</p><blockquote><p>MDN ä¹Ÿæåˆ°ä¸æ‡‰è©²éåº¦ä½¿ç”¨ (?.)</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj?.[<span class="string">&#x27;Rosa&#x27;</span>]?.<span class="property">number</span> ? obj.[<span class="string">&#x27;Rosa&#x27;</span>].<span class="property">number</span> : obj?.[<span class="string">&#x27;Rosa&#x27;</span>]) <span class="comment">// ğŸ‘ï¼Œå› ç‚ºåœ¨ obj.[&#x27;Rosa&#x27;] ä¸å­˜åœ¨å°±å¯ä»¥åœæ­¢äº†ï¼Œä¸ç”¨ä¸²ä¸²æ¨‚ä¾†ç¢ºèª</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj?.[<span class="string">&#x27;Rosa&#x27;</span>] ? obj.[<span class="string">&#x27;Rosa&#x27;</span>].<span class="property">number</span> : <span class="literal">undefined</span>) <span class="comment">// V</span></span><br></pre></td></tr></table></figure><h2 id="Nullish-coalescing-operator">Nullish coalescing operator (??)</h2><p>å¯ç”¨ä¾†åˆ¤æ–· <strong>æŸå€‹å€¼æ˜¯ null æˆ–æ˜¯ undefined</strong></p><h3 id="ç‚ºä»€éº¼è¦æœ‰-2">ç‚ºä»€éº¼è¦æœ‰ (??)</h3><p>è·Ÿä¸Šé¢æåˆ° <code>||</code> çš„åˆ¤æ–·æ˜¯ä¸€æ¨£çš„ï¼Œå¦‚æœæ˜¯æ•¸å­— 0 æœƒè¢«å¼·åˆ¶è½‰å‹æ¯”è¼ƒæˆ falseï¼Œå¦‚æœåªæ˜¯æƒ³æª¢æŸ¥ null æˆ–æ˜¯ undefinedï¼Œ?? å°±æœƒæ¯”è¼ƒæ–¹ä¾¿ ã€‚</p><p><strong>èˆ‰ä¾‹ä¾†èªª</strong></p><ol><li>å…ˆè®“ input æœ‰ 0 æˆ–æ˜¯æœ‰å€¼</li><li>æ‰‹å‹•æŠŠ input çš„å€¼å®Œå…¨æ¸…ç©ºï¼Œ <code>e.target.value</code> æœƒæ˜¯ <strong>ç©ºå­—ä¸²</strong>ï¼Œä½†æ˜¯æˆ‘ä¸æƒ³è®“ç©ºå­—ä¸²ä¹Ÿé€šé</li></ol><p class="codepen" data-height="300" data-default-tab="html,result" data-slug-hash="ZErwEBe" data-user="shan473" style="height: 300px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;">  <span>See the Pen <a href="https://codepen.io/shan473/pen/ZErwEBe">  ç·´ç¿’ ?? &amp; ?.</a> by YanShanHong (<a href="https://codepen.io/shan473">@shan473</a>)  on <a href="https://codepen.io">CodePen</a>.</span></p><script async src="https://cpwebassets.codepen.io/assets/embed/ei.js"></script><h3 id="function-call-çš„">function call çš„ (??)</h3><p>ä¾†è‡ª MDN çš„ç¯„ä¾‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">A</span>(<span class="params"></span>) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;A was called&#x27;</span>); <span class="keyword">return</span> <span class="literal">undefined</span>;&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">B</span>(<span class="params"></span>) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;B was called&#x27;</span>); <span class="keyword">return</span> <span class="literal">false</span>;&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">C</span>(<span class="params"></span>) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;C was called&#x27;</span>); <span class="keyword">return</span> <span class="string">&quot;foo&quot;</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="title function_">A</span>() ?? <span class="title function_">C</span>() );</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="title function_">B</span>() ?? <span class="title function_">C</span>() );</span><br></pre></td></tr></table></figure><p>æ ¹æ“š <a href="https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Operators/Operator_Precedence">é‹ç®—å­å„ªå…ˆåº</a></p><blockquote><p><code>??</code> æ˜¯ <code>left-hand side</code> ï¼Œä¹Ÿå°±æ˜¯ <strong>å¾å·¦é‚Šåˆ¤æ–·é–‹å§‹</strong>ã€‚</p></blockquote><p>å…¶çµæœæ˜¯</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;A was called&quot;</span></span><br><span class="line"><span class="string">&quot;C was called&quot;</span></span><br><span class="line"><span class="string">&quot;foo&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;B was called&quot;</span></span><br><span class="line"><span class="literal">false</span></span><br></pre></td></tr></table></figure><p>è·Ÿè‘—è·‘ä¸€æ¬¡ :</p><ol><li>A() åŸ·è¡Œï¼Œå°å‡º â€œA was calledâ€</li><li>?? çš„å·¦é‚Šæ˜¯ undefined æ‰€ä»¥æ±ºå®šåŸ·è¡Œ C()</li><li>C() åŸ·è¡Œï¼Œå°å‡º â€œC was calledâ€</li><li>?? å·¦é‚Šæ˜¯ undefined æ‰€ä»¥æ˜¯ C() å›å‚³çš„çµæœ â€˜fooâ€™</li><li>B() åŸ·è¡Œï¼Œå°å‡º â€œB was calledâ€</li><li>?? çš„å·¦é‚Šæ˜¯ false ï¼Œä¸ç¬¦åˆ null æˆ–æ˜¯ undefinedï¼ŒC() ä¸¦ä¸æœƒåŸ·è¡Œ</li><li>å›å‚³ B() çš„çµæœ</li></ol><h3 id="ä¸è¦ç›´æ¥ç”¨-OR-æˆ–-AND-ä¸€èµ·ä½¿ç”¨">ä¸è¦ç›´æ¥ç”¨ OR (||) æˆ– AND (&amp;&amp;) ä¸€èµ·ä½¿ç”¨ (??)</h3><p>OR è·Ÿ AND é‹ç®—å­çš„å„ªå…ˆåº¦æ¯” <strong>??</strong> é‚„ä½ï¼Œå› æ­¤ä¸€èµ·ä½¿ç”¨æœƒç™¼ç”ŸéŒ¯èª¤ï¼Œå³ä½¿å‰é¢çš„çµæœæ˜¯ null æˆ–æ˜¯ undefined</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">null</span> || <span class="literal">undefined</span> ?? <span class="string">&quot;foo&quot;</span>) <span class="comment">// éŒ¯èª¤</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">true</span> || <span class="literal">undefined</span> ?? <span class="string">&quot;foo&quot;</span>) <span class="comment">// éŒ¯èª¤</span></span><br></pre></td></tr></table></figure><p>æƒ³è®“å‰é¢å…ˆåˆ¤æ–·å¯ä»¥ç”¨ <code>()</code> grouping åŒ…èµ·ä¾†ï¼Œgrouping çš„å„ªå…ˆåº¦æ˜¯æœ€é«˜çš„ï¼Œæ‰€ä»¥æœƒå…ˆåŸ·è¡Œã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>((<span class="literal">null</span> || <span class="literal">undefined</span>) ?? <span class="string">&quot;foo&quot;</span>) <span class="comment">// &#x27;foo&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>((<span class="literal">true</span> || <span class="literal">undefined</span>) ?? <span class="string">&quot;foo&quot;</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h2 id="Polyfills">Polyfills</h2><p>å¦‚æœç€è¦½å™¨ä¸æ”¯æ´ (å¦‚ : IE)ï¼Œå¯ä»¥ä½¿ç”¨ Polyfillsï¼Œåªè¦åˆ¤æ–· null ä»¥åŠ undefinedã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> result = (somevalue !== <span class="literal">null</span> || somevalue !== <span class="literal">undefined</span>) ? somevalue ? <span class="title class_">DefaultValue</span></span><br></pre></td></tr></table></figure><h2 id="ç¸½çµ-18">ç¸½çµ</h2><ol><li><code>?.</code> æ˜¯ä¸­æ‰¾å°‹ Object é¡å‹ (object ã€array ã€function ç­‰ç­‰)çš„å€¼å¦‚æœæ˜¯ null æˆ–æ˜¯ undefinedï¼Œçµæœæ˜¯å³é‚Šçš„å€¼ã€‚äº¦å¯ç”¨åœ¨ function call (<strong>object.method?.()</strong>) ä¸Š</li><li><code>?.</code> ä¸ç®¡å­˜ä¸å­˜åœ¨ï¼Œä¸èƒ½ç”¨ä¾†é‡æ–°è³¦å€¼</li><li><code>??</code> æ˜¯åˆ¤æ–·ä»»ä½•å€¼å¦‚æœæ˜¯ null æˆ–æ˜¯ undefinedï¼Œçµæœæ˜¯å³é‚Šçš„å€¼</li><li><code>??</code> ä¸è¦ç›´æ¥è·Ÿ OR æˆ–æ˜¯ AND ä¸€èµ·ä½¿ç”¨ï¼Œè¦ç”¨å…ˆæŠŠ ?? å·¦é‚Šçš„æ‹¬è™Ÿèµ·ä¾†å…ˆåŸ·è¡Œ</li><li>å…©ç¨® IE ä¸æ”¯æ´ QQ</li></ol><h2 id="åƒè€ƒ-2">åƒè€ƒ</h2><ol><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining">Optional chaining (?.) - JavaScript | MDN</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Nullish_Coalescing_Operator">Nullish coalescing operator (??) - JavaScript | MDN</a></li><li><a href="https://javascript.info/optional-chaining">Optional chaining â€˜?.â€™ (javascript.info)</a></li><li><a href="https://javascript.info/nullish-coalescing-operator">Nullish coalescing operator â€˜??â€™ (javascript.info)</a></li><li><a href="https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Operators/Operator_Precedence">é‹ç®—å­å„ªå…ˆåº - JavaScript | MDN (mozilla.org)</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€-31&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;å°æ–¼ undefined æˆ–æ˜¯ null çš„è™•ç†ï¼Œæˆ‘æ¯”è¼ƒå¸¸ä½¿ç”¨ &lt;code&gt;||&lt;/code&gt; (OR) æˆ–æ˜¯ &lt;code&gt;&amp;amp;&amp;amp;&lt;/code&gt; (AND) çš„å¯«æ³•ï¼Œæ‰¾è³‡æ–™çš„æ™‚å€™å¾ˆå¸¸çœ‹è¦‹ &lt;code&gt;??&lt;/code&gt; ä»¥åŠ &lt;code&gt;?.&lt;/code&gt; çš„å¯«æ³•ã€‚å¯¦åœ¨æ˜¯å¤ªå¥½å¥‡äº†ï¼Œæ–¼æ˜¯æ‰¾äº†è³‡æ–™å­¸ç¿’ä¸¦ä¸”è¨˜éŒ„ä¸‹ä¾† ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="2022" scheme="https://blog.rosa.tw/categories/2022/"/>
    
    <category term="06" scheme="https://blog.rosa.tw/categories/2022/06/"/>
    
    
    <category term="JavaScript" scheme="https://blog.rosa.tw/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>ç´€éŒ„ | Frontend Mentor æŒ‘æˆ°é¡Œ - Time tracking dashboard</title>
    <link href="https://blog.rosa.tw/2022/04/04/Practice-to-Master-01"/>
    <id>https://blog.rosa.tw/2022/04/04/Practice-to-Master-01</id>
    <published>2022-04-29T04:00:01.000Z</published>
    <updated>2022-07-27T05:30:49.732Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€-44">å‰è¨€</h2><p>é€™æ˜¯åœ¨ <a href="https://www.frontendmentor.io/solutions/responsive-reactjs-styledcomponent-BkFnvCvr9">frontend mentor çš„æŒ‘æˆ°é¡Œ</a><br>ä½¿ç”¨ React + styled-components</p><ul><li><a href="https://meitung473.github.io/time-tracking-dashboard-main/">ç¶²é </a></li><li><a href="https://github.com/meitung473/time-tracking-dashboard-main">github repo</a></li></ul><p><img data-src="https://dsm01pap006files.storage.live.com/y4m9LQmpdiru45ZO2sTWfVBoSuRS1cfQoRCmHTFQxc-7aQWX0hkbq0r2q3tefJlGHA3SeXfA_G4CV5PHZIagjALPplvZ3s9MO6tpWyEEYyL2J7ep3EbhiNczfUybFUlxBTjvVQybnsXtFwrgoLmqEFJBftLbJvhzcipVkL-hdLjY23wEqHVpwrW0vNREUMTmt-y?width=1024&amp;height=585&amp;cropmode=none" alt="å®Œæˆåœ–"></p><span id="more"></span><h2 id="å°ˆæ¡ˆå»ºç½®">å°ˆæ¡ˆå»ºç½®</h2><ol><li><strong>create-react-app</strong> : ä¸€éµå»ºç«‹å¥½ç’°å¢ƒ</li><li><strong>eslint</strong> : åŠ ä¸Š <code>Protype</code> ä¾†æª¢æŸ¥é¡å‹</li></ol><h2 id="æˆ‘çš„æµç¨‹">æˆ‘çš„æµç¨‹</h2><ol><li>Design - ç…§è‘—åƒè€ƒåœ–åˆ»å‡º figma ç‰ˆå‹åŠå…ƒä»¶</li><li>JS - å®Œæˆ filter çš„åŠŸèƒ½ï¼Œæ‹¿å‡ºæƒ³è¦çš„è³‡æ–™</li><li>JS - ç…§ figma åˆ‡å‡º component æ¶æ§‹</li><li>CSS - mobile åˆ»æ¿</li><li>CSS - RWD</li><li>ä¸Šå‚³è‡³ frontend mentor + æ’°å¯« Readme</li></ol><h2 id="é¡å¤–ç·´ç¿’-figma-åˆ‡ç‰ˆ">é¡å¤–ç·´ç¿’ figma : åˆ‡ç‰ˆ</h2><p>ä¸€é‚Šç·´ç¿’åˆ‡ç‰ˆä»¥åŠ figma çš„ä½¿ç”¨<br>æœ¬æ¬¡å­¸ç¿’ &amp; ç·´ç¿’</p><ul><li>å…ƒä»¶ <code>component</code> :</li><li>è®Šé«” <strong>variants</strong> : ç”¨ç¨‹å¼æ¦‚å¿µæƒ³æœ‰é»åƒ obj  <code>key-value</code> pairï¼Œå¯é€éå…ˆå»ºç«‹å¥½çš„é¡ä¼¼é¡å‹ï¼Œå†æ›¿æ›é¸é …ã€‚<br>å¸¸ç”¨çš„ä¾‹å­ : æœ‰ç„¡åœ–æ¡ˆï¼Œå¯¦å¿ƒç©ºå¿ƒï¼Œæ–¹å‘ã€‚<br>figma æ˜¯ <code>[property,value]</code> ä¾†æ›¿æ›ã€‚<blockquote><p>obj çš„ key ä¸èƒ½é‡è¤‡ï¼Œ <strong>figma çš„ property ä¹Ÿæ˜¯ä¸èƒ½é‡è¤‡</strong>ã€‚<br>å¦‚æœä¸åœ¨åŒä¸€å€‹ frame è£¡çš„å…ƒä»¶ä¸èƒ½çµç‚ºè®Šé«”</p></blockquote></li><li><strong>auto layout</strong> : æœ‰é»åƒ css çš„ flex</li><li><strong>asset</strong> : å°‡é‡è¤‡çš„ç‰©ä»¶ä½œåšæˆå…ƒä»¶ï¼Œæ”¾åˆ°å…ƒä»¶åº«</li><li>å·¢ç‹€çµæ§‹ : ç”¨ <code>/</code> æ–œç·šä¾†ä»£è¡¨é¡ä¼¼çš„å…ƒä»¶ç¾¤çµ„</li></ul><p>æœ€å¾Œåˆ‡å‡ºä¾†çš„å…ƒä»¶<br><img data-src="https://dsm01pap006files.storage.live.com/y4mZHL-B7h3iluUZzub-BxoLDbrZc2Wp43yRJd2NVsXDW2zIV5XhtSM4KNshxjCkPBfsHoSgqnK2Kdxg1pBBWw0T5RjD-TTXkiNZn69EENIX9dqbxu3K51pbNjKeNhyHJ1bpXSDwFX9c_cUoC8vv_UUaPUbmLmE9C2qcbYmNRl93CPWgVuKOBRb8U8crh2FSTTU?width=656&amp;height=1024&amp;cropmode=none" alt="Asset"></p><p>èœé³¥è¨­è¨ˆç¨¿ ğŸ¥´ï¼Œç…§è‘—åœ–ç‰‡æª”æ…¢æ…¢åˆ‡å‡ºä¾†<br><img data-src="https://dsm01pap006files.storage.live.com/y4mwTdZBRAfGvMzTnynXGFrQ4yShvVgoGM-PJdXLOnF-3zi3OCyKeWiW1TYFmpurDs8l3lReNkOzMNTIDjoFCNdWNQbukzoR0iXkfmz9edOCJrqOrnH-aS2aT-17DZPd3W4cOL2lLovbNjta_rMsjlzeAgNDWQf458D4AxkOyiGYVlSHwfLTq1slPvuG8YDTHV4?width=1024&amp;height=800&amp;cropmode=none" alt="è¨­è¨ˆç¨¿"><br>ä¸ŠåŠéƒ¨éƒ½æ˜¯è®Šé«”çš„è¨­å®š</p><h3 id="è®Šé«”è¨­å®š">è®Šé«”è¨­å®š</h3><p>è®Šé«”éƒ¨åˆ†æ˜¯é€é nested çš„æ–¹å¼ï¼Œå¾å…ƒä»¶æœ€å°çš„éƒ¨åˆ†åˆ°æ•´å¡Šå¡ç‰‡éƒ½æ˜¯å¯ä»¥åˆ‡æ›</p><ol><li>å¡ç‰‡ç¨®é¡ï¼Œæˆ‘æŠŠæ¯ä¸€ç¨®éƒ½å…ˆåšæ¨£æ¿ï¼Œå¯ä»¥ç›´æ¥æ›¿æ›å¡ç‰‡ã€‚<br>ç™¼ç¾ç”¨è™•ä¸å¤§ XDï¼Œå› ç‚ºå¡ç‰‡éƒ½åªæœ‰ä¸€å¼µâ€¦ï¼Œæ›¿æ›é †åºå€’æ˜¯è »æœ‰å¹«åŠ©çš„ã€‚</li><li>æ»‘é¼ ç§»å…¥ <code>:hover</code> active &amp; inactiveã€‚<br>æˆ‘ç›´æ¥åšåœ¨ setting component ä¸Š</li><li>Profile åº•ä¸‹çš„æ™‚é–“ç¯€é»åˆ‡æ›ï¼ŒæŠŠ daily ã€ weekly ç­‰ç­‰çš„è·Ÿ setting ä¸€æ¨£åˆ†æˆ active è·Ÿ inactiveã€‚</li><li>é›»è…¦ç‰ˆå‹  &amp; æ‰‹æ©Ÿç‰ˆå‹ å¡ç‰‡ï¼Œç”¨è™•ä¹Ÿä¸å¤§ã€‚ç•¶æ™‚æ˜¯æƒ³èªªå¦‚æœå¤šä¸€ç¨®ç‰ˆå‹å¯ä»¥æ€è€ƒâ€¦</li><li>èƒŒæ™¯çš„ icon åˆ‡æ›ï¼Œé€™æ˜¯åœ¨åšå€‹åˆ¥å¡ç‰‡åŸä»¶å¿«é€Ÿåˆ‡æ›ç”¨çš„è€Œå·²</li></ol><p>åœ¨æŠŠä¸Šè¿°çš„åˆä½µèµ·ä¾†ï¼Œåœ¨é¢æ¿å¯ä»¥è‡ªç”±åˆ‡æ› ğŸ˜ƒ<br>æ¥ä¸‹ä¾†å°±æ˜¯é€²åˆ°å¯«ç¨‹å¼çš„ç’°ç¯€ğŸ¥°</p><h2 id="React-éƒ¨åˆ†">React éƒ¨åˆ†</h2><p>ç·´ç¿’é¡Œè¼ƒå°‘ç”¨åˆ°ä½¿ç”¨åˆ° React Hooks<br>å¤§éƒ¨åˆ†é‚„æ˜¯ CSS å±…å¤š<br>åªæœ‰ä½¿ç”¨ <code>useState</code>ã€<code>useMemo</code> è€Œå·²</p><h3 id="svg-ç•¶ä½œ-component-åŒ¯å…¥">svg ç•¶ä½œ component åŒ¯å…¥</h3><p><a href="https://create-react-app.dev/docs/adding-images-fonts-and-files/">å®˜æ–¹</a> è¦å¼•å…¥åœ–ç‰‡æœ‰å…©ç¨®æ–¹å¼</p><ol><li>ç•¶ä½œ component åŒ¯å…¥ (svg)</li><li>ç›´æ¥åŒ¯å…¥åœ–æª”ä¾†æº</li></ol><p>åœ–æª”æ˜¯ svg ï¼Œé€™é‚Šæˆ‘æ¡ç”¨ component çš„æ–¹å¼ï¼Œä¸»è¦æ˜¯æƒ³æ”¹è®Š hover æ™‚çš„å¡«è‰²</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç•¶ä½œå…ƒä»¶åŒ¯å…¥</span></span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">ReactComponent</span> <span class="keyword">as</span> <span class="title class_">Play</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;./images/icon-play.svg&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">&#123;/*ä½œç‚ºå…ƒä»¶ä½¿ç”¨*/&#125;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Play</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é—œæ–¼ç¬¬äºŒé»ï¼Œä½¿ç”¨ <code>src</code> å¼•å…¥åœ–æª”<br>å› ç‚º deploy ä¹‹å¾Œ <code>index.html</code> çš„è·¯å¾‘ç„¡æ³•å°ä¸Šï¼Œæœ‰çš„äººæœƒå»ºè­°æŠŠåœ–æª”æ”¾åœ¨ <code>public</code> ä¸Šï¼Œåœ¨é€éç›¸å°è·¯å¾‘å¼•å…¥ã€‚<br>æˆ–è€…è®“ webpack å¹«æˆ‘å€‘é€é JavaScript module (file loader)ä¾†è™•ç†ï¼Œä¸éè¦æ³¨æ„çš„æ˜¯ï¼Œè·¯å¾‘çš„èµ·å§‹é»æ˜¯ <code>./</code>ï¼Œæ‰€ä»¥å¾ŒçºŒåœ¨ deploy æ™‚è¦è¨­å®š <code>homepage</code> ä¾†çŸ¯æ­£è·¯å¾‘</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€™é‚Šæ˜¯ç›¸å°è·¯å¾‘å­—ä¸²</span></span><br><span class="line"><span class="keyword">import</span> play <span class="keyword">from</span> <span class="string">&#x27;./images/icon-play.svg&#x27;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">&#123;/*ä½œç‚ºè·¯å¾‘ä½¿ç”¨*/&#125;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;play&#125;</span> <span class="attr">alt</span>=<span class="string">&quot;Play icon&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¾å¤–éƒ¨åŒ¯å…¥çš„-Element-è½‰æˆæ­£ç¢ºçš„-React-component">å¾å¤–éƒ¨åŒ¯å…¥çš„ Element è½‰æˆæ­£ç¢ºçš„ React component</h3><p>é€™é‚Šæˆ‘éœ€è¦æ‰¾åˆ°å°æ‡‰çš„æ¨£å¼è·Ÿ icon åœ–ï¼Œèµ·åˆæˆ‘æ˜¯å›å‚³ <code>[Icon[type], theme.primary[type]]</code><br>é æƒ³ä¸­æ˜¯åœ¨ component ä¸­è¦æ‹¿åˆ° <code>&lt;Play/&gt;</code> é€™æ¨£çš„ svg as component<br>è½‰å‡ºä¾†çš„æ˜¯ component <code>&#123;Play&#125;</code> é€™æ¨£å¯ä»¥ï¼Œçœ‹èµ·ä¾†å¥½åƒä¸€èˆ¬çš„å€¼ï¼Œæˆ‘æƒ³æ”¹æˆ tag çš„å½¢å¼ï¼ŒåŠ ä¸Š <code>&lt;&gt;</code> åè€Œè®Šæˆ  <code>React Element</code> ã€‚<br>å¾<a href="https://github.com/facebook/react/issues/13445#issuecomment-414389398">å®˜æ–¹çš„ issues é€™ç¯‡</a> æœ‰æåˆ°ï¼Œæ˜¯å› ç‚º <strong>æ ¼å¼éŒ¯èª¤</strong><br>åŠ ä¸Š tag çš„æ–¹æ³•å¯¦éš›ä¸Šè®Šæˆé€™æ¨£ <code>&lt;&lt;Play/&gt;/&gt;</code>ï¼Œå¯ä»¥ç”¨ function å…ˆæŠŠå…ƒä»¶è¼¸å‡ºå†ä½¿ç”¨ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// svg as component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">Icon</span> = &#123;</span><br><span class="line">    <span class="title class_">Exercise</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">Exercise</span> /&gt;</span></span>,</span><br><span class="line">    <span class="title class_">Play</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">Play</span> /&gt;</span></span>,</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// æ‹¿åˆ°è©²åœ–æª”è·Ÿé¡è‰²</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">type2Style</span>(<span class="params">type</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (type.<span class="title function_">includes</span>(<span class="string">&quot; &quot;</span>)) &#123;</span><br><span class="line">        type = type.<span class="title function_">replace</span>(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// React Element -&gt; Componentï¼ŒæŠŠ React Component </span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">BgIcon</span> = (<span class="params"></span>) =&gt; <span class="title class_">Icon</span>[type];</span><br><span class="line">    <span class="keyword">return</span> [<span class="title class_">BgIcon</span>, theme.<span class="property">primary</span>[type]];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è³‡æ–™è½‰åŒ–">è³‡æ–™è½‰åŒ–</h3><p>é€™éƒ¨åˆ†æ˜¯æƒ³è¦ç†Ÿæ‚‰å¦‚ä½•å»ä½¿ç”¨ Object &amp; Array çš„ function<br>æŠŠè‡ªå·±æƒ³è¦çš„è³‡æ–™å¬å–šå‡ºä¾†ï¼Œç›®å‰å·²çŸ¥çš„æ˜¯æŒ‰éˆ•åˆ‡æ›å–å¾—è³‡æ–™ï¼Œ<code>useState</code> åœ¨ set çš„æ™‚å€™åš re-render è®“æˆ‘å€‘å¯ä»¥çœ‹åˆ°è³‡æ–™æ”¹è®Šå¾Œç•«é¢ä¹Ÿæ”¹è®Šã€‚</p><ul><li>Click Event</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// 1. è§€å¯Ÿ timeframe æ”¹è®Šæ™‚è¨­å®šçš„å€¼</span></span><br><span class="line">    <span class="keyword">const</span> [timeframe, setTimeframe] = <span class="title function_">useState</span>(<span class="function">() =&gt;</span></span><br><span class="line">        <span class="title class_">Type2Data</span>(timetype.<span class="property">daily</span>, data)</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// 2. é»æ“Šå¾Œæ”¹è®Š type</span></span><br><span class="line">    <span class="keyword">const</span> [type, setType] = <span class="title function_">useState</span>(timetype.<span class="property">daily</span>);</span><br><span class="line">    <span class="comment">// 3. å‚³å…¥ type å€¼</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">clickhandler</span> = (<span class="params">type</span>) =&gt; &#123;</span><br><span class="line">        <span class="title function_">setTimeframe</span>(<span class="function">() =&gt;</span> <span class="title class_">Type2Data</span>(type, data));</span><br><span class="line">        <span class="title function_">setType</span>(<span class="function">() =&gt;</span> type);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">ThemeProvider</span> <span class="attr">theme</span>=<span class="string">&#123;theme&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">TimerLayout</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;/* 4. æŠŠ handler ç•¶ä½œ props å‚³çµ¦å…ƒä»¶çš„ button */&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">ProfileCard</span> <span class="attr">clickhandler</span>=<span class="string">&#123;clickhandler&#125;</span> <span class="attr">type</span>=<span class="string">&#123;type&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;timeframe.map((&#123; last, title, prev, current &#125;, i) =&gt; (</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">TimeframeCard</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">key</span>=<span class="string">&#123;i&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">data</span>=<span class="string">&#123;&#123;</span> <span class="attr">last</span>, <span class="attr">title</span>, <span class="attr">prev</span>, <span class="attr">current</span> &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    /&gt;</span></span></span><br><span class="line"><span class="language-xml">                ))&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">TimerLayout</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">ThemeProvider</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è½‰æ›è³‡æ–™çš„ function</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">Type2Data</span>(<span class="params">type, data</span>) &#123;</span><br><span class="line"><span class="comment">// åˆå§‹å€¼æ˜¯é™£åˆ—</span></span><br><span class="line">    <span class="keyword">return</span> data.<span class="title function_">reduce</span>(<span class="function">(<span class="params">p, n</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 1. æŠŠå®˜æ–¹çµ¦çš„ data.json è§£æ§‹</span></span><br><span class="line">        <span class="keyword">const</span> &#123; title, timeframes &#125; = n;</span><br><span class="line">        <span class="comment">// 2. ç•«é¢ä¸Šéœ€è¦è½‰æ› timeframe çš„æ–‡å­—</span></span><br><span class="line">        <span class="keyword">let</span> type2text = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">            <span class="keyword">case</span> timetype.<span class="property">daily</span>:</span><br><span class="line">                type2text = <span class="string">&quot;day&quot;</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> timetype.<span class="property">weekly</span>:</span><br><span class="line">                type2text = <span class="string">&quot;week&quot;</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> timetype.<span class="property">monthly</span>:</span><br><span class="line">                type2text = <span class="string">&quot;month&quot;</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="attr">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3. æŠŠç¬¦åˆçš„ timeframe è³‡æ–™æŠ“å‡ºä¾†ï¼Œå¾ŒçºŒè¦é€é map æŠŠè³‡æ–™å°å‡ºä¾†</span></span><br><span class="line">        p.<span class="title function_">push</span>(&#123;</span><br><span class="line">            <span class="attr">last</span>: type2text,</span><br><span class="line">            title,</span><br><span class="line">            <span class="attr">prev</span>: timeframes[type].<span class="property">previous</span>,</span><br><span class="line">            <span class="attr">current</span>: timeframes[type].<span class="property">current</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;, []);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­æ‹‰ ! ç•¶æˆ‘æŒ‰ä¸‹æŒ‰éˆ•ï¼Œstate æ”¹è®Šé€²è¡Œ re-render<br><img data-src="https://i.imgur.com/P9Aj0ae.gif" alt="åˆ‡æ› timeframe"></p><h3 id="useMemo-æŠŠè³‡æ–™è¨˜èµ·ä¾†">useMemo : æŠŠè³‡æ–™è¨˜èµ·ä¾†</h3><p>ç”±æ–¼æˆ‘çš„åœ–ç‰‡ä»¥åŠé¡è‰²æ˜¯é€éè¨ˆç®—è€Œä¾†ï¼Œè€Œä¸æ˜¯å¯«æ­»çš„ï¼Œ æ¯æ¬¡ state æ”¹è®Šæ™‚ä¹Ÿæœƒ re-render ï¼Œå°è‡´æ¯æ¬¡éƒ½é‡æ–°è¨ˆç®—ä¸€æ¬¡ğŸ˜“ã€‚<br>ä½†æ˜¯ <strong>æ¨£å¼å…§å®¹æ˜¯ä¸è®Š</strong> çš„ï¼Œæ‰€ä»¥ç”¨ <code>useMemo</code> åŒ…èµ·ä¾†ï¼Œç´€éŒ„æ¨£å¼è³‡æ–™</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">TimeframeCard</span>(<span class="params">&#123; data &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; last, title, current, prev &#125; = data;</span><br><span class="line">    <span class="comment">// é¿å… re-render åˆè·‘ä¸€æ¬¡</span></span><br><span class="line">    <span class="keyword">const</span> [<span class="title class_">BgIcon</span>, <span class="title class_">BgColor</span>] = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> <span class="title function_">type2Style</span>(title), [title]);</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">TimeframeCardContainer</span> <span class="attr">bgcolor</span>=<span class="string">&#123;BgColor&#125;</span> <span class="attr">br</span>=<span class="string">&#123;br&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">BgIcon</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">FrameBody</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">FrameHeader</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">FrameHeaderTitle</span>&gt;</span>&#123;title&#125;<span class="tag">&lt;/<span class="name">FrameHeaderTitle</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Setting</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">FrameHeader</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">FrameContent</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">CurrentText</span>&gt;</span>&#123;current&#125;hrs<span class="tag">&lt;/<span class="name">CurrentText</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">PrevText</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        Last &#123;last&#125; - &#123;prev&#125;hrs</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">PrevText</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">FrameContent</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">FrameBody</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">TimeframeCardContainer</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾Œä¾†å¯«æ–‡æ™‚ï¼Œæˆ‘è¦ºå¾—é€™é‚Šå¯«çš„ä¸æ˜¯å¾ˆå¥½ï¼Œæ—¢ç„¶æ˜¯å›ºå®šçš„ï¼Œæˆ‘ç‚ºä»€éº¼è¦é€éè¨ˆç®—ä¾†å–å¾—æ¨£å¼å‘¢ğŸ¥´<br>å›æƒ³ç•¶åˆåœ¨å¯«ï¼Œå¤šæƒ³åˆ°å¦‚æœæ”¹æˆå®¢è£½åŒ–å¡ç‰‡ï¼Œæ¨£å¼å…§å®¹å°±æœƒæ”¹è®Šï¼Œä»¥ç›®å‰çš„ç·´ç¿’é¡Œä¸¦æ²’æœ‰é€™å€‹éœ€æ±‚ğŸ˜…<br>ä¹Ÿè¨±å¯ä»¥ä½œç‚ºä¹‹å¾Œçš„ :Todo</p><h3 id="Deploy-éƒ¨å±¬ç¶²ç«™">Deploy : éƒ¨å±¬ç¶²ç«™</h3><p><code>package.json</code> éœ€è¦è¨­å®š homepage å°‡è·¯å¾‘é‡æ–°è¨­å®šï¼Œå¦å‰‡è¼¸å‡ºçš„ build è£¡é¢çš„ index.html å¼•å…¥çš„æ±è¥¿æœƒæ‰¾ä¸åˆ°ã€‚<br><a href="https://create-react-app.dev/docs/deployment/#building-for-relative-paths">Deployment å®˜æ–¹æ•™å­¸</a></p><ul><li>package.json</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;my-app&quot;</span>,</span><br><span class="line">  <span class="comment">// æˆ‘ç™¼å¸ƒåœ¨ç¶²é ä¸Šçš„è·¯å¾‘</span></span><br><span class="line">+ <span class="string">&quot;homepage&quot;</span>: <span class="string">&quot;https://meitung473.github.io/time-tracking-dashboard-main/&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="CSSéƒ¨åˆ†">CSSéƒ¨åˆ†</h2><p>åŒ…å« styled-component ä»¥åŠä¸€äº› CSS é‡åˆ°çš„å•é¡Œ</p><h3 id="normalize-css">normalize.css</h3><p>æˆ‘è¨˜å¾—åœ¨ create-react-app ä½¿ç”¨ normalize åœ¨ <code>index.css</code> åŠ ä¸Š :</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import-normalize</span></span><br></pre></td></tr></table></figure><p>çµæœ IDE æç¤ºæ ¼å¼éŒ¯èª¤ä»¥å¤–ï¼Œæ„Ÿè¦ºå¥½åƒéƒ½æ²’ä½œç”¨<br><img data-src="https://dsm01pap006files.storage.live.com/y4muj1fnDJhMGuehE88QmzA1uezUw5o7ocb8_KQf52VuXLdBQFYupbRyS3943vlDwAYqGq1KtqHfS80RjlFnRRYsuOvLIUb1Nd-Rog1ThCib7FhPDbyqo_bYip_65arJPHfXKV5Q4g4iJGC1JO8kls0kAU8JQXlHFxFogThYvQFB2GRkhdoUH31i7XUKHkXADaH?width=1024&amp;height=115&amp;cropmode=none" alt="IDE æç¤ºæ ¼å¼éŒ¯èª¤"><br>æˆ‘æ˜¯æŒ‰ç…§å®˜æ–¹çš„ <a href="https://create-react-app.dev/docs/adding-css-reset/#browser-support">æ•™å­¸</a><br>æ‰“é–‹ devtool åè€Œæ˜¯å¤šäº† <code>where:</code> çš„æ¨£å¼ï¼Œæ‰€ä»¥ä¸¦ä¸æ˜¯æ²’æœ‰<br><img data-src="https://dsm01pap006files.storage.live.com/y4mzXONRr23Eb4GiE7hLxjSlL9TuG5SxD6Xhhcl5xYKY__SAR-WM9kUhCeYYOZQpf1O6AFdFl27BwQM1_6LlbadtlQvNV1T-VtH7aIhhR0MP35pOqAxyfMIjPgTVbN0UhbGShKwyy-LxhksBAcP-GSYnocw-tj-k3YF6zbeelM3Tn2MOfTm-p5cIGAwkqtW9xUl?width=1024&amp;height=147&amp;cropmode=none" alt="where:"></p><p>æˆ‘æŸ¥åˆ° <a href="https://stackoverflow.com/questions/56532121/normalize-css-does-not-fully-add-reset-to-react-app">é€™ç¯‡</a> è§£é‡‹ç‚ºä»€éº¼ normalize.css å…¶å¯¦æœ‰ä¸åŒä»½ï¼Œå¦‚æœåœ¨å¦å¤–å®‰è£ <a href="https://github.com/necolas/normalize.css">normalize.css</a> ï¼Œå¼•å…¥ç‚ºä»€éº¼ä½œç”¨æ˜¯å› ç‚º <strong>æ ¹æœ¬æ²’æœ‰æŒ‡å‘åˆ°é€™ç‰ˆ</strong>ã€‚</p><p>ç›®å‰çš„ React æ˜¯ä½¿ç”¨ <code>@csstool/normalize</code> è€Œä¸æ˜¯ <code>necolas/normalize</code> ç‰ˆçš„<br>é—œæ–¼é€™å…©ä»½çš„å·®åˆ¥ï¼Œ<a href="https://github.com/csstools/normalize.css/issues/3">å…±åŒä½œè€…è§£é‡‹</a> æ˜¯ç§»é™¤ä¸€äº›å›ºå®šæ ¼å¼çš„è¨­å®šåƒæ˜¯ (<code>body&#123;margin:0&#125;</code>) ï¼Œä»¥åŠå…¼é¡§ç€è¦½å™¨çš„å…¼å®¹æ€§å•é¡Œã€‚ ğŸ¤”</p><p>å¦å¤–æˆ‘ä¹ŸæŸ¥äº†ä¸€ä¸‹ <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/:where">:where</a> å½å…ƒç´ ï¼Œç‚ºä»€éº¼ normalize æœƒä½¿ç”¨é€™å€‹ã€‚<br>ä»¥å¾€åœ¨å¯« CSS å¿…é ˆæ³¨æ„æ¬Šé‡çš„å•é¡Œï¼Œè€Œ <code>:where</code> çš„æ¬Šé‡æ˜¯ 0 ï¼Œä¸ç®¡è¨­å®šçš„ CSS æ¬Šé‡å¾Œä¾†çš„å€¼éƒ½å¯ä»¥è¦†è“‹éå»ï¼Œ ç›¸è¼ƒ <code>:is()</code> ä¾†çš„æ›´é©åˆè¨­å®šé è¨­å€¼ã€‚<br>ç›®å‰å¹¾ä¹æ‰€æœ‰çš„ç€è¦½å™¨éƒ½æœ‰æ”¯æ´ï¼ŒIE å› ç‚ºä»Šå¹´å…­æœˆè¦è¢«æ·˜æ±°äº†ï¼Œå°±æ²’å·®äº†å§ ğŸ¥´</p><h3 id="styled-components-media-query">styled-components @media query</h3><p>åœ¨ä¹‹å‰å­¸ç¿’æ˜¯å¯«æˆå€‹åˆ¥ä¸€è¡Œï¼Œå†ä¸€å€‹å€‹ import åˆ°éœ€è¦æ”¹å‹•çš„å…ƒä»¶è£¡é¢åšä¿®æ”¹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> breakpoint_md = <span class="string">&quot;@media screen and (min-width: 768px)&quot;</span>;</span><br></pre></td></tr></table></figure><p>ä¸ééƒ½ CSS-in-JS äº†ï¼Œä¸å¦‚æŠŠå®ƒè®Šå¾—æ›´åŠ ç¨‹å¼åŒ–ä¸€é»ã€‚<br>æˆ‘åœ¨å¯« styled-component æ™‚åªæŠŠä»–æƒ³æˆ <strong>æœƒç”¢å‡ºä¸€å¤§ä¸²çš„æ–‡å­—</strong>ï¼Œæƒ³è¦åšåˆ° sass çš„ @mixin åŠŸèƒ½ï¼Œæ”¹æˆå¯« function å›å‚³æƒ³è¦çš„å­—ä¸²ã€‚<br>æ‰€ä»¥é€™æ¬¡çš„ç›®æ¨™æ˜¯ :</p><blockquote><p>object é€é key æ‹¿åˆ° <code>@media</code> çš„å­—ä¸²ï¼Œä¾‹ <a href="http://breakpoint.md">breakpoint.md</a> å°æ‡‰ min-width : 768px</p></blockquote><p>åƒè€ƒ : <a href="https://dev.to/cagatayunal/how-to-use-css-media-query-breakpoint-in-styled-components-9of">How to use CSS Media Query Breakpoint in Styled-Components</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…ˆå¯«å¥½å°æ‡‰çš„å°ºå¯¸</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> sizes = &#123;</span><br><span class="line">    <span class="attr">xxl</span>: <span class="number">1440</span>,</span><br><span class="line">    <span class="attr">xl</span>: <span class="number">996</span>,</span><br><span class="line">    <span class="attr">md</span>: <span class="number">768</span>,</span><br><span class="line">    <span class="attr">sm</span>: <span class="number">576</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// @media å›ºå®šçš„æ ¼å¼ï¼Œå¾æ‰‹æ©Ÿå¾€ä¸Šå¯« &#123;size&#125; æ‹¿ä¾†åšæ›¿æ›</span></span><br><span class="line"><span class="keyword">const</span> prefix = <span class="string">&quot;@media screen and (min-width: &#123;size&#125;px)&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> br = <span class="title class_">Object</span>.<span class="title function_">keys</span>(sizes).<span class="title function_">reduce</span>(<span class="function">(<span class="params">p, n</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">/* è½‰æ›éå¾Œçš„ sizes : [&#x27;xxl&#x27;,&#x27;xl&#x27;,...]</span></span><br><span class="line"><span class="comment">æˆ‘å€‘åªè¦</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">n1 : sizes[n1]</span></span><br><span class="line"><span class="comment">n2 : sizes[n2]</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨å–ä»£çš„æ–¹å¼</span></span><br><span class="line">    p[n] = prefix.<span class="title function_">replace</span>(<span class="string">&quot;&#123;size&#125;&quot;</span>, sizes[n]);</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;, &#123;&#125;);</span><br></pre></td></tr></table></figure><p>ä¸æƒ³é€™éº¼éº»ç…©ä¹Ÿå¯ä»¥ç›´æ¥é€é template å¸¶å€¼<br><code>@media screen and (min-width: $&#123;sizes[n]&#125;px)</code><br>åœ¨ styled-component å…§æˆ‘å€‘å°±å¯ä»¥ç›´æ¥ä½¿ç”¨</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; br &#125; <span class="keyword">from</span> <span class="string">&quot;../../Device&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">FrameBody</span> = <span class="title function_">styled</span>(<span class="title class_">InfoCard</span>)<span class="string">`</span></span><br><span class="line"><span class="string">&#123;/* ç›´æ¥å¯« */&#125;</span></span><br><span class="line"><span class="string">    <span class="subst">$&#123;br.md&#125;</span> &#123;</span></span><br><span class="line"><span class="string">        padding: 1em 1.2em;</span></span><br><span class="line"><span class="string">        cursor: pointer;</span></span><br><span class="line"><span class="string">        transition: filter 0.3s ease-out;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure><p>é€™æ¨£åš RWD å°±å¯ä»¥æ¯”è¼ƒç°¡å–®äº†ğŸ¥°</p><h2 id="çµèª-13">çµèª</h2><p>æ¯æ¬¡ç·´ç¿’éƒ½æœƒè¦ºå¾—è‡ªå·±åˆæ›´é€²æ­¥ä¸€äº›<br>é‡æ–°æ€è€ƒè‡ªå·±çš„è£½ä½œæµç¨‹<br>æœ€å¾Œè¦ºå¾— CSS çš„éƒ¨ä»½æœ‰é»é›œï¼Œå¯ä»¥æŠ½å‡ºç›¸åŒçš„æ¨£å¼å†é‡æ§‹<br>å¾ŒçºŒæœ‰æ™‚é–“å†ä¿®æ”¹</p><h2 id="åƒè€ƒè³‡æ–™">åƒè€ƒè³‡æ–™</h2><ol><li><a href="https://dev.to/cagatayunal/how-to-use-css-media-query-breakpoint-in-styled-components-9of">How to use CSS Media Query Breakpoint in Styled-Components</a></li><li><a href="https://airbnb.io/javascript/react/#class-vs-reactcreateclass-vs-stateless">Airbnb JavaScript Style Guide</a></li><li><a href="https://github.com/facebook/react/issues/13445">expected a string (for built-in components) or a class/function</a></li><li><a href="https://create-react-app.dev/">Create React App</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€-44&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;é€™æ˜¯åœ¨ &lt;a href=&quot;https://www.frontendmentor.io/solutions/responsive-reactjs-styledcomponent-BkFnvCvr9&quot;&gt;frontend mentor çš„æŒ‘æˆ°é¡Œ&lt;/a&gt;&lt;br&gt;
ä½¿ç”¨ React + styled-components&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://meitung473.github.io/time-tracking-dashboard-main/&quot;&gt;ç¶²é &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/meitung473/time-tracking-dashboard-main&quot;&gt;github repo&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;https://dsm01pap006files.storage.live.com/y4m9LQmpdiru45ZO2sTWfVBoSuRS1cfQoRCmHTFQxc-7aQWX0hkbq0r2q3tefJlGHA3SeXfA_G4CV5PHZIagjALPplvZ3s9MO6tpWyEEYyL2J7ep3EbhiNczfUybFUlxBTjvVQybnsXtFwrgoLmqEFJBftLbJvhzcipVkL-hdLjY23wEqHVpwrW0vNREUMTmt-y?width=1024&amp;amp;height=585&amp;amp;cropmode=none&quot; alt=&quot;å®Œæˆåœ–&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="2022" scheme="https://blog.rosa.tw/categories/2022/"/>
    
    <category term="04" scheme="https://blog.rosa.tw/categories/2022/04/"/>
    
    
    <category term="React" scheme="https://blog.rosa.tw/tags/React/"/>
    
    <category term="styled-components" scheme="https://blog.rosa.tw/tags/styled-components/"/>
    
  </entry>
  
  <entry>
    <title>ç­†è¨˜ | JavaScript - Prototype ç‰©ä»¶å°å‘ (IV) åŸå‹çš„ç¹¼æ‰¿</title>
    <link href="https://blog.rosa.tw/2022/04/04/JavaScript-Object-oriented-programming-04"/>
    <id>https://blog.rosa.tw/2022/04/04/JavaScript-Object-oriented-programming-04</id>
    <published>2022-04-19T04:33:33.000Z</published>
    <updated>2022-07-27T05:30:49.732Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€-41">å‰è¨€</h2><p>ä¸Šä¸€ç¯‡çŸ¥é“åŸå‹èˆ‡åŸå‹éˆçš„å…§å®¹<br>å¦‚æœæˆ‘å€‘è¦è®“æ±è¥¿ç¹¼æ‰¿ï¼Œé™¤äº†é€é new å»ºç«‹ç‰©ä»¶ç›´æ¥å¹«æˆ‘å€‘ç¹¼æ‰¿ä¹‹å¤–<br>é‚„æœ‰ <code>Object.setPrototypeOf</code> ä»¥åŠ <code>Object.create()</code></p><span id="more"></span>  <h2 id="åŸå‹å¦‚ä½•ç¹¼æ‰¿">åŸå‹å¦‚ä½•ç¹¼æ‰¿ ?</h2><ol><li><code>Object.setPrototypeOf(&lt;ç¹¼æ‰¿è€…&gt;,&lt;è¢«ç¹¼æ‰¿è€…&gt;)</code> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(person1, person2);</span><br></pre></td></tr></table></figure></li><li><code>Object.create(proto,å±¬æ€§ç‰©ä»¶)</code> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Person ç‰©ä»¶</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Default_Name&#x27;</span>,</span><br><span class="line">  <span class="attr">sayHello</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hi, I&#x27;m &quot;</span> + <span class="variable language_">this</span>.<span class="property">name</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€é Object.create() å°‡ Person ä½œç‚ºåŸå‹ç‰©ä»¶ä¾†å»ºç«‹ä¸€å€‹æ–°çš„ç‰©ä»¶</span></span><br><span class="line"><span class="keyword">var</span> p = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Person</span>);</span><br><span class="line"><span class="comment">// æ²’æœ‰ this.name</span></span><br><span class="line">p.<span class="title function_">sayHello</span>();   <span class="comment">// &quot;Hi, I&#x27;m Default_Name&quot;</span></span><br><span class="line"></span><br><span class="line">p.<span class="property">name</span> = <span class="string">&#x27;Rosa&#x27;</span>;</span><br><span class="line">p.<span class="title function_">sayHello</span>();   <span class="comment">// &quot;Hi, I&#x27;m Rosa&quot;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="Object-setPrototypeOf">Object.setPrototypeOf()</h2><p>ä¸Šä¸€ç¯‡æˆ‘å€‘æåˆ° <code>[[Prototype]]</code> æ˜¯éš±è—å±¬æ€§<br>ES5 ä¹‹å‰æ˜¯ä½¿ç”¨ <code>__proto__</code>ï¼ŒES6 æ–°å¢ <code>getPrototypeOf()</code> èˆ‡ <code>setPrototypeOf()</code> è®“æˆ‘å€‘å¯ä»¥ç›´æ¥æ”¹è®Šç‰©ä»¶çš„ prototype</p><h3 id="in-æŸå±¬æ€§æ˜¯å¦å¯ä»¥é€éé€™å€‹ç‰©ä»¶å­˜å–">in  : æŸå±¬æ€§æ˜¯å¦å¯ä»¥é€éé€™å€‹ç‰©ä»¶å­˜å–</h3><p>æˆ‘å€‘çŸ¥é“ç‰©ä»¶çš„å±¬æ€§æˆ–æ–¹æ³•ä¸ä¸€å®šæ˜¯æœ¬èº«ç‰©ä»¶çš„<br>è€Œæ˜¯ä¾†è‡ªåŸå‹éˆå¾€ä¸Šæ‰¾åˆ°çš„<br>å¦‚æ­¤ä¸€ä¾†ï¼Œå»ºæ§‹ç‰©ä»¶å°±èƒ½ä½¿ç”¨åŸå‹éˆä¸Šçš„å±¬æ€§<br>é‚£æ€éº¼ç¢ºå®šèƒ½å­˜å–åˆ°å‘¢ ?<br>æ²’éŒ¯ï¼Œå°±æ˜¯é€é <code>in</code> !</p><blockquote><p>å±¬æ€§åç¨±å¿…é ˆæ˜¯ã€Œå­—ä¸²ã€</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person1 = &#123;</span><br><span class="line">a : <span class="number">1</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person2 =&#123;</span><br><span class="line">b : <span class="number">2</span> ,</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;a&quot;</span> <span class="keyword">in</span> person1) <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;b&quot;</span> <span class="keyword">in</span> person1) <span class="comment">// false</span></span><br></pre></td></tr></table></figure><p>å¦‚æœè¦è®“ person1 ä¹Ÿèƒ½è®€å–åˆ° b å°±å¿…é ˆæ”¹è®Šå…¶åŸå‹<br>å¯ä»¥é€é <code>Object.setPrototypeOf()</code> ç›´æ¥æ”¹è®Š<br>ä¸éå»ºè­°éå¿…è¦ä¸è¦ç›´æ¥æ”¹è®Šç‰©ä»¶çš„ prototype</p><h3 id="Object-setPrototypeOf-2">Object.setPrototypeOf()</h3><p><code>Object.setPrototypeOf(&lt;ç¹¼æ‰¿è€…&gt;,&lt;è¢«ç¹¼æ‰¿è€…åŸå‹&gt;)</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(person1,person2)</span><br></pre></td></tr></table></figure><p>JavaScript çš„åŸå‹ç‰©ä»¶æ˜¯ç‰©ä»¶å…§éƒ¨å±¬æ€§ï¼Œ<strong>ç„¡æ³•ç›´æ¥å­˜å–</strong> (é€šå¸¸æ¨™ç¤ºç‚º <code>[[Prototype]]</code>)ï¼Œä½†æ˜¯å¯ä»¥é€é setPrototypeOf æŒ‡å®šç‰©ä»¶ä¹‹é–“çš„åŸå‹é—œä¿‚</p><blockquote><p>åŸå‹ç¹¼æ‰¿çš„è¦å‰‡è£¡ï¼Œ<strong>åŒä¸€å€‹ç‰©ä»¶ç„¡æ³•æŒ‡å®šå…©ç¨®åŸå‹ç‰©ä»¶</strong>ã€‚</p></blockquote><p>è©¦è‘—å»å­˜å–ã€Œä¸å­˜åœ¨ã€çš„å±¬æ€§æ™‚ï¼Œé‚£éº¼ JavaScript å°±æœƒå¾€å®ƒçš„Â <code>[[Prototype]]</code>Â åŸå‹ç‰©ä»¶å»å°‹æ‰¾ (prototype chain)</p><p>è®“ <code>person1</code> åŒæ™‚æœ‰ b ä¹Ÿæœ‰ c å±¬æ€§</p><blockquote><p>è®“ b å»ç¹¼æ‰¿ cï¼Œa å†ç¹¼æ‰¿ bï¼Œå°±èƒ½åŒæ™‚æ“æœ‰ b èˆ‡ c</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person1 = &#123;</span><br><span class="line">a : <span class="number">1</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person2 =&#123;</span><br><span class="line">b : <span class="number">2</span> ,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person3 = &#123;</span><br><span class="line">c : <span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(person2,person3)</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(person1,person2)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person1.<span class="property">c</span>) <span class="comment">// 5</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;c&quot;</span> <span class="keyword">in</span> person1) <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h3 id="hasOwnProperty-æ˜¯å¦ç‚ºç‰©ä»¶æœ¬èº«çš„æ–¹æ³•æˆ–å±¬æ€§">hasOwnProperty() æ˜¯å¦ç‚ºç‰©ä»¶æœ¬èº«çš„æ–¹æ³•æˆ–å±¬æ€§</h3><p>æœ‰äº›å±¬æ€§èˆ‡æ–¹æ³•æ˜¯ä¾†è‡ª prototype ç¹¼æ‰¿çš„<br>è¦ç¢ºå®šæ˜¯ä¸æ˜¯å±¬æ–¼è‡ªå·±æœ¬èº«ç”¨ <code>hasOwnProperty</code><br><code>objself.hasOwnProperty(&lt;property&gt;)</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person1 = &#123;</span><br><span class="line">a : <span class="number">1</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person2 =&#123;</span><br><span class="line">b : <span class="number">2</span> ,</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(person1,person2)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person1.<span class="property">b</span>) <span class="comment">// 2</span></span><br><span class="line"><span class="comment">// å±¬æ€§ b ä¸¦éå»ºç«‹æ–¼ person1 ç‰©ä»¶ä¸­ï¼Œè€Œæ˜¯é€éç¹¼æ‰¿çš„æ–¹å¼å–å¾—çš„ </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person1.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;b&#x27;</span>)) <span class="comment">//false</span></span><br></pre></td></tr></table></figure><h2 id="Object-create">Object.create()</h2><p>æ–°å»ºç‰©ä»¶å¾Œçš„Â <code>[[Prototype]]</code>Â å°±æœƒæ˜¯æˆ‘å€‘æ‰€æŒ‡å®šçš„é‚£å€‹åŸå‹ç‰©ä»¶ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line"><span class="keyword">let</span> rosa = <span class="title class_">Object</span>.<span class="title function_">creat</span>(<span class="title class_">Person</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(rosa.<span class="property"><span class="keyword">prototype</span></span>) <span class="comment">// constructor çš„ prototype</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥æ˜¯ <code>null</code>ï¼Œé€™æ¨£å°±æœƒè®Šæˆéå¸¸ä¸€èˆ¬çš„ç‰©ä»¶ (â€œVery plainâ€ objects)<br>ä¸å¸¶æœ‰ä»»ä½• prototype ç”šè‡³æ˜¯ <code>Object.prototype</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="title function_">toString</span>()) <span class="comment">//Error</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj <span class="keyword">instanceof</span> <span class="title class_">Object</span>) <span class="comment">// false</span></span><br><span class="line">conosle.<span class="title function_">log</span>(obj) <span class="comment">//éå¸¸ç©ºçš„ç‰©ä»¶</span></span><br><span class="line">obj.<span class="property">a</span> = <span class="number">2</span> <span class="comment">// é‚„æ˜¯å¯ä»¥çµ¦äºˆå±¬æ€§</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj) <span class="comment">// &#123;a:2&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">keys</span>(obj)) <span class="comment">// [&#x27;a&#x27;]</span></span><br></pre></td></tr></table></figure><p>ä½†ä¸¦ä¸ä»£è¡¨ Object æœ‰é—œçš„æ–¹æ³•éƒ½ä¸èƒ½å‘¼å«<br>è€Œæ˜¯è¦çœ‹æ–¹æ³•æ˜¯å¦åœ¨ prototype è£¡<br>åƒæ˜¯ Object.keys ä¾ç„¶å¯ä»¥ä½¿ç”¨</p><h3 id="é€ ä¸€å€‹-Object-create">é€ ä¸€å€‹ Object.create()</h3><p><code>Object.create()</code> ç°¡å–®å¯¦ä½œ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="property">create</span> = <span class="keyword">function</span> (<span class="params">proto</span>)&#123;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">F.<span class="property"><span class="keyword">prototype</span></span> = proto;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">F</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€éä¸€å€‹å°è£éçš„å»ºæ§‹å¼å»ºæ§‹å‡ºä¾†çš„ç‰©ä»¶ï¼Œä¸¦æŠŠÂ <code>prototype</code>Â æŒ‡å‘ä½œç‚ºåƒæ•¸çš„Â <code>proto</code>ã€‚</p><h2 id="Object-create-v-s-new">Object.create() v.s new ?</h2><p>å…©å€‹éƒ½æ˜¯å»ºç«‹ç‰©ä»¶ï¼Œå“ªè£¡ä¸ä¸€æ¨£ ?</p><blockquote><p><code>new</code> operator è·Ÿ <code>Object.create</code> çš„å·®åˆ¥åœ¨æ–¼æœƒä¸æœƒåŸ·è¡Œ constructor</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hi&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="title class_">Person</span>(); <span class="comment">// å»ºç«‹çš„æ™‚å€™ï¼Œä¹Ÿå°å‡º hi</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Person</span>) <span class="comment">// æŒ‡æ˜¯å»ºç«‹äº†è€Œå·²</span></span><br></pre></td></tr></table></figure><h2 id="åƒè€ƒ-16">åƒè€ƒ</h2><ol><li><a href="https://zh.javascript.info/prototype-methods#very-plain">åŸå‹æ–¹æ³•ï¼Œæ²¡æœ‰ <strong>proto</strong> çš„å¯¹è±¡</a></li><li><a href="https://ithelp.ithome.com.tw/articles/10194356">é‡æ–°èªè­˜ JavaScript: Day 25 åŸå‹èˆ‡ç¹¼æ‰¿</a></li><li><a href="https://medium.com/%E6%89%8B%E5%AF%AB%E7%AD%86%E8%A8%98/javascript-new-operator-implementation-8c0d15f2b899">new operator â€” JavaScript | ç‚ºäº†ç­è§£åŸç†ï¼Œé‚£å°±ä¾†å¯¦ä½œä¸€å€‹ new å§ï¼</a></li><li><a href="https://blog.csdn.net/blueblueskyhua/article/details/73135938">ä½ ä¸çŸ¥é“çš„javascriptä¹‹Object.create å’ŒnewåŒºåˆ«</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€-41&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;ä¸Šä¸€ç¯‡çŸ¥é“åŸå‹èˆ‡åŸå‹éˆçš„å…§å®¹&lt;br&gt;
å¦‚æœæˆ‘å€‘è¦è®“æ±è¥¿ç¹¼æ‰¿ï¼Œé™¤äº†é€é new å»ºç«‹ç‰©ä»¶ç›´æ¥å¹«æˆ‘å€‘ç¹¼æ‰¿ä¹‹å¤–&lt;br&gt;
é‚„æœ‰ &lt;code&gt;Object.setPrototypeOf&lt;/code&gt; ä»¥åŠ &lt;code&gt;Object.create()&lt;/code&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="2022" scheme="https://blog.rosa.tw/categories/2022/"/>
    
    <category term="04" scheme="https://blog.rosa.tw/categories/2022/04/"/>
    
    
    <category term="JavaScript" scheme="https://blog.rosa.tw/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>ç­†è¨˜ | JavaScript - Prototype ç‰©ä»¶å°å‘ (III) åŸå‹ &amp; åŸå‹éˆ</title>
    <link href="https://blog.rosa.tw/2022/04/04/JavaScript-Object-oriented-programming-03"/>
    <id>https://blog.rosa.tw/2022/04/04/JavaScript-Object-oriented-programming-03</id>
    <published>2022-04-19T04:33:30.000Z</published>
    <updated>2022-07-27T05:30:49.731Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€-40">å‰è¨€</h2><p>JavaScript çš„æ ¸å¿ƒå°±åœ¨åŸå‹ !<br>åŸå‹ä½¿å¾—ç‰©ä»¶éƒ½èƒ½ä½¿ç”¨åœ¨åŸå‹éˆä¸Šçš„å±¬æ€§åŠæ–¹æ³•<br>æœ¬èº«ç‰©ä»¶ä¹Ÿå¯ä»¥å†æ“´å……<br>é€éæœ¬ç¯‡äº†è§£åŸå‹çš„ä½¿ç”¨æ–¹æ³•</p><span id="more"></span><h2 id="ä»€éº¼æ˜¯-prototype">ä»€éº¼æ˜¯ prototype ?</h2><p><img data-src="https://dsm01pap006files.storage.live.com/y4mZUP0lakeV0ZyTOBA3FOhGoj0nLq4_-h6RClQix2hTtsj-YL9kg-RwmOfya_emwZ1jekhk9jIrt-JrTQQfyiPEwOfYlVWWxlFZHdaAgkONuvg-kxkJgmo67BaKWfhEePd-7sT21E5ITCGSdla3HTIiK8NillkQBfzy2mTCrs5ZtISAl-h5eV-JiE6ySo075Ow?width=946&amp;height=563&amp;cropmode=none" alt="prototype"><br>åƒè€ƒåœ– : <a href="https://ithelp.ithome.com.tw/articles/10194356">é‡æ–°èªè­˜ JavaScript: Day 25 åŸå‹èˆ‡ç¹¼æ‰¿</a></p><p>å¾ 01 ç¯‡çŸ¥é“ prototype å¯ä»¥è®“ä¸åŒçš„ç‰©ä»¶å…±äº«åŸå‹çš„åŒä¸€å€‹æ–¹æ³•æˆ–å±¬æ€§<br>prototype å°±åƒæ˜¯å¾ function ç”¢ç”Ÿçš„é›†è£ç®±<br>è®“ function å»ºç«‹å‡ºä¾†çš„ç‰©ä»¶éƒ½å¯ä»¥æ‹¿åˆ°åŒæ¨£çš„æ±è¥¿</p><blockquote><p><strong>å‡½å¼ä¹Ÿæ˜¯ç‰©ä»¶</strong>ï¼Œæ‰€ä»¥å¯ä»¥é€é prototype ä¾†æ“´å……æ¯ä¸€å€‹é€éé€™å€‹å‡½å¼æ‰€å»ºæ§‹çš„ç‰©ä»¶</p></blockquote><p>å¥½åƒé›£ä»¥é€£çµï¼Œä¸éæˆ‘å€‘æ™‚æ™‚åˆ»åˆ»éƒ½åœ¨ä½¿ç”¨ prototype çš„æ¦‚å¿µ<br>æœ‰æƒ³éç‚ºä»€éº¼åŸºæœ¬å‹åˆ¥çš„å€¼ (numberã€stringã€bool) å¯ä»¥ <strong>åƒ object ä¸€æ¨£å‘¼è¼ƒæ–¹æ³•ç²å–åˆ°å±¬æ€§</strong>å‘¢ ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;Hello&#x27;</span>; </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( str.<span class="property">length</span> );</span><br></pre></td></tr></table></figure><p>æ²’éŒ¯ï¼Œå°±æ˜¯é€é prototype åŸå‹æä¾›çš„æ–¹æ³•ä¾†ç¹¼æ‰¿<br>åœ¨ JavaScript å‘¼å«æ–¹æ³•æˆ–å±¬æ€§ä¹‹å‰ï¼Œæœƒé€éåŸºæœ¬å‹åˆ¥åŒ…è£¹å™¨ (Primitive Wrapper)<br>è¢«è½‰å‹ç‚ºè©²é¡åˆ¥çš„ã€Œç‰©ä»¶ã€ï¼Œç”±å°æ‡‰çš„ç‰©ä»¶æä¾›çš„æ–¹æ³•æ˜¯é€éåŸå‹éˆ (prototype chain)<br>è®“æˆ‘å€‘å¯ä»¥å°åŸºæœ¬å‹åˆ¥çš„å€¼å‘¼å«æ–¹æ³•</p><ul><li>é¡ä¼¼é€™æ¨£</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// str.length æ¨¡æ“¬éç¨‹</span></span><br><span class="line"><span class="keyword">var</span> str = <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&#x27;Hello&#x27;</span>) <span class="comment">// è®Šæˆç‰©ä»¶</span></span><br><span class="line">str.<span class="property">length</span> <span class="comment">// æ‹¿åˆ°å±¬æ€§</span></span><br><span class="line">str = <span class="literal">null</span> <span class="comment">// éŠ·æ¯€</span></span><br><span class="line">str = <span class="string">&#x27;Hello&#x27;</span> <span class="comment">// æ¢å¾©æˆåŸºæœ¬å‹åˆ¥</span></span><br></pre></td></tr></table></figure><h2 id="prototype-æ€éº¼ä¾†">prototype æ€éº¼ä¾† ?</h2><p><strong>å‡½å¼å»ºç«‹æ™‚æœƒè‡ªå‹•ç”¢ç”Ÿ prototype å±¬æ€§</strong>ã€‚<br>ç”¢ç”Ÿçš„ç‰©ä»¶ä¸¦&quot;ä¸&quot;ä»£è¡¨ç‰©ä»¶çš„ prototype å±¬æ€§å°±æ˜¯é€™å€‹å‡½å¼çš„åŸå‹ç‰©ä»¶<br>è€Œæ˜¯é€é <code>new</code> å‡ºä¾†çš„ç‰©ä»¶æœƒæœ‰ <code>[[Prototype]]</code> çš„éš±è—å±¬æ€§<br>æ˜¯æŒ‡ <strong>å»ºæ§‹å¼</strong> çš„ prototype</p><blockquote><p><code>constructor.prototype</code></p></blockquote><p>ä¸Šé¢çš„æ•˜è¿°å¾ˆä»¤äººæ··äº‚å°å§ ?<br>å…ˆèˆ‰å€‹ä¾‹å­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name</span>)&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">getName</span> =<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> rosa = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;Rosa&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(rosa.<span class="title function_">getName</span>()) <span class="comment">// Rosa</span></span><br></pre></td></tr></table></figure><p><code>rosa</code> æ˜¯å¾ Person å»ºæ§‹å‡ºä¾†çš„ç‰©ä»¶</p><blockquote><p>æ‰€ä»¥ rosa çš„åŸå‹æ˜¯ Person</p></blockquote><p>å›åˆ°ç¬¬ä¸€å¥è©±<br><strong>å‡½å¼å»ºç«‹æ™‚æœƒè‡ªå‹•ç”¢ç”Ÿ prototype å±¬æ€§</strong></p><p>å°è‘— <code>Person</code> å‡½å¼å– prototype ï¼Œç¢ºå¯¦æ˜¯æœ‰çš„</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>) <span class="comment">// Person æœ¬èº«</span></span><br></pre></td></tr></table></figure><p>prototype è®“ rosa å¯ä»¥ç›´æ¥æ‹¿åˆ° <code>Person</code> è£¡é¢çš„æ–¹æ³• (getName)</p><p>é‚£ç¬¬äºŒå¥æ˜¯ä»€éº¼æ„æ€ ?<br>è©¦è‘—è®“ <code>rosa</code> å‘¼å« <code>toString()</code>ï¼Œä½†æ˜¯ Person ä¸¦æ²’æœ‰é€™å€‹æ–¹æ³•å‘€ ?!<br>æˆ‘å€‘èªªé rosa çš„åŸå‹æ˜¯ Person</p><blockquote><p>ä½† <strong>ä¸</strong> ä»£è¡¨å»ºæ§‹å‡ºä¾†çš„ç‰©ä»¶ (rosa) çš„ prototype å±¬æ€§å°±æ˜¯é€™å€‹å‡½å¼ (Person) çš„åŸå‹ç‰©ä»¶</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">lgo</span>(rosa.<span class="title function_">toString</span>()) <span class="comment">// [object Object]</span></span><br></pre></td></tr></table></figure><p>rosa é€™è£¡å–ä¾†çš„å±¬æ€§æˆ–æ–¹æ³•æ˜¯ä¾†è‡ª <code>Object.prototype</code> å‚³ä¸‹ä¾†çš„</p><p>æ¥è‘—ç¬¬ä¸‰å¥ <strong>å»ºæ§‹å¼</strong> çš„ prototype æ˜¯ä»€éº¼æ„æ€ ?<br>è©¦è‘—å° <code>rosa</code> å– prototype<br>æ–°æ‰‹ä¸€é–‹å§‹æœƒä»¥ç‚º <code>rosa</code> çš„ prototype æ˜¯ç­‰æ–¼ <code>Person</code> çš„ prototype<br>ç‰¹åˆ¥è¦ææ¸…æ¥šé€™è£¡çš„ prototype æ˜¯æŒ‡ä»€éº¼(æˆ‘ä¸€é–‹å§‹ä¹Ÿææ··äº†)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(rosa.<span class="property"><span class="keyword">prototype</span></span> === <span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>) <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(rosa.<span class="property"><span class="keyword">prototype</span></span>) <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><p>å›åˆ°ç¬¬ä¸€å¥ï¼Œå›æƒ³ <code>.prototype</code> æ˜¯èª°ç”¢ç”Ÿçš„ ?<br>å°ï¼Œæ˜¯ <strong>å‡½å¼</strong><br>é‚£ rosa ç‰©ä»¶æ˜¯é€éå»ºæ§‹å¼çš„æ–¹å¼è€Œä¾†<br>prototype æ˜¯éš±è—å±¬æ€§ï¼Œæ²’è¾¦æ³•é€éå»ºæ§‹å‡ºä¾†çš„ç‰©ä»¶ç›´æ¥å–å¾—</p><p><img data-src="https://dsm01pap006files.storage.live.com/y4mL7f71rE-gVfp4ze955AsP5mGlQNR1PYAJH4jUShpBHgc6U4Wq0pK2oYpDCsmDsGL0r2AxpMx3WXujkLUwZtgTEX_C1HPGIei28YZq0VvVXXwaTb7DT7K2RM-5ywv0SCz41iHsWPYdEp4lRb2YP19GWxtllx_EEBLXmJXO65f5jsuWSyQcLed8gq4Xo3YG0e3?width=692&amp;height=620&amp;cropmode=none" alt="è—åœ¨ contructor"></p><h2 id="å–å¾—ç‰©ä»¶çš„-prototype">å–å¾—ç‰©ä»¶çš„ prototype</h2><p>æ—¢ç„¶ä¸èƒ½ç›´æ¥é€é <code>rosa.prototype</code> å–å¾—åŸå‹<br>å¦‚æœæˆ‘å€‘è¦çŸ¥é“ rosa æ˜¯ç¹¼æ‰¿èª°çš„ prototype å¯ä»¥é€éä¸‰ç¨®çš„æ–¹å¼</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(rosa)) <span class="comment">// ç¾åœ¨æ¯”è¼ƒå¥½çš„æ‹¿åˆ°çš„æ–¹æ³•</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(rosa.<span class="property">constructor</span>.<span class="property"><span class="keyword">prototype</span></span>) <span class="comment">// å¾å»ºæ§‹å¼æ‹¿åˆ° [[Prototype]] çš„å€¼</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(rosa.<span class="property">__proto__</span>) <span class="comment">// åŸæœ¬å„å®¶ç€è¦½å™¨å¯¦ä½œï¼Œå¾Œä¾† ES6 ä¿ç•™çš„æ–¹æ³•</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span> === <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(rosa)) <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span> === rosa.<span class="property">constructor</span>.<span class="property"><span class="keyword">prototype</span></span>) <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span> === rosa.<span class="property">__proto__</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h2 id="åŸå‹éˆ-Prototype-Chain">åŸå‹éˆ Prototype Chain</h2><p>åŸå‹å¯ä»¥è®“æœ¬ä¾† <strong>æ²’æœ‰æŸå±¬æ€§çš„ç‰©ä»¶å»å­˜å–å…¶ä»–ç‰©ä»¶çš„å±¬æ€§</strong></p><h3 id="proto-æºé€šçš„åŸå‰‡">__proto__ : æºé€šçš„åŸå‰‡</h3><p>å¦‚æœæœ¬èº«ç‰©ä»¶æ²’æœ‰å±¬æ€§æˆ–æ–¹æ³•ä½¿ç”¨ï¼Œå¯ä»¥é€éåŸå‹éŠ (prototype chain) ä¾†å–å¾—<br>é‚£æ˜¯æ€éº¼å‚³çš„å‘¢ ?</p><p>åŸæœ¬ JavaScript æ²’æœ‰æä¾›æ¨™æº–æ–¹æ³•ç›´æ¥å­˜å–ç‰©ä»¶çš„ <code>[[Prototype]]</code>ã€‚<br><code>__proto__</code> æ˜¯ç€è¦½å™¨å¯¦ä½œçš„çš„ï¼Œä¸¦é EMCAScript çš„æ¨™æº–ï¼Œä¸æ˜¯æ‰€æœ‰çš„ç’°å¢ƒéƒ½æœ‰é€™å€‹å€¼ã€‚</p><blockquote><p>ES5 ä»¥å¾Œçš„æ˜¯ä½¿ç”¨ <code>Object.getPrototypeOf()</code><br>ES6 ç‚ºäº†å‘ä¸‹å…¼å®¹ï¼Œ<code>__proto__</code> ä¹Ÿæ˜¯æ‰¿èªçš„ï¼Œä½†ç’°å¢ƒçš„ä¸åŒæ”¯æ´åº¦ä¸åŒï¼Œé‚„æ˜¯ç”¨ <code>getPrototypeOf</code><br><code>__proto__</code> æ˜¯ <code>[[Prototype]]</code> åº•ä¸‹çš„å±¬æ€§ï¼Œå±¬æ–¼ setter/getter</p></blockquote><p><code>__proto__</code>Â é€™å€‹ç‰¹æ®Šå±¬æ€§æˆ–è€…æ˜¯Â <code>Object.getPrototypeOf()</code>Â éƒ½æ˜¯å–å¾—æŸå€‹ç‰©ä»¶çš„åŸå‹ç‰©ä»¶Â <code>[[Prototype]]</code>Â çš„æ–¹å¼ã€‚</p><p>å®˜æ–¹æ¯”è¼ƒå»ºè­°ä½¿ç”¨ <code>Object.getPrototypeOf()</code>ï¼Œå› ç‚º <code>__proto__</code> æ¯”è¼ƒè€—æ•ˆèƒ½</p><p>é™¤äº†æ‹¿åˆ°ç‰©ä»¶åŸå‹çš„ prototypeï¼Œ<br>é‚„å¯ä»¥é€é <code>.__proto__</code> çœ‹åŸå‹å€‘å¦‚ä½•æºé€š</p><p><strong>ç¯„ä¾‹</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Cat</span>(<span class="params">name</span>)&#123;</span><br><span class="line"> <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Cat</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hello</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> says meow`</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> lily = <span class="keyword">new</span> <span class="title class_">Cat</span>(<span class="string">&#x27;lily&#x27;</span>)</span><br><span class="line">lily.<span class="title function_">hello</span>()</span><br><span class="line"><span class="keyword">let</span> <span class="title class_">Bob</span> = <span class="keyword">new</span> <span class="title class_">Cat</span>(<span class="string">&#x27;Bob&#x27;</span>)</span><br><span class="line"><span class="title class_">Bob</span>.<span class="title function_">hello</span>()</span><br></pre></td></tr></table></figure><h3 id="æ¨¡æ“¬æºé€š">æ¨¡æ“¬æºé€š</h3><p>æƒ³åŸ·è¡Œ <code>lily.hello()</code><br>æœƒä¾ç…§é€™æ¨£çš„é †åºå°‹æ‰¾</p><ol><li>æ‰¾ lily æœ¬èº«æ˜¯ä¸æ˜¯æœ‰ hello function ?<br>ğŸ‘‰ æ²’æœ‰ï¼Œå¾€ä¸Šä¸€å±¤æ‰¾</li><li>æ‰¾ <code>lily.__proto__</code> æ˜¯ä¸æ˜¯æœ‰ hello ?<br>ğŸ‘‰ æ²’æœ‰çš„è©±ï¼Œå†å¾€ä¸Šä¸€å±¤æ‰¾<br>çŸ¥é“ <strong>lily._<em>proto_</em> = Cat.prototype</strong></li><li>æ‰¾ <code>lily.__proto__.__proto__</code> æ˜¯ä¸æ˜¯æœ‰ hello ?<br>=&gt; <code>lily.__proto__.__proto__ = Cat.prototype.__proto__</code>ã€‚<br>=&gt; <code>lily.__proto__.__proto__  = Object.prototype</code></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Cat</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span> === <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>å¾€ä¸Šæ‰¾åƒæ˜¯ç”¨éˆçµçš„æ–¹å¼ï¼Œæ‰€ä»¥æ‰ç¨± prototype chain<br>æˆ‘å€‘æ‰¾åˆ° Object.prototype å°±åœæ­¢äº†</p><blockquote><p>é‚£ <code>Object.prototype.__proto__</code> å‘¢?</p></blockquote><h3 id="æœ€é ‚å±¤çš„åŸå‹ç‰©ä»¶-Object-prototype">æœ€é ‚å±¤çš„åŸå‹ç‰©ä»¶: Object.prototype</h3><p>å¾€ä¸Šæ‰¾ <code>__proto__</code>ï¼Œä»€éº¼æ™‚å€™æ‰æœƒåœæ­¢ ?<br>æœƒç™¼ç¾ <code>Object.prototype.__proto__</code> ç­‰æ–¼ <code>null</code>ï¼Œä»£è¡¨ Object æ˜¯æœ€é ‚å±¤äº†ã€‚</p><p>åœ¨ JavaScript å¹¾ä¹æ‰€æœ‰çš„ç‰©ä»¶ (ç’°å¢ƒå®¿ä¸»ç‰©ä»¶é™¤å¤–)æœƒé †è‘—åŸå‹éŠæ‰¾åˆ°æœ€é ‚å±¤<br><code>Object.prototype</code>Â æ‰åœæ­¢ï¼Œå› ç‚ºÂ <code>Object.prototype</code>Â æ˜¯ JavaScript æ‰€æœ‰ç‰©ä»¶çš„èµ·æºã€‚</p><p>åœ¨Â <code>Object.prototype</code>Â æä¾›çš„æ‰€æœ‰æ–¹æ³•ï¼Œåœ¨ JavaScript çš„æ‰€æœ‰ç‰©ä»¶çš„å¯ä»¥å‘¼å«å®ƒã€‚</p><ul><li><code>Object.prototype.hasOwnProperty()</code> : æ˜¯å¦ç‚ºè‡ªå·±çš„å±¬æ€§æˆ–æ–¹æ³•</li><li><code>Object.prototype.toString()</code> : è½‰å‹æˆå­—ä¸²</li><li><code>Object.prototype.valueOf()</code> : å–å¾— <strong>åŸºæœ¬å‹åˆ¥</strong> çš„å€¼</li></ul><p>å¹¾ä¹æ‰€æœ‰çš„å€¼å¯ä»¥ä½¿ç”¨çš„ã€‚<br>å³ä¾¿å»ºç«‹ç‰©ä»¶æ™‚ï¼Œæ²’æœ‰å®šç¾©é€™äº›æ–¹æ³•ï¼Œä½†åŸºæ–¼åŸå‹éˆçš„ç¹¼æ‰¿ï¼Œæˆ‘å€‘é‚„æ˜¯å¯ä»¥å‘¼å«é€™äº›æ–¹æ³•ã€‚</p><h2 id="instanceof-æ˜¯å¦åœ¨ç‰©ä»¶çš„åŸå‹éˆä¸Š">instanceof : æ˜¯å¦åœ¨ç‰©ä»¶çš„åŸå‹éˆä¸Š</h2><p>instanceof é™¤äº†æª¢æŸ¥ <code>constructor.prototype</code> æ˜¯ä¸æ˜¯åœ¨ç‰©ä»¶çš„åŸå‹éˆä¸Š<br>ä¹Ÿèƒ½æª¢æŸ¥ <strong>è¤‡åˆå¼ç‰©ä»¶çš„åŸºæœ¬å‹åˆ¥</strong></p><ul><li>æª¢æŸ¥åŸºæœ¬å‹åˆ¥</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num = <span class="keyword">new</span> <span class="title class_">Number</span>(<span class="number">100</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(num) <span class="comment">// 100</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> num) <span class="comment">// &#x27;object&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(num <span class="keyword">instanceof</span> <span class="title class_">Number</span>) <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(num.<span class="title function_">valueOf</span>()) <span class="comment">// 100ï¼ŒåŸºæœ¬å‹åˆ¥çš„å€¼</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> num.<span class="title function_">valueOf</span>()) <span class="comment">//&#x27;number&#x27;</span></span><br></pre></td></tr></table></figure><p><code>valueOf()</code> å¯ä»¥æ‹¿åˆ°åŸºæœ¬å‹åˆ¥çš„å€¼</p><ul><li>æª¢æŸ¥æ˜¯ä¸æ˜¯åœ¨åŸå‹éˆä¸Šï¼ŒåŒç†ä½¿ç”¨ <code>class</code> çš„çµæ§‹ä¹Ÿå¯ä»¥æª¢æŸ¥</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">User</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> rosa = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(rosa <span class="keyword">instanceof</span> <span class="title class_">User</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h2 id="ç‰©ä»¶æœ¬èº«-v-s-åŸå‹éˆ-å‡ºç¾åŒåå±¬æ€§ç‰©ä»¶">ç‰©ä»¶æœ¬èº« v.s åŸå‹éˆ : å‡ºç¾åŒåå±¬æ€§ç‰©ä»¶ ?</h2><p>ç‰©ä»¶å¯¦é«”èˆ‡åŸå‹å…·æœ‰ç›¸åŒçš„å±¬æ€§æˆ–æ–¹æ³•</p><blockquote><p><strong>å„ªå…ˆå­˜å–è‡ªå·±çš„å±¬æ€§æˆ–æ–¹æ³•</strong>ï¼Œå¦‚æœæ²’æœ‰æ‰æœƒå†é †è‘—åŸå‹éˆå‘ä¸Šå°‹æ‰¾ã€‚</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Person</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">sayHello</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Yo!&quot;</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayHello</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;Hi!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="title function_">sayHello</span>()) <span class="comment">// Yo!</span></span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## åŸå‹çš„æ–¹æ³•æ“´å……</span></span><br><span class="line"><span class="string">class ç´šåˆ¥çš„æ“æœ‰ extend å¾€ä¸‹æ“´å……  </span></span><br><span class="line"><span class="string">å¯¦ä¾‹å‡ºå¯¦é«”å¾Œï¼Œæœƒå°‹æ‰¾å­˜åœ¨çš„åŸå‹ï¼Œä¸¦ä¸”ä¸€å±¤å±¤å¾€ä¸Šæ‰¾ã€‚</span></span><br><span class="line"><span class="string">å¦‚æœè¦æ›¿åŸå‹å®šç¾©å…¶ä»–çš„æ–¹æ³•å¯ä»¥é€™æ¨£å¯«    </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>javascript</span><br><span class="line"><span class="comment">// åŸå§‹</span></span><br><span class="line"><span class="title class_">Cat</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hello</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> says meow`</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å®šåœ¨æœ€ä¸Šå±¤ï¼Œè®“å¾€ä¸‹çš„éƒ½å¯ä»¥ä½¿ç”¨</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hello</span> =<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> says meow`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Object æ˜¯æœ€é ‚å±¤ï¼Œå…¶å¯¦åœ¨é€™é‚Šå®šç¾©ä¹Ÿå¯ä»¥ã€‚<br>å¦‚æœä¸æ˜¯åŒä¸€é¡å‹éƒ½éœ€è¦ä½¿ç”¨ï¼Œé€™ç¨®æ–¹æ³•ä¹Ÿå¯ä»¥å°è‡´å¥‡æ€ªçš„å•é¡Œç™¼ç”Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">push</span>(<span class="string">&#x27;lol&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> arr= []</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr[<span class="number">0</span>]) <span class="comment">// &#x27;lol&#x27;</span></span><br></pre></td></tr></table></figure><p>æ¯ä¸€å€‹ array ç”¢ç”Ÿæ™‚å·²ç¶“è¢«åŠ ä¸Š <code>'lol'</code><br>ä½¿ç”¨ä¸Šåˆæ³•ï¼Œä½†ä¸æ˜¯ä¸€å€‹å¥½æ“ä½œ</p><p>ä»¥ä¸Šå¦‚æœæœ‰èª¤ï¼Œæ­¡è¿æŒ‡æ•™ QQ</p><h2 id="åƒè€ƒ-15">åƒè€ƒ</h2><ol><li><a href="https://ithelp.ithome.com.tw/articles/10194356">é‡æ–°èªè­˜ JavaScript: Day 25 åŸå‹èˆ‡ç¹¼æ‰¿</a></li><li><a href="https://lidemy.com/courses/enrolled/390599">JS201 é€²éš JavaScriptï¼šé‚£äº›ä½ ä¸€ç›´æä¸æ‡‚çš„åœ°æ–¹</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€-40&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;JavaScript çš„æ ¸å¿ƒå°±åœ¨åŸå‹ !&lt;br&gt;
åŸå‹ä½¿å¾—ç‰©ä»¶éƒ½èƒ½ä½¿ç”¨åœ¨åŸå‹éˆä¸Šçš„å±¬æ€§åŠæ–¹æ³•&lt;br&gt;
æœ¬èº«ç‰©ä»¶ä¹Ÿå¯ä»¥å†æ“´å……&lt;br&gt;
é€éæœ¬ç¯‡äº†è§£åŸå‹çš„ä½¿ç”¨æ–¹æ³•&lt;/p&gt;</summary>
    
    
    
    <category term="2022" scheme="https://blog.rosa.tw/categories/2022/"/>
    
    <category term="04" scheme="https://blog.rosa.tw/categories/2022/04/"/>
    
    
    <category term="JavaScript" scheme="https://blog.rosa.tw/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>ç­†è¨˜ | JavaScript - class ç‰©ä»¶å°å‘ (II) ç¹¼æ‰¿</title>
    <link href="https://blog.rosa.tw/2022/04/04/JavaScript-Object-oriented-programming-02"/>
    <id>https://blog.rosa.tw/2022/04/04/JavaScript-Object-oriented-programming-02</id>
    <published>2022-04-19T04:33:24.000Z</published>
    <updated>2022-07-27T05:30:49.731Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€-39">å‰è¨€</h2><p>ä¸Šä¸€ç¯‡æˆ‘å€‘æåˆ° class åƒæ˜¯å¹«æˆ‘å€‘è£½ä½œè—åœ–<br>æœ‰è»Šå­åŸºæœ¬æ§‹é€ çš„è—åœ–<br>æ˜¯ä¸æ˜¯èƒ½é€éè—åœ–èƒ½åšå‡ºå…¶ä»–è»Šç¨®çš„è—åœ–å‘¢ ?</p><p>å¯ä»¥ï¼Œå°±æ˜¯ç¹¼æ‰¿ !</p><span id="more"></span><h2 id="extends">extends</h2><p>è¦è®“å­ç‰©ä»¶æ“æœ‰çˆ¶ç‰©ä»¶çš„å…§å®¹å¯ä»¥é€é <code>extends</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">newClass</span> <span class="keyword">extends</span> <span class="title class_ inherited__">OldClass</span>&#123;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç¯„ä¾‹ :</strong><br>Dog ç¹¼æ‰¿ Animal</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">speak</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> makes a noise.`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line"><span class="title function_">sit</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> sits.`</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> d = <span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="string">&#x27;Mitzie&#x27;</span>);</span><br><span class="line">d.<span class="title function_">speak</span>();<span class="comment">// &#x27;Mitzie barks.&#x27;</span></span><br><span class="line">d.<span class="title function_">sit</span>(); <span class="comment">// &#x27;Mitzie sits.&#x27;</span></span><br></pre></td></tr></table></figure><p>Dog ç¹¼æ‰¿ Animal çš„æ–¹æ³•äº†ï¼Œå› æ­¤åœ¨ Dog å‘¼å« speak æ˜¯å¯ä»¥çš„ã€‚</p><p>extends èƒŒå¾Œæœƒå¹«æˆ‘å€‘é€£æ¥ç‰©ä»¶çš„ prototype<br>ä½¿æˆ‘å€‘å¯ä»¥å–å¾—çˆ¶ç‰©ä»¶çš„æ–¹æ³•æˆ–å±¬æ€§ã€‚</p><blockquote><p>JavaScript ä½¿ç”¨ prototyped-based ä¸èƒ½è®“ç‰©ä»¶ä¸€æ¬¡ç¹¼æ‰¿å…©ç¨®<br>ä½†æœ‰ä¸€å€‹æ–¹æ³•å« <code>mixin</code> åˆ©ç”¨æ‹·è²çš„æ¦‚å¿µé”åˆ°ç›®çš„</p></blockquote><p>å› ç‚ºæˆ‘é‚„ä¸æœƒï¼Œå…ˆæ“±è‘— QQï¼Œå¾…è£œ<br>åƒè€ƒ :</p><ul><li><a href="https://zh.javascript.info/mixins">Mixin æ¨¡å¼</a></li></ul><h2 id="super">super()</h2><p>å¦‚æœè¦åœ¨ä¸€é–‹å§‹å°± <strong>å‘¼å«çˆ¶å±¤çš„æ–¹æ³•</strong>ï¼Œå¿…é ˆåŠ å…¥<code>super()</code>ï¼Œä»£è¡¨åœ¨ç¹¼æ‰¿çš„å­å±¤åˆå§‹åŒ–æ™‚ï¼Œå°‡èˆŠæ•¸å€¼è“‹éå»ï¼Œè¦å‚³é€²çš„åƒæ•¸ä¹Ÿè¦å¸¶å…¥ã€‚</p><blockquote><p>ç°¡å–®ä¾†èªªï¼Œ<code>super</code> å°±æ˜¯ä¸Šä¸€å±¤çš„ <code>constructor</code></p></blockquote><ul><li>æ²’æœ‰ <code>super()</code> çš„æƒ…æ³ä¸‹ï¼Œæƒ³åœ¨æ–°ç‰©ä»¶ç”Ÿæˆæ™‚å‘¼å«åŸå‹æ–¹æ³•çš„ <code>speak()</code></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">speak</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> makes a noise.`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line"><span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">speak</span>() <span class="comment">// å»ºæ§‹æ™‚åœ¨é€™è£¡å‘¼å«åŸå‹çš„æ–¹æ³•  </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">sit</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> sits.`</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> d = <span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="string">&#x27;Mitzie&#x27;</span>);</span><br><span class="line">d.<span class="title function_">speak</span>(); <span class="comment">// Error</span></span><br></pre></td></tr></table></figure><p>å°±æœƒè·‘å‡º</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Must call <span class="keyword">super</span> constructor <span class="keyword">in</span> derived <span class="keyword">class</span> <span class="symbol">before</span> <span class="symbol">accessing</span> &#x27;<span class="symbol">this</span>&#x27; <span class="symbol">or</span> <span class="symbol">returning</span> <span class="symbol">from</span> <span class="symbol">derived</span> <span class="symbol">constructor</span></span><br></pre></td></tr></table></figure><p>æœƒæç¤ºä½ è¦è¨˜å¾—åŠ å…¥ superï¼Œä¸ç„¶ <code>this</code> ä½¿ç”¨æ™‚æœƒå‡ºç¾å•é¡Œ</p><ul><li>åŠ ä¸Š super ä»¥åŠè¦åˆå§‹åŒ–çš„å€¼</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">speak</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> makes a noise.`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line"><span class="title function_">constructor</span>(<span class="params">name</span>)&#123;</span><br><span class="line"><span class="variable language_">super</span>(name)</span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">speak</span>() <span class="comment">// å»ºæ§‹æ™‚åœ¨é€™è£¡å‘¼å«åŸå‹çš„æ–¹æ³•  </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">sit</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> sits.`</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> d = <span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="string">&#x27;Mitzie&#x27;</span>);</span><br><span class="line">d.<span class="title function_">speak</span>(); <span class="comment">// &#x27;Mitzie makes a noise.&#x27;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœ super è£¡é¢æ²’æœ‰å‚³å…¥ <code>name</code><br><code>this</code> æ˜¯ Dog æœ¬èº«ï¼Œä½†æ˜¯ä¸å…·æœ‰ <code>name</code> é€™å€‹å€¼ï¼Œå°±æœƒæ˜¯ <code>undefined</code></p><h2 id="æ‡‰ç”¨-3">æ‡‰ç”¨</h2><p>ç¹¼æ‰¿å¯ä»¥ç”¨åœ¨æœ‰ <strong>å…±åŒå±¬æ€§</strong> çš„æ™‚å€™ï¼Œæƒ³å†åŠ ä¸€äº›é™„åŠ åŠŸèƒ½ï¼Œé€éç¹¼æ‰¿ä¸ç”¨å®Œå…¨é‡å¯«ã€‚</p><h2 id="åƒè€ƒ-14">åƒè€ƒ</h2><ul><li><a href="https://lidemy.com/courses/enrolled/390599">JS201 é€²éš JavaScriptï¼šé‚£äº›ä½ ä¸€ç›´æä¸æ‡‚çš„åœ°æ–¹</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€-39&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;ä¸Šä¸€ç¯‡æˆ‘å€‘æåˆ° class åƒæ˜¯å¹«æˆ‘å€‘è£½ä½œè—åœ–&lt;br&gt;
æœ‰è»Šå­åŸºæœ¬æ§‹é€ çš„è—åœ–&lt;br&gt;
æ˜¯ä¸æ˜¯èƒ½é€éè—åœ–èƒ½åšå‡ºå…¶ä»–è»Šç¨®çš„è—åœ–å‘¢ ?&lt;/p&gt;
&lt;p&gt;å¯ä»¥ï¼Œå°±æ˜¯ç¹¼æ‰¿ !&lt;/p&gt;</summary>
    
    
    
    <category term="2022" scheme="https://blog.rosa.tw/categories/2022/"/>
    
    <category term="04" scheme="https://blog.rosa.tw/categories/2022/04/"/>
    
    
    <category term="OOP" scheme="https://blog.rosa.tw/tags/OOP/"/>
    
  </entry>
  
  <entry>
    <title>ç­†è¨˜ | JavaScript - class ç‰©ä»¶å°å‘ (I) åˆæ¢ OOP</title>
    <link href="https://blog.rosa.tw/2022/04/04/JavaScript-Object-oriented-programming-01"/>
    <id>https://blog.rosa.tw/2022/04/04/JavaScript-Object-oriented-programming-01</id>
    <published>2022-04-19T04:33:15.000Z</published>
    <updated>2022-07-27T05:30:49.731Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€-38">å‰è¨€</h2><p>JavaScript æ˜¯ç‰©ä»¶å°å‘çš„èªè¨€<br>ä½†è·Ÿå…¶ä»–çš„ç‰©ä»¶å°å‘èªè¨€ä½¿ç”¨ class æœ‰é»ä¸åŒ</p><p>æ© ? Javascript ä¸æ˜¯ä¹Ÿç”¨ class å— ?<br>ä¸ï¼Œ<code>class</code> æ˜¯èªæ³•ç³–ï¼Œåˆ° ES6 æ‰å•ä¸–<br>çœŸæ­£çš„ JavaScript æ˜¯ä½¿ç”¨ prototype ä¾†é”æˆç‰©ä»¶å°å‘</p><p>æœ¬ç³»åˆ—å°‡å¾ç¾ä»£é–‹ç™¼ç”¨çš„ <code>class</code> ä¾†äº†è§£<br>å†åˆ°èªè­˜çœŸçš„åŸæ±åŸå‘³ <code>prototype</code> çš„ä½œæ³•</p><span id="more"></span><h2 id="class-çš„ç‰©ä»¶å°å‘">class çš„ç‰©ä»¶å°å‘</h2><p><code>Object-oriented programming</code> ç°¡ç¨± OOP<br>ç‰©ä»¶å°å‘çš„å„ªé»åœ¨æ–¼æ›´ <strong>ç›´è¦º</strong>ï¼Œæ›´æ¨¡çµ„åŒ–</p><p>ES6 æ˜¯ä½¿ç”¨ class<br>ES5 ä»¥å‰ä¸¦æ²’æœ‰ classï¼Œè€Œæ˜¯ä½¿ç”¨ <code>prototype</code> (åŸå‹) çš„æ–¹å¼ã€‚<br><code>class</code> åƒæ˜¯è—åœ–ï¼Œè€Œ <code>new</code> å‰‡æ˜¯æŠŠè—åœ–è£¡çš„æ±è¥¿å¯¦ä¾‹å‡ºä¾†</p><blockquote><p>é¡åˆ¥å‹çš„ç‰©ä»¶éƒ½æ˜¯<strong>å¤§å¯«é–‹é ­</strong>ï¼Œé€™æ˜¯å¸¸ç”¨çš„å¯«æ³•</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šç¾©è²“</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span>&#123;</span><br><span class="line"><span class="comment">// æ¯éš»è²“æœ‰åå­—</span></span><br><span class="line"><span class="title function_">constructor</span>(<span class="params">name</span>)&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ¯éš»è²“æ‰“æ‹›å‘¼æœƒå–µå–µå«</span></span><br><span class="line"><span class="title function_">hello</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> says meow`</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å»ºç«‹ä¸€éš»å« lily çš„è²“ï¼ŒæŠŠå®ƒå­˜åœ¨ lily é€™å€‹è®Šæ•¸</span></span><br><span class="line"><span class="keyword">let</span> lily = <span class="keyword">new</span> <span class="title class_">Cat</span>(<span class="string">&#x27;lily&#x27;</span>)</span><br><span class="line">lily.<span class="title function_">hello</span>() <span class="comment">// lily says meow</span></span><br><span class="line"><span class="keyword">let</span> bob = <span class="keyword">new</span> <span class="title class_">Cat</span>(<span class="string">&#x27;bob&#x27;</span>)</span><br><span class="line">bob.<span class="title function_">hello</span>() <span class="comment">// bob says meow</span></span><br></pre></td></tr></table></figure><ol><li><code>class</code> : ç‰©ä»¶çš„è—åœ–<br>è£¡é¢çš„æ¶µå¼ä¸éœ€è¦å¯« <code>function</code> çš„å­—ï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Method_definitions#description">function shorthand</a></li><li><code>new</code> : æŠŠè—åœ–å¯¦åšå‡ºä¾†ï¼Œæ”¾åˆ°è‡ªè¨‚ç¾©è®Šæ•¸ä¸­ï¼Œä¹‹å¾Œé€™å€‹è®Šæ•¸ä¹Ÿæ“æœ‰è—åœ–åŒ…å«çš„åŠŸèƒ½ã€‚<br>ç”¨ <code>.</code> (dot) é€£æ¥ï¼Œåƒ <code>object</code> ä¾†å‘¼å«ã€‚</li><li><code>new XXX(å»ºæ§‹å­åƒæ•¸)</code> : å»ºæ§‹å­æ˜¯ class å…§éƒ¨çš„æ¶µå¼ï¼Œå¯ä»¥åŠ å…¥åƒæ•¸ï¼Œé¡ä¼¼åˆå§‹åŒ–ã€‚<br>å°æ‡‰ <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é€™æ˜¯å»ºæ§‹å­</span></span><br><span class="line"><span class="title function_">construtor</span>(<span class="params"><span class="variable language_">arguments</span></span>)&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">arguments</span> = <span class="variable language_">arguments</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>constructor</code> : å¯ä»¥çœ‹åšåŸºæœ¬è³‡æ–™(è¨­å®šæª”)ï¼Œ<code>this.name = name</code><br>æŠŠ new å¸¶å…¥çš„å¼•æ•¸ä½œç‚ºå…§éƒ¨å»ºæ§‹å­åƒæ•¸ä½¿ç”¨ã€‚</p></blockquote></li><li><code>this</code> : åˆ†æˆ class å…§éƒ¨çš„ <code>this</code> èˆ‡å¤–éƒ¨çš„ <code>this</code>ã€‚é€™é‚Šè‘—é‡å…§éƒ¨çš„ thisã€‚<br><code>this</code> æ˜¯å°æ‡‰è¢«å¯¦é«”å‡ºä¾†çš„ä¸»é«”ã€‚<br>lily è¢«æŒ‡å‘å«åš lily çš„è²“<br>åä¹‹ bob ä¹Ÿæ˜¯ï¼Œä¸¦ä¸æ˜¯æŒ‡åŒä¸€å€‹ç‰©ä»¶<br>ä½†æ˜¯å…§éƒ¨æ–¹æ³•æ˜¯å…±ç”¨åŒä¸€å€‹ <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(lily.<span class="property">hello</span> === <span class="title class_">Bob</span>.<span class="property">hello</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure></li></ol><p>å°æ–¼å·²ç¶“å»ºç«‹çš„ç‰©ä»¶å†ä¿®æ”¹å…§éƒ¨å»ºæ§‹çš„å€¼éå¸¸ä¸å»ºè­°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lily.<span class="property">name</span> = <span class="string">&quot;rosa&quot;</span> (ğŸ‘)  </span><br></pre></td></tr></table></figure><p>é›–ç„¶å¯ä»¥ä¿®æ”¹æ‰å…§éƒ¨çš„ <code>this.name</code> çš„å€¼<br>ä¸€èˆ¬ä¾†èªªåœ¨å»ºç«‹å¯¦é«”æ™‚éƒ½æœƒè¨­å®šå¥½ï¼Œè¼ƒå°‘å†ç›´æ¥é€éå€‹åˆ¥æ›´æ”¹</p><h2 id="æ²’æœ‰-class-çš„ç‰©ä»¶å°å‘">æ²’æœ‰ class çš„ç‰©ä»¶å°å‘</h2><p>åœ¨ ES5 ä¸¦æ²’æœ‰ class çš„åšæ³•<br>å¦‚æœæ²’æœ‰ä½¿ç”¨ prototype çš„å¯«æ³•<br>æˆ‘å€‘å¯ä»¥é€é function ä¾†å»ºæ§‹</p><blockquote><p>function ä¹Ÿæ˜¯ç‰©ä»¶ï¼Œæ‰€ä»¥å¯ä»¥é€é <code>.</code> æ‹¿åˆ°å±¬æ€§æˆ–æ–¹æ³•</p></blockquote><ul><li>æ”¹å¯«ä¸Šé¢çš„ Cat class</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Cat</span>(<span class="params">name</span>) &#123;</span><br><span class="line"><span class="comment">// ç”¨ _ (dash) é€šå¸¸æŒ‡è¢«å°è£åœ¨å‡½å¼å…§çš„è®Šæ•¸ï¼Œé¡ä¼¼ç§æœ‰è®Šæ•¸ï¼Œä¸€èˆ¬ä¸æœƒç›´æ¥ä¿®æ”¹</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">_name</span> = name;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="variable language_">this</span>.<span class="property">_name</span>,</span><br><span class="line">    <span class="attr">hello</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> says meow`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Lily</span> = <span class="title class_">Cat</span>(<span class="string">&quot;Lily&quot;</span>);</span><br><span class="line"><span class="title class_">Lily</span>.<span class="title function_">hello</span>();</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Bob</span> = <span class="title class_">Cat</span>(<span class="string">&quot;Bob&quot;</span>);</span><br><span class="line"><span class="title class_">Bob</span>.<span class="title function_">hello</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Lily</span>.<span class="property">hello</span> === <span class="title class_">Bob</span>.<span class="property">hello</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><p>è®“ç‰©ä»¶èƒ½å‘¼å«æ–¹æ³•ç”¨ <code>function</code> å›å‚³ function çš„æ–¹å¼<br>ä½†æ˜¯é€™å€‹æ–¹æ³• <strong>éå¸¸æ¶ˆè€—è¨˜æ†¶é«”</strong><br>æ¯ä¸€å€‹ç”¢ç”Ÿçš„ function éƒ½æ˜¯ä¸åŒçš„ function</p><h2 id="å°æ¯”åœ–">å°æ¯”åœ–</h2><p><img data-src="https://dsm01pap006files.storage.live.com/y4mPsTnRBXXRDKUTn4h4YIRTBAE1Q3K4imjKAv-NaRLxF9KjYvNc3TJj5u-GvDWoZUpm_TBcByzdTcbSFqiAJtRNy43xJRnNoug9RKxYtHqxvCm-JrazXLtBM82gThGBaH8-SjTQbaFr0zZr4tGF2CuwLIl0u7I3soTI3iJ8usyN9oWE1SV6GyXIBp3snhf2Ply?width=1024&amp;height=325&amp;cropmode=none" alt="å³ : ES5 ï¼Œå·¦ : ES6"></p><p>å³é‚Šå› ç‚ºæ¯ä¸€å€‹å¯¦é«”éƒ½æ˜¯é‡æ–°å‰µå»ºä¸€å€‹æ–°ç‰©ä»¶æ–¹æ³•ï¼Œæ˜æ˜è¦å‘¼å«çš„æŒ‡å‘å¯¦é«”æ˜¯åŒä¸€å€‹è€Œå·²ã€‚<br>æ”¹å–„é€™éƒ¨åˆ†æœƒä½¿ç”¨åˆ° <code>prototype</code>ï¼Œè®“å»ºæ§‹çš„ç‰©ä»¶éƒ½æœ‰å…±åŒçš„æ–¹æ³•èˆ‡å±¬æ€§</p><ul><li>æœ‰ç„¡ä½¿ç”¨ prototype çš„å¯«æ³•</li></ul><p><img data-src="https://dsm01pap006files.storage.live.com/y4meCfDywgqAcUJCJFA07OVsJ4OvfDl-Qu_nPbSoDEocZ_v0aTe19CwejVfn_H2ZHF8PR5mb1xI4pjAwUuAQLb-NdFX5VB-_AmcjbZbIrfTn8wy1Cf5im0Lr8--yFtVkM8wsSdEd-N4TO9cPP64dTTXfH0td0OWI8XuyKow6jmPGLxam61-1dH2JWOpXzMFCDg3?width=1024&amp;height=308&amp;cropmode=none" alt="å·¦ : function ç›´æ¥å›å‚³ç‰©ä»¶ï¼Œå³ : é€é prototype"></p><p>æœ€å¤§çš„å·®åˆ¥åœ¨æ–¼ç”¢ç”Ÿçš„ç‰©ä»¶ <strong>æ˜¯ä¸æ˜¯å…±ç”¨åŒä¸€å€‹æ–¹æ³•</strong><br>å³é‚Šçš„é€é prototype æ–¹æ³•æ˜¯éƒ½æŒ‡å‘åŒä¸€å€‹</p><p>å»ºç«‹ç‰©ä»¶æ™‚å³é‚Šæ˜¯ä½¿ç”¨äº† <code>new</code>ï¼Œå¹«å°‡ç‰©ä»¶çš„åŸå‹ç¶åœ¨å»ºæ§‹å‡½å¼ä¸Š</p><h2 id="new-è—åœ–çš„å¯¦ä½œ">new : è—åœ–çš„å¯¦ä½œ</h2><p>new åˆ°åº•åšäº†ä»€éº¼æ˜¯å‘¢ ?</p><ul><li>new ä¸ new ?</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç­‰åŒæ–¼ class çš„ construtor</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Car</span>(<span class="params">name</span>)&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">name</span> = name </span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Car</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">buy</span>=<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`you buy a new <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> toyota = <span class="keyword">new</span> <span class="title class_">Car</span>(<span class="string">&#x27;toyota&#x27;</span>)</span><br><span class="line">toyota.<span class="title function_">buy</span>()</span><br><span class="line"><span class="keyword">let</span> honda = <span class="title class_">Car</span>(<span class="string">&#x27;honda&#x27;</span>) <span class="comment">// éŒ¯èª¤</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ²’ new æœƒå‡ºç¾ <code>Class constructor Car cannot be invoked without 'new'</code><br>ä»£è¡¨æ²’æœ‰åˆå§‹åŒ–ã€‚</p><h3 id="è¤‡ç¿’ä¸€ä¸‹-call">è¤‡ç¿’ä¸€ä¸‹ call</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hello</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">hello</span>() <span class="comment">//é€™é‚Šå°å‡ºçš„ this æ˜¯å…¨åŸŸç‰©ä»¶  </span></span><br><span class="line">hello.<span class="title function_">call</span>(<span class="string">&#x27;123&#x27;</span>) <span class="comment">//123ï¼Œthis è®Šæˆå‚³é€²å»çš„æ±è¥¿</span></span><br></pre></td></tr></table></figure><p><code>.call</code> æ˜¯å‘¼å«å‡½å¼çš„å¦ä¸€ç¨®æ–¹æ³•<br>é€éé€™æ¨£çš„æ–¹å¼å¯ä»¥å°‡ this ç¶åœ¨å‚³å…¥çš„ç‰©ä»¶ä¸Š</p><h3 id="æ‰‹å‹•é€ ä¸€å€‹-new">æ‰‹å‹•é€ ä¸€å€‹ new</h3><p>çŸ¥é“ call è·Ÿ this çš„é—œä¿‚ï¼Œå°±èƒ½äº†è§£ <code>constructor</code> çš„åˆå§‹åŒ–ã€‚</p><ul><li>ç›®æ¨™ : ä¸ç”¨ new åšä¸€æ¨£çš„åŠŸèƒ½</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> toyota = <span class="title function_">newCar</span>(<span class="string">&#x27;toyota&#x27;</span>)</span><br><span class="line">toyota.<span class="title function_">buy</span>()</span><br></pre></td></tr></table></figure><ul><li>ç”¨ newCar</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Car</span>(<span class="params">name</span>)&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">name</span> = name </span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Car</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">buy</span>=<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`you buy a new <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">newCar</span>(<span class="params">name</span>)&#123;</span><br><span class="line"><span class="keyword">var</span> obj =&#123;&#125;</span><br><span class="line"><span class="title class_">Car</span>.<span class="title function_">call</span>(obj,name)</span><br><span class="line">obj.<span class="property">__proto__</span> = <span class="title class_">Car</span>.<span class="property"><span class="keyword">prototype</span></span></span><br><span class="line"><span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>new å…¶å¯¦åšäº† :</p><ol><li>å»ºç«‹ä¸€å€‹ obj</li><li><code>.call(obj,name)</code>ï¼Œå‘¼å«å»ºæ§‹å­ã€‚æŠŠ obj ç•¶ä½œ <code>this</code>ï¼Œname ä½œç‚ºåƒæ•¸ï¼Œå®Œæˆ <code>constructor</code> çš„åˆå§‹åŒ–ã€‚<blockquote><p>æ²’æœ‰é€™ä¸€é …ç„¡æ³•æŒ‡å‘å¯¦é«”ï¼Œ<code>this</code> ç¶å®šå•é¡Œ</p></blockquote></li><li>ç”¨ <code>__proto__</code> å°å‘è‡³ prototypeï¼Œè·ŸåŸå‹é€²è¡Œæ­æ©‹ï¼Œæ‰èƒ½ä½¿ç”¨åˆ°è©²åŸå‹æ–¹æ³•ã€‚</li><li><code>return obj</code> ï¼Œå¯¦ä¾‹ (instance) å‡ºä¾†çš„æ±è¥¿ã€‚</li></ol><h2 id="çµèª-12">çµèª</h2><p>ç¾ä»£é–‹ç™¼å¤§å¤šé‚„æ˜¯ä½¿ç”¨ class<br>ä½†ä¸¦éä»£è¡¨ JavaScript å°±æ˜¯ç”¨ class(é¡åˆ¥) ä¾†å»ºç«‹<br>èƒŒå¾Œä¾ç„¶æ˜¯ function èˆ‡æŒ‡å®š prototype çš„å¯¦ä½œ</p><p>æƒ³æ›´äº†è§£ JavaScript èªè­˜ prototype æ˜¯ä¸å¯å°‘çš„<br>åŒæ™‚æˆ‘ä¹ŸæŸ¥äº†ç‚ºä»€éº¼ JavaScript ä½œè€…ä½¿ç”¨ prototype çš„è¨­è¨ˆ<br>è€Œä¸æ˜¯ç”¨é¡åˆ¥ ï¼Œæ˜¯å‡ºæ–¼ä»€éº¼è€ƒé‡?</p><p>åœ¨<a href="https://stackoverflow.com/questions/8433459/what-s-the-purpose-of-prototype">é€™ç¯‡</a> æ‰¾åˆ°çš„çš„è§£é‡‹æ˜¯ class-based æ˜¯è¦ <strong>é‡é ­è¨­è¨ˆç‰©ä»¶</strong>ï¼Œè€Œ prototype-based å¯ä»¥é€éç¾æœ‰å·²å»ºç«‹çš„ç‰©ä»¶å†å»ºç«‹ï¼Œç¸½å¾—ä¾†èªªæ•ˆèƒ½ä¸Šæ›´å¿«ã€‚</p><h2 id="åƒè€ƒ-13">åƒè€ƒ</h2><ul><li><a href="https://lidemy.com/courses/enrolled/390599">JS201 é€²éš JavaScriptï¼šé‚£äº›ä½ ä¸€ç›´æä¸æ‡‚çš„åœ°æ–¹</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€-38&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;JavaScript æ˜¯ç‰©ä»¶å°å‘çš„èªè¨€&lt;br&gt;
ä½†è·Ÿå…¶ä»–çš„ç‰©ä»¶å°å‘èªè¨€ä½¿ç”¨ class æœ‰é»ä¸åŒ&lt;/p&gt;
&lt;p&gt;æ© ? Javascript ä¸æ˜¯ä¹Ÿç”¨ class å— ?&lt;br&gt;
ä¸ï¼Œ&lt;code&gt;class&lt;/code&gt; æ˜¯èªæ³•ç³–ï¼Œåˆ° ES6 æ‰å•ä¸–&lt;br&gt;
çœŸæ­£çš„ JavaScript æ˜¯ä½¿ç”¨ prototype ä¾†é”æˆç‰©ä»¶å°å‘&lt;/p&gt;
&lt;p&gt;æœ¬ç³»åˆ—å°‡å¾ç¾ä»£é–‹ç™¼ç”¨çš„ &lt;code&gt;class&lt;/code&gt; ä¾†äº†è§£&lt;br&gt;
å†åˆ°èªè­˜çœŸçš„åŸæ±åŸå‘³ &lt;code&gt;prototype&lt;/code&gt; çš„ä½œæ³•&lt;/p&gt;</summary>
    
    
    
    <category term="2022" scheme="https://blog.rosa.tw/categories/2022/"/>
    
    <category term="04" scheme="https://blog.rosa.tw/categories/2022/04/"/>
    
    
    <category term="OOP" scheme="https://blog.rosa.tw/tags/OOP/"/>
    
  </entry>
  
  <entry>
    <title>ç­†è¨˜ | JavaScript - this (II) callã€appalyã€bind</title>
    <link href="https://blog.rosa.tw/2022/04/04/JavaScript-this-II"/>
    <id>https://blog.rosa.tw/2022/04/04/JavaScript-this-II</id>
    <published>2022-04-15T03:07:53.000Z</published>
    <updated>2022-07-27T05:30:49.732Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€-43">å‰è¨€</h2><p>é™¤äº†é€éåŸ·è¡Œç’°å¢ƒèˆ‡ä¸Šä¸‹æ–‡ä¾†ç¶å®šä¹‹å¤–<br>this æ˜¯å¯ä»¥æ”¹è®Šçš„<br>æ”¹è®Š this æœ‰ä¸‰ç¨®æ–¹å¼</p><span id="more"></span><h2 id="call-apply">call &amp; apply</h2><p>ä¸Šä¸€ç¯‡æœ‰ç°¡ç•¥æé <code>.call()</code><br>ç­‰åŒæ–¼ function ç›´æ¥åŸ·è¡Œ<br>è€Œä¸”æ˜¯æœ‰å¸¶ <code>this</code><br>ç¬¬ä¸€å€‹åƒæ•¸æ˜¯æŒ‡å®š <code>this</code>ï¼Œå¾Œé¢åŠæ˜¯ <code>arguments</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€™æ¨£æ˜¯ä¸€æ¨£çš„</span></span><br><span class="line"><span class="title function_">test</span>() === test.<span class="title function_">call</span>()</span><br><span class="line"><span class="title function_">test</span>() === test.<span class="title function_">apply</span>()</span><br></pre></td></tr></table></figure><p>é€™å…©å€‹åŸ·è¡Œæ˜¯å·®ä¸å¤šçš„<br>å·®åœ¨å¾Œé¢çš„åƒæ•¸é¡å‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> test =&#123;</span><br><span class="line">a : <span class="number">1</span>,</span><br><span class="line"><span class="title function_">log</span>(<span class="params">num</span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>,num)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> obj =&#123;</span><br><span class="line"><span class="attr">a</span>: <span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line">test.<span class="title function_">log</span>(<span class="number">5</span>) <span class="comment">// 1 , 5</span></span><br><span class="line"><span class="comment">// æ”¹è®Š this </span></span><br><span class="line">test.<span class="property">log</span>.<span class="title function_">apply</span>(obj,[<span class="number">5</span>]) <span class="comment">// 5 , 5</span></span><br><span class="line">test.<span class="property">log</span>.<span class="title function_">call</span>(obj,<span class="number">5</span>) <span class="comment">// 5 , 5</span></span><br></pre></td></tr></table></figure><ul><li><code>call</code> : å¾Œé¢éƒ½ç”¨é€—è™Ÿéš”é–‹<br><code>.call(thisValue,args[0],args[1])</code></li><li><code>apply</code> : å‰é¢ç‚º thisï¼Œå¾Œé¢åƒæ•¸ç‚ºé¡é™£åˆ—ã€‚<br><code>.apply(thisValue,[args[0],args[1]])</code></li></ul><h3 id="call-è·Ÿ-apply-ç‚ºä»€éº¼åŒæ™‚å­˜åœ¨">call è·Ÿ apply ç‚ºä»€éº¼åŒæ™‚å­˜åœ¨ ?</h3><p>ä¾‹å­æ˜¯ä¾†è‡ª <a href="https://blog.huli.tw/2020/04/18/javascript-function-is-awesome/">è¦ºå¾— JavaScript function å¾ˆæœ‰è¶£çš„æˆ‘æ˜¯ä¸æ˜¯å¾ˆå¥‡æ€ª</a><br>é€™ç¯‡ä¹Ÿæ¢è¨å¾ˆæœ‰è¶£çš„ JS å•é¡Œ</p><ul><li>Math.max çš„åƒæ•¸å¯ä»¥åƒéš¨æ„æ•¸å€¼</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)) <span class="comment">// 6</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘å€‘è¦å¾é™£åˆ—ä¸­æ‰¾å‡ºæœ€å¤§å€¼å‘¢ ?<br>ç›´æ¥å‘¼å«æœƒå°è‡´éŒ¯èª¤<br>å¯ä»¥é‹ç”¨ apply çš„åƒæ•¸æ˜¯ <strong>é™£åˆ—</strong> çš„æ–¹å¼å¸¶å…¥<br>æˆ–è€…ç”¨ ES6 å±•é–‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="property">max</span>.<span class="title function_">apply</span>(<span class="literal">null</span>,arr)) <span class="comment">// 6</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">max</span>(...arr)) <span class="comment">// 6 , å±•é–‹ </span></span><br></pre></td></tr></table></figure><p>ç¸½æ˜¯æœƒæœ‰ä¸åŒçš„æƒ…å¢ƒå¯ä»¥ä½¿ç”¨</p><h2 id="bind">bind</h2><p>æŠŠ this çš„å€¼å…ˆç¶æ­»ï¼Œä¸ç®¡å¾Œé¢æ€éº¼ call<br>éƒ½ä¸æœƒè®Šå‹•ã€‚</p><blockquote><p>bind å›å‚³çš„æ˜¯ä¸€å€‹ <strong>function</strong></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o = &#123;</span><br><span class="line"><span class="attr">a</span>:<span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line"><span class="attr">a</span>:<span class="number">1</span>,</span><br><span class="line"><span class="attr">test</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> b = obj.<span class="property">test</span>.<span class="title function_">bind</span>(o) <span class="comment">// function</span></span><br><span class="line"><span class="title function_">b</span>() <span class="comment">// 10</span></span><br><span class="line">b.<span class="title function_">call</span>(obj) <span class="comment">// ä¾èˆŠæ˜¯ 10</span></span><br></pre></td></tr></table></figure><p>éåš´æ ¼æ¨¡å¼åº•ä¸‹ï¼Œç„¡è«–æ˜¯ç”¨ callã€apply é‚„æ˜¯ bind<br>å‚³é€²å»çš„å¦‚æœæ˜¯ primitive éƒ½æœƒè¢«è½‰æˆ <strong>object</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hello</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">hello.<span class="title function_">call</span>(<span class="number">123</span>) <span class="comment">// [Number: 123]</span></span><br><span class="line"><span class="keyword">const</span> myHello = hello.<span class="title function_">bind</span>(<span class="string">&#x27;my&#x27;</span>)</span><br><span class="line"><span class="title function_">myHello</span>() <span class="comment">// [String: &#x27;my&#x27;]</span></span><br></pre></td></tr></table></figure><h2 id="ç®­é ­å‡½å¼-v-s-bind">ç®­é ­å‡½å¼ v.s bind</h2><p>åˆå­¸æ™‚æœƒèªç‚º arrow funciton æœ‰æŒ‡å‘è‡ªå·±ï¼Œç¶å®šçš„æ„å‘³<br>ä½†å…©è€…æœ‰å¾ˆå¤§çš„å€åˆ¥</p><ul><li><code>.bind(this)</code> : å‘¼å«ä¹‹å‰å°±å…ˆç¶å®šï¼Œè®“è¢«å‘¼å«çš„éƒ½æœ‰å›ºå®šçš„ <code>this</code>ã€‚</li><li>arrow function this : ç®­é ­å‡½å¼æ²’æœ‰å»ºç«‹ä»»ä½•çš„ thisï¼Œç°¡å–®ä¾†èªªæ˜¯æ ¹æœ¬æ²’æœ‰è‡ªå·±çš„ thisã€‚<br>åœ¨ç®­é ­å‡½å¼ä½¿ç”¨ thisï¼Œæœƒåƒè®Šæ•¸ä¸€æ¨£ï¼Œå¾€å¤–éƒ¨å°‹æ‰¾ã€‚</li></ul><h2 id="åƒè€ƒ-18">åƒè€ƒ</h2><ol><li><a href="https://blog.huli.tw/2019/02/23/javascript-what-is-this/">æ·ºè«‡ JavaScript é ­è™Ÿé›£é¡Œ thisï¼šçµ•å°ä¸å®Œæ•´ï¼Œä½†ä¿è­‰å¥½æ‡‚ - Huli</a></li><li><a href="https://blog.huli.tw/2020/04/18/javascript-function-is-awesome/">è¦ºå¾— JavaScript function å¾ˆæœ‰è¶£çš„æˆ‘æ˜¯ä¸æ˜¯å¾ˆå¥‡æ€ª</a></li><li><a href="https://zh.javascript.info/arrow-functions">æ·±å…¥ç†è§£ç®­å¤´å‡½æ•°</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€-43&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;é™¤äº†é€éåŸ·è¡Œç’°å¢ƒèˆ‡ä¸Šä¸‹æ–‡ä¾†ç¶å®šä¹‹å¤–&lt;br&gt;
this æ˜¯å¯ä»¥æ”¹è®Šçš„&lt;br&gt;
æ”¹è®Š this æœ‰ä¸‰ç¨®æ–¹å¼&lt;/p&gt;</summary>
    
    
    
    <category term="2022" scheme="https://blog.rosa.tw/categories/2022/"/>
    
    <category term="04" scheme="https://blog.rosa.tw/categories/2022/04/"/>
    
    
    <category term="JavaScript" scheme="https://blog.rosa.tw/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>ç­†è¨˜ | JavaScript - this (I) åŸºç¤æ¦‚å¿µ</title>
    <link href="https://blog.rosa.tw/2022/04/04/JavaScript-this-I"/>
    <id>https://blog.rosa.tw/2022/04/04/JavaScript-this-I</id>
    <published>2022-04-15T03:07:39.000Z</published>
    <updated>2022-07-27T05:30:49.732Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€-42">å‰è¨€</h2><p>åœ¨å­¸ç¿’ JavaScript æ™‚å¾ˆå¤šèª²ç¨‹æœƒå»ºè­°ä¸è¦æ€¥è‘—å…ˆç”¨ <code>this</code><br>å› ç‚º this æœƒè·‘å‡ºè®“æ–°æ‰‹ç„¡æ³•é æœŸçš„çµæœ<br>åœ¨æŸäº›æƒ…æ³ä¸‹ä½¿ç”¨ this åè€Œæ›´æ£˜æ‰‹<br>è—‰ç”±æœ¬æ¬¡ä¾†åˆæ­¥äº†è§£é€™å€‹å¥‡å¦™çš„ <strong>this</strong>!</p><span id="more"></span><h2 id="ä»€éº¼æ˜¯-this">ä»€éº¼æ˜¯ this ?</h2><ul><li>é—œéµå­—</li><li>function åŸ·è¡Œæ™‚ï¼Œè‡ªå‹•ç”Ÿæˆçš„å…§éƒ¨ç‰©ä»¶</li><li>éš¨ function åŸ·è¡Œå ´åˆä¸åŒï¼Œthis æŒ‡å‘çš„å€¼ä¹Ÿæœƒä¸åŒ</li><li>å¤§å¤šæ•¸æƒ…æ³ï¼ŒthisÂ ä»£è¡¨çš„å°±æ˜¯å‘¼å« function çš„ç‰©ä»¶ (Owner Object of the function)ã€‚</li></ul><p>ç¸½å¾—ä¾†èªª :</p><blockquote><p>this æœƒå›  <strong>åŸ·è¡Œçš„ç’°å¢ƒèˆ‡ä¸Šä¸‹æ–‡</strong> (context) çš„ä¸åŒï¼Œè€Œæœ‰ä¸åŒçš„çµæœ<br>ç¿»è­¯æ©Ÿ : <strong>è·Ÿ function åœ¨å“ªè£¡å‘¼å«æœ‰é—œ</strong></p></blockquote><p>ç©ºèªª this æœ‰é»é›£ä»¥äº†è§£ï¼Œthis å…¶å¯¦åœ¨å“ªè£¡éƒ½å¯ä»¥ä½¿ç”¨(éåš´æ ¼æ¨¡å¼ä¸‹)<br>JavaScript ä¸¦æ²’æœ‰ç‰¹åˆ¥é™åˆ¶ this ç¶å®šåœ¨å“ªï¼Œæ‰€ä»¥ this æ˜¯æœƒè®Šä¾†è®Šå»çš„<br>æ­£å› å¦‚æ­¤æ‰é¡¯å¾—æœ‰é»éº»ç…©</p><h2 id="ä¸åŒæƒ…æ³ä¸‹çš„-this">ä¸åŒæƒ…æ³ä¸‹çš„ this</h2><h3 id="ç‰©ä»¶å°å‘çš„-this">ç‰©ä»¶å°å‘çš„ this</h3><p>this å°±æ˜¯ <code>instance</code> æœ¬èº«ï¼Œè¢« <strong>å¯¦ä¾‹</strong> å‡ºä¾†çš„é‚£å€‹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span>&#123;</span><br><span class="line"><span class="title function_">constructor</span>(<span class="params">name</span>)&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">getValue</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> toyota = <span class="keyword">new</span> <span class="title class_">Car</span>(<span class="string">&#x27;toyota&#x27;</span>)</span><br><span class="line">toyota.<span class="title function_">getValue</span>()</span><br></pre></td></tr></table></figure><p>é€™å€‹ä¾‹å­å°±æ˜¯ <code>toyota</code> ç‰©ä»¶æœ¬èº«</p><h3 id="ç‰©ä»¶å°å‘ä¹‹å¤–çš„-this">ç‰©ä»¶å°å‘ä¹‹å¤–çš„ this</h3><p>è„«é›¢ <code>class</code> å¾Œï¼Œå¯ä»¥å†ç´°åˆ†æˆ</p><ol><li>ä¸€èˆ¬ function ä¸­çš„ this</li><li>DOM äº‹ä»¶ä¸­çš„ this</li><li><code>object</code> çš„ this</li><li>arrow function çš„ this <strong>(ç‰¹åˆ¥)</strong> â­</li></ol><blockquote><p>æ®ºæ‰‹é§ : å¯ä»¥ç”¨ <code>.call()</code> ä¾†çŸ¥é“ this çš„æ„ç¾©</p></blockquote><p><code>.call()</code> æ˜¯åŸ·è¡Œ function å¦ä¸€ç¨®æ–¹å¼<br><code>.call(context,args[0],args[1])</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params">p1,p2</span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>,p1,p2)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">test</span>(<span class="number">1</span>,<span class="number">2</span>) <span class="comment">// undefined 1 2</span></span><br><span class="line">test.<span class="title function_">call</span>(<span class="literal">undefined</span>,<span class="number">1</span>,<span class="number">2</span>) <span class="comment">// undefined 1 2</span></span><br></pre></td></tr></table></figure><p>é€™å…©å€‹æ˜¯ä¸€æ¨£çš„ï¼Œæœƒç™¼ç¾åŸä¾†ä¸€èˆ¬å‘¼å« function æœƒå°‘äº† this<br>è€Œé€™å€‹ this å°±æ˜¯çœ‹åŸ·è¡Œçš„ç’°å¢ƒèˆ‡ä¸Šä¸‹æ–‡ (context) è€Œä¾†çš„</p><p><strong>ç‰©ä»¶ä¸­çš„ function å‘¢ ?</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params">p1,p2</span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>,p1,p2)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">func : test</span><br><span class="line">&#125;</span><br><span class="line">obj.<span class="property">func</span>.<span class="title function_">call</span>(obj)</span><br></pre></td></tr></table></figure><p>æ ¹æ“šä¸Šé¢èªªçš„</p><blockquote><p><code>this</code>Â ä»£è¡¨çš„å°±æ˜¯å‘¼å« function çš„ç‰©ä»¶</p></blockquote><p>ç‰©ä»¶å‘¼å«ï¼Œå‘¼å«çš„ method å‰é¢æ˜¯ obj<br>æ‰€ä»¥ call è£¡é¢çš„ this ä½ç½®æ˜¯ <code>obj</code></p><h4 id="ä¸€èˆ¬-function-ä¸­çš„-this">ä¸€èˆ¬ function ä¸­çš„ this</h4><p>æ ¹æ“šç’°å¢ƒä¸åŒï¼Œçµæœä¸åŒ<br>ä½†æ˜¯éƒ½æ˜¯ global çš„ç‰©ä»¶<br>åœ¨ <strong>éåš´æ ¼æ¨¡å¼</strong> ä¸‹</p><ul><li>node.js : <code>this = global</code><br><img data-src="https://dsm01pap006files.storage.live.com/y4mBY1X7hZFvUS0mwa7p25amxq2Q5tXcp0SRBAKj7cJNx_37JCdjvCWa0cMAjfVWWbH4a8_YsBV0qOgYrNgcg6zJ5FhgIGuLqLlMT8euJQKJx8Dr9WTfy2FGVzvqh4ES1YzVoXlfdOCNR8Q_ndRIiDSyucw5IxbNHFsKeU5KRB71oZ9e096hhsMhYq6JT-FlHeR?width=1022&amp;height=617&amp;cropmode=none" alt="global ç‰©ä»¶"></li><li>ç€è¦½å™¨ : <code>this = window</code><br><img data-src="https://dsm01pap006files.storage.live.com/y4mkwi-WphtCQHHgZoUP5u8Q0AkSyEZZcX6U6ErkFF5AKuF0z1us2zGqqo2w-Ir8auT0FL7AbZxjEfLh3Y4wyVYyLU38xVibSCWD1r70lghQMdlCieK35uGdQSgT5HKX5iStqZw2ekAtQWqgxktoKIFmMjFBf-L3h8PkZ505ii9ON4qS1jF7nRxrEJz42_hQ7AL?width=662&amp;height=300&amp;cropmode=none" alt="window æ˜¯ç€è¦½å™¨çš„å…¨åŸŸç‰©ä»¶"></li></ul><blockquote><p><strong>åš´æ ¼æ¨¡å¼</strong> ä¸‹çš„ this æŒ‡å‘å…¨åŸŸç‰©ä»¶æ˜¯ <code>undefined</code><br>å› ç‚º this æ²’æœ‰ç¶å®šèª°ï¼Œæ‰€ä»¥æœƒæ˜¯ <code>undefined</code>ã€‚</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">test</span>() <span class="comment">// undefined</span></span><br><span class="line"><span class="comment">// è½‰æˆ call</span></span><br><span class="line">test.<span class="title function_">call</span>() <span class="comment">// undefined ,æ²’æœ‰å¸¶å…¥æ±è¥¿ï¼Œåš´æ ¼æ¨¡å¼ä¸‹æ˜¯ undefined</span></span><br></pre></td></tr></table></figure><h4 id="DOM-äº‹ä»¶ä¸­çš„-this">DOM äº‹ä»¶ä¸­çš„ this</h4><p>å°æ‡‰åˆ°äº‹ä»¶è§¸ç™¼çš„ <strong>å…ƒç´ </strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.btn&#x27;</span>)</span><br><span class="line">.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ä»¥ click ç‚ºä¾‹ï¼Œ <code>this</code> æœƒå°å‘è¢«æŒ‰åˆ°çš„ <strong>å…ƒç´ </strong> æœ¬èº«</p><p>ä½†æ˜¯åœ¨äº‹ä»¶è£¡ <strong>å‘¼å«å…¶ä»– function</strong> æ™‚å°±è¦ç‰¹åˆ¥æ³¨æ„äº†<br>ç”±æ–¼å…§éƒ¨çš„ function æ²’æœ‰ç¶å®šç‰©ä»¶ï¼Œ this æœƒæ˜¯å…¨åŸŸç‰©ä»¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">el.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line"><span class="comment">// ajax çš„ this æ˜¯ window å…¨åŸŸç‰©ä»¶</span></span><br><span class="line">$.<span class="title function_">ajax</span>(<span class="string">&#x27;url&#x27;</span>,<span class="keyword">function</span>(<span class="params">res</span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">textContent</span>,res) </span><br><span class="line">&#125;)</span><br><span class="line">&#125;,<span class="literal">false</span>)</span><br></pre></td></tr></table></figure><p>å¯ä»¥é€éå…¶ä»–è®Šæ•¸å°‡ <code>this</code> å…ˆå­˜èµ·ä¾†ï¼Œç›´æ¥åœ¨å…§éƒ¨å‘¼å«çš„å‡½å¼æ›¿æ›ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">el.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line"><span class="comment">// æŠŠé€™é‚Šçš„ this å­˜èµ·ä¾†ï¼ŒæŒ‡å‘çš„æ˜¯å…ƒç´ æœ¬èº«</span></span><br><span class="line"><span class="keyword">var</span> that = <span class="variable language_">this</span>;</span><br><span class="line"><span class="comment">// ajax çš„ this æ˜¯ window</span></span><br><span class="line">$.<span class="title function_">ajax</span>(<span class="string">&#x27;url&#x27;</span>,<span class="keyword">function</span>(<span class="params">res</span>)&#123;</span><br><span class="line"><span class="comment">// æŠŠ å…ƒç´ æœ¬èº«çš„ this å¸¶é€²ä¾†</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(that.<span class="property">textContent</span>,res) </span><br><span class="line">&#125;)</span><br><span class="line">&#125;,<span class="literal">false</span>)</span><br></pre></td></tr></table></figure><p>ä¸‹ä¸€ç¯‡æœƒæåˆ°å¦‚ä½•ç”¨å‡½å¼çš„æ–¹å¼ç¶å®š this</p><ul><li>è½‰æˆ <code>.call</code><br><code>el</code> æ˜¯ document å­çµé»å–å¾—çš„ï¼Œé€™é‚Šä¹Ÿå¯ä»¥çœ‹åšä¸€å€‹ç‰©ä»¶</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">el.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,handler,<span class="literal">false</span>)</span><br><span class="line">el.<span class="title function_">addEventListener</span>(<span class="string">&#x27;type&#x27;</span>,handler.<span class="title function_">call</span>(el),<span class="literal">false</span>) <span class="comment">// æ”¾å…¥çš„æ˜¯ å…ƒç´  æœ¬èº«</span></span><br></pre></td></tr></table></figure><h4 id="object-çš„-this">object çš„ this</h4><p>æŒ‡ obj æœ¬èº«ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">2</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line"><span class="attr">a</span>:<span class="number">1</span>,</span><br><span class="line">test : <span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>) <span class="comment">// 1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>) <span class="comment">// obj</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.<span class="title function_">test</span>()</span><br><span class="line"><span class="comment">// è½‰æˆ call</span></span><br><span class="line">obj.<span class="property">test</span>.<span class="title function_">call</span>(obj)</span><br></pre></td></tr></table></figure><h4 id="arrow-function-çš„-this">arrow function çš„ this</h4><blockquote><p>arrow function æ²’æœ‰è‡ªå·±çš„ this<br>è€Œæ˜¯ç”¨å¤–éƒ¨çš„ this</p></blockquote><p>ç®­é ­å‡½å¼ä¹‹æ‰€ä»¥åœ¨ this è¡¨ç¾å¥‡æ€ª<br>è·Ÿå…¶ä»–ç‹€æ³çš„ this ä¸åŒçš„æ˜¯ <strong>ä¸æ˜¯å“ªè£¡è¢«å‘¼å«æœ‰é—œ</strong><br>è€Œæ˜¯ <strong>åœ¨å“ªå®šç¾©</strong> æœ‰é—œ<br>å¦‚æœå‰é¢å·²å®šç¾©äº†ï¼Œå°±æœƒç”¨é‚£å€‹å€¼<br>ä¾†çœ‹çœ‹ä¾‹å­</p><ul><li>ä¸€èˆ¬ function</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">hello</span>&#123;</span><br><span class="line"> <span class="title function_">test</span>(<span class="params"></span>)&#123;</span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)</span><br><span class="line"> <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)</span><br><span class="line"> &#125;,<span class="number">2000</span>)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="title function_">hello</span>()</span><br><span class="line">a.<span class="title function_">test</span>()</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜é¡¯çš„ <code>new</code> å»ºæ§‹å‡ºä¾†çš„ç‰©ä»¶<br>å‰é¢æœ‰æåˆ°æ˜¯ <strong>å¯¦ä¾‹</strong> æœ¬èº«<br>ä½†æ˜¯è£¡é¢å‘¼å« function çš„  this å‘¢ ?<br>æ˜¯æŒ‡ <strong>å…¨åŸŸç‰©ä»¶</strong><br>setTimeout ä¸¦æ²’æœ‰é€éå…¶ä»–ç‰©ä»¶å‘¼å«<br>å°±åƒåœ¨å¤–éƒ¨å‘¼å« <code>setTimeout</code></p><p>æ—¢ç„¶æ˜¯ hello é€™å€‹ç‰©ä»¶çš„æ±è¥¿<br>æˆ‘å€‘å¸Œæœ› <code>this</code> æŒ‡å‘çš„æ˜¯ hello æœ¬èº«å»ºæ§‹å‡ºä¾†çš„ç‰©ä»¶<br><code>arrow function</code> å°±æ´¾ä¸Šç”¨å ´äº†</p><ul><li>ç”¨ <code>arrow function</code></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">hello</span>&#123;</span><br><span class="line"> <span class="title function_">test</span>(<span class="params"></span>)&#123;</span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>) <span class="comment">// hello&#123;&#125;</span></span><br><span class="line"> <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>) <span class="comment">// hello&#123;&#125;</span></span><br><span class="line"> &#125;,<span class="number">2000</span>)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="title function_">hello</span>()</span><br><span class="line">a.<span class="title function_">test</span>()</span><br></pre></td></tr></table></figure><p>arrow function æœ¬èº«æ²’æœ‰ this<br>è€Œæ˜¯æ ¹æ“šå®šç¾©åœ¨å“ªï¼Œthis å°±æ˜¯é‚£å€‹å€¼<br>é€šå¸¸ä¹Ÿæ˜¯æŒ‡ç®­é ­å‡½æ˜¯å¤–éƒ¨çš„ this</p><h2 id="this-èˆ‡å‰å¾Œæ–‡æœ¬-context-çš„ç¶å®šåŸºæœ¬åŸå‰‡">this èˆ‡å‰å¾Œæ–‡æœ¬ (context) çš„ç¶å®šåŸºæœ¬åŸå‰‡</h2><p>this ç¶å®šåŸå‰‡å¤§æ¦‚å¯ä»¥åˆ†å››å¤§ç¨®</p><ul><li><strong>é è¨­ç¶å®š</strong> (Default Binding)</li><li><strong>éš±å«å¼ç¶å®š</strong> (Implicit Binding)</li><li><strong>é¡¯å¼ç¶å®š</strong> (Explicit Binding)</li><li>ã€Œ<strong>newã€é—œéµå­—ç¶å®š</strong></li></ul><h3 id="é è¨­ç¶å®š">é è¨­ç¶å®š</h3><p>å®£å‘Šåœ¨ global scope çš„è®Šæ•¸ï¼Œè·Ÿå…¨åŸŸç‰©ä»¶å±¬æ€§æ˜¯ç›¸åŒçš„ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="comment">// ç›´æ¥è®€</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a) <span class="comment">// 1 </span></span><br><span class="line"><span class="comment">// é€éå…¨åŸŸç‰©ä»¶åº•ä¸‹çš„å±¬æ€§è®€å–</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">a</span>)  <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><p>å› ç‚ºé è¨­ç¶å®šï¼Œç•¶ function è¢«å‘¼å«çš„ç•¶ä¸‹å¦‚æœæ²’æœ‰å€¼æˆ–æ˜¯åœ¨Â <code>func.call(null)</code>Â æˆ–Â <code>func.call(undefined)</code>Â æ­¤é¡çš„æƒ…æ³ä¸‹ï¼Œæ­¤æ™‚è£¡é¢çš„Â <code>this</code>Â æœƒ<strong>è‡ªå‹•æŒ‡å®šè‡³å…¨åŸŸç‰©ä»¶</strong>ã€‚</p><p>å¦‚æœæ˜¯åš´æ ¼æ¨¡å¼ï¼Œ this ç¶å®šå…¨åŸŸç‰©ä»¶æ˜¯ <code>undefined</code></p><h3 id="éš±å«å¼ç¶å®š">éš±å«å¼ç¶å®š</h3><p>function è¢«å®£å‘Šçš„åœ°æ–¹æ˜¯åœ¨ global scope ä¸­ï¼Œåªè¦å®ƒ <strong>æˆç‚ºæŸå€‹ç‰©ä»¶çš„åƒè€ƒå±¬æ€§</strong> (reference property)ï¼Œåœ¨é‚£å€‹ function è¢«å‘¼å«çš„ç•¶ä¸‹ï¼Œè©² function å³è¢«é‚£å€‹ç‰©ä»¶æ‰€åŒ…å«ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a  = <span class="number">1</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">func</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="variable language_">this</span>.<span class="property">a</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">foo</span>: func <span class="comment">// å¼•ç”¨ global çš„ function</span></span><br><span class="line">&#125;;</span><br><span class="line">obj.<span class="title function_">foo</span>();  <span class="comment">// 2 , thisæ˜¯ obj æœ¬èº«</span></span><br><span class="line"><span class="keyword">var</span> func2 = obj.<span class="property">foo</span>;</span><br><span class="line"><span class="title function_">func2</span>();    <span class="comment">// undefined ï¼Œ é€™é‚Šçš„ func æ˜¯ global çš„ï¼Œthis æ˜¯ windowï¼Œa æ˜¯æ‰¾ä¸åˆ°çš„</span></span><br></pre></td></tr></table></figure><p>æ±ºå®š this çš„é—œéµä¸åœ¨æ–¼å®ƒå±¬æ–¼å“ªå€‹ç‰©ä»¶ï¼Œè€Œæ˜¯</p><blockquote><p>åœ¨æ–¼ functionã€Œå‘¼å«çš„æ™‚æ©Ÿé»ã€</p></blockquote><p>é€éç‰©ä»¶å‘¼å«æŸå€‹æ–¹æ³• (method) çš„æ™‚å€™ï¼Œæ­¤æ™‚ this å°±æ˜¯é‚£å€‹ç‰©ä»¶ (owner object)ã€‚</p><h3 id="é¡¯å¼ç¶å®š">é¡¯å¼ç¶å®š</h3><ol><li><code>.bind()</code></li><li><code>.call()</code></li><li><code>.apply()</code></li></ol><p>é€™é¡ç›´æ¥æŒ‡å®š this çš„ function éƒ½å¯è¢«æ­¸é¡è‡³é¡¯å¼ç¶å®šçš„é¡å‹ã€‚</p><h3 id="new-é—œéµå­—ç¶å®š">new é—œéµå­—ç¶å®š</h3><p>ç•¶ä¸€å€‹Â <code>function</code>Â å‰é¢å¸¶æœ‰Â <code>new</code>Â è¢«å‘¼å«æ™‚ï¼Œæœƒç™¼ç”Ÿï¼š</p><ul><li>æœƒç”¢ç”Ÿä¸€å€‹æ–°çš„ç‰©ä»¶ (ç‰©ä»¶è¢«å»ºæ§‹å‡ºä¾†)</li><li>é€™å€‹æ–°å»ºæ§‹çš„ç‰©ä»¶æœƒè¢«è¨­ç‚ºé‚£å€‹ function çš„Â <code>this</code>Â ç¶å®šç›®æ¨™ï¼Œä¹Ÿå°±æ˜¯Â <code>this</code>Â æœƒæŒ‡å‘æ–°å»ºæ§‹çš„ç‰©ä»¶ã€‚</li><li>é™¤éé€™å€‹ function æŒ‡å®šå›å‚³ (return) äº†ä»–è‡ªå·±çš„æ›¿ä»£ç‰©ä»¶ï¼Œå¦å‰‡é€™å€‹é€éÂ <code>new</code>Â ç”¢ç”Ÿçš„ç‰©ä»¶æœƒè¢«è‡ªå‹•å›å‚³ã€‚</li></ul><p>é—œæ–¼ <code>new</code>ï¼Œåƒè€ƒ : <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/new#description">MDN å° new çš„èªªæ˜</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">a</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">a</span> = a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> <span class="title function_">foo</span>( <span class="number">123</span> );</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( obj.<span class="property">a</span> );      <span class="comment">// 123</span></span><br></pre></td></tr></table></figure><h2 id="this-çš„æ‡‰ç”¨-Cascade-çµ„åˆæŠ€">this çš„æ‡‰ç”¨ : Cascade çµ„åˆæŠ€</h2><p>Cascade ä¹Ÿæœ‰äººç¨±ä½œ <strong>ã€ŒFluent Interfaceã€</strong><br>å¯ä»¥è®“ method ä¸²ä¸²æ¨‚</p><p>JavaScript å…è¨±å‡½å¼ <code>return undefined</code><br>é‚£æ”¹æˆ <code>return this</code> å‘¢ ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> calNum = <span class="keyword">function</span>(<span class="params">num</span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">num</span> = num;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">add</span> = <span class="keyword">function</span>(<span class="params">newNum</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">num</span> += newNum;</span><br><span class="line"><span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">sub</span> = <span class="keyword">function</span>(<span class="params">newNum</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">num</span> -= newNum;</span><br><span class="line"><span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">multi</span> = <span class="keyword">function</span>(<span class="params">newNum</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">num</span> *= newNum;</span><br><span class="line"><span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">division</span> = <span class="keyword">function</span>(<span class="params">newNum</span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">num</span> /= newNum;</span><br><span class="line"><span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// é€é new å»ºç«‹å¯¦é«”ï¼Œthis æ˜¯ calNumæœ¬èº«</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="title function_">calNum</span>(<span class="number">100</span>);</span><br><span class="line"><span class="comment">// åˆ†é–‹å‘¼å«</span></span><br><span class="line">a.<span class="title function_">add</span>(<span class="number">50</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( a.<span class="property">num</span> ); <span class="comment">// 150</span></span><br><span class="line">a.<span class="title function_">sub</span>(<span class="number">100</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( a.<span class="property">num</span> ); <span class="comment">// 50</span></span><br></pre></td></tr></table></figure><p>ç•¶å›å‚³ this æ™‚ï¼ŒæŒ‡çš„æ˜¯ç‰©ä»¶æœ¬èº«ï¼Œå¯ä»¥å¾€å¾Œä¸²åœ¨ä¸€èµ·ï¼Œ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a.<span class="title function_">add</span>(<span class="number">50</span>).<span class="title function_">sub</span>(<span class="number">100</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( a.<span class="property">num</span> ); <span class="comment">// 50</span></span><br></pre></td></tr></table></figure><p>JQuery ä¸­çš„ä¹Ÿæ˜¯ç”¨ method chain (æ–¹æ³•éˆ) é€™æ¨£çš„æ–¹å¼</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;div&#x27;</span>).<span class="title function_">addClass</span>(<span class="string">&#x27;is-active&#x27;</span>)</span><br><span class="line">        .<span class="title function_">removeClass</span>(<span class="string">&#x27;is-hide&#x27;</span>)</span><br><span class="line">        .<span class="title function_">text</span>(<span class="string">&#x27;Hello World!&#x27;</span>);</span><br></pre></td></tr></table></figure><p>æˆ–è€… <code>Array</code> çš„å…§å»ºå‡½å¼<br>æ˜¯å¯ä»¥ä¸²è¯ä¸åŒçš„æ–¹æ³•<br>è€Œä¸”å›å‚³çš„éƒ½æ˜¯ <strong>åŒé¡å‹</strong> çš„é™£åˆ—</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].<span class="title function_">map</span>(<span class="function"><span class="params">el</span> =&gt;</span> e*<span class="number">2</span>)</span><br><span class="line">   .<span class="title function_">filter</span>(<span class="function"><span class="params">el</span> =&gt;</span> el &gt;= <span class="number">4</span>) <span class="comment">// [4,6]</span></span><br></pre></td></tr></table></figure><h2 id="ç¸½çµ-24">ç¸½çµ</h2><p>é™¤äº†è½‰æˆ <code>.call()</code> ä¾†åˆ¤æ–· this<br>å°æ–¼ this ä¹Ÿå¯ä»¥æœå¹¾ç¨®æ–¹å‘ä¾†åˆ¤æ–·</p><ol><li>function çš„å‘¼å«ï¼Œæ˜¯é€é <code>new</code> é€²è¡Œçš„å—ï¼Ÿ<br>å¦‚æœæ˜¯ï¼Œé‚£ this å°±æ˜¯è¢«å»ºæ§‹å‡ºä¾†çš„ç‰©ä»¶ã€‚</li><li>function æ˜¯ä»¥ .call() æˆ– .apply() çš„æ–¹å¼å‘¼å«çš„å—ï¼Ÿ æˆ–æ˜¯ function é€é .bind() æŒ‡å®šï¼Ÿ<br>å¦‚æœæ˜¯ï¼Œé‚£ this å°±æ˜¯è¢«æŒ‡å®šçš„ç‰©ä»¶ã€‚</li><li>function è¢«å‘¼å«æ™‚ï¼Œæ˜¯å¦å­˜åœ¨æ–¼æŸå€‹ç‰©ä»¶ï¼Ÿ<br>å¦‚æœæ˜¯ï¼Œé‚£ this å°±æ˜¯é‚£å€‹ç‰©ä»¶ã€‚</li><li>å¦‚æœæ²’æœ‰æ»¿è¶³ä»¥ä¸Šæ¢ä»¶ï¼Œæ­¤ function è£¡çš„ this å°±ä¸€å®šæ˜¯å…¨åŸŸç‰©ä»¶<br>åœ¨åš´æ ¼æ¨¡å¼ä¸‹å‰‡æ˜¯ undefinedã€‚</li></ol><h2 id="åƒè€ƒ-17">åƒè€ƒ</h2><ol><li><a href="https://blog.huli.tw/2019/02/23/javascript-what-is-this/">æ·ºè«‡ JavaScript é ­è™Ÿé›£é¡Œ thisï¼šçµ•å°ä¸å®Œæ•´ï¼Œä½†ä¿è­‰å¥½æ‡‚ - Huli</a></li><li><a href="https://zhuanlan.zhihu.com/p/23804247">this çš„å€¼åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿä¸€æ¬¡è¯´æ¸…æ¥š</a></li><li><a href="https://ithelp.ithome.com.tw/articles/10193193">é‡æ–°èªè­˜ JavaScript: Day 20 Whatâ€™s â€œTHISâ€ in JavaScript (éµäººç²¾è¯ç‰ˆ)</a></li><li><a href="https://zh.javascript.info/object-methods">å¯¹è±¡æ–¹æ³•ï¼Œâ€œthisâ€</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€-42&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;åœ¨å­¸ç¿’ JavaScript æ™‚å¾ˆå¤šèª²ç¨‹æœƒå»ºè­°ä¸è¦æ€¥è‘—å…ˆç”¨ &lt;code&gt;this&lt;/code&gt;&lt;br&gt;
å› ç‚º this æœƒè·‘å‡ºè®“æ–°æ‰‹ç„¡æ³•é æœŸçš„çµæœ&lt;br&gt;
åœ¨æŸäº›æƒ…æ³ä¸‹ä½¿ç”¨ this åè€Œæ›´æ£˜æ‰‹&lt;br&gt;
è—‰ç”±æœ¬æ¬¡ä¾†åˆæ­¥äº†è§£é€™å€‹å¥‡å¦™çš„ &lt;strong&gt;this&lt;/strong&gt;!&lt;/p&gt;</summary>
    
    
    
    <category term="2022" scheme="https://blog.rosa.tw/categories/2022/"/>
    
    <category term="04" scheme="https://blog.rosa.tw/categories/2022/04/"/>
    
    
    <category term="JavaScript" scheme="https://blog.rosa.tw/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>ç­†è¨˜ | JavaScript - Closure é–‰åŒ…(II) å¸¸è¦‹é™·é˜±é¡Œ</title>
    <link href="https://blog.rosa.tw/2022/04/04/JavaScript-Closure-II"/>
    <id>https://blog.rosa.tw/2022/04/04/JavaScript-Closure-II</id>
    <published>2022-04-13T13:51:51.000Z</published>
    <updated>2022-07-27T05:30:49.731Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€-36">å‰è¨€</h2><p>ä¹‹å‰å­¸ç¿’é–‰åŒ…æ²’è¾¦æ³•å¾ˆå®¹æ˜“é€£çµåˆ°<br>å°¤å…¶ Function æœ‰ä¸€å †åè©è®Šç•°é«”<br>ç¸½æœƒå¥½å¥‡å¯¦éš›çš„æ‡‰ç”¨æƒ…å¢ƒ</p><p>é‚£ç™¼ç”Ÿä»€éº¼å•é¡Œæ‰æœƒä½¿ç”¨åˆ° Closure å‘¢?<br>åˆæ€éº¼åœ¨çœŸæ­£çš„å°ˆæ¡ˆè§£æ±ºå•é¡Œ ?</p><span id="more"></span><h2 id="å•é¡Œ-åœ¨è¿´åœˆä¸­å‘¼å«å‡½å¼">å•é¡Œ : åœ¨è¿´åœˆä¸­å‘¼å«å‡½å¼</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = []; </span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123; </span><br><span class="line">  arr[i] = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(i); </span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line">arr[<span class="number">0</span>]();</span><br><span class="line">arr[<span class="number">1</span>]();</span><br></pre></td></tr></table></figure><p>è¤‡ç¿’ä¸€ä¸‹ :</p><blockquote><p><code>var</code> çš„åˆ‡åˆ†å–®ä½æ˜¯ <code>function</code></p></blockquote><p>ç›´è¦ºä¾†èªªæœƒè¦ºå¾— <code>i</code> æ˜¯æœƒæŒ‰é †åºåˆ—å‡º<br>çµæœæ˜¯ <code>5 5</code><br>å› ç‚º for è¨­ç«‹çš„ <code>i</code> æœƒå­˜åœ¨ global ä¸­</p><p><strong>è©¦è‘—æŠŠé‹ä½œæ‹†é–‹ä¾†</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">arr[<span class="number">0</span>] = <span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(i)</span><br><span class="line">&#125;</span><br><span class="line">arr[<span class="number">1</span>] = <span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(i)</span><br><span class="line">&#125;</span><br><span class="line">arr[<span class="number">2</span>] = <span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(i)</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ç•¶è¿´åœˆè·‘å®Œæ™‚ï¼Œ <code>i</code> æ˜¯ 5ï¼Œ<code>var i  = 5</code><br>å› ç‚º 5 ä¸ç¬¦åˆè¿´åœˆæ¢ä»¶è·³å‡º<br>æ‰€ä»¥ä¸ç®¡ <code>arr[?]()</code>ï¼Œç›´æ¥å°å‡º <code>i</code> æ˜¯ 5</p><h3 id="è§£æ±ºæ–¹æ³•">è§£æ±ºæ–¹æ³•</h3><h4 id="é–‰åŒ…">é–‰åŒ…</h4><p>æŠŠ function ç¨ç«‹å‡ºä¾†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line"> arr[i] = <span class="title function_">logN</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//é–‰åŒ…ï¼Œè¨˜ä½ç•¶ä¸‹çš„ i</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">logN</span>(<span class="params">num</span>)&#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(num)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">arr[<span class="number">0</span>]() <span class="comment">//0</span></span><br><span class="line">arr[<span class="number">1</span>]() <span class="comment">//1</span></span><br></pre></td></tr></table></figure><h4 id="IIFE">IIFE</h4><p>IIFE(Immediately Invoked Function Expression) å®šç¾©å®Œå°±å›å‚³çš„ function</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">  <span class="comment">//æ‹¿åˆ°ç•¶ä¸‹çš„ i</span></span><br><span class="line">  arr[i] = (<span class="keyword">function</span> (<span class="params">num</span>)&#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(num)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;)(i);</span><br><span class="line">&#125;</span><br><span class="line">arr[<span class="number">0</span>]() <span class="comment">//0</span></span><br><span class="line">arr[<span class="number">1</span>]() <span class="comment">//1</span></span><br></pre></td></tr></table></figure><p>æŠŠåŸæœ¬æœ‰åçš„å‡½å¼æ”¹ç‚ºåŒ¿åå‡½å¼ï¼Œç”¨<code>()</code>åŒ…è£¹ functionï¼Œå°¾å·´æ˜¯å¸¶å…¥åƒæ•¸<code>(åƒæ•¸)</code>ï¼Œæ²’æœ‰çš„è©±ç‚ºç©º</p><h4 id="ES6-çš„-let">ES6 çš„ let</h4><p>ä¸Šé¢å‡ºç¾çš„åŸå› éƒ½æ˜¯ <code>var</code> çš„ scope å•é¡Œ<br>ES6 çš„ let å°‡ä½œç”¨åŸŸé™åˆ¶åœ¨ block <code>&#123;&#125;</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = []; </span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123; arr[i] = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(i); </span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line">arr[<span class="number">0</span>](); <span class="comment">// 0</span></span><br><span class="line">arr[<span class="number">1</span>](); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><blockquote><p>åªè¦ <code>var -&gt; let</code> ï¼Œ å°±è§£æ±ºå•é¡Œäº†ï¼Œé›¢é–‹ä¹‹å¾Œå°±ä¸æœƒä¿ç•™ã€‚</p></blockquote><h2 id="Closure-æ‡‰ç”¨">Closure æ‡‰ç”¨</h2><h3 id="Cache-æš«å­˜">Cache æš«å­˜</h3><p>è¨ˆç®—é‡å¤§çš„æ™‚å€™é¿å…é‡æ–°è¨ˆç®—ï¼Œé å…ˆæŠŠå·²ç®—å¥½çš„å€¼å­˜èµ·ä¾†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">complex</span>(<span class="params">num</span>)&#123;</span><br><span class="line">  <span class="comment">// è¤‡é›œè¨ˆç®—</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;calculate&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> num*num*num</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">cache</span>(<span class="params">func</span>)&#123;</span><br><span class="line">  <span class="comment">// æŸ¥çœ‹æ˜¯ä¸æ˜¯æœ‰ç®—é</span></span><br><span class="line">  <span class="keyword">var</span> ans =&#123;&#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">num</span>)&#123;</span><br><span class="line">    <span class="comment">//æœ‰çš„è©±å›å‚³ç´¢å¼•è£¡çš„å€¼</span></span><br><span class="line">    <span class="keyword">if</span>(ans[num])&#123;</span><br><span class="line">      <span class="keyword">return</span> ans[num]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ²’æœ‰çš„è©±æ‰åšé‡æ–°è¨ˆç®—</span></span><br><span class="line">    ans[num] = <span class="title function_">func</span>(num)</span><br><span class="line">    <span class="keyword">return</span> ans[num]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> cacheComplex = <span class="title function_">cahe</span>(complex)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">cacheComplex</span>(<span class="number">20</span>)) <span class="comment">// ç¬¬ä¸€æ¬¡è¨ˆç®—</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">cacheComplex</span>(<span class="number">20</span>)) <span class="comment">// å¾ cache æ‹¿åˆ°çš„å€¼</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">cacheComplex</span>(<span class="number">20</span>)) <span class="comment">// å¾ cache æ‹¿åˆ°çš„å€¼</span></span><br></pre></td></tr></table></figure><p>ç”¨ <code>console.time</code> è¨ˆæ™‚åŸ·è¡Œçš„æ™‚é–“<br>æ¯”èµ·ç›´æ¥ç”¨ complex ç®—å†é‡æ–°ç®—<br>æœƒç™¼ç¾ç¬¬äºŒæ¬¡çš„è¨ˆç®—çš„æ™‚é–“æ˜é¡¯ç¸®çŸ­å¾ˆå¤š</p><h3 id="éš±åŒ¿è³‡è¨Š">éš±åŒ¿è³‡è¨Š</h3><p>æƒ³éš±åŒ¿ä¸€äº›è³‡è¨Šï¼Œè®“åˆ¥äººä¸å¯ä»¥ç›´æ¥æ›´æ”¹ã€‚<br>æŠŠæ–¹æ³•ä»¥åŠè®Šæ•¸å°è£åœ¨å…§éƒ¨ï¼Œåˆ¥äººè¦èª¿ç”¨åªèƒ½å‘¼å«ä½ è¦å®šå¥½çš„æ–¹æ³•ã€‚</p><ul><li>ä»¥ç°¡æ˜“è¨ˆç®—æ©Ÿç‚ºä¾‹</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">calculate</span>(<span class="params">initNum</span>)&#123;</span><br><span class="line"> <span class="keyword">var</span> sum = initNum</span><br><span class="line"> <span class="keyword">return</span> &#123;</span><br><span class="line"> <span class="attr">add</span>:<span class="keyword">function</span>(<span class="params">num</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> sum +=num</span><br><span class="line">&#125;,</span><br><span class="line"> <span class="attr">minus</span>:<span class="keyword">function</span>(<span class="params">num</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> sum -=num</span><br><span class="line">&#125;,</span><br><span class="line"> <span class="attr">mutiply</span>:<span class="keyword">function</span>(<span class="params">num</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> sum *=num</span><br><span class="line">&#125;,</span><br><span class="line"> <span class="attr">divided</span>:<span class="keyword">function</span>(<span class="params">num</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> sum/=num</span><br><span class="line">&#125;,</span><br><span class="line"> <span class="attr">getresult</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> counter1 = <span class="title function_">calculate</span>(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">let</span> counter2 = <span class="title function_">calculate</span>(<span class="number">10</span>)</span><br><span class="line">counter1.<span class="title function_">add</span>(<span class="number">5</span>)</span><br><span class="line">counter2.<span class="title function_">mutiply</span>(<span class="number">20</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(counter1.<span class="title function_">getresult</span>()) <span class="comment">// 5</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(counter2.<span class="title function_">getresult</span>()) <span class="comment">// 200</span></span><br></pre></td></tr></table></figure><p>ä¸€å€‹ç°¡å–®çš„è¨ˆç®—æ©Ÿ (?)ğŸ¤”<br>counter1 è·Ÿ counter2 ä¸¦ä¸æœƒå½±éŸ¿åˆ°å½¼æ­¤<br>æˆ‘å€‘åªèƒ½é€éç¾æœ‰çš„æ–¹æ³•ä¾†ä¿®æ”¹ sum çš„å€¼</p><h2 id="ç¸½çµ-22">ç¸½çµ</h2><p>é–‰åŒ…è®“æˆ‘æ„Ÿè¦ºæ˜¯å¾ˆç¥å¥‡çš„æ±è¥¿<br>çœ‹èµ·ä¾†ä¸ç†Ÿæ‚‰ï¼Œä½†å¯¦éš›ä¸Šæˆ‘å€‘éƒ½ç”¨åˆ°äº†ğŸ¤”</p><h2 id="åƒè€ƒ-11">åƒè€ƒ</h2><ul><li><a href="https://lidemy.com/courses/enrolled/390599"> [JS201] é€²éš JavaScriptï¼šé‚£äº›ä½ ä¸€ç›´æä¸æ‡‚çš„åœ°æ–¹ </a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€-36&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;ä¹‹å‰å­¸ç¿’é–‰åŒ…æ²’è¾¦æ³•å¾ˆå®¹æ˜“é€£çµåˆ°&lt;br&gt;
å°¤å…¶ Function æœ‰ä¸€å †åè©è®Šç•°é«”&lt;br&gt;
ç¸½æœƒå¥½å¥‡å¯¦éš›çš„æ‡‰ç”¨æƒ…å¢ƒ&lt;/p&gt;
&lt;p&gt;é‚£ç™¼ç”Ÿä»€éº¼å•é¡Œæ‰æœƒä½¿ç”¨åˆ° Closure å‘¢?&lt;br&gt;
åˆæ€éº¼åœ¨çœŸæ­£çš„å°ˆæ¡ˆè§£æ±ºå•é¡Œ ?&lt;/p&gt;</summary>
    
    
    
    <category term="2022" scheme="https://blog.rosa.tw/categories/2022/"/>
    
    <category term="04" scheme="https://blog.rosa.tw/categories/2022/04/"/>
    
    
    <category term="JavaScript" scheme="https://blog.rosa.tw/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>ç­†è¨˜ | JavaScript - Closure é–‰åŒ…(I) åŸºç¤æ¦‚å¿µ</title>
    <link href="https://blog.rosa.tw/2022/04/04/JavaScript-Closure-I"/>
    <id>https://blog.rosa.tw/2022/04/04/JavaScript-Closure-I</id>
    <published>2022-04-13T13:51:39.000Z</published>
    <updated>2022-07-27T05:30:49.731Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€-35">å‰è¨€</h2><p>Closure æ˜¯ JavaScript å¾ˆé‡è¦çš„åŸºç¤<br>è—‰ç”±æœ¬ç¯‡å¹«åŠ©è‡ªå·±é‡æ¸… Closure çš„æ¦‚å¿µ</p><span id="more"></span><h2 id="å…ˆèªè­˜-Scope-Chain">å…ˆèªè­˜ Scope Chain</h2><p><a href="https://blog.rosa.tw/Frontend/JavaScript/JavaScript-Hoisting-II/?highlight=scope#%E4%BD%9C%E7%94%A8%E5%9F%9F-Scope">Scope</a> æ˜¯è®Šæ•¸ç”Ÿå­˜çš„ç¯„åœï¼Œå¦‚æœåœ¨è‡ªå·±å±¤ç´šæ‰¾ä¸åˆ°å°±æœƒä¸€å±¤ä¸€å±¤å¾€å¤–æ‰¾ï¼Œç›´åˆ° Global ç‚ºæ­¢ã€‚</p><p>é€™ç¨®è¡Œç‚ºå°±ç¨±ç‚ºã€Œ<strong>ç¯„åœéˆ</strong>ã€(Scope Chain)ã€‚</p><blockquote><p>ç¯„åœéˆæ˜¯åœ¨å‡½å¼<strong>è¢«å®šç¾©çš„ç•¶ä¸‹æ±ºå®š</strong> (lexical scope ä¾†æ±ºå®š)çš„ï¼Œä¸æ˜¯åœ¨è¢«å‘¼å«çš„æ™‚å€™æ±ºå®šã€‚</p></blockquote><h3 id="ç¯„ä¾‹-2">ç¯„ä¾‹</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">&#x27;global&#x27;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">change</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="keyword">var</span> a  = <span class="string">&#x27;change&#x27;</span></span><br><span class="line"><span class="title function_">test</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a) <span class="comment">// change</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a) <span class="comment">//global</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">change</span>()</span><br></pre></td></tr></table></figure><p>ä¸€é–‹å§‹æœƒä»¥ç‚º <code>test()</code> åœ¨ change è£¡é¢å‘¼å«ï¼Œå–å¾—çš„è®Šæ•¸ a æ˜¯ change å°ä¸å° ?</p><p>NO NO NO,å†é‡è¤‡ä¸€æ¬¡ !</p><blockquote><p>ç¯„åœéˆæ˜¯åœ¨å‡½å¼<strong>è¢«å®šç¾©çš„ç•¶ä¸‹æ±ºå®š</strong> çš„ï¼Œä¸æ˜¯åœ¨è¢«å‘¼å«çš„æ™‚å€™æ±ºå®šã€‚</p></blockquote><p><code>test</code> å‡½å¼åœ¨ Lexical Environments æ˜¯ gloabal çš„ä¸‹ä¸€å±¤ï¼ŒScope Chain æ˜¯æ ¹æ“š Lexical scope æ±ºå®šï¼Œå¾€ä¸Šæ‰¾æ˜¯ gloabl é‚£å±¤ï¼Œæ‰€ä»¥çµæœæ‰æœƒæ˜¯ <code>'global'</code></p><h2 id="ç‚ºä»€éº¼è¦æœ‰-Closure">ç‚ºä»€éº¼è¦æœ‰ Closure ?</h2><blockquote><p>åå• ğŸ‘‰ <strong>æ²’æœ‰ Closure æœƒæ€æ¨£ ?</strong></p></blockquote><p>æˆ‘å€‘çŸ¥é“ Execution Context åŸ·è¡Œç’°å¢ƒåœ¨åŸ·è¡Œå®Œ function å¾Œï¼ŒStack æœƒæŠ½æ‰ï¼Œæœ‰é—œé€™å€‹ function çš„ä¸€åˆ‡è®Šæ•¸ä¹Ÿæœƒè¢«å›æ”¶è€Œä¸”ä¸å¯å†ä½¿ç”¨ã€‚</p><ul><li>å¦‚æœè¦ä½¿ç”¨ function è£¡çš„è®Šæ•¸å‘¢ ? (<code>private variable</code> çš„æ¦‚å¿µ)</li></ul><p>ç›´è¦ºå¯èƒ½æœƒä¸Ÿåˆ° <code>global</code> é€²è¡Œå®£å‘Šï¼Œä½†ç•¶å°ˆæ¡ˆçµæ§‹é€æ¼¸é¾å¤§ï¼Œä¹…è€Œä¹…ä¹‹æœƒé€ æˆ <strong>å…¨åŸŸè®Šæ•¸æ±™æŸ“</strong></p><p><strong>é‚£é–‰åŒ…çš„å‡ºç¾è§£æ±ºäº†â€¦</strong> :</p><ul><li>è‡ªç”±è®Šæ•¸ (free variable)ï¼Œåªæœ‰åœ¨ function å…§éƒ¨å¯è®€å–è®Šæ•¸ï¼Œåœ¨å¤–éƒ¨å‰‡ç„¡æ³•è®€å–ã€‚</li><li>è®Šæ•¸æš«å­˜ï¼Œæ¸›å°‘é‡è¤‡çš„è¤‡é›œè¨ˆç®—</li></ul><h2 id="Closure-çš„å„ªç¼ºé»">Closure çš„å„ªç¼ºé»</h2><ul><li><p>å„ªé» :</p><ol><li>é¿å… <strong>å…¨åŸŸè®Šæ•¸æ±™æŸ“</strong></li><li>æä¾› <strong>è‡ªç”±è®Šæ•¸</strong>ï¼Œè®“è©² function åŸ·è¡Œå®Œå¾Œï¼Œè®Šæ•¸çš„ä½œç”¨åŸŸä¸æœƒå›  function çµæŸè¢«å›æ”¶ï¼Œè€Œæ˜¯æœƒç¹¼çºŒå­˜åœ¨ã€‚</li><li>é¿å…é‡è¤‡åŸ·è¡Œé¾å¤§çš„è¨ˆç®—<br>å¯ä»¥è¨˜éŒ„å‰ä¸€æ¬¡è¨ˆç®—çš„ç‹€æ…‹ï¼Œä¸‹ä¸€æ¬¡å†å‘¼å«ä¸ç”¨é‡ç®—ä¸€æ¬¡ (cache çš„æ¦‚å¿µ)ã€‚</li><li>åœ¨å¤šäººå”ä½œçš„æ™‚å€™ï¼Œæœ‰äº›éš±å¯†çš„è³‡è¨Šä¸æƒ³è®“äººå»ä¿®æ”¹ï¼Œå¯ä»¥ä½¿ç”¨å°è£é–‰åŒ…çš„æ–¹å¼ã€‚<br>åˆ¥äººå¿…é ˆä¾ç…§å›ºå®šçš„å¯«æ³•ä¾†å–å¾—è³‡æ–™ï¼Œä¸”ä¸èƒ½ä¿®æ”¹åˆ°å…§éƒ¨çš„è³‡è¨Šã€‚<br>åœ¨é–‹æºè³‡æ–™æˆ– API çš„æ–¹æ³•å¸¸ä½¿ç”¨é€™æ¨£çš„æ–¹å¼ï¼Œä»¥å…æ”¹å‹•åˆ°å…§éƒ¨æ•¸å€¼ã€‚</li></ol></li><li><p>ç¼ºé» :</p><ol><li>å¯èƒ½ä¿ç•™åˆ°ä¸€äº›ä¸å¿…è¦çš„è®Šæ•¸æˆ–è³‡è¨Šï¼Œé€ æˆè³‡æºå¤šé¤˜æ¶ˆè€—ã€‚</li><li>åªèƒ½ä½¿ç”¨æ¶µå¼æä¾›çš„æ–¹æ³•ï¼Œå› ç‚ºå…§éƒ¨çš„è³‡è¨Šè¢«éš±è”½ï¼Œåœ¨æ›´å‹•ä¸Šè¼ƒä¸å½ˆæ€§ã€‚<br>(ä½†æ˜¯ç›¸åå¦‚æœä¸æƒ³è¦è¢«æ”¹å‹•æœƒæ˜¯å„ªé»)</li></ol></li></ul><h2 id="ä»€éº¼æ˜¯é–‰åŒ…">ä»€éº¼æ˜¯é–‰åŒ… ?</h2><p>é™¤äº†è‡ªå·±æœ¬èº«çš„ç¨‹å¼ç¢¼å¤–ï¼Œä¹Ÿå¯ä»¥å–å¾—äº†<strong>å…§éƒ¨å‡½å¼ã€Œç•¶æ™‚ç’°å¢ƒã€çš„è®Šæ•¸å€¼</strong>ï¼Œè¨˜ä½äº†åŸ·è¡Œç•¶æ™‚çš„ç’°å¢ƒï¼Œé€™å°±æ˜¯ã€Œé–‰åŒ…ã€ã€‚</p><h2 id="ç°¡å–®çš„-Closure-ç¯„ä¾‹">ç°¡å–®çš„ Closure ç¯„ä¾‹</h2><ul><li>æ²’æœ‰ä½¿ç”¨é–‰åŒ…</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> rate = <span class="number">.75</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">itmePrice</span>(<span class="params">price</span>)&#123;</span><br><span class="line"> <span class="keyword">return</span> price &gt;= <span class="number">100</span> ? price*rate : price</span><br><span class="line">&#125;</span><br><span class="line">rate = <span class="number">.1</span> </span><br><span class="line"><span class="keyword">let</span> bag = <span class="title function_">itmePrice</span>(<span class="number">150</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(bag)</span><br></pre></td></tr></table></figure><blockquote><p>å¯ä»¥é€éç›´æ¥ä¿®æ”¹æ•¸å€¼ (ğŸ‘)<br>ä»»ä½•äººéƒ½å¯ä»¥åœ¨å¤–éƒ¨é€²è¡Œä¿®æ”¹</p></blockquote><ul><li>ä½¿ç”¨é–‰åŒ…</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">itmePrice</span>(<span class="params">price</span>)&#123;</span><br><span class="line"><span class="comment">// æŠŠ rate è®Šæˆç§æœ‰è®Šæ•¸</span></span><br><span class="line"><span class="keyword">var</span> rate = <span class="number">.75</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line"><span class="keyword">return</span> price &gt;= <span class="number">100</span> ? price*rate : price</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> bag = <span class="title function_">itmePrice</span>(<span class="number">150</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">bag</span>())</span><br></pre></td></tr></table></figure><blockquote><p>åªè¦å‘¼å«éœ€è¦çš„æ±è¥¿å³å¯ (ğŸ‘)<br>ä¸æœƒè¢«å¤–éƒ¨ä¿®æ”¹</p></blockquote><h2 id="åƒè€ƒ-10">åƒè€ƒ</h2><ol><li><a href="https://blog.huli.tw/2018/12/08/javascript-closure/">æ‰€æœ‰çš„å‡½å¼éƒ½æ˜¯é–‰åŒ…ï¼šè«‡ JS ä¸­çš„ä½œç”¨åŸŸèˆ‡ Closure - Huli</a></li><li><a href="https://javascript.info/closure#lexical-environment">Variable scope, closure</a></li><li><a href="https://ithelp.ithome.com.tw/articles/10193009">é‡æ–°èªè­˜ JavaScript: Day 19 é–‰åŒ… Closure</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€-35&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;Closure æ˜¯ JavaScript å¾ˆé‡è¦çš„åŸºç¤&lt;br&gt;
è—‰ç”±æœ¬ç¯‡å¹«åŠ©è‡ªå·±é‡æ¸… Closure çš„æ¦‚å¿µ&lt;/p&gt;</summary>
    
    
    
    <category term="2022" scheme="https://blog.rosa.tw/categories/2022/"/>
    
    <category term="04" scheme="https://blog.rosa.tw/categories/2022/04/"/>
    
    
    <category term="JavaScript" scheme="https://blog.rosa.tw/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>ç­†è¨˜ | JavaScript - äº‹ä»¶æ©Ÿåˆ¶åŸç† &amp; äº‹ä»¶ä»£ç†</title>
    <link href="https://blog.rosa.tw/2022/04/04/JavaScript-EventFlow-EventListener"/>
    <id>https://blog.rosa.tw/2022/04/04/JavaScript-EventFlow-EventListener</id>
    <published>2022-04-12T02:24:14.000Z</published>
    <updated>2022-07-27T05:30:49.731Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€-37">å‰è¨€</h2><p>äº‹ä»¶æ˜¯ä»€éº¼ ? ç‚ºä»€éº¼è¦ç”¨äº‹ä»¶ä»£ç†å‘¢ ?<br>åœ¨ä¸äº†è§£äº‹ä»¶çš„æµç¨‹èˆ‡é‹ä½œæ©Ÿåˆ¶ï¼Œæ˜¯ä¸æ˜¯é‡éé»ä¸€ä¸‹å…ƒç´ <br>çµæœè·‘å‡ºå…©æ¬¡ä»¥ä¸Šçš„çµæœ<br>é€éæœ¬ç¯‡å¹«è‡ªå·±é‡æ¸…äº‹ä»¶å„ç¨®å¤§å°äº‹</p><span id="more"></span>  <h2 id="EventFlow-ç¶²é å…ƒç´ æ¥æ”¶äº‹ä»¶çš„é †åº">EventFlow : ç¶²é å…ƒç´ æ¥æ”¶äº‹ä»¶çš„é †åº</h2><p><img data-src="https://dsm01pap006files.storage.live.com/y4m9V74R0Rbxh2VocqOo5K1vnxJNiyqAL1pr2Vw2o2yxenGxG5Uq3iMSm5n1bXDNs7hubkxY7rtnZfQtgz3tSNPDcX22k_WWBKKto5w_fnALPe1MSGDNDjlF11Yr7svwp8O0b8PmsLyMikVMa0Be3EWrsugI0ZsfWzkq9aYgX7R48Jm2YL0dJs6VWHvl3tqxowk?width=1208&amp;height=1160&amp;cropmode=none" alt="EventFlow"></p><ul><li><code>Capture phase</code> : æ•ç²éšæ®µæŒ‡ç”± <strong>ä¸Šåˆ°ä¸‹</strong> å‚³ä¸‹å»çš„</li><li><code>Target phase</code> : ç›®æ¨™éšæ®µï¼Œæœ¬èº«è¢«ä½œç”¨çš„ç›®æ¨™æ‰æœƒåœ¨é€™å€‹éšæ®µ</li><li><code>Bubbling phase</code> : å†’æ³¡éšæ®µ æŒ‡ç”± <strong>ä¸‹å¾€ä¸Š</strong> å‚³å»çš„</li></ul><p>é€é <code>e.eventPhase</code> å¯ä»¥çœ‹è¦‹äº‹ä»¶çš„éšæ®µ<br>ç•¶æˆ‘é»ä¸‹ link</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">link.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;link capturing&#x27;</span>,e.<span class="property">eventPhase</span>);</span><br><span class="line">&#125;,<span class="literal">true</span>)</span><br><span class="line">link.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;link bubbling&#x27;</span>,e.<span class="property">eventPhase</span>);</span><br><span class="line">&#125;)</span><br><span class="line">box.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;box capturing&#x27;</span>,e.<span class="property">eventPhase</span>);</span><br><span class="line">&#125;,<span class="literal">true</span>)</span><br><span class="line">box.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="function">(<span class="params">e</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;box bubbling&#x27;</span>,e.<span class="property">eventPhase</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">box capturing <span class="number">1</span>  <span class="comment">// CAPTURING_PHASE</span></span><br><span class="line">link capturing <span class="number">2</span> <span class="comment">// AT_TARGET </span></span><br><span class="line">link bubbling <span class="number">2</span> <span class="comment">// AT_TARGET </span></span><br><span class="line">box bubbling <span class="number">3</span> <span class="comment">// BUBBLING_PHASE</span></span><br></pre></td></tr></table></figure><p>å‡ºç¾çš„ä»£ç¢¼å°±æ˜¯äº‹ä»¶çš„ä¸åŒéšæ®µ</p><h3 id="äº‹ä»¶å†’æ³¡-Event-Bubbling">äº‹ä»¶å†’æ³¡ (Event Bubbling)</h3><p>å•Ÿå‹•äº‹ä»¶çš„å…ƒç´ å¾€ä¸Šå‚³éåˆ° <strong>æ ¹ç¯€é»</strong> (document)</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>TITLE<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>CLICK<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å†’æ³¡å‚³éæ–¹å‘ :<br>CLICK äº‹ä»¶æœ¬èº«å…ƒç´  ğŸ‘‰ body ğŸ‘‰ html ğŸ‘‰ document</p><h3 id="äº‹ä»¶æ•ç²-Event-Capturing">äº‹ä»¶æ•ç² (Event Capturing)</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>TITLE<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>CLICK<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ•ç²å‚³éæ–¹å‘ :<br>document ğŸ‘‰html ğŸ‘‰ body ğŸ‘‰CLICK äº‹ä»¶æœ¬èº«å…ƒç´ </p><h3 id="äº‹ä»¶æ˜¯å“ªç¨®æ©Ÿåˆ¶">äº‹ä»¶æ˜¯å“ªç¨®æ©Ÿåˆ¶ ?</h3><p>å…©ç¨®éƒ½æœƒï¼Œç•¶æˆ‘æŒ‰ä¸‹æŒ‰éˆ•ï¼Œå¦‚æœå¤–å±¤å…ƒç´ ä¹Ÿæœ‰ç¶å®š <strong>äº‹ä»¶</strong>ï¼ŒåŒæ™‚ä¹Ÿæœƒè¢«è§¸ç™¼</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;outer&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;inner&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.outer&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hi&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.inner&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>çµæœ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hello</span><br><span class="line">hi <span class="comment">// å†’æ³¡è€Œè§¸ç™¼</span></span><br></pre></td></tr></table></figure><p>é»æ“Š <code>inner</code> æ™‚ï¼ŒåŒæ™‚å‡ºç¾ hello è·Ÿ hi<br>å› ç‚ºå†’æ³¡çš„é—œä¿‚ï¼Œouter ä¹Ÿè¢«è§¸ç™¼ã€‚</p><h3 id="äº‹ä»¶çš„æ•ç²-å†’æ³¡é †åº">äº‹ä»¶çš„æ•ç² &amp; å†’æ³¡é †åº ?</h3><ul><li>å°æ–¼ <strong>éè§¸ç™¼äº‹ä»¶</strong> æœ¬èº«çš„å…ƒç´ </li></ul><blockquote><p>å…ˆæ•ç²å¾Œå†’æ³¡</p></blockquote><ul><li>äº‹ä»¶æœ¬èº«<br>åœ¨ä»¥å¾€çš„æ–‡ç« ä¸­éƒ½æ˜¯ <strong>æŒ‰ç…§ç¨‹å¼ç¢¼åŸ·è¡Œçš„é †åº</strong><br>ç•¶æˆ‘è©¦è‘—åŸ·è¡Œå¾Œå»ç™¼ç¾å³ä½¿æŠŠå†’æ³¡æ”¾åœ¨å‰é¢ï¼Œæ•ç²æ”¾å¾Œ<br>ä¸€æ¨£éƒ½æ˜¯ <strong>å…ˆæ•ç²å†å†’æ³¡</strong><br>ä»”ç´°ä¸€æŸ¥ï¼Œæ‰ç™¼ç¾åŸä¾†æ˜¯ Chorme 89 ä»¥å¾Œçš„ç‰ˆæœ¬éƒ½æœƒå…ˆæ•ç²å†å†’æ³¡<br>89 ä¹‹å‰çš„ç‰ˆæœ¬å°±æœƒæ˜¯çœ‹ç¨‹å¼ç¢¼åŸ·è¡Œçš„é †åº<blockquote><p>å‡ºç¾é€™æ¨£çš„ç‹€æ³æ˜¯å› ç‚º shadow DOM å¼•èµ·çš„ï¼Œè©³ç´°åŸå› è«‹åƒè€ƒ <a href="https://juejin.cn/post/6965682915141386254#heading-2">é€™ç¯‡</a></p></blockquote></li></ul><p>æ‰€ä»¥ï¼Œæ–°ç‰ˆçš„ç€è¦½å™¨ä¸ç®¡æ˜¯å“ªå€‹éƒ½æ˜¯ <strong>å…ˆæ•ç²å†å†’æ³¡</strong></p><h2 id="äº‹ä»¶çš„è¨»å†Šç¶å®š">äº‹ä»¶çš„è¨»å†Šç¶å®š</h2><ol><li><code>on-event</code> : æœ‰ HTML ä¸­ inline on-eventï¼›JS on-event æ¥ function</li><li><code>EventListener</code> : addEventListenerã€removeEventListenerâ€¦ç­‰</li></ol><h3 id="on-event">on-event</h3><ol><li>Html <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> </span></span><br><span class="line"><span class="tag"><span class="attr">onclick</span>=<span class="string">&quot;console.log(&#x27;click&#x27;)&quot;</span>&gt;</span>click </span><br><span class="line">me<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>ç›®å‰å¾ˆå°‘é€™æ¨£å¯«ï¼Œå…¶ä¸€åŸå› æ˜¯ä¸å¥½ç¶­è­·</li><li>é Html <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> btn = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.btn&#x27;</span>)</span><br><span class="line">btn.<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;click&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>æˆ‘å€‘æœ€å¸¸çœ‹è¦‹ <code>window.onload</code> ä¹Ÿæ˜¯äº‹ä»¶çš„ on-event</p><h3 id="EventListener">EventListener</h3><h4 id="addEventListener">addEventListener</h4><p>æœ‰ä¸‰å€‹åƒæ•¸</p><ol><li>äº‹ä»¶åç¨±</li><li>äº‹ä»¶è™•ç†å™¨ (è§¸ç™¼æ™‚åŸ·è¡Œçš„ function)</li><li>Boolen ï¼Œä»¥ ã€Œæ•ç²ã€ æˆ–ã€Œå†’æ³¡ã€ æ©Ÿåˆ¶åŸ·è¡Œï¼Œ <code>false</code> (ä¸æŒ‡å®š) ç‚º å†’æ³¡</li></ol><blockquote><p>ç¬¬ä¸‰å€‹å¸ƒæ—å€¼ï¼Œä¸æ˜¯æ”¹è®Šäº‹ä»¶å‚³éçš„æ–¹å¼ï¼Œè€Œæ˜¯åœ¨ <strong>å“ªè£¡é€²è¡Œç›£è½</strong></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å†’æ³¡</span></span><br><span class="line">btn.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;HI&#x27;</span>); &#125;);</span><br><span class="line">btn.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;HI&#x27;</span>); &#125;, <span class="literal">false</span>);</span><br><span class="line"><span class="comment">// æ•ç² </span></span><br><span class="line">btn.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;HELLO&#x27;</span>); &#125;, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure><h4 id="removeListener">removeListener</h4><p>è·Ÿ addEventListener ä¸€æ¨£ï¼Œå¦‚æœè¦è§£é™¤çš„è©± handler çš„ function å¿…é ˆæ˜¯åŒä¸€å€‹å¯¦é«”æ‰è¡Œ</p><blockquote><p><strong>ç‚ºä»€éº¼èªªæ˜¯åŒä¸€å¯¦é«” ?</strong><br>å›æƒ³é€™å€‹ä¾‹å­ <code>&#123;&#125; === &#123;&#125; // false</code><br>function ä¹Ÿæ˜¯ Object çš„ä¸€ç¨®<br>åŒ¿åå‡½å¼æ²’æœ‰æŒ‡å®šçµ¦è®Šæ•¸æ™‚ï¼Œéƒ½æ˜¯å±¬æ–¼ä¸åŒçš„è¨˜æ†¶é«”ä½å€</p></blockquote><p>äº‹ä»¶ç›£è½ä½¿ç”¨åŒ¿åå‡½å¼çš„å¯«æ³•ï¼Œå°±åƒæ½‘å‡ºå»çš„æ°´ï¼Œå›ä¸ä¾†äº† ğŸ¤”</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;btn&#x27;</span>);</span><br><span class="line"></span><br><span class="line">btn.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;HI&#x27;</span>);</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç§»é™¤äº‹ä»¶ï¼Œä½†æ˜¯æ²’ç”¨</span></span><br><span class="line">btn.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;HI&#x27;</span>);</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure><p>è§£æ±ºæ­¤å•é¡Œï¼ŒæŠŠ handler çš„ function <strong>ç¨ç«‹å‡ºä¾†</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;btn&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> clickhandler = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;HI&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">btn.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,clickhandler&#125;, <span class="literal">false</span>);</span><br><span class="line"><span class="comment">// ç§»é™¤äº‹ä»¶ï¼Œok!</span></span><br><span class="line">btn.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;click&#x27;</span>,clickhandler, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure><h3 id="on-event-v-s-EventListener">on-event v.s EventListener</h3><ul><li><p><code>EventListener</code> : å¯ä»¥é‡è¤‡æŒ‡å®šå¤šå€‹ã€Œè™•ç†å™¨ã€(handler) çµ¦åŒä¸€å€‹å…ƒç´ çš„åŒä¸€å€‹äº‹ä»¶</p></li><li><p><code>on-event</code> : åªèªä¸€å€‹ï¼Œå¾Œé¢å¤šå¯«çš„æœƒè¦†è“‹å‰é¢çš„äº‹ä»¶</p></li><li><p>on-event</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;btn&#x27;</span>);</span><br><span class="line">btn.<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hi!&#x27;</span>) <span class="comment">// ä¸æœƒå‡ºç¾</span></span><br><span class="line">&#125;;</span><br><span class="line">btn.<span class="property">onclick</span>= <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello!&#x27;</span>) <span class="comment">// æœƒå‡ºç¾ hello</span></span><br><span class="line">&#125;; </span><br></pre></td></tr></table></figure><ul><li>EventListener</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;btn&#x27;</span>);</span><br><span class="line">btn.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hi!&#x27;</span>) <span class="comment">// å‡ºç¾ hi</span></span><br><span class="line">&#125;&#125;);</span><br><span class="line">btn.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello!&#x27;</span>) <span class="comment">// å†å‡ºç¾ hello</span></span><br><span class="line">&#125;&#125;);</span><br></pre></td></tr></table></figure><h2 id="EventHandler-ä¸­çš„-â€œeventâ€">EventHandler ä¸­çš„ â€œeventâ€</h2><p>äº‹ä»¶ç‰©ä»¶æœƒä¾ç…§ <strong>è§¸ç™¼çš„äº‹ä»¶</strong>(clickã€change) ï¼Œå…§å®¹æœƒæœ‰ç¨å¾®ä¸åŒ<br>é€šå¸¸çœ‹åˆ° <code>event</code> å¯«æˆ <code>e</code> ã€<code>evt</code> æ˜¯ç‚ºäº†æ–¹ä¾¿ï¼Œä¹Ÿå¯ä»¥è‡ªè¨‚è­¯åç¨±<br>åªæ˜¯å¤§å®¶æœƒé¸æ“‡æœ‰æ„ç¾©çš„åç¨±ä¸”å¥½è¨˜</p><p>å¯ä»¥è©¦è‘—åœ¨äº‹ä»¶è§¸ç™¼å°å‡º <code>e</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">btn.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string">å¸¸è¦‹çš„å±¬æ€§   </span></span><br><span class="line"><span class="string">-   `</span>type<span class="string">` : è¡¨ç¤ºäº‹ä»¶çš„åç¨±</span></span><br><span class="line"><span class="string">-   `</span>target<span class="string">` : è¡¨ç¤ºè§¸ç™¼äº‹ä»¶çš„å…ƒç´ </span></span><br><span class="line"><span class="string">-   `</span>bubbles<span class="string">` : è¡¨ç¤ºé€™äº‹ä»¶æ˜¯å¦æ˜¯åœ¨ã€Œå†’æ³¡ã€éšæ®µè§¸ç™¼ (`</span><span class="literal">true</span><span class="string">` / `</span><span class="literal">false</span><span class="string">`)</span></span><br><span class="line"><span class="string">-   `</span>pageX<span class="string">` / `</span>pageY<span class="string">` : è¡¨ç¤ºäº‹ä»¶è§¸ç™¼æ™‚ï¼Œæ»‘é¼ åº§æ¨™åœ¨ç¶²é çš„ç›¸å°ä½ç½®  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### é˜»æ“‹é è¨­è¡Œç‚º event.preventDefault()</span></span><br><span class="line"><span class="string">&gt;ä¸¦ä¸æœƒé˜»æ­¢äº‹ä»¶å‘ä¸Šå‚³é (äº‹ä»¶å†’æ³¡) </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>javascript</span><br><span class="line"><span class="keyword">let</span> link = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.link&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> box = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.box&#x27;</span>);</span><br><span class="line"></span><br><span class="line">link.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">  e.<span class="title function_">preventDefault</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æˆ‘&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">box.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;box&#x27;</span>) <span class="comment">// ä¾ç„¶æœƒå‡ºç¾</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>on-event</code> åœ¨ eventhandler function çš„<strong>æœ€å¾Œ</strong>åŠ ä¸Š <code>return false;</code> ä¹Ÿæœƒæœ‰ <code>event.preventDefault()</code> çš„æ•ˆæœ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> link = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.link&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰æ–¼ e.preventDefault()</span></span><br><span class="line">link.<span class="property">onclick</span>=<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;æˆ‘&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ‡‰ç”¨ç¯„ä¾‹ä¸€-è¡¨å–®-submit-å‰çš„æª¢æŸ¥">æ‡‰ç”¨ç¯„ä¾‹ä¸€ : è¡¨å–® submit å‰çš„æª¢æŸ¥</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">action</span>=<span class="string">&quot;url&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">        å¸³è™Ÿ</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">        å¯†ç¢¼</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è€…æŒ‰ä¸‹ submit æŒ‰éˆ•æœƒé€å‡ºè¡¨å–®<br>å‰ç«¯å¯ä»¥å…ˆåšé©—è­‰ï¼Œç¢ºèªä½¿ç”¨è€…çš„è¼¸å…¥æ˜¯ä¸æ˜¯ç¬¦åˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> form = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;form&quot;</span>)</span><br><span class="line">form.<span class="title function_">addEventListener</span>(<span class="string">&#x27;submit&#x27;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="comment">//å…ˆé˜»æ­¢é€å‡º</span></span><br><span class="line">    e.<span class="title function_">preventDefault</span>();</span><br><span class="line">    <span class="keyword">let</span> username = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;[name=&#x27;username&#x27;]&quot;</span>).<span class="property">value</span></span><br><span class="line">    <span class="keyword">let</span> password = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;[name=&#x27;password&#x27;]&quot;</span>).<span class="property">value</span></span><br><span class="line">    <span class="comment">// æª¢æŸ¥æ¬„ä½</span></span><br><span class="line">    <span class="keyword">if</span>(!username) <span class="keyword">return</span> <span class="title function_">alert</span>(<span class="string">&#x27;è«‹è¼¸å…¥ä½¿ç”¨è€…å¸³è™Ÿ&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span>(!password) <span class="keyword">return</span> <span class="title function_">alert</span>(<span class="string">&#x27;è«‹è¼¸å…¥å¯†ç¢¼&#x27;</span>)</span><br><span class="line">    <span class="comment">// éƒ½æœ‰è¼¸å…¥å°±é€å‡º</span></span><br><span class="line">    form.<span class="title function_">submit</span>();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="æ‡‰ç”¨ç¯„ä¾‹äºŒ-é¿å…è¶…é€£çµé€ æˆç¶²é è·³è½‰">æ‡‰ç”¨ç¯„ä¾‹äºŒ : é¿å…è¶…é€£çµé€ æˆç¶²é è·³è½‰</h4><p>æŒ‰ä¸‹ <code>a</code> çš„æ™‚å€™æœƒæ‰¾ç¶²é çš„éŒ¨é»ï¼Œå¦‚æœæ²’æœ‰çš„è©±æœƒè·³ <code>#</code> äº•å­—è™Ÿ<br>å¦‚æœä¸æƒ³è¦å‡ºç¾äº•å­—è™Ÿå‘¢ ?<br>æœ‰äº›æ˜¯å°å¤–é€£çµï¼Œæœ‰äº›æ˜¯å…§é€£çµä½¿ç”¨ï¼Œç¸½ä¸èƒ½é˜»æ“‹æ¯å€‹å§ !</p><p>é€™é‚Šç”¨æˆ‘ä½¿ç”¨ <code>class</code> åˆ†é–‹å¤–éƒ¨é€£çµ</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;www.example.com&quot;</span>&gt;</span>æˆ‘æ˜¯æ™®é€šè¶…é€£çµ<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>gotoTop<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é¸æ²’æœ‰ link class çš„ a æ¨™ç±¤</span></span><br><span class="line"><span class="keyword">let</span> actionLink = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;a:not(.link)&#x27;</span>)</span><br><span class="line">actionLink.<span class="title function_">forEach</span>( <span class="function"><span class="params">a</span> =&gt;</span> &#123;</span><br><span class="line">    a.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        e.<span class="title function_">preventDefault</span>();</span><br><span class="line">        <span class="comment">// åˆ¤æ–·å„å€‹ actionLink è¦åšçš„äº‹</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>é€™æ¨£å°±å¯ä»¥åˆ†å‡ºå“ªäº›æ˜¯å¤–éƒ¨é€£çµï¼Œå“ªäº›æ˜¯å…§ç¶²é é€£çµï¼Œè€Œä¸”ä¸æœƒå‡ºç¾ <code>#</code> äº•å­—è™Ÿ ğŸ˜ƒ</p><h3 id="é˜»æ“‹äº‹ä»¶å†’æ³¡å‚³é-event-stopPropagation">é˜»æ“‹äº‹ä»¶å†’æ³¡å‚³é event.stopPropagation()</h3><blockquote><p>é˜»æ­¢çš„å‹•ä½œï¼ŒåŠ åœ¨å†’æ³¡ç™¼ç”Ÿçš„å…ƒç´ ä¸Š</p></blockquote><p>å¦‚æœä¸è¦è®“ box å‡ºç¾ï¼ŒåŠ åœ¨æƒ³åœæ­¢å†’æ³¡çš„åœ°æ–¹ <code>event.stopPropagation()</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;link&quot;</span>&gt;</span>link<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> link = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.link&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> box = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.box&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€™è£¡æœƒç™¼ç”Ÿå†’æ³¡ï¼Œè¦é˜»æ­¢ä¸Šå‚³</span></span><br><span class="line">link.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">  e.<span class="title function_">stopPropagation</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hi&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">box.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;box&#x27;</span>) <span class="comment">// ä¸æœƒå‡ºç¾</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥è©¦è‘—è¨»è§£ <code>e.stopPropagation();</code> æœƒç™¼ç¾ç•¶ä½ æŒ‰ä¸‹ link<br>å› ç‚º link å†’æ³¡æ©Ÿåˆ¶å°è‡´ box çš„äº‹ä»¶ä¹Ÿè§¸ç™¼è€Œå°å‡º <code>'box'</code></p><h4 id="é˜»æ­¢ä»»ä½•çš„å‚³é-event-stopImmediatePropagation">é˜»æ­¢ä»»ä½•çš„å‚³é event.stopImmediatePropagation()</h4><p>å¦‚æœåŒä¸€å€‹å…ƒç´ æœ‰æ›å…©å€‹ <code>addEventListener</code><br>é»æ“Šæ™‚å…©å€‹éƒ½æœƒåœ¨ <code>Target phase</code><br>A è·Ÿ B äº‹ä»¶ä¸€æ¨£æœƒè§¸ç™¼<br>åœ¨ A åŠ å…¥ <code>stopImmediatePropagation()</code> æœƒæŠŠ B åœæ‰</p><p>ä»¥ä¸Šé¢çš„ä¾‹å­ä¾†èªªï¼Œlink æ›å…©å€‹äº‹ä»¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A äº‹ä»¶</span></span><br><span class="line">link.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">  e.<span class="title function_">stopImmediatePropagation</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;i am A&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// B äº‹ä»¶</span></span><br><span class="line">link.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;i am B&#x27;</span>) <span class="comment">//ä¸æœƒå‡ºç¾ï¼Œåœ¨ A target pharse é˜»æ­¢ B å†’æ³¡éšæ®µç™¼ç”Ÿ</span></span><br><span class="line">&#125;)</span><br><span class="line">box.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;box&#x27;</span>) <span class="comment">// ä¸æœƒå‡ºç¾ï¼Œå› ç‚ºé˜»æ­¢äº†å†’æ³¡</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="æ‡‰ç”¨ç¯„ä¾‹-label-input">æ‡‰ç”¨ç¯„ä¾‹ : label &amp; input</h4><p>label è·Ÿ input çš„çµ„åˆéœ€è¦å¤šä¸€å€‹ id<br>ç‚ºäº†ä¸æµªè²» idï¼Œæˆ‘å€‘å¸¸å¸¸æœƒç”¨ label æŠŠ input åŒ…èµ·ä¾†ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span>/&gt;</span></span><br><span class="line">é–‹é—œ</span><br><span class="line"><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨ <code>label</code> ç¶ä¸Šç›£è½äº‹ä»¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> labelone= <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;label&#x27;</span>);</span><br><span class="line"></span><br><span class="line">labelone.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hi&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ç¥å¥‡çš„æ˜¯ï¼Œhi æœƒå‡ºç¾å…©æ¬¡<br>checkbox ä¹Ÿæœƒæ¥æ”¶åˆ° click äº‹ä»¶ï¼Œæ”¹è®Šäº†ç‹€æ…‹<br>ç™¼ç”Ÿå†’æ³¡åˆ° label å…ƒç´ ï¼Œå†æ¬¡è§¸ç™¼ label çš„äº‹ä»¶</p><p><strong>é‡é»è¤‡ç¿’</strong></p><blockquote><p><strong>é˜»æ­¢çš„å‹•ä½œï¼ŒåŠ åœ¨å†’æ³¡ç™¼ç”Ÿçš„å…ƒç´ ä¸Š</strong></p></blockquote><p>å†’æ³¡ç™¼ç”Ÿçš„æ˜¯ <strong>input</strong> ï¼Œæ‰€ä»¥ <code>stopPropagation</code> æ˜¯è¦åŠ åœ¨ input è€Œé label</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> labelone= <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;label&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> inputone= <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;input&#x27;</span>);</span><br><span class="line"></span><br><span class="line">labelone.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hi&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">inputone.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">  e.<span class="title function_">stopPropagation</span>();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="äº‹ä»¶-â€œæœ¬èº«â€-æŒ‡çš„æ˜¯-target-v-s-currentTarget-this">äº‹ä»¶ â€œæœ¬èº«â€ æŒ‡çš„æ˜¯ ? target v.s currentTarget (this)</h3><p>æˆ‘å€‘çŸ¥é“åœ¨ function ç•¶ä¸­æ˜¯å¯ä»¥ä½¿ç”¨ <code>this</code><br>é‚£é€™é‚Šçš„ <code>this</code> æ˜¯æŒ‡ä»€éº¼å‘¢ ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> labelone= <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;label&#x27;</span>);</span><br><span class="line"></span><br><span class="line">labelone.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">tagName</span>) <span class="comment">// LABEL</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p><code>this</code> ä»£è¡¨çš„æœƒæ˜¯ã€Œè§¸ç™¼äº‹ä»¶çš„<strong>ç›®æ¨™</strong>ã€å…ƒç´ <br>ä¹Ÿå°±æ˜¯ <code>event.currentTarget</code> è€Œä¸æ˜¯ <code>e.target</code>ã€‚</p></blockquote><p>é‚£ <code>e.target</code> æŒ‡çš„æ˜¯ ?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> labelone= <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;label&#x27;</span>);</span><br><span class="line">labelone.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">target</span>.<span class="property">tagName</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">tagName</span>, <span class="number">1</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">let</span> inputone= <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;input&#x27;</span>);</span><br><span class="line">inputone.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">target</span>.<span class="property">tagName</span>, <span class="number">2</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">tagName</span>, <span class="number">2</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>é»æ“Š label</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;LABEL&quot;</span> <span class="number">1</span> <span class="comment">// e.target</span></span><br><span class="line"><span class="string">&quot;LABEL&quot;</span> <span class="number">1</span> <span class="comment">// this</span></span><br><span class="line"><span class="string">&quot;INPUT&quot;</span> <span class="number">2</span> <span class="comment">// e.target</span></span><br><span class="line"><span class="string">&quot;INPUT&quot;</span> <span class="number">2</span> <span class="comment">// this</span></span><br><span class="line"><span class="string">&quot;INPUT&quot;</span> <span class="number">1</span> <span class="comment">// checkbox å†’æ³¡ä¸Šä¾†çš„è€Œè§¸ç™¼ labeloneï¼Œe.target</span></span><br><span class="line"><span class="string">&quot;LABEL&quot;</span> <span class="number">1</span> <span class="comment">// checkbox å†’æ³¡ä¸Šä¾†çš„è€Œè§¸ç™¼ labeloneï¼Œ this</span></span><br></pre></td></tr></table></figure><blockquote><p><code>e.target</code> å…¶å¯¦æ˜¯ã€Œè§¸ç™¼äº‹ä»¶çš„å…ƒç´ ã€</p></blockquote><p>å¦‚æœä¸è€ƒæ…®äº‹ä»¶å‚³éçš„æƒ…æ³ä¸‹ï¼Œ<code>this</code> å¯¦è³ªä¸Šå°±ç­‰åŒæ–¼ <code>e.target</code> äº†ã€‚</p><h2 id="äº‹ä»¶æŒ‡æ´¾-Event-Delegation">äº‹ä»¶æŒ‡æ´¾ (Event Delegation)</h2><p>ç”¨ JavaScript æ–°å¢çš„å…ƒç´ ä¸¦ä¸æœƒç¶åˆ°äº‹ä»¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> list = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.list&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> items = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.list-item&#x27;</span>);</span><br><span class="line"><span class="comment">// ä¸€å€‹å€‹æ‰‹å‹•åŠ å…¥</span></span><br><span class="line">items.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">item.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">target</span>.<span class="property">textContent</span>);</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> newItem = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;LI&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> txt = <span class="variable language_">document</span>.<span class="title function_">creatTextNode</span>(<span class="string">&#x27;new&#x27;</span>);</span><br><span class="line">newIten.<span class="title function_">appendChild</span>(txt)</span><br><span class="line">list.<span class="title function_">appendChild</span>(newItem)</span><br></pre></td></tr></table></figure><p><code>newItem</code> ä¸æœƒæœ‰ click äº‹ä»¶<br>ç‚ºé¿å…æ¯æ¬¡æ–°å¢è¦é‡æ–°ç¶å®šäº‹ä»¶ï¼Œåˆè¦ç§»é™¤ç›£è½ï¼Œé€ æˆ memory leak çš„åš´é‡å•é¡Œ<br><strong>äº‹ä»¶æŒ‡æ´¾</strong> æ˜¯æ¯”è¼ƒå¥½çš„åšæ³•ã€‚</p><p><strong>äº‹ä»¶ä»£ç†äºº</strong> é€éåˆ¤æ–· <strong>ç›®æ¨™ç¯€é»</strong>ï¼Œå†åŸ·è¡Œå‹•ä½œ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> list = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.list&#x27;</span>);</span><br><span class="line"><span class="comment">// list ç›´æ¥çœ‹åº•ä¸‹çš„å­å…ƒç´ </span></span><br><span class="line">list.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(e.<span class="property">target</span>.<span class="property">tagName</span>.<span class="title function_">toLowerCase</span>()===<span class="string">&#x27;li&#x27;</span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">target</span>.<span class="property">textContent</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> newItem = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;LI&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> txt = <span class="variable language_">document</span>.<span class="title function_">creatTextNode</span>(<span class="string">&#x27;new&#x27;</span>);</span><br><span class="line"></span><br><span class="line">newIten.<span class="title function_">appendChild</span>(txt)</span><br><span class="line">list.<span class="title function_">appendChild</span>(newItem)</span><br></pre></td></tr></table></figure><p>æ­æ‹‰ ! <code>newItem</code> å°±æœ‰é»æ“Šçš„æ•ˆæœ</p><h2 id="ç¸½çµ-23">ç¸½çµ</h2><p>äº‹ä»¶æ˜¯ JavaScript çš„åŸºæœ¬ï¼Œç•¶æˆ‘å€‘äº†è§£æ©Ÿåˆ¶çš„é‹ä½œ<br>é‡åˆ°å¥‡æ€ªçš„è§¸ç™¼å¤šæ¬¡æ™‚ï¼Œè¨˜å¾—æƒ³èµ·äº‹ä»¶çš„æµç¨‹</p><blockquote><p>å…ˆæ•ç²å†å†’æ³¡</p></blockquote><p>é‚„æœ‰ç›¸é—œçš„</p><ul><li>é˜»æ­¢é è¨­è¡Œç‚º <code>preventDefault</code></li><li>é˜»æ“‹å†’æ³¡è¡Œç‚º <code>stopPropagtion</code></li></ul><h2 id="åƒè€ƒ-12">åƒè€ƒ</h2><ol><li><a href="https://ithelp.ithome.com.tw/articles/10191970">é‡æ–°èªè­˜ JavaScript: Day 14 äº‹ä»¶æ©Ÿåˆ¶çš„åŸç†</a></li><li><a href="https://ithelp.ithome.com.tw/articles/10192015">é‡æ–°èªè­˜ JavaScript: Day 15 éš±è—åœ¨ â€œäº‹ä»¶â€ ä¹‹ä¸­çš„ç§˜å¯†</a></li><li><a href="https://blog.techbridge.cc/2017/07/15/javascript-event-propagation/">DOM çš„äº‹ä»¶å‚³éæ©Ÿåˆ¶ï¼šæ•ç²èˆ‡å†’æ³¡</a></li><li><a href="https://juejin.cn/post/6965682915141386254#heading-2">Chrome 89 æ›´æ–°äº‹ä»¶è§¦å‘é¡ºåºï¼Œå¯¼è‡´99%çš„æ–‡ç« éƒ½é”™äº†ï¼ˆåŒ…æ‹¬MDNï¼‰</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€-37&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;äº‹ä»¶æ˜¯ä»€éº¼ ? ç‚ºä»€éº¼è¦ç”¨äº‹ä»¶ä»£ç†å‘¢ ?&lt;br&gt;
åœ¨ä¸äº†è§£äº‹ä»¶çš„æµç¨‹èˆ‡é‹ä½œæ©Ÿåˆ¶ï¼Œæ˜¯ä¸æ˜¯é‡éé»ä¸€ä¸‹å…ƒç´ &lt;br&gt;
çµæœè·‘å‡ºå…©æ¬¡ä»¥ä¸Šçš„çµæœ&lt;br&gt;
é€éæœ¬ç¯‡å¹«è‡ªå·±é‡æ¸…äº‹ä»¶å„ç¨®å¤§å°äº‹&lt;/p&gt;</summary>
    
    
    
    <category term="2022" scheme="https://blog.rosa.tw/categories/2022/"/>
    
    <category term="04" scheme="https://blog.rosa.tw/categories/2022/04/"/>
    
    
    <category term="JavaScript" scheme="https://blog.rosa.tw/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>CSSZeroToOneSeries  | 10 | ç ´æ ¼å¼è¨­è¨ˆ</title>
    <link href="https://blog.rosa.tw/2022/04/04/CSSSeriesZeroToOne-10"/>
    <id>https://blog.rosa.tw/2022/04/04/CSSSeriesZeroToOne-10</id>
    <published>2022-04-10T04:36:53.000Z</published>
    <updated>2022-07-27T05:30:49.731Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æœ¬ç¯‡æˆæœ-20">æœ¬ç¯‡æˆæœ</h2><p><a href="https://codepen.io/shan473/pen/QWOZgzP">Codepen</a><br><img data-src="https://dsm01pap006files.storage.live.com/y4mc1SNrsZu-Jd9u35WNRJfQgL79lh5rKUE-T708KZoUgmfj1e0iFbqwtXItGPmNayXFew5OcaISpno8uR1h5a0KOuWpfs9NvwytLMedU4ijzl-h2mJT3AKapQU7kA5rNBSPp_QOV-6viFwczOvlSgU65TDbCQlby6ccQSZ4Rvcith2HND8fQOqhBUHkD3FrJAo?width=1024&amp;height=586&amp;cropmode=none" alt="ç ´æ ¼å¼è¨­è¨ˆ"></p><span id="more"></span><h3 id="margin-å€¼çš„æ•¸é‡">margin å€¼çš„æ•¸é‡</h3><ul><li>å…©å€‹æ•¸å€¼<br>margin : &lt;ä¸Šä¸‹&gt;  &lt;å·¦å³&gt;</li><li>å››å€‹æ•¸å€¼<br>margin : &lt;ä¸Š&gt; &lt;å³&gt; &lt;ä¸‹&gt; &lt;å·¦&gt;</li><li>ä¸‰å€‹æ•¸å€¼<br>margin : &lt;ä¸Š&gt; &lt;å·¦å³&gt; &lt;ä¸‹&gt;</li></ul><p>æ¯”è¼ƒå¸¸ç”¨åˆ°ç½®ä¸­ <code>margin : 0 auto</code>ï¼Œauto æ˜¯æŠŠå‰©é¤˜çš„ç©ºé–“åˆ†é…çµ¦å·¦å³ï¼Œå› æ­¤æ‰æœƒç½®ä¸­ã€‚<br>å¯¦éš›ä¸Š margin : auto ï¼Œé›–ç„¶æ˜¯å¯«å…¨éƒ¨è‡ªå‹•åˆ†é…ï¼Œä½†æ˜¯ <a href="https://www.zhihu.com/question/21644198">ä¸Šä¸‹ä¸¦æ²’æœ‰ä½œç”¨</a>ã€‚</p><p>css çš„é è¨­ <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/writing-mode">write-mode (æ›¸å¯«æ¨¡å¼)</a> çš„æ–¹å‘æ˜¯ <strong>æ°´å¹³</strong> çš„ï¼Œç•¶æˆ‘å€‘ç”¨ margin-top : auto æˆ– margin-bottom : auto ï¼Œå› ç‚ºé«˜åº¦ä¸¦ç„¡å›ºå®šå€¼ï¼Œç„¡æ³•åƒç…§ï¼Œå‰©é¤˜ç©ºé–“ä¹Ÿæ˜¯ 0 ã€‚</p><h3 id="line-height-å–®è¡Œå‚ç›´å±…ä¸­">line-height å–®è¡Œå‚ç›´å±…ä¸­</h3><p>å¦‚æœæ˜¯æ–‡å­—å–®è¡Œå±…ä¸­å®¹å™¨ï¼Œå¯ä»¥æŠŠ <code>line-height</code> è¨­å®šè·Ÿå®¹å™¨é«˜ä¸€æ¨£</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line"><span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line"><span class="attribute">line-height</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="border-å€å¡Šä½ç½®è¨ˆç®—-è¦è¨˜å¾—æ‰£æ‰">border å€å¡Šä½ç½®è¨ˆç®— : è¦è¨˜å¾—æ‰£æ‰</h3><p>å¯¦ä½œæ˜¯ icon çš„åˆ©ç”¨ <code>:before</code> çš„ border åšåœ“æ¡†ï¼Œç²—åº¦æ˜¯ 10 pxã€‚<br><code>top : 0ã€left : 0</code>ï¼ŒæŠŠç‰ˆé¢å®šä½åˆ°çˆ¶å±¤èµ·å§‹å·¦ä¸Šè§’ä¸€æ¨£ï¼Œæ­¤æ™‚ border ç²—åº¦ä¸Šä¸‹å·¦å³éƒ½æœƒå¢é•· 10pxï¼Œå¦‚æœè¦ç½®ä¸­ï¼Œå¿…é ˆæŠŠ border å¤šå‡ºä¾†çš„åœ¨ topã€left æ‰£æ‰ï¼Œå…ƒç´ æ‰èƒ½æ“ºåˆ°ä¸­é–“å¡«æ»¿ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.icon</span><span class="selector-pseudo">:before</span>&#123;</span><br><span class="line"><span class="attribute">position</span> : absolute;</span><br><span class="line"><span class="attribute">border</span>: <span class="number">10px</span> solid red;</span><br><span class="line"><span class="attribute">top</span>: -<span class="number">10px</span>;</span><br><span class="line"><span class="attribute">left</span>: -<span class="number">10px</span>;</span><br><span class="line"><span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line"><span class="attribute">width</span> : <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="border-ä¸Šä¸‹å·¦å³çš„å‘ˆç¾æ–¹å¼">border ä¸Šä¸‹å·¦å³çš„å‘ˆç¾æ–¹å¼</h3><p>ä»¥åŠåœ“æ¡†ç‚ºä¾‹ï¼Œæˆ‘å€‘çŸ¥é“ border çš„åˆ‡é½Šé»æ˜¯å°è§’ç·š (ä¸‹åœ–)ï¼Œè®Šæˆåœ“å½¢çš„è©±ï¼Œä¸Šä¸‹å·¦å³ä¸¦ä¸æ˜¯å‰›å¥½å¾ 0 åˆ‡é½Šåˆ° 90 åº¦<br>å¦‚æœæƒ³è¦å¾—åˆ°åŠåœ“ï¼Œå¿…é ˆæ˜¯é„°è¿‘å…©å€‹ border å†åšæ—‹è½‰ 45 åº¦ã€‚</p><ul><li>widthã€height ç‚º 0 ï¼Œå–®ç´”çš„ border</li></ul><p><img data-src="https://dsm01pap006files.storage.live.com/y4mVu7eeg2awMupFoD5T_nq55dVmzodISxqWR8paqvV46NhzCf4-VPLWZ0Xlm_JLUFsOCEGTcqVb6SoH4icdXFX9V3ZLR39nFB5YYYyNr-ENP529_4MNud_lE-ksXUdUOblMf7y8cah3KcaOjNIgJr_9l8o-fXeE4FZotOCa1CSDMl5pHcz4tP-0UtZeuurM5DG?width=496&amp;height=488&amp;cropmode=none" alt="ç´” border åœ“å½¢"></p><blockquote><p>æ­£ç¢ºçš„åŠåœ“æ˜¯ç›¸é„°å…©é‚Šçš„ border çµ„åˆå‡ºä¾†çš„<br>åƒæ˜¯ <a href="../CSSSeriesZeroToOne-03/#%E8%A3%9C%E5%85%85-%E4%B8%89%E8%A7%92%E5%BD%A2%E7%9A%84%E9%99%B0%E5%BD%B1">03 ç¯‡</a>èƒ½å‡ºç¾é™°å½±çš„ä¸‰è§’å½¢ä¸€æ¨£çš„æ¦‚å¿µ</p></blockquote><h3 id="å­å±¤ç‰©ä»¶æ•´é«”é«˜åº¦è¶…å‡ºçˆ¶å±¤-padding-æ“ å›å»">å­å±¤ç‰©ä»¶æ•´é«”é«˜åº¦è¶…å‡ºçˆ¶å±¤ : padding æ“ å›å»</h3><p>å› ç‚º icon margin-top æ˜¯ -75 pxï¼Œæ¯”åŸæœ¬çˆ¶å±¤å‡¸å‡º 75 px ï¼Œå¿…é ˆåœ¨æ•´é«”çš„ padding æŠŠå¤šçš„è£œå›å»ï¼ŒæŠŠå­å®¹å™¨çš„å…ƒç´ éƒ½åŒ…å«åœ¨å…§ã€‚</p><h2 id="åƒè€ƒ-9">åƒè€ƒ</h2><ol><li><a href="https://www.zhihu.com/question/21644198">ä¸ºä»€ä¹ˆã€Œmargin:autoã€å¯ä»¥è®©å—çº§å…ƒç´ æ°´å¹³å±…ä¸­ï¼Ÿ</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æœ¬ç¯‡æˆæœ-20&quot;&gt;æœ¬ç¯‡æˆæœ&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://codepen.io/shan473/pen/QWOZgzP&quot;&gt;Codepen&lt;/a&gt;&lt;br&gt;
&lt;img src=&quot;https://dsm01pap006files.storage.live.com/y4mc1SNrsZu-Jd9u35WNRJfQgL79lh5rKUE-T708KZoUgmfj1e0iFbqwtXItGPmNayXFew5OcaISpno8uR1h5a0KOuWpfs9NvwytLMedU4ijzl-h2mJT3AKapQU7kA5rNBSPp_QOV-6viFwczOvlSgU65TDbCQlby6ccQSZ4Rvcith2HND8fQOqhBUHkD3FrJAo?width=1024&amp;amp;height=586&amp;amp;cropmode=none&quot; alt=&quot;ç ´æ ¼å¼è¨­è¨ˆ&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="2022" scheme="https://blog.rosa.tw/categories/2022/"/>
    
    <category term="04" scheme="https://blog.rosa.tw/categories/2022/04/"/>
    
    
    <category term="CSS" scheme="https://blog.rosa.tw/tags/CSS/"/>
    
    <category term="CSSZeroToOneSeries" scheme="https://blog.rosa.tw/tags/CSSZeroToOneSeries/"/>
    
  </entry>
  
  <entry>
    <title>CSSZeroToOneSeries | 09 | æ–¹å¡Šé…¥ç‰ˆ</title>
    <link href="https://blog.rosa.tw/2022/04/04/CSSSeriesZeroToOne-09"/>
    <id>https://blog.rosa.tw/2022/04/04/CSSSeriesZeroToOne-09</id>
    <published>2022-04-10T04:36:49.000Z</published>
    <updated>2022-07-27T05:30:49.731Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æœ¬ç¯‡æˆæœ-19">æœ¬ç¯‡æˆæœ</h2><p><a href="https://codepen.io/shan473/pen/wvPYowG?editors=0100">Codepen</a><br><img data-src="https://dsm01pap006files.storage.live.com/y4mRHJR5nKjd7Mry0fH-Eevw_EuUBALAe_xSDwFAsLc-jhOf9MVukfDscCyR0aOVgn_lXXMo0TTA9P005lZ17bfeeA1u1cH1pUKDVEDHN8e9zgJptSKT1iav8eWY0i6YhYCS8uM0UuTvFQpSWlDK4sLzuIjHGVDA8aLixITKrKveAHX73wjxjTY1VgK64Xx19fM?width=1024&amp;height=585&amp;cropmode=none" alt="æ–¹å¡Šé…¥ç‰ˆ"></p><span id="more"></span><h3 id="float-2">float</h3><p>å­å±¤è¨­å®š float çš„æ™‚å€™ï¼Œæœƒè„«é›¢åŸæœ¬çš„æ’ç‰ˆåºï¼Œæœƒå°è‡´çˆ¶å±¤çš„é«˜åº¦éŒ¯èª¤æˆ–æŠ“ä¸åˆ°ï¼Œå°±è¦æ¸…é™¤æµ®å‹• (clearfix)ï¼Œä»¥å…å¾Œé¢çš„å…ƒç´ ä¸ç…§é †åºæ“ ä¸Šä¾†ã€‚</p><h4 id="æ¸…é™¤æµ®å‹•-overflow">æ¸…é™¤æµ®å‹• : overflow</h4><blockquote><p>çˆ¶å±¤æ¶ˆé™¤ float</p></blockquote><p>çˆ¶å±¤ <code>overflow:hidden</code> ï¼Œè®“çˆ¶å±¤å¯ä»¥æŠ“åˆ°å­å±¤çš„é«˜åº¦ã€‚<br>overflow æ˜¯è™•ç†å¤šé¤˜çš„å…§å®¹ï¼Œhidden éš±è—èµ·ä¾†</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>å·¦é‚Š<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>å³é‚Š<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>æˆ‘è¦åœ¨ä¸‹é¢<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>:<span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">overflow</span>:hidden;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fa0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.left</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>:<span class="number">80%</span>;</span><br><span class="line">  <span class="attribute">float</span><span class="selector-pseudo">:left</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.right</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>:<span class="number">20%</span>;</span><br><span class="line">  <span class="attribute">float</span><span class="selector-pseudo">:right</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ¸…é™¤æµ®å‹•-å¤šä¸€å€‹-clearfix-å…ƒç´ ">æ¸…é™¤æµ®å‹• : å¤šä¸€å€‹ clearfix å…ƒç´ </h4><blockquote><p>é‡é»åœ¨æ–¼å­å…ƒç´ ï¼Œå¦‚æœä¸‹ä¸€å€‹æƒ³è¦æŒ‰ç…§è‡ªå·±çš„æµå‘æ’ï¼Œå¯ä»¥åœ¨å‰é¢åŠ ä¸Š <code>clearfix</code> æ–¬æ–· float çš„æ’ç‰ˆ</p></blockquote><p>åœ¨æƒ³è¦æ­£å¸¸æ’ç‰ˆåœ¨å­å…ƒç´ å±è‚¡å¾Œé¢ï¼Œè¨­å®š <code>clear : both</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span>float å·¦é‚Š<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span>float å³é‚Š<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;clearfix&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>æŒ‰ç…§è€æ–¹æ³•å¾€ä¸‹æ’<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.left</span>&#123;</span><br><span class="line"> <span class="attribute">float</span>: left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.right</span>&#123;</span><br><span class="line"> <span class="attribute">float</span>: right;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.clearfix</span>&#123;</span><br><span class="line"><span class="attribute">clear</span>: both;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŒ‰ä¸‹é–‹é—œå¯ä»¥çœ‹æœ‰ç„¡ float çš„æ•ˆæœ</p><iframe height="300" style="width: 100%;" scrolling="no" title="float clearfix" src="https://codepen.io/shan473/embed/NWwObjj?default-tab=result&theme-id=dark" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen="true">  See the Pen <a href="https://codepen.io/shan473/pen/NWwObjj">  float clearfix</a> by YanShanHong (<a href="https://codepen.io/shan473">@shan473</a>)  on <a href="https://codepen.io">CodePen</a>.</iframe><h4 id="æ¸…é™¤æµ®å‹•-çˆ¶å±¤-after">æ¸…é™¤æµ®å‹• : çˆ¶å±¤ :after</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>å·¦é‚Š<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>å³é‚Š<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>æˆ‘è¦åœ¨ä¸‹é¢<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>:<span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">overflow</span>:hidden;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fa0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span> &gt;<span class="selector-tag">div</span>&#123;</span><br><span class="line"><span class="attribute">float</span>: left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:after</span>&#123;</span><br><span class="line"><span class="attribute">content</span> :<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="attribute">display</span>:block;</span><br><span class="line"><span class="attribute">clear</span>:both;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å½å…ƒç´ ä¸€å®šè¦è¨­å®š <code>block</code>ï¼Œè®“å¯¬åº¦æ’é–‹</p></blockquote><h3 id="æ³¢æµªè™Ÿé¸æ“‡å™¨">~ æ³¢æµªè™Ÿé¸æ“‡å™¨</h3><p>æ³¢æµªè™Ÿæ˜¯å…„å¼Ÿé¸æ“‡å™¨ï¼Œåœ¨åŒä¸€å±¤çš„å¾Œé¢å…„å¼Ÿéƒ½é¸èµ·ä¾†</p><p>å¸¸ç”¨ <strong>ç¬¬ä¸€å€‹  ~  åˆ°åº•çš„å…ƒç´ </strong> éƒ½é¸èµ·ä¾†ï¼Œ<a href="../CSSSeriesZeroToOne-08.md">08 ç¯‡</a> çš„éºµåŒ…å±‘é™¤äº† <code>(p + p)</code>ï¼Œæ³¢æµªè™Ÿä¹Ÿå¯ä»¥ä½¿ç”¨</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>no.1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>no.2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>no.3<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>no.4<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">:first</span>-child ~<span class="selector-tag">p</span>&#123;</span><br><span class="line"><span class="attribute">color</span>:red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦ä¸€ç¨®æ˜¯æƒ³é¸åˆ°åŒä¸€å±¤çš„æŸå€‹æ±è¥¿(å€‘)ï¼Œé™¤äº†ç›´æ¥é¸å–å¤–ï¼Œä¹Ÿå¯ä»¥é€é æ³¢æµªè™Ÿ</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>æˆ‘æ˜¯ä¸€æ®µæ–‡å­—<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>æˆ‘æ˜¯ span<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>æˆ‘æ˜¯ span<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span>&gt;</span>æˆ‘æ˜¯é€£çµ<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span>&gt;</span>æˆ‘æ˜¯é€£çµ<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>æˆ‘æ˜¯ span<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span>~<span class="selector-tag">a</span>&#123;</span><br><span class="line"><span class="attribute">color</span>:red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="not-æ’æ“ ä½ ">:not : æ’æ“ ä½ </h3><p>å±¬æ–¼é€†å‘æ€è€ƒï¼Œå¦‚æœè¦é¸å–é™¤äº†ç¬¬ä¸€å€‹ä»¥å¤–çš„å…¶ä»–æ–¹æ¡†ï¼Œé™¤äº†ç”¨æ³¢æµªè™Ÿ</p><ul><li>ä¸€èˆ¬æ³¢æµªè™Ÿæ’æ“ </li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>æ³¢æµªè™Ÿå¼æ’æ“ <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>ä¸€è™Ÿèµ°é–‹<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>ä¸€è™Ÿèµ°é–‹<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>ä¸€è™Ÿèµ°é–‹<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span>~<span class="selector-tag">p</span>&#123;</span><br><span class="line"><span class="attribute">color</span>:red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>:not</code> : æ’æ“ ï¼Œéº»ç“œç¿»è­¯æ©Ÿï¼Œè¦é¸åˆ° <strong>éç¬¬ä¸€å€‹çš„ p</strong></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:first</span>-child)&#123;</span><br><span class="line"><span class="attribute">color</span>:red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è©¦è‘—ç”¨-Grid">è©¦è‘—ç”¨ Grid</h2><p>åŒæ¨£çš„æ¶æ§‹ï¼ŒæŠŠ float å»é™¤ï¼Œåˆ©ç”¨è»Œé“ç·šé€²è¡Œæ’ç‰ˆã€‚<br><a href="https://codepen.io/shan473/pen/ZEvRByL?editors=0100">Codepen</a></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.wrapper</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">display</span>:grid;</span><br><span class="line">  <span class="attribute">grid-template</span>: <span class="built_in">repeat</span>(<span class="number">3</span>,<span class="number">1</span>fr) / <span class="built_in">repeat</span>(<span class="number">4</span>,<span class="number">1</span>fr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item</span><span class="selector-pseudo">:first</span>-child&#123;</span><br><span class="line">  <span class="attribute">grid-area</span>: <span class="number">1</span> / <span class="number">1</span> / <span class="number">3</span> / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åƒè€ƒ-8">åƒè€ƒ</h2><ol><li><a href="https://medium.com/ui-ux%E7%B7%B4%E5%8A%9F%E5%9D%8A/%E8%A7%A3%E9%99%A4-float-%E5%B1%AC%E6%80%A7%E7%9A%84%E6%96%B9%E6%B3%95-5e29cc30777d">è§£é™¤ float å±¬æ€§çš„æ–¹æ³•. ä½¿ç”¨ float å±¬æ€§ä¸€å®šè¦æ¸…é™¤æµ®å‹•ï¼Œå¦å‰‡æœƒæœ‰ç‰ˆé¢éŒ¯ç½®æˆ–å¤±å»é«˜åº¦çš„æƒ…æ³</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;æœ¬ç¯‡æˆæœ-19&quot;&gt;æœ¬ç¯‡æˆæœ&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://codepen.io/shan473/pen/wvPYowG?editors=0100&quot;&gt;Codepen&lt;/a&gt;&lt;br&gt;
&lt;img src=&quot;https://dsm01pap006files.storage.live.com/y4mRHJR5nKjd7Mry0fH-Eevw_EuUBALAe_xSDwFAsLc-jhOf9MVukfDscCyR0aOVgn_lXXMo0TTA9P005lZ17bfeeA1u1cH1pUKDVEDHN8e9zgJptSKT1iav8eWY0i6YhYCS8uM0UuTvFQpSWlDK4sLzuIjHGVDA8aLixITKrKveAHX73wjxjTY1VgK64Xx19fM?width=1024&amp;amp;height=585&amp;amp;cropmode=none&quot; alt=&quot;æ–¹å¡Šé…¥ç‰ˆ&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="2022" scheme="https://blog.rosa.tw/categories/2022/"/>
    
    <category term="04" scheme="https://blog.rosa.tw/categories/2022/04/"/>
    
    
    <category term="CSS" scheme="https://blog.rosa.tw/tags/CSS/"/>
    
    <category term="CSSZeroToOneSeries" scheme="https://blog.rosa.tw/tags/CSSZeroToOneSeries/"/>
    
  </entry>
  
</feed>
